/*! Copyright (c) Microsoft Open Technologies, Inc.  All Rights Reserved. Licensed under the Apache License, Version 2.0. See https://github.com/winjs/winjs/blob/master/License.txt for license information. */
!function(n){!function(t){"function"==typeof define&&define.amd?define([],t):(n.msWriteProfilerMark&&msWriteProfilerMark("WinJS.3.1 3.0.0.winjs.2014.10.1 WinJS.js,StartTM"),t(n.WinJS),n.msWriteProfilerMark&&msWriteProfilerMark("WinJS.3.1 3.0.0.winjs.2014.10.1 WinJS.js,StopTM"))}(function(){var i,t,r;!function(){"use strict";function u(n,t){var i=n.split("/");return i.pop(),t.map(function(n){if("."===n[0]){var r=n.split("/"),t=i.slice(0);return r.forEach(function(n){".."===n?t.pop():"."!==n&&t.push(n)}),t.join("/")}return n})}function f(t,u){return t.map(function(t){if("exports"===t)return u;if("require"===t)return i;var f=r[t];if(!f)throw new Error("Undefined dependency: "+t);return f.resolved||(f.resolved=n(f.dependencies,f.factory,f.exports),f.exports&&(f.resolved=f.exports)),f.resolved})}function n(n,t,i){var r=f(n,i);return t&&t.apply?t.apply(null,r):t}var r={};t=function(n,t,i){Array.isArray(t)||(i=t,t=[]);var f={dependencies:u(n,t),factory:i};-1!==t.indexOf("exports")&&(f.exports={});r[n]=f};i=function(t,i){Array.isArray(t)||(t=[t]);n(t,i)}}();t("amd",function(){});t("WinJS/Core/_WinJS",{}),function(n){"use strict";t("WinJS/Core/_Global",n)}(this);t("WinJS/Core/_BaseCoreUtils",["./_Global"],function(n){"use strict";function t(n){return n.supportedForProcessing=!0,n}var i=!!n.Windows;return{hasWinRT:i,markSupportedForProcessing:t,_setImmediate:n.setImmediate?n.setImmediate.bind(n):function(t){n.setTimeout(t,0)}}});t("WinJS/Core/_WriteProfilerMark",["./_Global"],function(n){"use strict";return n.msWriteProfilerMark||function(){}});t("WinJS/Core/_Base",["./_WinJS","./_Global","./_BaseCoreUtils","./_WriteProfilerMark"],function(n,t,i,r){"use strict";function u(n,t,i){for(var u,h=Object.keys(t),c=Array.isArray(n),e=0,s=h.length;s>e;e++){var f=h[e],o=95!==f.charCodeAt(0),r=t[f];!r||"object"!=typeof r||void 0===r.value&&"function"!=typeof r.get&&"function"!=typeof r.set?o?c?n.forEach(function(n){n[f]=r}):n[f]=r:(u=u||{},u[f]={value:r,enumerable:o,configurable:!0,writable:!0}):(void 0===r.enumerable&&(r.enumerable=o),i&&r.setName&&"function"==typeof r.setName&&r.setName(i+"."+f),u=u||{},u[f]=r)}u&&(c?n.forEach(function(n){Object.defineProperties(n,u)}):Object.defineProperties(n,u))}return function(){function e(i,r){var u=i||{},f,e,s,o;if(r)for(f=r.split("."),u===t&&"WinJS"===f[0]&&(u=n,f.splice(0,1)),e=0,s=f.length;s>e;e++)o=f[e],u[o]||Object.defineProperty(u,o,{value:{},writable:!1,enumerable:!0,configurable:!0}),u=u[o];return u}function o(n,t,i){var r=e(n,t);return i&&u(r,i,t||"<ANONYMOUS>"),r}function s(n,i){return o(t,n,i)}function h(n){var f,u,t=i.uninitialized;return{setName:function(n){f=n},get:function(){switch(t){case i.initialized:return u;case i.uninitialized:t=i.working;try{r("WinJS.Namespace._lazy:"+f+",StartTM");u=n()}finally{r("WinJS.Namespace._lazy:"+f+",StopTM");t=i.uninitialized}return n=null,t=i.initialized,u;case i.working:throw"Illegal: reentrancy on initialization";default:throw"Illegal";}},set:function(n){switch(t){case i.working:throw"Illegal: reentrancy on initialization";default:t=i.initialized;u=n}},enumerable:!0,configurable:!0}}function c(n,i,r){var o=[n],f=null;return i&&(f=e(t,i),o.push(f)),u(o,r,i||"<ANONYMOUS>"),f}var f=n,i;f.Namespace||(f.Namespace=Object.create(Object.prototype));i={uninitialized:1,working:2,initialized:3};Object.defineProperties(f.Namespace,{defineWithParent:{value:o,writable:!0,enumerable:!0,configurable:!0},define:{value:s,writable:!0,enumerable:!0,configurable:!0},_lazy:{value:h,writable:!0,enumerable:!0,configurable:!0},_moduleDefine:{value:c,writable:!0,enumerable:!0,configurable:!0}})}(),function(){function t(n,t,r){return n=n||function(){},i.markSupportedForProcessing(n),t&&u(n.prototype,t),r&&u(n,r),n}function r(n,r,f,e){if(n){r=r||function(){};var o=n.prototype;return r.prototype=Object.create(o),i.markSupportedForProcessing(r),Object.defineProperty(r.prototype,"constructor",{value:r,writable:!0,configurable:!0,enumerable:!0}),f&&u(r.prototype,f),e&&u(r,e),r}return t(r,f,e)}function f(n){n=n||function(){};for(var t=1,i=arguments.length;i>t;t++)u(n.prototype,arguments[t]);return n}n.Namespace.define("WinJS.Class",{define:t,derive:r,mix:f})}(),{Namespace:n.Namespace,Class:n.Class}});t("WinJS/Core/_ErrorFromName",["./_Base"],function(n){"use strict";var t=n.Class.derive(Error,function(n,t){this.name=n;this.message=t||n},{},{supportedForProcessing:!1});return n.Namespace.define("WinJS",{ErrorFromName:t}),t});t("WinJS/Core/_WinRT",["exports","./_Global","./_Base"],function(n,t,i){"use strict";n.msGetWeakWinRTProperty=t.msGetWeakWinRTProperty;n.msSetWeakWinRTProperty=t.msSetWeakWinRTProperty;["Windows.ApplicationModel.DesignMode.designModeEnabled","Windows.ApplicationModel.Resources.Core.ResourceContext","Windows.ApplicationModel.Resources.Core.ResourceManager","Windows.ApplicationModel.Search.Core.SearchSuggestionManager","Windows.ApplicationModel.Search.SearchQueryLinguisticDetails","Windows.Data.Text.SemanticTextQuery","Windows.Foundation.Collections.CollectionChange","Windows.Foundation.Uri","Windows.Globalization.ApplicationLanguages","Windows.Globalization.Calendar","Windows.Globalization.DateTimeFormatting","Windows.Globalization.Language","Windows.Phone.UI.Input.HardwareButtons","Windows.Storage.ApplicationData","Windows.Storage.CreationCollisionOption","Windows.Storage.BulkAccess.FileInformationFactory","Windows.Storage.FileIO","Windows.Storage.FileProperties.ThumbnailType","Windows.Storage.FileProperties.ThumbnailMode","Windows.Storage.FileProperties.ThumbnailOptions","Windows.Storage.KnownFolders","Windows.Storage.Search.FolderDepth","Windows.Storage.Search.IndexerOption","Windows.Storage.Streams.RandomAccessStreamReference","Windows.UI.ApplicationSettings.SettingsEdgeLocation","Windows.UI.ApplicationSettings.SettingsCommand","Windows.UI.ApplicationSettings.SettingsPane","Windows.UI.Core.AnimationMetrics","Windows.UI.Input.EdgeGesture","Windows.UI.Input.EdgeGestureKind","Windows.UI.Input.PointerPoint","Windows.UI.ViewManagement.HandPreference","Windows.UI.ViewManagement.InputPane","Windows.UI.ViewManagement.UISettings","Windows.UI.WebUI.Core.WebUICommandBar","Windows.UI.WebUI.Core.WebUICommandBarBitmapIcon","Windows.UI.WebUI.Core.WebUICommandBarClosedDisplayMode","Windows.UI.WebUI.Core.WebUICommandBarIconButton","Windows.UI.WebUI.Core.WebUICommandBarSymbolIcon","Windows.UI.WebUI.WebUIApplication"].forEach(function(r){var u=r.split("."),f={};f[u[u.length-1]]={get:function(){return u.reduce(function(n,t){return n?n[t]:null},t)}};i.Namespace.defineWithParent(n,u.slice(0,-1).join("."),f)})});t("WinJS/Core/_Events",["exports","./_Base"],function(n,t){"use strict";function i(n){var t="_on"+n+"state";return{get:function(){var n=this[t];return n&&n.userHandler},set:function(i){var r=this[t];i?(r||(r={wrapper:function(n){return r.userHandler(n)},userHandler:i},Object.defineProperty(this,t,{value:r,enumerable:!1,writable:!0,configurable:!0}),this.addEventListener(n,r.wrapper,!1)),r.userHandler=i):r&&(this.removeEventListener(n,r.wrapper,!1),this[t]=null)},enumerable:!0}}function r(){for(var t,r={},n=0,u=arguments.length;u>n;n++)t=arguments[n],r["on"+t]=i(t);return r}var u=t.Class.define(function(n,t,i){this.detail=t;this.target=i;this.timeStamp=Date.now();this.type=n},{bubbles:{value:!1,writable:!1},cancelable:{value:!1,writable:!1},currentTarget:{get:function(){return this.target}},defaultPrevented:{get:function(){return this._preventDefaultCalled}},trusted:{value:!1,writable:!1},eventPhase:{value:0,writable:!1},target:null,timeStamp:null,type:null,preventDefault:function(){this._preventDefaultCalled=!0},stopImmediatePropagation:function(){this._stopImmediatePropagationCalled=!0},stopPropagation:function(){}},{supportedForProcessing:!1}),f={_listeners:null,addEventListener:function(n,t,i){var f;i=i||!1;this._listeners=this._listeners||{};for(var r=this._listeners[n]=this._listeners[n]||[],u=0,e=r.length;e>u;u++)if(f=r[u],f.useCapture===i&&f.listener===t)return;r.push({listener:t,useCapture:i})},dispatchEvent:function(n,t){var i=this._listeners&&this._listeners[n],r,f,e;if(i){for(r=new u(n,t,this),i=i.slice(0,i.length),f=0,e=i.length;e>f&&!r._stopImmediatePropagationCalled;f++)i[f].listener(r);return r.defaultPrevented||!1}return!1},removeEventListener:function(n,t,i){var r,u,e,f;if(i=i||!1,r=this._listeners&&this._listeners[n],r)for(u=0,e=r.length;e>u;u++)if(f=r[u],f.listener===t&&f.useCapture===i){r.splice(u,1);0===r.length&&delete this._listeners[n];break}}};t.Namespace._moduleDefine(n,"WinJS.Utilities",{_createEventProperty:i,createEventProperties:r,eventMixin:f})});t("require-json",{load:function(n){throw new Error("Dynamic load not allowed: "+n);}});t("require-json!en-US/ui.resjson",{appBarAriaLabel:"App Bar",appBarCommandAriaLabel:"App Bar Item",autoSuggestBoxAriaLabel:"Autosuggestbox",autoSuggestBoxAriaLabelInputNoPlaceHolder:"Autosuggestbox, enter to submit query, esc to clear text",autoSuggestBoxAriaLabelInputPlaceHolder:"Autosuggestbox, {0}, enter to submit query, esc to clear text",autoSuggestBoxAriaLabelQuery:"Suggestion: {0}","_autoSuggestBoxAriaLabelQuery.comment":"Suggestion: query text (example: Suggestion: contoso)",autoSuggestBoxAriaLabelSeparator:"Separator: {0}","_autoSuggestBoxAriaLabelSeparator.comment":"Separator: separator text (example: Separator: People or Separator: Apps)",autoSuggestBoxAriaLabelResult:"Result: {0}, {1}","_autoSuggestBoxAriaLabelResult.comment":"Result: text, detailed text (example: Result: contoso, www.contoso.com)",averageRating:"Average Rating",backbuttonarialabel:"Back",clearYourRating:"Clear your rating",closeOverlay:"Close",datePicker:"Date Picker",flipViewPanningContainerAriaLabel:"Scrolling Container",flyoutAriaLabel:"Flyout",hubViewportAriaLabel:"Scrolling Container",listViewViewportAriaLabel:"Scrolling Container",menuCommandAriaLabel:"Menu Item",menuAriaLabel:"Menu",navBarContainerViewportAriaLabel:"Scrolling Container",off:"Off",on:"On",pivotAriaLabel:"Pivot",pivotViewportAriaLabel:"Scrolling Container",searchBoxAriaLabel:"Searchbox",searchBoxAriaLabelInputNoPlaceHolder:"Searchbox, enter to submit query, esc to clear text",searchBoxAriaLabelInputPlaceHolder:"Searchbox, {0}, enter to submit query, esc to clear text",searchBoxAriaLabelButton:"Click to submit query",selectAMPM:"Select A.M P.M",selectDay:"Select Day",selectHour:"Select Hour",selectMinute:"Select Minute",selectMonth:"Select Month",selectYear:"Select Year",settingsFlyoutAriaLabel:"Settings Flyout",tentativeRating:"Tentative Rating",timePicker:"Time Picker",toolbarAriaLabel:"Toolbar",toolbarOverflowButtonAriaLabel:"View more",unrated:"Unrated",userRating:"User Rating","appBarIcons\\previous":"","_appBarIcons\\previous.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\next":"","_appBarIcons\\next.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\play":"","_appBarIcons\\play.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pause":"","_appBarIcons\\pause.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\edit":"","_appBarIcons\\edit.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\save":"","_appBarIcons\\save.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clear":"","_appBarIcons\\clear.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\delete":"","_appBarIcons\\delete.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\remove":"","_appBarIcons\\remove.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\add":"","_appBarIcons\\add.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cancel":"","_appBarIcons\\cancel.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\accept":"","_appBarIcons\\accept.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\more":"","_appBarIcons\\more.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\redo":"","_appBarIcons\\redo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\undo":"","_appBarIcons\\undo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\home":"","_appBarIcons\\home.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\up":"","_appBarIcons\\up.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\forward":"","_appBarIcons\\forward.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\right":"","_appBarIcons\\right.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\back":"","_appBarIcons\\back.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\left":"","_appBarIcons\\left.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\favorite":"","_appBarIcons\\favorite.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\camera":"","_appBarIcons\\camera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\settings":"","_appBarIcons\\settings.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\video":"","_appBarIcons\\video.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\sync":"","_appBarIcons\\sync.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\download":"","_appBarIcons\\download.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mail":"","_appBarIcons\\mail.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\find":"","_appBarIcons\\find.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\help":"","_appBarIcons\\help.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\upload":"","_appBarIcons\\upload.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\emoji":"","_appBarIcons\\emoji.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\twopage":"","_appBarIcons\\twopage.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\leavechat":"","_appBarIcons\\leavechat.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailforward":"","_appBarIcons\\mailforward.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clock":"","_appBarIcons\\clock.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\send":"","_appBarIcons\\send.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\crop":"","_appBarIcons\\crop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rotatecamera":"","_appBarIcons\\rotatecamera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\people":"","_appBarIcons\\people.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\closepane":"","_appBarIcons\\closepane.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openpane":"","_appBarIcons\\openpane.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\world":"","_appBarIcons\\world.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\flag":"","_appBarIcons\\flag.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\previewlink":"","_appBarIcons\\previewlink.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\globe":"","_appBarIcons\\globe.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\trim":"","_appBarIcons\\trim.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\attachcamera":"","_appBarIcons\\attachcamera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoomin":"","_appBarIcons\\zoomin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bookmarks":"","_appBarIcons\\bookmarks.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\document":"","_appBarIcons\\document.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\protecteddocument":"","_appBarIcons\\protecteddocument.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\page":"","_appBarIcons\\page.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bullets":"","_appBarIcons\\bullets.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\comment":"","_appBarIcons\\comment.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mail2":"","_appBarIcons\\mail2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contactinfo":"","_appBarIcons\\contactinfo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\hangup":"","_appBarIcons\\hangup.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\viewall":"","_appBarIcons\\viewall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mappin":"","_appBarIcons\\mappin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\phone":"","_appBarIcons\\phone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\videochat":"","_appBarIcons\\videochat.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\switch":"","_appBarIcons\\switch.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contact":"","_appBarIcons\\contact.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rename":"","_appBarIcons\\rename.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pin":"","_appBarIcons\\pin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\musicinfo":"","_appBarIcons\\musicinfo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\go":"","_appBarIcons\\go.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\keyboard":"","_appBarIcons\\keyboard.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockleft":"","_appBarIcons\\dockleft.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockright":"","_appBarIcons\\dockright.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockbottom":"","_appBarIcons\\dockbottom.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\remote":"","_appBarIcons\\remote.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\refresh":"","_appBarIcons\\refresh.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rotate":"","_appBarIcons\\rotate.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\shuffle":"","_appBarIcons\\shuffle.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\list":"","_appBarIcons\\list.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\shop":"","_appBarIcons\\shop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\selectall":"","_appBarIcons\\selectall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\orientation":"","_appBarIcons\\orientation.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\import":"","_appBarIcons\\import.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\importall":"","_appBarIcons\\importall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\browsephotos":"","_appBarIcons\\browsephotos.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\webcam":"","_appBarIcons\\webcam.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pictures":"","_appBarIcons\\pictures.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\savelocal":"","_appBarIcons\\savelocal.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\caption":"","_appBarIcons\\caption.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\stop":"","_appBarIcons\\stop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\showresults":"","_appBarIcons\\showresults.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\volume":"","_appBarIcons\\volume.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repair":"","_appBarIcons\\repair.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\message":"","_appBarIcons\\message.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\page2":"","_appBarIcons\\page2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarday":"","_appBarIcons\\calendarday.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarweek":"","_appBarIcons\\calendarweek.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendar":"","_appBarIcons\\calendar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\characters":"","_appBarIcons\\characters.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailreplyall":"","_appBarIcons\\mailreplyall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\read":"","_appBarIcons\\read.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\link":"","_appBarIcons\\link.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\accounts":"","_appBarIcons\\accounts.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\showbcc":"","_appBarIcons\\showbcc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\hidebcc":"","_appBarIcons\\hidebcc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cut":"","_appBarIcons\\cut.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\attach":"","_appBarIcons\\attach.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\paste":"","_appBarIcons\\paste.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\filter":"","_appBarIcons\\filter.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\copy":"","_appBarIcons\\copy.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\emoji2":"","_appBarIcons\\emoji2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\important":"","_appBarIcons\\important.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailreply":"","_appBarIcons\\mailreply.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\slideshow":"","_appBarIcons\\slideshow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\sort":"","_appBarIcons\\sort.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\manage":"","_appBarIcons\\manage.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\allapps":"","_appBarIcons\\allapps.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\disconnectdrive":"","_appBarIcons\\disconnectdrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mapdrive":"","_appBarIcons\\mapdrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\newwindow":"","_appBarIcons\\newwindow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openwith":"","_appBarIcons\\openwith.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contactpresence":"","_appBarIcons\\contactpresence.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\priority":"","_appBarIcons\\priority.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\uploadskydrive":"","_appBarIcons\\uploadskydrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\gototoday":"","_appBarIcons\\gototoday.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\font":"","_appBarIcons\\font.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontcolor":"","_appBarIcons\\fontcolor.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contact2":"","_appBarIcons\\contact2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\folder":"","_appBarIcons\\folder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\audio":"","_appBarIcons\\audio.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\placeholder":"","_appBarIcons\\placeholder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\view":"","_appBarIcons\\view.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\setlockscreen":"","_appBarIcons\\setlockscreen.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\settile":"","_appBarIcons\\settile.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cc":"","_appBarIcons\\cc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\stopslideshow":"","_appBarIcons\\stopslideshow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\permissions":"","_appBarIcons\\permissions.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\highlight":"","_appBarIcons\\highlight.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\disableupdates":"","_appBarIcons\\disableupdates.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unfavorite":"","_appBarIcons\\unfavorite.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unpin":"","_appBarIcons\\unpin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openlocal":"","_appBarIcons\\openlocal.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mute":"","_appBarIcons\\mute.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\italic":"","_appBarIcons\\italic.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\underline":"","_appBarIcons\\underline.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bold":"","_appBarIcons\\bold.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\movetofolder":"","_appBarIcons\\movetofolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\likedislike":"","_appBarIcons\\likedislike.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dislike":"","_appBarIcons\\dislike.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\like":"","_appBarIcons\\like.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\alignright":"","_appBarIcons\\alignright.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\aligncenter":"","_appBarIcons\\aligncenter.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\alignleft":"","_appBarIcons\\alignleft.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoom":"","_appBarIcons\\zoom.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoomout":"","_appBarIcons\\zoomout.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openfile":"","_appBarIcons\\openfile.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\otheruser":"","_appBarIcons\\otheruser.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\admin":"","_appBarIcons\\admin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\street":"","_appBarIcons\\street.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\map":"","_appBarIcons\\map.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clearselection":"","_appBarIcons\\clearselection.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontdecrease":"","_appBarIcons\\fontdecrease.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontincrease":"","_appBarIcons\\fontincrease.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontsize":"","_appBarIcons\\fontsize.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cellphone":"","_appBarIcons\\cellphone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\reshare":"","_appBarIcons\\reshare.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\tag":"","_appBarIcons\\tag.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repeatone":"","_appBarIcons\\repeatone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repeatall":"","_appBarIcons\\repeatall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\outlinestar":"","_appBarIcons\\outlinestar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\solidstar":"","_appBarIcons\\solidstar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calculator":"","_appBarIcons\\calculator.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\directions":"","_appBarIcons\\directions.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\target":"","_appBarIcons\\target.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\library":"","_appBarIcons\\library.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\phonebook":"","_appBarIcons\\phonebook.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\memo":"","_appBarIcons\\memo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\microphone":"","_appBarIcons\\microphone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\postupdate":"","_appBarIcons\\postupdate.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\backtowindow":"","_appBarIcons\\backtowindow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fullscreen":"","_appBarIcons\\fullscreen.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\newfolder":"","_appBarIcons\\newfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarreply":"","_appBarIcons\\calendarreply.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unsyncfolder":"","_appBarIcons\\unsyncfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\reporthacked":"","_appBarIcons\\reporthacked.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\syncfolder":"","_appBarIcons\\syncfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\blockcontact":"","_appBarIcons\\blockcontact.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\switchapps":"","_appBarIcons\\switchapps.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\addfriend":"","_appBarIcons\\addfriend.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\touchpointer":"","_appBarIcons\\touchpointer.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\gotostart":"","_appBarIcons\\gotostart.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zerobars":"","_appBarIcons\\zerobars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\onebar":"","_appBarIcons\\onebar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\twobars":"","_appBarIcons\\twobars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\threebars":"","_appBarIcons\\threebars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fourbars":"","_appBarIcons\\fourbars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\scan":"","_appBarIcons\\scan.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\preview":"","_appBarIcons\\preview.comment":"{Locked:qps-ploc,qps-plocm}"});t("WinJS/Core/_Resources",["exports","./_Global","./_WinRT","./_Base","./_Events","require-json!en-US/ui.resjson"],function(n,t,i,r,u,f){"use strict";function v(n){var t=c("ms-resource://"+s+"/"+n);return t.empty&&(t=b(n)),t}function b(n){var i=n.split("/"),t;return i.shift(),t=f[i.join("\\")],"string"==typeof t&&(t={value:t}),t||{value:n,empty:!0}}function l(n){var t=arguments;return t.length>1&&(n=n.replace(/({{)|(}})|{(\d+)}|({)|(})/g,function(n,i,r,u,f,e){if(f||e)throw l(g.malformedFormatStringInput,f||e);return i&&"{"||r&&"}"||t[(0|u)+1]})),n}var s="WinJS.3.1",y="Developer.",w,c;0===s.indexOf(y)&&(s=s.substring(y.length));var e,a,p=!1,h="contextchanged",k=r.Class.mix(r.Class.define(null,{},{supportedForProcessing:!1}),u.eventMixin),o=new k,d=u._createEventProperty,g={get malformedFormatStringInput(){return"Malformed, did you mean to escape your '{0}'?"}};r.Namespace.define("WinJS.Resources",{_getWinJSString:v});r.Namespace._moduleDefine(n,"WinJS.Resources",{addEventListener:function(t,r,u){if(i.Windows.ApplicationModel.Resources.Core.ResourceManager&&!p&&t===h)try{var f=n._getResourceContext();f?f.qualifierValues.addEventListener("mapchanged",function(t){n.dispatchEvent(h,{qualifier:t.key,changed:t.target[t.key]})},!1):i.Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.qualifierValues.addEventListener("mapchanged",function(t){n.dispatchEvent(h,{qualifier:t.key,changed:t.target[t.key]})},!1);p=!0}catch(e){}o.addEventListener(t,r,u)},removeEventListener:o.removeEventListener.bind(o),dispatchEvent:o.dispatchEvent.bind(o),_formatString:l,_getStringWinRT:function(t){var f,r,s,u,o;if(!e){f=i.Windows.ApplicationModel.Resources.Core.ResourceManager.current.mainResourceMap;try{e=f.getSubtree("Resources")}catch(h){}e||(e=f)}try{o=n._getResourceContext();u=o?e.getValue(t,o):e.getValue(t);u&&(r=u.valueAsString,void 0===r&&(r=u.toString()))}catch(h){}if(!r)return n._getStringJS(t);try{s=u.getQualifierValue("Language")}catch(h){return{value:r}}return{value:r,lang:s}},_getStringJS:function(n){var i=t.strings&&t.strings[n];return"string"==typeof i&&(i={value:i}),i||{value:n,empty:!0}},_getResourceContext:function(){if(t.document&&"undefined"==typeof a){var n=i.Windows.ApplicationModel.Resources.Core.ResourceContext;a=n.getForCurrentView?n.getForCurrentView():null}return a},oncontextchanged:d(h)});w=i.Windows.ApplicationModel.Resources.Core.ResourceManager?n._getStringWinRT:n._getStringJS;c=function(n){return w(n)};r.Namespace._moduleDefine(n,null,{_formatString:l,_getWinJSString:v});r.Namespace._moduleDefine(n,"WinJS.Resources",{getString:{get:function(){return c},set:function(n){c=n}}})});t("WinJS/Core/_Trace",["./_Global"],function(n){"use strict";function t(n){return n}return{_traceAsyncOperationStarting:n.Debug&&n.Debug.msTraceAsyncOperationStarting&&n.Debug.msTraceAsyncOperationStarting.bind(n.Debug)||t,_traceAsyncOperationCompleted:n.Debug&&n.Debug.msTraceAsyncOperationCompleted&&n.Debug.msTraceAsyncOperationCompleted.bind(n.Debug)||t,_traceAsyncCallbackStarting:n.Debug&&n.Debug.msTraceAsyncCallbackStarting&&n.Debug.msTraceAsyncCallbackStarting.bind(n.Debug)||t,_traceAsyncCallbackCompleted:n.Debug&&n.Debug.msTraceAsyncCallbackCompleted&&n.Debug.msTraceAsyncCallbackCompleted.bind(n.Debug)||t}});t("WinJS/Promise/_StateMachine",["../Core/_Global","../Core/_BaseCoreUtils","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Trace"],function(n,t,i,r,u,f){"use strict";function e(){}function w(n,t){var i;i=t&&"object"==typeof t&&"function"==typeof t.then?p:ri;n._value=t;n._setState(i)}function b(n,t,i,r,u,f){return{exception:n,error:t,promise:i,handler:f,id:r,parent:u}}function k(n,t,i,r){var u=i._isException,f=i._errorId;return b(u?t:null,u?null:t,n,f,i,r)}function pt(n,t,i){var r=i._isException,u=i._errorId;return st(n,u,r),b(r?t:null,r?null:t,n,u,i)}function wt(n,t){var i=++at;return st(n,i),b(null,t,n,i)}function bt(n,t){var i=++at;return st(n,i,!0),b(t,null,n,i)}function d(n,t,i,r){var u=f._traceAsyncOperationStarting("WinJS.Promise.done");ot(n,{c:t,e:i,p:r,asyncOpID:u})}function g(n,t,i,r){n._value=t;l(n,t,i,r);n._setState(lt)}function kt(t,i){var l=t._value,u=t._listeners,e,s;if(u)for(t._listeners=null,e=0,s=Array.isArray(u)?u.length:1;s>e;e++){var o=1===s?u:u[e],h=o.c,r=o.promise;if(f._traceAsyncOperationCompleted(o.asyncOpID,n.Debug&&n.Debug.MS_ASYNC_OP_STATUS_SUCCESS),r){f._traceAsyncCallbackStarting(o.asyncOpID);try{r._setCompleteValue(h?h(l):l)}catch(a){r._setExceptionValue(a)}finally{f._traceAsyncCallbackCompleted()}r._state!==p&&r._listeners&&i.push(r)}else c.prototype.done.call(t,h)}}function dt(t,i){var u=t._value,e=t._listeners,s,c,v;if(e)for(t._listeners=null,s=0,c=Array.isArray(e)?e.length:1;c>s;s++){var h=1===c?e:e[s],o=h.e,r=h.promise,w=n.Debug&&(u&&u.name===y?n.Debug.MS_ASYNC_OP_STATUS_CANCELED:n.Debug.MS_ASYNC_OP_STATUS_ERROR);if(f._traceAsyncOperationCompleted(h.asyncOpID,w),r){v=!1;try{o?(f._traceAsyncCallbackStarting(h.asyncOpID),v=!0,o.handlesOnError||l(r,u,k,t,o),r._setCompleteValue(o(u))):r._setChainedErrorValue(u,t)}catch(b){r._setExceptionValue(b)}finally{v&&f._traceAsyncCallbackCompleted()}r._state!==p&&r._listeners&&i.push(r)}else a.prototype.done.call(t,null,o)}}function l(n,t,i,r,u){if(v._listeners[ht]){if(t instanceof Error&&t.message===y)return;v.dispatchEvent(ht,i(n,t,r,u))}}function nt(n,t){var r=n._listeners,u,f,i,e;if(r)for(u=0,f=Array.isArray(r)?r.length:1;f>u;u++){if(i=1===f?r:r[u],e=i.p,e)try{e(t)}catch(o){}i.c||i.e||!i.promise||i.promise._progress(t)}}function ot(n,t){var i=n._listeners;i?(i=Array.isArray(i)?i:[i],i.push(t)):i=t;n._listeners=i}function st(n,t,i){n._isException=i||!1;n._errorId=t}function tt(n,t,i,r){n._value=t;l(n,t,i,r);n._setState(et)}function it(n,t){var i;i=t&&"object"==typeof t&&"function"==typeof t.then?p:ft;n._value=t;n._setState(i)}function rt(n,t,i,r){var u=new yt(n),e=f._traceAsyncOperationStarting("WinJS.Promise.then");return ot(n,{promise:u,c:t,e:i,p:r,asyncOpID:e}),u}function ei(i){var r;return new o(function(u){i?r=n.setTimeout(u,i):t._setImmediate(u)},function(){r&&n.clearTimeout(r)})}function oi(n,t){var r=function(){t.cancel()},i=function(){n.cancel()};return n.then(r),t.then(i,i),t}var gt,v,ut,ni,p,ti,ii,ct,ri,ft,lt,et,at;n.Debug&&(n.Debug.setNonUserCodeExceptions=!0);gt=i.Class.mix(i.Class.define(null,{},{supportedForProcessing:!1}),u.eventMixin);v=new gt;v._listeners={};var ht="error",y="Canceled",s=!1,h={promise:1,thenPromise:2,errorPromise:4,exceptionPromise:8,completePromise:16};h.all=h.promise|h.thenPromise|h.errorPromise|h.exceptionPromise|h.completePromise;at=1;ut={name:"created",enter:function(n){n._setState(ni)},cancel:e,done:e,then:e,_completed:e,_error:e,_notify:e,_progress:e,_setCompleteValue:e,_setErrorValue:e};ni={name:"working",enter:e,cancel:function(n){n._setState(ii)},done:d,then:rt,_completed:w,_error:g,_notify:e,_progress:nt,_setCompleteValue:it,_setErrorValue:tt};p={name:"waiting",enter:function(n){var t=n._value,i;t instanceof yt&&t._state!==et&&t._state!==ft?ot(t,{promise:n}):(i=function(r){t._errorId?n._chainedError(r,t):(l(n,r,k,t,i),n._error(r))},i.handlesOnError=!0,t.then(n._completed.bind(n),i,n._progress.bind(n)))},cancel:function(n){n._setState(ti)},done:d,then:rt,_completed:w,_error:g,_notify:e,_progress:nt,_setCompleteValue:it,_setErrorValue:tt};ti={name:"waiting_canceled",enter:function(n){n._setState(ct);var t=n._value;t.cancel&&t.cancel()},cancel:e,done:d,then:rt,_completed:w,_error:g,_notify:e,_progress:nt,_setCompleteValue:it,_setErrorValue:tt};ii={name:"canceled",enter:function(n){n._setState(ct);n._cancelAction()},cancel:e,done:d,then:rt,_completed:w,_error:g,_notify:e,_progress:nt,_setCompleteValue:it,_setErrorValue:tt};ct={name:"canceling",enter:function(n){var t=new Error(y);t.name=t.message;n._value=t;n._setState(lt)},cancel:e,done:e,then:e,_completed:e,_error:e,_notify:e,_progress:e,_setCompleteValue:e,_setErrorValue:e};ri={name:"complete_notify",enter:function(n){if(n.done=c.prototype.done,n.then=c.prototype.then,n._listeners)for(var t,i=[n];i.length;)t=i.shift(),t._state._notify(t,i);n._setState(ft)},cancel:e,done:null,then:null,_completed:e,_error:e,_notify:kt,_progress:e,_setCompleteValue:e,_setErrorValue:e};ft={name:"success",enter:function(n){n.done=c.prototype.done;n.then=c.prototype.then;n._cleanupAction()},cancel:e,done:null,then:null,_completed:e,_error:e,_notify:kt,_progress:e,_setCompleteValue:e,_setErrorValue:e};lt={name:"error_notify",enter:function(n){if(n.done=a.prototype.done,n.then=a.prototype.then,n._listeners)for(var t,i=[n];i.length;)t=i.shift(),t._state._notify(t,i);n._setState(et)},cancel:e,done:null,then:null,_completed:e,_error:e,_notify:dt,_progress:e,_setCompleteValue:e,_setErrorValue:e};et={name:"error",enter:function(n){n.done=a.prototype.done;n.then=a.prototype.then;n._cleanupAction()},cancel:e,done:null,then:null,_completed:e,_error:e,_notify:dt,_progress:e,_setCompleteValue:e,_setErrorValue:e};var ui,vt=i.Class.define(null,{_listeners:null,_nextState:null,_state:null,_value:null,cancel:function(){this._state.cancel(this);this._run()},done:function(n,t,i){this._state.done(this,n,t,i)},then:function(n,t,i){return this._state.then(this,n,t,i)},_chainedError:function(n,t){var i=this._state._error(this,n,pt,t);return this._run(),i},_completed:function(n){var t=this._state._completed(this,n);return this._run(),t},_error:function(n){var t=this._state._error(this,n,wt);return this._run(),t},_progress:function(n){this._state._progress(this,n)},_setState:function(n){this._nextState=n},_setCompleteValue:function(n){this._state._setCompleteValue(this,n);this._run()},_setChainedErrorValue:function(n,t){var i=this._state._setErrorValue(this,n,pt,t);return this._run(),i},_setExceptionValue:function(n){var t=this._state._setErrorValue(this,n,bt);return this._run(),t},_run:function(){for(;this._nextState;)this._state=this._nextState,this._nextState=null,this._state.enter(this)}},{supportedForProcessing:!1}),yt=i.Class.derive(vt,function(n){s&&(s===!0||s&h.thenPromise)&&(this._stack=o._getStack());this._creator=n;this._setState(ut);this._run()},{_creator:null,_cancelAction:function(){this._creator&&this._creator.cancel()},_cleanupAction:function(){this._creator=null}},{supportedForProcessing:!1}),a=i.Class.define(function(n){s&&(s===!0||s&h.errorPromise)&&(this._stack=o._getStack());this._value=n;l(this,n,wt)},{cancel:function(){},done:function(n,t){var i=this._value,r;if(t)try{return t.handlesOnError||l(null,i,k,this,t),r=t(i),void(r&&"object"==typeof r&&"function"==typeof r.done&&r.done())}catch(u){i=u}i instanceof Error&&i.message===y||o._doneHandler(i)},then:function(n,t){if(!t)return this;var i,r=this._value;try{t.handlesOnError||l(null,r,k,this,t);i=new c(t(r))}catch(u){i=u===r?this:new fi(u)}return i}},{supportedForProcessing:!1}),fi=i.Class.derive(a,function(n){s&&(s===!0||s&h.exceptionPromise)&&(this._stack=o._getStack());this._value=n;l(this,n,bt)},{},{supportedForProcessing:!1}),c=i.Class.define(function(n){if(s&&(s===!0||s&h.completePromise)&&(this._stack=o._getStack()),n&&"object"==typeof n&&"function"==typeof n.then){var t=new yt(null);return t._setCompleteValue(n),t}this._value=n},{cancel:function(){},done:function(n){if(n)try{var t=n(this._value);t&&"object"==typeof t&&"function"==typeof t.done&&t.done()}catch(i){o._doneHandler(i)}},then:function(n){try{var t=n?n(this._value):this._value;return t===this._value?this:new c(t)}catch(i){return new fi(i)}}},{supportedForProcessing:!1}),o=i.Class.derive(vt,function(n,t){s&&(s===!0||s&h.promise)&&(this._stack=o._getStack());this._oncancel=t;this._setState(ut);this._run();try{var i=this._completed.bind(this),r=this._error.bind(this),u=this._progress.bind(this);n(i,r,u)}catch(f){this._setExceptionValue(f)}},{_oncancel:null,_cancelAction:function(){if(this._oncancel)try{this._oncancel()}catch(n){}},_cleanupAction:function(){this._oncancel=null}},{addEventListener:function(n,t,i){v.addEventListener(n,t,i)},any:function(n){return new o(function(t,i){var r=Object.keys(n),u;0===r.length&&t();u=0;r.forEach(function(f){o.as(n[f]).then(function(){t({key:f,value:n[f]})},function(e){return e instanceof Error&&e.name===y?void(++u===r.length&&t(o.cancel)):void i({key:f,value:n[f]})})})},function(){var t=Object.keys(n);t.forEach(function(t){var i=o.as(n[t]);"function"==typeof i.cancel&&i.cancel()})})},as:function(n){return n&&"object"==typeof n&&"function"==typeof n.then?n:new c(n)},cancel:{get:function(){return ui=ui||new a(new r(y))}},dispatchEvent:function(n,t){return v.dispatchEvent(n,t)},is:function(n){return n&&"object"==typeof n&&"function"==typeof n.then},join:function(n){return new o(function(t,i,r){var f=Object.keys(n),u=Array.isArray(n)?[]:{},e=Array.isArray(n)?[]:{},h=0,s=f.length,c=function(n){var h,c;0==--s?(h=Object.keys(u).length,0===h?t(e):(c=0,f.forEach(function(n){var t=u[n];t instanceof Error&&t.name===y&&c++}),c===h?t(o.cancel):i(u))):r({Key:n,Done:!0})};return f.forEach(function(t){var i=n[t];void 0===i?h++:o.then(i,function(n){e[t]=n;c(t)},function(n){u[t]=n;c(t)})}),s-=h,0===s?void t(e):void 0},function(){Object.keys(n).forEach(function(t){var i=o.as(n[t]);"function"==typeof i.cancel&&i.cancel()})})},removeEventListener:function(n,t,i){v.removeEventListener(n,t,i)},supportedForProcessing:!1,then:function(n,t,i,r){return o.as(n).then(t,i,r)},thenEach:function(n,t,i,r){var u=Array.isArray(n)?[]:{};return Object.keys(n).forEach(function(f){u[f]=o.as(n[f]).then(t,i,r)}),o.join(u)},timeout:function(n,t){var i=ei(n);return t?oi(i,t):i},wrap:function(n){return new c(n)},wrapError:function(n){return new a(n)},_veryExpensiveTagWithStack:{get:function(){return s},set:function(n){s=n}},_veryExpensiveTagWithStack_tag:h,_getStack:function(){if(n.Debug&&n.Debug.debuggerEnabled)try{throw new Error;}catch(t){return t.stack}},_cancelBlocker:function(n,t){if(!o.is(n))return o.wrap(n);var i,r,u=new o(function(n,t){i=n;r=t},function(){i=null;r=null;t&&t()});return n.then(function(n){i&&i(n)},function(n){r&&r(n)}),u}});return Object.defineProperties(o,u.createEventProperties(ht)),o._doneHandler=function(n){t._setImmediate(function(){throw n;})},{PromiseStateMachine:vt,Promise:o,state_created:ut}});t("WinJS/Promise",["./Core/_Base","./Promise/_StateMachine"],function(n,t){"use strict";return n.Namespace.define("WinJS",{Promise:t.Promise}),t.Promise});t("WinJS/Core/_Log",["exports","./_Global","./_Base"],function(n,t,i){"use strict";function o(n,t,i){var u=n;return"function"==typeof u&&(u=u()),(i&&f.test(i)?"":i?i+": ":"")+(t?t.replace(r,":")+": ":"")+u}function s(i,r,u){var e=n.formatLog(i,r,u);t.console&&t.console[u&&f.test(u)?u:"log"](e)}function u(n){return n.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}var r=/\s+/g,f=/^(error|warn|info|log)$/,e=null;i.Namespace._moduleDefine(n,"WinJS.Utilities",{startLog:function(t){var i;t=t||{};"string"==typeof t&&(t={tags:t});var f=t.type&&new RegExp("^("+u(t.type).replace(r," ").split(" ").join("|")+")$"),e=t.excludeTags&&new RegExp("(^|\\s)("+u(t.excludeTags).replace(r," ").split(" ").join("|")+")(\\s|$)","i"),o=t.tags&&new RegExp("(^|\\s)("+u(t.tags).replace(r," ").split(" ").join("|")+")(\\s|$)","i"),h=t.action||s;if(!(f||e||o||n.log))return void(n.log=h);i=function(n,t,r){f&&!f.test(r)||e&&e.test(t)||o&&!o.test(t)||h(n,t,r);i.next&&i.next(n,t,r)};i.next=n.log;n.log=i},stopLog:function(){n.log=null},formatLog:o});i.Namespace._moduleDefine(n,"WinJS",{log:{get:function(){return e},set:function(n){e=n}}})});t("WinJS/Scheduler",["exports","./Core/_Global","./Core/_Base","./Core/_ErrorFromName","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WriteProfilerMark","./Promise"],function(n,t,i,r,u,f,e,o,s){"use strict";function ii(n){var r={},t="_prev"+n,i="_next"+n;return r["_remove"+n]=function(){var n=this[t],r=this[i];r&&(r[t]=n);n&&(n[i]=r);this[t]=null;this[i]=null},r["_insert"+n+"Before"]=function(n){var r=this[t];return r&&(r[i]=n),n[i]=this,n[t]=r,this[t]=n,n},r["_insert"+n+"After"]=function(n){var r=this[i];return this[i]=n,n[i]=r,n[t]=this,r&&(r[t]=n),n},r}function fi(n,t,i){return void 0!==i?"("+n+";"+t+";"+i+")":void 0!==t?"("+n+";"+t+")":void 0!==n?"("+n+")":""}function tt(n,t,i,r){o("WinJS.Scheduler:"+n+fi(i,r)+","+t)}function v(n,t,i,r,u){var f=n.name||void 0!==r||void 0!==u;o("WinJS.Scheduler:"+t+":"+n.id+(f?fi(n.name,r,u):"")+","+i)}function c(){return!1}function ft(n){throw"Illegal call by job("+n.id+") in state: "+this.name;}function d(n){return function(t,i,r){t._setState(n,i,r)}}function wt(n,t){n._setPriority(t)}function sr(n,t){function f(n,t){u.log&&u.log(t+": MARKER: "+n.name,"winjs scheduler","log")}function e(n,t){u.log&&u.log(t+": JOB("+n.id+"): state: "+(n._state?n._state.name:"")+(n.name?", name: "+n.name:""),"winjs scheduler","log")}u.log&&u.log("highWaterMark: "+a,"winjs scheduler","log");var r=0,o=t?dt[dt.length-1]:dt[0],i=o;do i instanceof h&&f(i,r),i instanceof it&&e(i,r),r++,i=t?i["_prev"+n]:i["_next"+n];while(i)}function hr(){function u(t,i){n+="    "+(i?"*":" ")+"id: "+t.id+", priority: "+w(t.priority).name+(t.name?", name: "+t.name:"")+"\n"}var n="",t,r,i,f;for(n+="Jobs:\n",t=w(a),r=0,yt&&(u(yt,!0),r++);t.priority>=p.min;)t instanceof it&&(u(t,!1),r++),t=t._nextJob;for(0===r&&(n+="     None\n"),n+="Drain requests:\n",i=0,f=y.length;f>i;i++)n+="    "+(0===i?"*":" ")+"priority: "+w(y[i].priority).name+", name: "+y[i].name+"\n";return 0===y.length&&(n+="     None\n"),n}function cr(){var n=dt[0];do{if(n instanceof it)return!1;n=n._nextJob}while(n);return!0}function vi(){return 0===y.length?null:y[0].priority}function ei(n){tt("drain","StartTM",n.name,w(n.priority).name)}function yi(n,t){t&&tt("drain-canceled","info",n.name,w(n.priority).name);tt("drain","StopTM",n.name,w(n.priority).name)}function lr(n,t,i){y.push({priority:n,complete:t,name:i});1===y.length&&(ei(y[0]),n>a&&(a=n,ct=!0))}function ar(n,t){for(var r=y.length,i=0;r>i;i++)if(y[i].complete===n){0===i&&(yi(y[0],t),y[1]&&ei(y[1]));y.splice(i,1);break}}function vr(){var n=y.shift();n&&(yi(n),y[0]&&ei(y[0]),n.complete())}function pi(){var t=!1,n;if(y.length)for(n=vi();+n===n&&n>a;)kt=n,vr(),t=!0,n=vi();return t}function bt(n){return n>=p.aboveNormal+1?l.HIGH:n>=p.belowNormal?l.NORMAL:l.IDLE}function yr(n,t){return pt[n]>=pt[t]}function pr(n,t){return pt[n]>pt[t]}function wi(n){switch(n){case l.HIGH:return!1;case l.NORMAL:return l.isTaskScheduledAtPriorityOrHigher(l.HIGH);case l.IDLE:return l.isTaskScheduledAtPriorityOrHigher(l.NORMAL)}}function wr(n,t){var i=w(t);i.priority>a&&(a=i.priority,ct=!0);i._insertJobAfter(n)}function oi(n,t){var i=w(t);i.priority>a&&(a=i.priority,ct=!0);i._nextMarker._insertJobBefore(n)}function si(n){return n=0|n,n=Math.max(n,ru),n=Math.min(n,rr)}function w(n){return n=si(n),dt[-1*(n-rr)]}function br(n){var c,s,e,b;ti=!0;tt("timeslice","StartTM");var r,t,i,u=!0,o=!1,f=!1;ct=!1;try{for(var k=fr(),d=k+ur,h=function(){return o=!1,ct?!0:wi(bt(a))?!0:y.length?!1:fr()>d?(o=!0,!0):!1};a>=p.min&&!h()&&!f;){r=!1;t=w(a)._nextJob;do(kt=t.priority,t instanceof it)?(i!==t.priority&&(+i===i&&tt("priority","StopTM",w(i).name),tt("priority","StartTM",w(t.priority).name),i=t.priority),r=!0,u=!1,yt=t,v(yt,"job-running","StartTM",w(kt).name),t._execute(h),v(yt,"job-running","StopTM",w(kt).name),yt=null,u=!0):(c=bt(a),a=t.priority,r=pi(),s=bt(a),pr(c,s)&&(!gt||l.isTaskScheduledAtPriorityOrHigher(s))&&(f=!0)),t=t._nextJob;while(t&&!r&&!f&&!wi(bt(a)));ct=!1}}finally{for(yt=null,u||(v(t,"job-error","info"),v(t,"job-running","StopTM",w(kt).name),t.cancel()),+i===i&&tt("priority","StopTM",w(i).name),e=!1;a>=p.min&&!e;){r=!1;t=w(a)._nextJob;do t instanceof it?e=!0:(a=t.priority,r=pi()),t=t._nextJob;while(t&&!r&&!e)}b=u?o?"timeslice exhausted":a<p.min?"jobs exhausted":f?"reached WWA priority boundary":"WWA host work":"job error";n&&(ui=null);ti=!1;a>=p.min&&hi();tt("yielding","info",b);tt("timeslice","StopTM")}}function hi(n){var t,i,r;+n!==n&&(n=a);t=bt(n);ti||ui&&(!gt||yr(ui,t))||(i=++er,r=function(){i>or&&(or=er,br(!0))},l.execAsyncAtPriority(r,t),ui=t)}function kr(n,t){var u=iu++,i,r;return void 0===t&&(t="Drain Request "+u),n=+n===n?n:p.min,n=si(n),r=new s(function(r){i=r;lr(n,i,t)},function(){ar(i,!0)}),ti||hi(),r}function dr(n){return l.execAtPriority(n,l.HIGH)}function gr(){return new gi}function bi(n,t,i,r){t=t||p.normal;i=i||null;var u=++tu,f=e._traceAsyncOperationStarting("WinJS.Utilities.Scheduler.schedule: "+u+fi(r));return r=r||"",new it(u,n,t,i,r,f)}function nu(){if(ti)return kt;switch(l.getCurrentPriority()){case l.HIGH:return p.high;case l.NORMAL:return p.normal;case l.IDLE:return p.idle}}function ni(n){return function(t,i){var r;return new s(function(u){r=bi(function(){u(t)},n,null,i)},function(){r.cancel()})}}var ki,it,h;i.Namespace.define("WinJS.Utilities",{_linkedListMixin:ii});ki={get jobInfoIsNoLongerValid(){return"The job info object can only be used while the job is running"}};it=i.Class.define(function(n,t,i,r,u,f){this._id=n;this._work=t;this._context=r;this._name=u;this._asyncOpID=f;this._setPriority(i);this._setState(nr);v(this,"job-scheduled","info")},{completed:{get:function(){return!!this._state.completed}},id:{get:function(){return this._id}},name:{get:function(){return this._name},set:function(n){this._name=n}},owner:{get:function(){return this._owner},set:function(n){this._owner&&this._owner._remove(this);this._owner=n;this._owner&&this._owner._add(this)}},priority:{get:function(){return this._priority},set:function(n){n=si(n);this._state.setPriority(this,n)}},cancel:function(){this._state.cancel(this)},pause:function(){this._state.pause(this)},resume:function(){this._state.resume(this)},_execute:function(n){this._state.execute(this,n)},_executeDone:function(n){return this._state.executeDone(this,n)},_blockedDone:function(n){return this._state.blockedDone(this,n)},_setPriority:function(n){+this._priority===this._priority&&this._priority!==n&&v(this,"job-priority-changed","info",w(this._priority).name,w(n).name);this._priority=n},_setState:function(n,t,i){this._state&&u.log&&u.log("Transitioning job ("+this.id+") from: "+this._state.name+" to: "+n.name,"winjs scheduler","log");this._state=n;this._state.enter(this,t,i)}});i.Class.mix(it,ii("Job"));var k={complete:1,"continue":2,block:3},di=i.Class.define(function(n,t){this._job=t;this._result=null;this._yieldPolicy=k.complete;this._shouldYield=n},{job:{get:function(){return this._throwIfDisabled(),this._job}},shouldYield:{get:function(){return this._throwIfDisabled(),this._shouldYield()}},setPromise:function(n){this._throwIfDisabled();this._result=n;this._yieldPolicy=k.block},setWork:function(n){this._throwIfDisabled();this._result=n;this._yieldPolicy=k.continue},_disablePublicApi:function(){this._publicApiDisabled=!0},_throwIfDisabled:function(){if(this._publicApiDisabled)throw new r("WinJS.Utilities.Scheduler.JobInfoIsNoLongerValid",ki.jobInfoIsNoLongerValid);}}),gi=i.Class.define(function(){this._jobs={}},{cancelAll:function(){var t=this._jobs,i=Object.keys(t),n,r;for(this._jobs={},n=0,r=i.length;r>n;n++)t[i[n]].cancel()},_add:function(n){this._jobs[n.id]=n},_remove:function(n){delete this._jobs[n.id]}}),b=i.Class.define(function(n){this.name=n;this.enter=ft;this.execute=ft;this.executeDone=ft;this.blockedDone=ft;this.cancel=ft;this.pause=ft;this.resume=ft;this.setPriority=ft}),nr=new b("created"),rt=new b("scheduled"),lt=new b("paused"),g=new b("canceled"),at=new b("running"),et=new b("running_paused"),vt=new b("running_resumed"),ut=new b("running_canceled"),tr=new b("running_canceled_blocked"),ri=new b("cooperative_yield"),ci=new b("cooperative_yield_paused"),li=new b("blocked"),ot=new b("blocked_waiting"),ir=new b("blocked_paused"),st=new b("blocked_paused_waiting"),ht=new b("blocked_canceled"),nt=new b("complete");nr.enter=function(n){oi(n,n.priority);n._setState(rt)};rt.enter=function(){hi()};rt.execute=d(at);rt.cancel=d(g);rt.pause=d(lt);rt.resume=c;rt.setPriority=function(n,t){n.priority!==t&&(n._setPriority(t),n.pause(),n.resume())};lt.enter=function(n){v(n,"job-paused","info");n._removeJob()};lt.cancel=d(g);lt.pause=c;lt.resume=function(n){v(n,"job-resumed","info");oi(n,n.priority);n._setState(rt)};lt.setPriority=wt;g.enter=function(n){v(n,"job-canceled","info");e._traceAsyncOperationCompleted(n._asyncOpID,t.Debug&&t.Debug.MS_ASYNC_OP_STATUS_CANCELED);n._removeJob();n._work=null;n._context=null;n.owner=null};g.cancel=c;g.pause=c;g.resume=c;g.setPriority=c;at.enter=function(n,t){var i,f;n._removeJob();var r=n.priority,o=n._work,u=n._context;n._work=null;n._context=null;i=new di(t,n);e._traceAsyncCallbackStarting(n._asyncOpID);try{l.execAtPriority(function(){o.call(u,i)},bt(r))}finally{e._traceAsyncCallbackCompleted();i._disablePublicApi()}n._context=u;f=n._executeDone(i._yieldPolicy);n._setState(f,i._result,r)};at.executeDone=function(n,t){switch(t){case k.complete:return nt;case k.continue:return ri;case k.block:return li}};at.cancel=function(n){ct=!0;n._setState(ut)};at.pause=function(n){ct=!0;n._setState(et)};at.resume=c;at.setPriority=wt;et.enter=c;et.executeDone=function(n,t){switch(t){case k.complete:return nt;case k.continue:return ci;case k.block:return ir}};et.cancel=d(ut);et.pause=c;et.resume=d(vt);et.setPriority=wt;vt.enter=c;vt.executeDone=function(n,t){switch(t){case k.complete:return nt;case k.continue:return ri;case k.block:return li}};vt.cancel=d(ut);vt.pause=d(et);vt.resume=c;vt.setPriority=wt;ut.enter=c;ut.executeDone=function(n,t){switch(t){case k.complete:case k.continue:return g;case k.block:return tr}};ut.cancel=c;ut.pause=c;ut.resume=c;ut.setPriority=c;tr.enter=function(n,t){t.cancel();n._setState(g)};ri.enter=function(n,t,i){v(n,"job-yielded","info");i===n.priority?wr(n,n.priority):oi(n,n.priority);n._work=t;n._setState(rt)};ci.enter=function(n,t){v(n,"job-yielded","info");n._work=t;n._setState(lt)};li.enter=function(n,t,i){v(n,"job-blocked","StartTM");n._work=t;n._setState(ot);t.done(function(t){v(n,"job-blocked","StopTM");var r=n._blockedDone(t);n._setState(r,t,i)},function(t){return t&&"Canceled"===t.name||v(n,"job-error","info"),v(n,"job-blocked","StopTM"),n._setState(g),s.wrapError(t)})};ot.enter=c;ot.blockedDone=function(n,t){return"function"==typeof t?ri:nt};ot.cancel=d(ht);ot.pause=d(st);ot.resume=c;ot.setPriority=wt;ir.enter=function(n,t,i){v(n,"job-blocked","StartTM");n._work=t;n._setState(st);t.done(function(t){v(n,"job-blocked","StopTM");var r=n._blockedDone(t);n._setState(r,t,i)},function(t){return t&&"Canceled"===t.name||v(n,"job-error","info"),v(n,"job-blocked","StopTM"),n._setState(g),s.wrapError(t)})};st.enter=c;st.blockedDone=function(n,t){return"function"==typeof t?ci:nt};st.cancel=d(ht);st.pause=c;st.resume=d(ot);st.setPriority=wt;ht.enter=function(n){n._work.cancel();n._work=null};ht.blockedDone=function(){return g};ht.cancel=c;ht.pause=c;ht.resume=c;ht.setPriority=c;nt.completed=!0;nt.enter=function(n){e._traceAsyncOperationCompleted(n._asyncOpID,t.Debug&&t.Debug.MS_ASYNC_OP_STATUS_SUCCESS);n._work=null;n._context=null;n.owner=null;v(n,"job-completed","info")};nt.cancel=c;nt.pause=c;nt.resume=c;nt.setPriority=c;h=i.Class.define(function(n,t){this.priority=n;this.name=t},{});i.Class.mix(h,ii("Job"),ii("Marker"));var ti,kt,ct,tu=0,iu=0,ru=-15,rr=15,p={max:15,high:13,aboveNormal:9,normal:0,belowNormal:-9,idle:-13,min:-15},dt=[new h(15,"max"),new h(14,"14"),new h(13,"high"),new h(12,"12"),new h(11,"11"),new h(10,"10"),new h(9,"aboveNormal"),new h(8,"8"),new h(7,"7"),new h(6,"6"),new h(5,"5"),new h(4,"4"),new h(3,"3"),new h(2,"2"),new h(1,"1"),new h(0,"normal"),new h(-1,"-1"),new h(-2,"-2"),new h(-3,"-3"),new h(-4,"-4"),new h(-5,"-5"),new h(-6,"-6"),new h(-7,"-7"),new h(-8,"-8"),new h(-9,"belowNormal"),new h(-10,"-10"),new h(-11,"-11"),new h(-12,"-12"),new h(-13,"idle"),new h(-14,"-14"),new h(-15,"min"),new h(-16,"<TAIL>")],ui=null,yt=null,gt=!(!t.MSApp||!t.MSApp.execAtPriority),y=[],ur=30,a=p.min;dt.reduce(function(n,t){return n&&(n._insertJobAfter(t),n._insertMarkerAfter(t)),t});var uu=t.setImmediate?t.setImmediate.bind(t):function(n){t.setTimeout(n,16)},ai={execAsyncAtPriority:function(n,i){i===l.HIGH&&t.setTimeout(n,0);uu(n)},execAtPriority:function(n){return n()},getCurrentPriority:function(){return ai.NORMAL},isTaskScheduledAtPriorityOrHigher:function(){return!1},HIGH:"high",NORMAL:"normal",IDLE:"idle"},l=gt?t.MSApp:ai,pt={};pt[l.IDLE]=1;pt[l.NORMAL]=2;pt[l.HIGH]=3;var fr=t.performance&&t.performance.now&&t.performance.now.bind(t.performance)||Date.now.bind(Date),er=0,or=0;i.Namespace._moduleDefine(n,"WinJS.Utilities.Scheduler",{Priority:p,schedule:bi,createOwnerToken:gr,execHigh:dr,requestDrain:kr,currentPriority:{get:nu},schedulePromiseHigh:ni(p.high),schedulePromiseAboveNormal:ni(p.aboveNormal),schedulePromiseNormal:ni(p.normal),schedulePromiseBelowNormal:ni(p.belowNormal),schedulePromiseIdle:ni(p.idle),retrieveState:hr,_JobNode:it,_JobInfo:di,_OwnerToken:gi,_dumpList:sr,_isEmpty:{get:cr},_usingWwaScheduler:{get:function(){return gt},set:function(n){gt=n;l=gt?t.MSApp:ai}},_MSApp:{get:function(){return l},set:function(n){l=n}},_TIME_SLICE:ur})});t("WinJS/Core/_BaseUtils",["exports","./_Global","./_Base","./_BaseCoreUtils","./_ErrorFromName","./_Resources","./_Trace","../Promise","../Scheduler"],function(n,t,i,r,u,f,e,o,s){"use strict";function k(n){return n}function v(n,t,i){return n.split(".").reduce(function(n,t){return n?i(n[t]):null},t)}function d(n,i){return n?v(n,i||t,k):null}function y(n){return n.length>0&&0!==n.indexOf("-moz")&&"-"===n.charAt(0)&&(n=n.slice(1)),n.replace(/\-[a-z]/g,function(n){return n[1].toUpperCase()})}function p(n,t){return""===n?t:n+t.charAt(0).toUpperCase()+t.slice(1)}function c(n,t){return(""!==n?"-"+n.toLowerCase()+"-":"")+t}function g(){var r,o,l;if(!t.document)return{};for(var n={},a=t.document.documentElement.style,s=["","webkit","ms","Moz"],h=["animation","transition","transform","animation-name","animation-duration","animation-delay","animation-timing-function","animation-iteration-count","animation-direction","animation-fill-mode","grid-column","grid-columns","grid-column-span","grid-row","grid-rows","grid-row-span","transform-origin","transition-property","transition-duration","transition-delay","transition-timing-function","scroll-snap-points-x","scroll-snap-points-y","scroll-chaining","scroll-limit","scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","touch-action","overflow-style","user-select"],u={},f=0,v=h.length;v>f;f++)for(var i=h[f],w=y(i),e=0,b=s.length;b>e;e++)if(r=s[e],o=p(r,w),o in a){l=c(r,i);n[i]={cssName:l,scriptName:o};u[i]=r;break}return n.animationPrefix=c(u.animation,""),n.keyframes=c(u.animation,"keyframes"),n}function nt(){for(var o,n,c,r,i={},s=["","WebKit"],h=[{eventObject:"TransitionEvent",events:["transitionStart","transitionEnd"]},{eventObject:"AnimationEvent",events:["animationStart","animationEnd"]}],u=0,l=h.length;l>u;u++){for(var f=h[u],e="",n=0,a=s.length;a>n;n++)if(o=s[n],o+f.eventObject in t){e=o.toLowerCase();break}for(n=0,c=f.events.length;c>n;n++)r=f.events[n],i[r]=p(e,r),""===e&&(i[r]=i[r].toLowerCase())}return i.manipulationStateChanged="MSManipulationEvent"in t?"ManipulationEvent":null,i}function tt(n,t){function e(){return o.timeout(n).then(function(){i=null})}var i=null,f=null,r=null,u=null;return function(){f?(r=this,u=[].slice.call(arguments,0)):i?(r=this,u=[].slice.call(arguments,0),f=i.then(function(){var o=r,n;r=null;n=u;u=null;i=e();f=null;t.apply(o,n)})):(i=e(),t.apply(this,arguments))}}var l,it={get notSupportedForProcessing(){return"Value is not supported within a declarative processing context, if you want it to be supported mark it using WinJS.Utilities.markSupportedForProcessing. The value was: '{0}'"}},rt=0,h={},w=!1,a=t.navigator.platform,b="iPhone"===a||"iPad"===a||"iPod"===a;i.Namespace._moduleDefine(n,"WinJS.Utilities",{_setHasWinRT:{value:function(n){r.hasWinRT=n},configurable:!1,writable:!1,enumerable:!1},hasWinRT:{get:function(){return r.hasWinRT},configurable:!1,enumerable:!0},_setIsiOS:{value:function(n){b=n},configurable:!1,writable:!1,enumerable:!1},_isiOS:{get:function(){return b},configurable:!1,enumerable:!0},_getMemberFiltered:v,getMember:d,_browserStyleEquivalents:g(),_browserEventEquivalents:nt(),_getCamelCasedName:y,ready:function ut(n,i){return new o(function(r,u){function f(){if(n)try{n();r()}catch(t){u(t)}else r()}var e=ut._testReadyState;e||(e=t.document?t.document.readyState:"complete");"complete"===e||t.document&&null!==t.document.body?i?s.schedule(function(){f()},s.Priority.normal,null,"WinJS.Utilities.ready"):f():t.addEventListener("DOMContentLoaded",f,!1)})},strictProcessing:{get:function(){return!0},configurable:!1,enumerable:!0},markSupportedForProcessing:{value:r.markSupportedForProcessing,configurable:!1,writable:!1,enumerable:!0},requireSupportedForProcessing:{value:function(n){var i=!0,r,e;switch(i=i&&n!==t,i=i&&n!==t.location,i=i&&!(n instanceof t.HTMLIFrameElement),i=i&&!("function"==typeof n&&!n.supportedForProcessing),t.frames.length){case 0:break;case 1:i=i&&n!==t.frames[0];break;default:for(r=0,e=t.frames.length;i&&e>r;r++)i=i&&n!==t.frames[r]}if(i)return n;throw new u("WinJS.Utilities.requireSupportedForProcessing",f._formatString(it.notSupportedForProcessing,n));},configurable:!1,writable:!1,enumerable:!0},_setImmediate:r._setImmediate,_requestAnimationFrame:t.requestAnimationFrame?t.requestAnimationFrame.bind(t):function(n){var i=++rt;return h[i]=n,l=l||t.setTimeout(function(){var n=h,t=Date.now();h={};l=null;Object.keys(n).forEach(function(i){n[i](t)})},16),i},_cancelAnimationFrame:t.cancelAnimationFrame?t.cancelAnimationFrame.bind(t):function(n){delete h[n]},_yieldForEvents:t.setImmediate?t.setImmediate.bind(t):function(n){t.setTimeout(n,0)},_yieldForDomModification:t.setImmediate?t.setImmediate.bind(t):function(n){t.setTimeout(n,0)},_throttledFunction:tt,_shallowCopy:function(n){return this._mergeAll([n])},_merge:function(n,t){return this._mergeAll([n,t])},_mergeAll:function(n){var t={};return n.forEach(function(n){Object.keys(n).forEach(function(i){t[i]=n[i]})}),t},_getProfilerMarkIdentifier:function(n){var t="";return n.id&&(t+=" id='"+n.id+"'"),n.className&&(t+=" class='"+n.className+"'"),t},_now:function(){return t.performance&&t.performance.now&&t.performance.now()||Date.now()},_traceAsyncOperationStarting:e._traceAsyncOperationStarting,_traceAsyncOperationCompleted:e._traceAsyncOperationCompleted,_traceAsyncCallbackStarting:e._traceAsyncCallbackStarting,_traceAsyncCallbackCompleted:e._traceAsyncCallbackCompleted});i.Namespace._moduleDefine(n,"WinJS",{validation:{get:function(){return w},set:function(n){w=n}}});i.Namespace.define("WinJS",{strictProcessing:{value:function(){},configurable:!1,writable:!1,enumerable:!1}})});t("WinJS/Core",["./Core/_Base","./Core/_BaseCoreUtils","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Global","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WinRT","./Core/_WriteProfilerMark"],function(){});t("WinJS/_Signal",["./Core/_Base","./Promise/_StateMachine"],function(n,t){"use strict";var r=n.Class.derive(t.PromiseStateMachine,function(n){this._oncancel=n;this._setState(t.state_created);this._run()},{_cancelAction:function(){this._oncancel&&this._oncancel()},_cleanupAction:function(){this._oncancel=null}},{supportedForProcessing:!1}),i=n.Class.define(function(n){this._promise=new r(n)},{promise:{get:function(){return this._promise}},cancel:function(){this._promise.cancel()},complete:function(n){this._promise._completed(n)},error:function(n){this._promise._error(n)},progress:function(n){this._promise._progress(n)}},{supportedForProcessing:!1});return n.Namespace.define("WinJS",{_Signal:i}),i});t("WinJS/Utilities/_Control",["exports","../Core/_Global","../Core/_Base"],function(n,t,i){"use strict";function u(n,t){r(n,t)}function r(n,t,i){var r,u,e,o;if("object"==typeof t)for(var s=Object.keys(t),f=0,h=s.length;h>f;f++){if(r=s[f],u=t[r],r.length>2&&(e=r[0],o=r[1],!("o"!==e&&"O"!==e||"n"!==o&&"N"!==o)&&"function"==typeof u&&n.addEventListener)){n.addEventListener(r.substr(2),u);continue}i||(n[r]=u)}}t.document&&i.Namespace._moduleDefine(n,"WinJS.UI",{DOMEventMixin:i.Namespace._lazy(function(){return{_domElement:null,addEventListener:function(n,t,i){(this.element||this._domElement).addEventListener(n,t,i||!1)},dispatchEvent:function(n,i){var r=t.document.createEvent("Event");return r.initEvent(n,!1,!1),r.detail=i,"object"==typeof i&&Object.keys(i).forEach(function(n){r[n]=i[n]}),(this.element||this._domElement).dispatchEvent(r)},removeEventListener:function(n,t,i){(this.element||this._domElement).removeEventListener(n,t,i||!1)}}}),setOptions:u,_setOptions:r})});t("WinJS/Utilities/_ElementUtilities",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WinRT","../Promise","../Scheduler"],function(n,t,i,r,u,f,e){"use strict";function l(n){for(var i=n.length,t=i-1;t>=0;t--)n[t]||(n.splice(t,1),i--);return i}function v(n){var t=n.className||"";return"string"==typeof t?t:t.baseVal||""}function a(n,t){var i=n.className||"";return"string"==typeof i?n.className=t:n.className.baseVal=t,n}function g(n,t){var h,r,o,s,i;if(n.classList){if(t.indexOf(" ")<0)n.classList.add(t);else for(r=t.split(" "),l(r),i=0,h=r.length;h>i;i++)n.classList.add(r[i]);return n}var u,c=v(n),f=c.split(" "),e=l(f);if(t.indexOf(" ")>=0){for(r=t.split(" "),l(r),i=0;e>i;i++)o=r.indexOf(f[i]),o>=0&&r.splice(o,1);r.length>0&&(u=r.join(" "))}else{for(s=!1,i=0;e>i;i++)if(f[i]===t){s=!0;break}s||(u=t)}return u&&(e>0&&f[0].length>0?a(n,c+" "+u):a(n,u)),n}function nt(n,t){var r,e,i,o,f;if(n.classList){if(0===n.classList.length)return n;for(i=t.split(" "),l(i),r=0,e=i.length;e>r;r++)n.classList.remove(i[r]);return n}if(f=v(n),t.indexOf(" ")>=0)i=t.split(" "),o=l(i);else{if(f.indexOf(t)<0)return n;i=[t];o=1}for(var s,u=f.split(" "),h=l(u),r=h-1;r>=0;r--)i.indexOf(u[r])>=0&&(u.splice(r,1),s=!0);return s&&a(n,u.join(" ")),n}function kt(n,t){if(n.classList)return n.classList.toggle(t),n;for(var r=v(n),i=r.trim().split(" "),f=i.length,e=!1,u=0;f>u;u++)i[u]===t&&(e=!0);return e?a(n,i.reduce(function(n,i){return i===t?n:n&&n.length>0?n+" "+i:i},"")):f>0&&i[0].length>0?a(n,r+" "+t):a(n,r+t),n}function dt(n,t,i){n.getAttribute(t)!==""+i&&n.setAttribute(t,i)}function tt(n,t,i,r){var u=Math.max(t,Math.min(i,+n));return 0===u?0:u||Math.max(t,Math.min(i,r))}function ct(n,t){if(!hi.test(t)&&ci.test(t)){var i=n.style.left;return n.style.left=t,t=n.style.pixelLeft,n.style.left=i,t}return Math.round(parseFloat(t))||0}function o(n,i){return ct(n,t.getComputedStyle(n,null)[i])}function lt(n,t,i,r,u){var f=t.toLowerCase();n._eventsMap||(n._eventsMap={});n._eventsMap[f]||(n._eventsMap[f]=[]);n._eventsMap[f].push({listener:i,useCapture:r,data:u})}function it(n,t,i,r){var o=t.toLowerCase(),f=n._eventsMap&&n._eventsMap[o],u,e;if(f)for(u=f.length-1;u>=0;u--)if(e=f[u],e.listener===i&&!!r==!!e.useCapture)return f.splice(u,1),e;return null}function gt(n,t){var i=t.toLowerCase();return n._eventsMap&&n._eventsMap[i]&&n._eventsMap[i].slice(0)||[]}function y(n,t,i){for(;n;){for(var u=gt(n,t),r=0,f=u.length;f>r;r++)u[r].listener.call(n,i);n=n.parentNode}}function rt(n){return(n.relatedTarget&&"IFRAME"===n.relatedTarget.tagName||n.target&&"IFRAME"===n.target.tagName)&&(n.relatedTarget=null),n}function at(n,t,i,r){if(r)throw"This custom WinJS event only supports bubbling";lt(n,t,i,r)}function ni(n,t){var f=t.changedTouches,r=null,u,e;if(!f)return r;for(u=0,e=f.length;e>u;u++){var i=f[u],o=new w(t,{pointerType:et.MSPOINTER_TYPE_TOUCH,pointerId:i.identifier,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,radiusX:i.radiusX,radiusY:i.radiusY,rotationAngle:i.rotationAngle,force:i.force,_currentTouch:i}),s=n(o);r=r||s}return r}function ti(n,t){return t.pointerType=et.MSPOINTER_TYPE_MOUSE,t.pointerId=-1,n(t)}function ii(n,t){return n(t)}function ri(n,i,r,u){var s,h,c,e,o=i.toLowerCase(),f=b[o];t.MSPointerEvent?(c=function(n){return n._normalizedType=o,e=!0,ii(r,n)},n.addEventListener(f.mspointer,c,u)):(f.mouse&&(s=function(n){return n._normalizedType=o,e?void(e=!1):ti(r,n)},n.addEventListener(f.mouse,s,u)),f.touch&&(h=function(n){return n._normalizedType=o,e=!0,ni(r,n)},n.addEventListener(f.touch,h,u)));lt(n,i,r,u,{mouseWrapper:s,touchWrapper:h,mspointerWrapper:c})}function ui(n,t,i,r){var e=t.toLowerCase(),u=it(n,t,i,r),f;u&&(f=b[e],u.data.mouseWrapper&&n.removeEventListener(f.mouse,u.data.mouseWrapper,r),u.data.touchWrapper&&n.removeEventListener(f.touch,u.data.touchWrapper,r),u.data.mspointerWrapper&&n.removeEventListener(f.mspointer,u.data.mspointerWrapper,r))}function vt(){var n=t.document.createElement("div"),i;n.style.direction="rtl";n.innerHTML="<div style='width: 100px; height: 100px; overflow: scroll; visibility:hidden'><div style='width: 10000px; height: 100px;'><\/div><\/div>";t.document.body.appendChild(n);i=n.firstChild;i.scrollLeft>0&&(ht=!0);i.scrollLeft+=100;0===i.scrollLeft&&(wt=!0);t.document.body.removeChild(n);st=!0}function ut(n){var r=t.getComputedStyle(n),i=n.scrollLeft;return"rtl"===r.direction&&(st||vt(),ht&&(i=n.scrollWidth-n.clientWidth-i),i=Math.abs(i)),{scrollLeft:i,scrollTop:n.scrollTop}}function ft(n,i,r){if(void 0!==i){var u=t.getComputedStyle(n);"rtl"===u.direction&&(st||vt(),wt?i=-i:ht&&(i=n.scrollWidth-n.clientWidth-i));n.scrollLeft=i}void 0!==r&&(n.scrollTop=r)}function yt(n){return ut(n)}function fi(n,t){t=t||{};ft(n,t.scrollLeft,t.scrollTop)}function pt(n){return n.uniqueID||n._uniqueID||(n._uniqueID="element__"+ ++ki),n.uniqueID||n._uniqueID}function ei(n){n.id||(n.id=pt(n))}function oi(n){var i=t.document.documentElement,r=yt(i);return{left:n.clientX+("rtl"===t.document.body.dir?-r.scrollLeft:r.scrollLeft),top:n.clientY+i.scrollTop}}function si(n,t){for(var r,u=[],i=0,f=t.length;f>i;i++)r=n.querySelector("."+t[i]),r&&u.push(r);return u}var w,b,s,c;if(t.document){var p=167,hi=/^-?\d+\.?\d*(px)?$/i,ci=/^-?\d+/i,li=t.MSGestureEvent||{MSGESTURE_FLAG_BEGIN:1,MSGESTURE_FLAG_CANCEL:4,MSGESTURE_FLAG_END:2,MSGESTURE_FLAG_INERTIA:8,MSGESTURE_FLAG_NONE:0},ai=t.MSManipulationEvent||{MS_MANIPULATION_STATE_ACTIVE:1,MS_MANIPULATION_STATE_CANCELLED:6,MS_MANIPULATION_STATE_COMMITTED:7,MS_MANIPULATION_STATE_DRAGGING:5,MS_MANIPULATION_STATE_INERTIA:2,MS_MANIPULATION_STATE_PRESELECT:3,MS_MANIPULATION_STATE_SELECTING:4,MS_MANIPULATION_STATE_STOPPED:0},et=t.MSPointerEvent||{MSPOINTER_TYPE_TOUCH:"touch",MSPOINTER_TYPE_PEN:"pen",MSPOINTER_TYPE_MOUSE:"mouse"},h=null;t.addEventListener("blur",function(){var n=h;n&&y(n,"focusout",rt({type:"focusout",target:n,relatedTarget:null}));h=null});t.document.documentElement.addEventListener("focus",function(n){var t=h;h=n.target;t&&y(t,"focusout",rt({type:"focusout",target:t,relatedTarget:h}));h&&y(h,"focusin",rt({type:"focusin",target:h,relatedTarget:t}))},!0);w=function(n,t){t=t||{};this.__eventObject=n;var i=this;Object.keys(t).forEach(function(n){Object.defineProperty(i,n,{value:t[n]})})};["altKey","AT_TARGET","bubbles","BUBBLING_PHASE","button","buttons","cancelable","cancelBubble","CAPTURING_PHASE","clientX","clientY","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","getModifierState","height","hwTimestamp","initEvent","initMouseEvent","initPointerEvent","initUIEvent","isPrimary","isTrusted","layerX","layerY","metaKey","offsetX","offsetY","pageX","pageY","pointerId","pointerType","pressure","preventDefault","relatedTarget","rotation","screenX","screenY","shiftKey","srcElement","stopImmediatePropagation","stopPropagation","target","tiltX","tiltY","timeStamp","toElement","type","view","which","width","x","y","_normalizedType","_fakedBySemanticZoom"].forEach(function(n){Object.defineProperty(w.prototype,n,{get:function(){var t=this.__eventObject[n];return"function"==typeof t?t.bind(this.__eventObject):t},configurable:!0})});b={pointerdown:{touch:"touchstart",mspointer:"MSPointerDown",mouse:"mousedown"},pointerup:{touch:"touchend",mspointer:"MSPointerUp",mouse:"mouseup"},pointermove:{touch:"touchmove",mspointer:"MSPointerMove",mouse:"mousemove"},pointerenter:{touch:"touchenter",mspointer:"MSPointerEnter",mouse:"mouseenter"},pointerover:{touch:null,mspointer:"MSPointerOver",mouse:"mouseover"},pointerout:{touch:"touchleave",mspointer:"MSPointerOut",mouse:"mouseout"},pointercancel:{touch:"touchcancel",mspointer:"MSPointerCancel",mouse:null}};s={focusout:{register:at,unregister:it},focusin:{register:at,unregister:it}};t.PointerEvent||(c={register:ri,unregister:ui},s.pointerdown=c,s.pointerup=c,s.pointermove=c,s.pointerenter=c,s.pointerover=c,s.pointerout=c,s.pointercancel=c);var vi=i.Class.define(function(n){this._callback=n;this._toDispose=[];this._attributeFilter=[];this._scheduled=!1;this._pendingChanges=[];this._observerCount=0;this._handleCallback=this._handleCallback.bind(this);this._targetElements=[]},{observe:function(n,t){-1===this._targetElements.indexOf(n)&&this._targetElements.push(n);this._observerCount++;t.attributes&&this._addRemovableListener(n,"DOMAttrModified",this._handleCallback);t.attributeFilter&&(this._attributeFilter=t.attributeFilter)},disconnect:function(){this._observerCount=0;this._targetElements=[];this._toDispose.forEach(function(n){n()})},_addRemovableListener:function(n,t,i){n.addEventListener(t,i);this._toDispose.push(function(){n.removeEventListener(t,i)})},_handleCallback:function(n){if(n.stopPropagation(),(!this._attributeFilter.length||-1!==this._attributeFilter.indexOf(n.attrName))&&-1!==this._targetElements.indexOf(n.target)){var t=n.attrName;"tabindex"===t&&(t="tabIndex");this._pendingChanges.push({type:"attributes",target:n.target,attributeName:t});1===this._observerCount?this._dispatchEvent():this._scheduled===!1&&(this._scheduled=!0,r._setImmediate(this._dispatchEvent.bind(this)))}},_dispatchEvent:function(){try{this._callback(this._pendingChanges)}finally{this._pendingChanges=[];this._scheduled=!1}}},{_isShim:!0}),yi=t.MutationObserver||vi,ot=null,pi=i.Class.define(function(){t.addEventListener("resize",this._handleResize.bind(this))},{subscribe:function(n,t){n.addEventListener(this._resizeEvent,t);g(n,this._resizeClass)},unsubscribe:function(n,t){nt(n,this._resizeClass);n.removeEventListener(this._resizeEvent,t)},_handleResize:function(){for(var i,r=t.document.querySelectorAll("."+this._resizeClass),u=r.length,n=0;u>n;n++)i=t.document.createEvent("Event"),i.initEvent(this._resizeEvent,!1,!0),r[n].dispatchEvent(i)},_resizeClass:{get:function(){return"win-element-resize"}},_resizeEvent:{get:function(){return"WinJSElementResize"}}}),k=i.Class.define(function(n,t,i){i=i||{};this.registerThruWinJSCustomEvents=!!i.registerThruWinJSCustomEvents;this.objectName=n;this.object=t;this.capture={};this.bubble={}},{addEventListener:function(t,i,r,u){i=i.toLowerCase();var e=this._getHandlers(u),f=e[i];f||(f=this._getListener(i,u),f.refCount=0,e[i]=f,this.registerThruWinJSCustomEvents?n._addEventListener(this.object,i,f,u):this.object.addEventListener(i,f,u));f.refCount++;t.addEventListener(this._getEventName(i,u),r);g(t,this._getClassName(i,u))},removeEventListener:function(t,i,r,u){i=i.toLowerCase();var e=this._getHandlers(u),f=e[i];f&&(f.refCount--,0===f.refCount&&(this.registerThruWinJSCustomEvents?n._removeEventListener(this.object,i,f,u):this.object.removeEventListener(i,f,u),delete e[i]));nt(t,this._getClassName(i,u));t.removeEventListener(this._getEventName(i,u),r)},_getHandlers:function(n){return n?this.capture:this.bubble},_getClassName:function(n,t){var i=t?"capture":"bubble";return"win-"+this.objectName.toLowerCase()+"-event-"+n+i},_getEventName:function(n,t){var i=t?"capture":"bubble";return"WinJS"+this.objectName+"Event-"+n+i},_getListener:function(n,i){var r=function(r){for(var u,s,o=t.document.querySelectorAll("."+this._getClassName(n,i)),h=o.length,f=!1,e=0;h>e;e++)u=t.document.createEvent("Event"),u.initEvent(this._getEventName(n,i),!1,!0),u.detail={originalEvent:r},s=o[e].dispatchEvent(u),f=f||!s;return f};return r.bind(this)}}),st=!1,ht=!1,wt=!1,wi=!!t.HTMLElement.prototype.msZoomTo,bi=!(!t.MSPointerEvent&&!t.TouchEvent),ki=0,bt=".win-selectionborder, .win-selectionbackground, .win-selectioncheckmark, .win-selectioncheckmarkbackground",d="_msDataKey";i.Namespace._moduleDefine(n,"WinJS.Utilities",{_dataKey:d,_supportsTouchDetection:{get:function(){return bi}},_supportsZoomTo:{get:function(){return wi}},_uniqueID:pt,_ensureId:ei,_clamp:tt,_getCursorPos:oi,_getElementsByClasses:si,_createGestureRecognizer:function(){if(t.MSGesture)return new t.MSGesture;var n=function(){};return{addEventListener:n,removeEventListener:n,addPointer:n,stop:n}},_supportsTouchActionCrossSlide:{get:function(){var i,n;return void 0===this._supportsTouchActionCrossSlideValue&&(this._supportsTouchActionCrossSlideValue=!1,i=r._browserStyleEquivalents["touch-action"],i&&(n=t.document.createElement("div"),n.style.touchAction="cross-slide-x",t.document.body.appendChild(n),this._supportsTouchActionCrossSlideValue="cross-slide-x"===t.getComputedStyle(n).touchAction,t.document.body.removeChild(n))),this._supportsTouchActionCrossSlideValue}},_detectSnapPointsSupport:function(){return this._snapPointsDetectionPromise||(this._snapPointsDetectionPromise=t.HTMLElement.prototype.msZoomTo?new f(function(n){var i=t.document.createElement("div"),r,u,f;i.style.width="100px";i.style.overflowX="scroll";i.style.msScrollSnapType="mandatory";i.style.position="absolute";i.style.opacity="0";i.style.visibility="hidden";r=function(){i.removeEventListener("MSManipulationStateChanged",r);t.clearTimeout(f);t.document.body.removeChild(i);n(!0)};i.addEventListener("MSManipulationStateChanged",r);u=t.document.createElement("div");u.style.width=u.style.height="200px";i.appendChild(u);t.document.body.appendChild(i);i.msZoomTo({contentX:90});f=t.setTimeout(function(){i.removeEventListener("MSManipulationStateChanged",r);t.document.body.removeChild(i);n(!1)},50)}):f.wrap(!1)),this._snapPointsDetectionPromise},_MSGestureEvent:li,_MSManipulationEvent:ai,_elementsFromPoint:function(n,i){if(t.document.msElementsFromPoint)return t.document.msElementsFromPoint(n,i);var r=t.document.elementFromPoint(n,i);return r?[r]:null},_matchesSelector:function(n,t){var i=n.matches||n.msMatchesSelector||n.mozMatchesSelector||n.webkitMatchesSelector;return i.call(n,t)},_selectionPartsSelector:bt,_isSelectionRendered:function(n){return n.querySelectorAll(bt).length>0},_addEventListener:function(n,t,i,u){var o=t&&t.toLowerCase(),f=s[o],e=r._browserEventEquivalents[t];f?f.register(n,t,i,u):e?n.addEventListener(e,i,u):n.addEventListener(t,i,u)},_removeEventListener:function(n,t,i,u){var o=t&&t.toLowerCase(),f=s[o],e=r._browserEventEquivalents[t];f?f.unregister(n,t,i,u):e?n.removeEventListener(e,i,u):n.removeEventListener(t,i,u)},_initEventImpl:function(n,t,i){i=i.toLowerCase();var r=b[i];if(r)switch(n.toLowerCase()){case"pointer":arguments[2]=r.mspointer;break;default:arguments[2]=r[n.toLowerCase()]}t["init"+n+"Event"].apply(t,Array.prototype.slice.call(arguments,2))},_initMouseEvent:function(n){this._initEventImpl.apply(this,["Mouse",n].concat(Array.prototype.slice.call(arguments,1)))},_initPointerEvent:function(n){this._initEventImpl.apply(this,["Pointer",n].concat(Array.prototype.slice.call(arguments,1)))},_PointerEventProxy:w,_bubbleEvent:y,_setPointerCapture:function(n,t){n.setPointerCapture&&n.setPointerCapture(t)},_releasePointerCapture:function(n,t){n.releasePointerCapture&&n.releasePointerCapture(t)},_MSPointerEvent:et,_zoomToDuration:p,_zoomTo:function(n,i){n.msZoomTo?n.msZoomTo(i):e.schedule(function(){var u=ut(n),s="number"==typeof n._zoomToDestX?n._zoomToDestX:u.scrollLeft,h="number"==typeof n._zoomToDestY?n._zoomToDestY:u.scrollTop,f=t.getComputedStyle(n),l=n.scrollWidth-parseInt(f.width,10)-parseInt(f.paddingLeft,10)-parseInt(f.paddingRight,10),a=n.scrollHeight-parseInt(f.height,10)-parseInt(f.paddingTop,10)-parseInt(f.paddingBottom,10),e,o;if("number"!=typeof i.contentX&&(i.contentX=s),"number"!=typeof i.contentY&&(i.contentY=h),e=tt(i.contentX,0,l),o=tt(i.contentY,0,a),e!==s||o!==h){n._zoomToId=n._zoomToId||0;n._zoomToId++;n._zoomToDestX=e;n._zoomToDestY=o;var v=n._zoomToId,y=r._now(),w=(n._zoomToDestX-u.scrollLeft)/p,b=(n._zoomToDestY-u.scrollTop)/p,c=function(){var t=r._now()-y;n._zoomToId===v&&(t>p?(ft(n,n._zoomToDestX,n._zoomToDestY),n._zoomToDestX=null,n._zoomToDestY=null):(ft(n,u.scrollLeft+t*w,u.scrollTop+t*b),r._requestAnimationFrame(c)))};r._requestAnimationFrame(c)}},e.Priority.high,null,"WinJS.Utilities._zoomTo")},_setActive:function(n,i){var r=!0,u,f;try{t.HTMLElement&&t.HTMLElement.prototype.setActive?n.setActive():(i&&(u=i.scrollLeft,f=i.scrollTop),n.focus(),i&&(i.scrollLeft=u,i.scrollTop=f))}catch(e){r=!1}return r},_MutationObserver:yi,_resizeNotifier:{get:function(){return ot||(ot=new pi),ot}},_GenericListener:k,_globalListener:new k("Global",t,{registerThruWinJSCustomEvents:!0}),_documentElementListener:new k("DocumentElement",t.document.documentElement,{registerThruWinJSCustomEvents:!0}),_inputPaneListener:u.Windows.UI.ViewManagement.InputPane?new k("InputPane",u.Windows.UI.ViewManagement.InputPane.getForCurrentView()):{addEventListener:function(){},removeEventListener:function(){}},_addInsertedNotifier:function(i){var u=t.document.createElement("div");return u.style[r._browserStyleEquivalents["animation-name"].scriptName]="WinJS-node-inserted",u.style[r._browserStyleEquivalents["animation-duration"].scriptName]="0.01s",u.style.position="absolute",i.appendChild(u),n._addEventListener(u,"animationStart",function(n){if("WinJS-node-inserted"===n.animationName){var n=t.document.createEvent("Event");n.initEvent("WinJSNodeInserted",!1,!0);i.dispatchEvent(n)}},!1),u},_setFlexStyle:function(n,t){var i=n.style;"undefined"!=typeof t.grow&&(i.msFlexPositive=t.grow,i.webkitFlexGrow=t.grow,i.flexGrow=t.grow);"undefined"!=typeof t.shrink&&(i.msFlexNegative=t.shrink,i.webkitFlexShrink=t.shrink,i.flexShrink=t.shrink);"undefined"!=typeof t.basis&&(i.msFlexPreferredSize=t.basis,i.webkitFlexBasis=t.basis,i.flexBasis=t.basis)},Key:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,deleteKey:46,num0:48,num1:49,num2:50,num3:51,num4:52,num5:53,num6:54,num7:55,num8:56,num9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindows:91,rightWindows:92,menu:93,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,numLock:144,scrollLock:145,browserBack:166,browserForward:167,semicolon:186,equal:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222,IME:229},data:function(n){return n[d]||(n[d]={}),n[d]},hasClass:function(n,t){if(n.classList)return n.classList.contains(t);for(var u=v(n),r=u.trim().split(" "),f=r.length,i=0;f>i;i++)if(r[i]===t)return!0;return!1},addClass:g,removeClass:nt,toggleClass:kt,_setAttribute:dt,getRelativeLeft:function(n,t){if(!n)return 0;for(var r=n.offsetLeft,i=n.parentNode;i&&(r-=i.offsetLeft,i!==t);)i=i.parentNode;return r},getRelativeTop:function(n,t){if(!n)return 0;for(var r=n.offsetTop,i=n.parentNode;i&&(r-=i.offsetTop,i!==t);)i=i.parentNode;return r},getScrollPosition:yt,setScrollPosition:fi,empty:function(n){if(n.childNodes&&n.childNodes.length>0)for(var t=n.childNodes.length-1;t>=0;t--)n.removeChild(n.childNodes.item(t));return n},_isDOMElement:function(n){return n&&"object"==typeof n&&"string"==typeof n.tagName},getContentWidth:function(n){var t=o(n,"borderLeftWidth")+o(n,"borderRightWidth"),i=o(n,"paddingLeft")+o(n,"paddingRight");return n.offsetWidth-t-i},getTotalWidth:function(n){var t=o(n,"marginLeft")+o(n,"marginRight");return n.offsetWidth+t},getContentHeight:function(n){var t=o(n,"borderTopWidth")+o(n,"borderBottomWidth"),i=o(n,"paddingTop")+o(n,"paddingBottom");return n.offsetHeight-t-i},getTotalHeight:function(n){var t=o(n,"marginTop")+o(n,"marginBottom");return n.offsetHeight+t},getPosition:function(n){for(var e,u=n,f=n.offsetParent,i=n.offsetTop,r=n.offsetLeft;(n=n.parentNode)&&n!==t.document.body&&n!==t.document.documentElement;)i-=n.scrollTop,e=t.document.defaultView.getComputedStyle(n,null).direction,r-="rtl"!==e?n.scrollLeft:-ut(n).scrollLeft,n===f&&(i+=n.offsetTop,r+=n.offsetLeft,f=n.offsetParent);return{left:r,top:i,width:u.offsetWidth,height:u.offsetHeight}},getTabIndex:function(n){var i,t;return n.disabled?-1:(i=n.getAttribute("tabindex"),null===i||void 0===i)?(t=n.tagName,/BUTTON|COMMAND|MENUITEM|OBJECT|SELECT|TEXTAREA/.test(t)||n.href&&("A"===t||"AREA"===t||"LINK"===t)||"INPUT"===t&&"hidden"!==n.type||"TH"===t&&n.sorted?0:-1):parseInt(i,10)},convertToPixels:ct,eventWithinElement:function(n,t){var i=t.relatedTarget;return i&&i!==n?n.contains(i):!1},_deprecated:function(n){t.console&&t.console.warn(n)},_syncRenderer:function(n,i){if(i=i||"div","function"==typeof n)return function(t,i){return i?(i.appendChild(n(t)),i):n(t)};var r;return"function"==typeof n.render?r=n:n.winControl&&"function"==typeof n.winControl.render&&(r=n.winControl),function(n,u){var e=u||t.document.createElement(i),f,o;return(r.render(n,e),u)?u:(f=e.firstElementChild,f&&e.dispose&&(o=f.dispose,f.dispose=function(){f.dispose=o;e.appendChild(f);e.dispose()}),f)}},_getHighAndLowTabIndices:function(n){for(var u,t,e=n.getElementsByTagName("*"),i=0,r=0,o=!1,f=0,s=e.length;s>f;f++)u=e[f].getAttribute("tabIndex"),null!==u&&void 0!==u&&(t=parseInt(u,10),t>0&&(i>t||0===i)&&(i=t),o||(0===t?(o=!0,r=0):t>r&&(r=t)));return{highest:r,lowest:i}},_getLowestTabIndexInList:function(n){for(var t,i=0,r=0;r<n.length;r++)t=parseInt(n[r].getAttribute("tabIndex"),10),t>0&&(i>t||!i)&&(i=t);return i},_getHighestTabIndexInList:function(n){for(var t,i=0,r=0;r<n.length;r++){if(t=parseInt(n[r].getAttribute("tabIndex"),10),0===t)return t;t>i&&(i=t)}return i},_reparentChildren:function(n,t){for(var r,i=n.firstChild;i;)r=i.nextSibling,t.appendChild(i),i=r},_trySetActive:function(n,t){return this._tryFocus(n,!0,t)},_tryFocus:function(i,r,u){var f=t.document.activeElement,e;return i===f?!0:(e=n.getTabIndex(i)>=0,e?(r?n._setActive(i,u):i.focus(),f!==t.document.activeElement?!0:!1):!1)},_setActiveFirstFocusableElement:function(n,t){return this._focusFirstFocusableElement(n,!0,t)},_focusFirstFocusableElement:function(n,t,i){for(var r,u=n.getElementsByTagName("*"),e=this._getLowestTabIndexInList(u),f=0;e;){for(r=0;r<u.length;r++)if(u[r].tabIndex===e){if(this._tryFocus(u[r],t,i))return!0}else e<u[r].tabIndex&&(u[r].tabIndex<f||0===f)&&(f=u[r].tabIndex);e=f;f=0}for(r=0;r<u.length;r++)if(this._tryFocus(u[r],t,i))return!0;return!1},_setActiveLastFocusableElement:function(n,t){return this._focusLastFocusableElement(n,!0,t)},_focusLastFocusableElement:function(n,t,i){var r,u=n.getElementsByTagName("*"),e=this._getHighestTabIndexInList(u),f=0;if(0===e){for(r=u.length-1;r>=0;r--)if(u[r].tabIndex===e){if(this._tryFocus(u[r],t,i))return!0}else f<u[r].tabIndex&&(f=u[r].tabIndex);e=f;f=0}for(;e;){for(r=u.length-1;r>=0;r--)if(u[r].tabIndex===e){if(this._tryFocus(u[r],t,i))return!0}else f<u[r].tabIndex&&u[r].tabIndex<e&&(f=u[r].tabIndex);e=f;f=0}for(r=u.length-2;r>0;r--)if(this._tryFocus(u[r],t,i))return!0;return!1}})}});t("WinJS/Utilities/_Dispose",["exports","../Core/_Base","../Core/_WriteProfilerMark","./_ElementUtilities"],function(n,t,i,r){"use strict";function f(n,t){var i=!1,f;r.addClass(n,"win-disposable");f=n.winControl||n;f.dispose=function(){i||(i=!0,u(n),t&&t())}}function u(n){var t;if(n){i("WinJS.Utilities.disposeSubTree,StartTM");for(var u=n.querySelectorAll(".win-disposable"),r=0,f=u.length;f>r;)t=u[r],t.winControl&&t.winControl.dispose&&t.winControl.dispose(),t.dispose&&t.dispose(),r+=t.querySelectorAll(".win-disposable").length+1;i("WinJS.Utilities.disposeSubTree,StopTM")}}function e(n){if(n){var t=!1;n.winControl&&n.winControl.dispose&&(n.winControl.dispose(),t=!0);n.dispose&&(n.dispose(),t=!0);t||u(n)}}t.Namespace._moduleDefine(n,"WinJS.Utilities",{markDisposable:f,disposeSubTree:u,_disposeElement:e})});t("WinJS/ControlProcessor/_OptionsLexer",["exports","../Core/_Base"],function(n,t){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_optionsLexer:t.Namespace._lazy(function(){function i(t){return{type:n.reservedWord,value:t,length:t.length,keyword:!0}}function u(n){switch(n.charCodeAt(0)){case 98:switch(n){case"break":return i(n)}break;case 99:switch(n){case"case":case"catch":case"class":case"const":case"continue":return i(n)}break;case 100:switch(n){case"debugger":case"default":case"delete":case"do":return i(n)}break;case 101:switch(n){case"else":case"enum":case"export":case"extends":return i(n)}break;case 102:switch(n){case"false":return t.falseLiteral;case"finally":case"for":case"function":return i(n)}break;case 105:switch(n){case"if":case"import":case"in":case"instanceof":return i(n)}break;case 110:switch(n){case"null":return t.nullLiteral;case"new":return i(n)}break;case 114:switch(n){case"return":return i(n)}break;case 115:switch(n){case"super":case"switch":return i(n)}break;case 116:switch(n){case"true":return t.trueLiteral;case"this":return t.thisKeyword;case"throw":case"try":case"typeof":return i(n)}break;case 118:switch(n){case"var":case"void":return i(n)}break;case 119:switch(n){case"while":case"with":return i(n)}}}var n={leftBrace:1,rightBrace:2,leftBracket:3,rightBracket:4,separator:5,colon:6,semicolon:7,comma:8,dot:9,nullLiteral:10,trueLiteral:11,falseLiteral:12,numberLiteral:13,stringLiteral:14,identifier:15,reservedWord:16,thisKeyword:17,leftParentheses:18,rightParentheses:19,eof:20,error:21},t={leftBrace:{type:n.leftBrace,length:1},rightBrace:{type:n.rightBrace,length:1},leftBracket:{type:n.leftBracket,length:1},rightBracket:{type:n.rightBracket,length:1},colon:{type:n.colon,length:1},semicolon:{type:n.semicolon,length:1},comma:{type:n.comma,length:1},dot:{type:n.dot,length:1},nullLiteral:{type:n.nullLiteral,length:4,value:null,keyword:!0},trueLiteral:{type:n.trueLiteral,length:4,value:!0,keyword:!0},falseLiteral:{type:n.falseLiteral,length:5,value:!1,keyword:!0},thisKeyword:{type:n.thisKeyword,length:4,value:"this",keyword:!0},leftParentheses:{type:n.leftParentheses,length:1},rightParentheses:{type:n.rightParentheses,length:1},eof:{type:n.eof,length:0}},r=function(){function h(n,t,r,u){switch(n){case n>=97&&122>=n&&n:case n>=65&&90>=n&&n:case 36:case 95:return!0;case s(n)&&n:case e(n)&&n:return!1;case n>127&&n:return!0;case 92:return u>r+4&&117===t.charCodeAt(r)&&i(t.charCodeAt(r+1))&&i(t.charCodeAt(r+2))&&i(t.charCodeAt(r+3))&&i(t.charCodeAt(r+4))?!0:!1;default:return!1}}function c(n,t,r){for(var u,f=!1;r>t;){u=n.charCodeAt(t);switch(u){case u>=97&&122>=u&&u:case u>=65&&90>=u&&u:case 36:case 95:break;case s(u)&&u:case e(u)&&u:return f?-t:t;case u>127&&u:break;case u>=48&&57>=u&&u:break;case 92:if(r>t+5&&117===n.charCodeAt(t+1)&&i(n.charCodeAt(t+2))&&i(n.charCodeAt(t+3))&&i(n.charCodeAt(t+4))&&i(n.charCodeAt(t+5))){t+=5;f=!0;break}return f?-t:t;default:return f?-t:t}t++}return f?-t:t}function l(t,i,r){var e=i,o,f,s;return i=c(t,i,r),o=!1,0>i&&(i=-i,o=!0),f=t.substr(e,i-e),o&&(f=""+JSON.parse('"'+f+'"')),s=u(f),s?s:{type:n.identifier,length:i-e,value:f}}function i(n){switch(n){case n>=48&&57>=n&&n:case n>=97&&102>=n&&n:case n>=65&&70>=n&&n:return!0;default:return!1}}function a(n,t,r){for(;r>t&&i(n.charCodeAt(t));)t++;return t}function r(n){switch(n){case n>=48&&57>=n&&n:return!0;default:return!1}}function o(n,t,i){for(;i>t&&r(n.charCodeAt(t));)t++;return t}function v(n,t,i){var u,f;return(t=o(n,t,i),i>t&&46===n.charCodeAt(t)&&i>t+1&&r(n.charCodeAt(t+1))&&(t=o(n,t+2,i)),i>t)&&(u=n.charCodeAt(t),(101===u||69===u)&&(f=t+1,i>f&&(u=n.charCodeAt(f),(43===u||45===u)&&f++,t=o(n,f,i)))),t}function f(t,i,r,u){var r=v(t,r,u),f=r-i;return{type:n.numberLiteral,length:f,value:+t.substr(i,f)}}function e(n){switch(n){case 10:case 13:case 8232:case 8233:return!0;default:return!1}}function y(text,offset,limit){var startOffset=offset,quoteCharCode=text.charCodeAt(offset),hasEscape=!1,length,stringValue;for(offset++;limit>offset&&!e(text.charCodeAt(offset));){if(limit>offset+1&&92===text.charCodeAt(offset))switch(hasEscape=!0,text.charCodeAt(offset+1)){case quoteCharCode:case 92:case 10:case 8232:case 8233:offset+=2;continue;case 13:offset+=limit>offset+2&&10===text.charCodeAt(offset+2)?3:2;continue}if(offset++,text.charCodeAt(offset-1)===quoteCharCode)break}return length=offset-startOffset,hasEscape=hasEscape||1===length||text.charCodeAt(offset-1)!==quoteCharCode,stringValue=hasEscape?eval(text.substr(startOffset,length)):text.substr(startOffset+1,length-2),{type:n.stringLiteral,length:length,value:stringValue}}function s(n){switch(n){case 9:case 11:case 12:case 32:case 160:case 65279:return!0;case 5760>n&&n:return!1;case 5760:case 6158:case n>=8192&&8202>=n&&n:case 8239:case 8287:case 12288:return!0;default:return!1}}function p(n,t,i){for(;i>t;){var r=n.charCodeAt(t);switch(r){case 9:case 11:case 12:case 32:case 160:case 65279:break;case 5760>r&&r:return t;case 5760:case 6158:case r>=8192&&8202>=r&&r:case 8239:case 8287:case 12288:break;default:return t}t++}return t}function w(i,u,o,c){for(var v,w,b,d,k,g,nt;c>o;){w=o;b=u.charCodeAt(o++);switch(b){case s(b)&&b:case e(b)&&b:o=p(u,o,c);v={type:n.separator,length:o-w};continue;case 34:case 39:v=y(u,o-1,c);break;case 40:v=t.leftParentheses;break;case 41:v=t.rightParentheses;break;case 43:case 45:if(c>o)if(d=u.charCodeAt(o),46===d){if(k=o+1,c>k&&r(u.charCodeAt(k))){v=f(u,w,k,c);break}}else if(r(d)){v=f(u,w,o,c);break}v={type:n.error,length:o-w,value:u.substring(w,o)};break;case 44:v=t.comma;break;case 46:v=t.dot;c>o&&r(u.charCodeAt(o))&&(v=f(u,w,o,c));break;case 48:g=c>o?u.charCodeAt(o):0;120===g||88===g?(nt=a(u,o+1,c),v={type:n.numberLiteral,length:nt-w,value:+u.substr(w,nt-w)}):v=f(u,w,o,c);break;case b>=49&&57>=b&&b:v=f(u,w,o,c);break;case 58:v=t.colon;break;case 59:v=t.semicolon;break;case 91:v=t.leftBracket;break;case 93:v=t.rightBracket;break;case 123:v=t.leftBrace;break;case 125:v=t.rightBrace;break;default:if(h(b,u,o,c)){v=l(u,o-1,c);break}v={type:n.error,length:o-w,value:u.substring(w,o)}}o+=v.length-1;i.push(v)}}return function(n){var i=[];return w(i,n,0,n.length),i.push(t.eof),i}}();return r.tokenType=n,r})})});t("WinJS/ControlProcessor/_OptionsParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","./_OptionsLexer"],function(n,t,i,r,u,f){"use strict";function s(){throw"Illegal";}function a(n){for(var i=Object.keys(e.tokenType),t=0,r=i.length;r>t;t++)if(n===e.tokenType[i[t]])return i[t];return"<unknown>"}var c={get invalidOptionsRecord(){return"Invalid options record: '{0}', expected to be in the format of an object literal. {1}"},get unexpectedTokenExpectedToken(){return"Unexpected token: {0}, expected token: {1}, at offset {2}"},get unexpectedTokenExpectedTokens(){return"Unexpected token: {0}, expected one of: {1}, at offset {2}"},get unexpectedTokenGeneric(){return"Unexpected token: {0}, at offset {1}"}},e=t.Namespace.defineWithParent(null,null,{lexer:t.Namespace._lazy(function(){return f._optionsLexer}),tokenType:t.Namespace._lazy(function(){return f._optionsLexer.tokenType})}),v=i.requireSupportedForProcessing,o=t.Namespace.defineWithParent(null,null,{BaseInterpreter:t.Namespace._lazy(function(){return t.Class.define(null,{_error:function(n){throw new r("WinJS.UI.ParseError",n);},_currentOffset:function(){for(var i=this._pos,t=0,n=0;i>n;n++)t+=this._tokens[n].length;return t},_evaluateAccessExpression:function(n){var t,i;switch(this._current.type){case e.tokenType.dot:switch(this._read(),this._current.type){case e.tokenType.identifier:case this._current.keyword&&this._current.type:return t=this._current.value,this._read(),n[t];default:this._unexpectedToken(e.tokenType.identifier,e.tokenType.reservedWord)}return;case e.tokenType.leftBracket:return this._read(),i=this._evaluateValue(),this._read(e.tokenType.rightBracket),n[i]}},_evaluateAccessExpressions:function(n){for(;;)switch(this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:n=this._evaluateAccessExpression(n);break;default:return n}},_evaluateIdentifier:function(n,t){var i=this._readIdentifier();return n?t[i]:this._context[i]},_evaluateIdentifierExpression:function(){var n=this._evaluateIdentifier(!1);switch(this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:return this._evaluateAccessExpressions(n);default:return n}},_initialize:function(n,t,i,r){this._originalSource=t;this._tokens=n;this._context=i;this._functionContext=r;this._pos=0;this._current=this._tokens[0]},_read:function(n){n&&this._current.type!==n&&this._unexpectedToken(n);this._current!==e.tokenType.eof&&(this._current=this._tokens[++this._pos])},_peek:function(n){if(!n||this._current.type===n)return this._current!==e.tokenType.eof?this._tokens[this._pos+1]:void 0},_readAccessExpression:function(n){switch(this._current.type){case e.tokenType.dot:switch(this._read(),this._current.type){case e.tokenType.identifier:case this._current.keyword&&this._current.type:n.push(this._current.value);this._read();break;default:this._unexpectedToken(e.tokenType.identifier,e.tokenType.reservedWord)}return;case e.tokenType.leftBracket:return this._read(),n.push(this._evaluateValue()),void this._read(e.tokenType.rightBracket)}},_readAccessExpressions:function(n){for(;;)switch(this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:this._readAccessExpression(n);break;default:return}},_readIdentifier:function(){var n=this._current.value;return this._read(e.tokenType.identifier),n},_readIdentifierExpression:function(){var n=[];switch(this._peek(e.tokenType.thisKeyword)&&0===n.length?this._read():n.push(this._readIdentifier()),this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:this._readAccessExpressions(n)}return n},_unexpectedToken:function(n){var t=this._current.type===e.tokenType.error?"'"+this._current.value+"'":a(this._current.type);if(n)if(1===arguments.length)n=a(n),this._error(u._formatString(c.unexpectedTokenExpectedToken,t,n,this._currentOffset()));else{for(var r=[],i=0,f=arguments.length;f>i;i++)r.push(a(arguments[i]));n=r.join(", ");this._error(u._formatString(c.unexpectedTokenExpectedTokens,t,n,this._currentOffset()))}else this._error(u._formatString(c.unexpectedTokenGeneric,t,this._currentOffset()))}},{supportedForProcessing:!1})}),OptionsInterpreter:t.Namespace._lazy(function(){return t.Class.derive(o.BaseInterpreter,function(n,t,i,r){this._initialize(n,t,i,r)},{_error:function(n){throw new r("WinJS.UI.ParseError",u._formatString(c.invalidOptionsRecord,this._originalSource,n));},_evaluateArrayLiteral:function(){var n=[];return this._read(e.tokenType.leftBracket),this._readArrayElements(n),this._read(e.tokenType.rightBracket),n},_evaluateObjectLiteral:function(){var n={};return this._read(e.tokenType.leftBrace),this._readObjectProperties(n),this._tryReadComma(),this._read(e.tokenType.rightBrace),n},_evaluateOptionsLiteral:function(){var n=this._evaluateValue();return this._current.type!==e.tokenType.eof&&this._unexpectedToken(e.tokenType.eof),n},_peekValue:function(){switch(this._current.type){case e.tokenType.falseLiteral:case e.tokenType.nullLiteral:case e.tokenType.stringLiteral:case e.tokenType.trueLiteral:case e.tokenType.numberLiteral:case e.tokenType.leftBrace:case e.tokenType.leftBracket:case e.tokenType.identifier:return!0;default:return!1}},_evaluateValue:function(){switch(this._current.type){case e.tokenType.falseLiteral:case e.tokenType.nullLiteral:case e.tokenType.stringLiteral:case e.tokenType.trueLiteral:case e.tokenType.numberLiteral:var n=this._current.value;return this._read(),n;case e.tokenType.leftBrace:return this._evaluateObjectLiteral();case e.tokenType.leftBracket:return this._evaluateArrayLiteral();case e.tokenType.identifier:return v(this._peek(e.tokenType.identifier).type===e.tokenType.leftParentheses?this._evaluateObjectQueryExpression():this._evaluateIdentifierExpression());default:this._unexpectedToken(e.tokenType.falseLiteral,e.tokenType.nullLiteral,e.tokenType.stringLiteral,e.tokenType.trueLiteral,e.tokenType.numberLiteral,e.tokenType.leftBrace,e.tokenType.leftBracket,e.tokenType.identifier)}},_tryReadElement:function(n){return this._peekValue()?(n.push(this._evaluateValue()),!0):!1},_tryReadComma:function(){return this._peek(e.tokenType.comma)?(this._read(),!0):!1},_tryReadElision:function(n){for(var t=!1;this._tryReadComma();)n.push(void 0),t=!0;return t},_readArrayElements:function(n){for(;!this._peek(e.tokenType.rightBracket);){var i=this._tryReadElision(n),t=this._tryReadElement(n),r=this._peek(e.tokenType.comma);if(!t||!r){if(t||i)break;this._unexpectedToken(e.tokenType.falseLiteral,e.tokenType.nullLiteral,e.tokenType.stringLiteral,e.tokenType.trueLiteral,e.tokenType.numberLiteral,e.tokenType.leftBrace,e.tokenType.leftBracket,e.tokenType.identifier);break}this._read()}},_readObjectProperties:function(n){for(;!this._peek(e.tokenType.rightBrace);){var t=this._tryReadObjectProperty(n),i=this._peek(e.tokenType.comma);if(!t||!i){if(t)break;this._unexpectedToken(e.tokenType.numberLiteral,e.tokenType.stringLiteral,e.tokenType.identifier);break}this._read()}},_tryReadObjectProperty:function(n){switch(this._current.type){case e.tokenType.numberLiteral:case e.tokenType.stringLiteral:case e.tokenType.identifier:case this._current.keyword&&this._current.type:var t=this._current.value;return this._read(),this._read(e.tokenType.colon),n[t]=this._evaluateValue(),!0;default:return!1}},_failReadObjectProperty:function(){this._unexpectedToken(e.tokenType.numberLiteral,e.tokenType.stringLiteral,e.tokenType.identifier,e.tokenType.reservedWord)},_evaluateObjectQueryExpression:function(){var i=this._current.value,t,n;this._read(e.tokenType.identifier);this._read(e.tokenType.leftParentheses);t=this._current.value;this._read(e.tokenType.stringLiteral);this._read(e.tokenType.rightParentheses);n=v(this._functionContext[i])(t);switch(this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:return this._evaluateAccessExpressions(n);default:return n}},run:function(){return this._evaluateOptionsLiteral()}},{supportedForProcessing:!1})}),OptionsParser:t.Namespace._lazy(function(){return t.Class.derive(o.OptionsInterpreter,function(n,t){this._initialize(n,t)},{_evaluateAccessExpression:s,_evaluateAccessExpressions:s,_evaluateIdentifier:s,_evaluateIdentifierExpression:s,_evaluateObjectQueryExpression:s,_evaluateValue:function(){switch(this._current.type){case e.tokenType.falseLiteral:case e.tokenType.nullLiteral:case e.tokenType.stringLiteral:case e.tokenType.trueLiteral:case e.tokenType.numberLiteral:var n=this._current.value;return this._read(),n;case e.tokenType.leftBrace:return this._evaluateObjectLiteral();case e.tokenType.leftBracket:return this._evaluateArrayLiteral();case e.tokenType.identifier:return this._peek(e.tokenType.identifier).type===e.tokenType.leftParentheses?this._readObjectQueryExpression():this._readIdentifierExpression();default:this._unexpectedToken(e.tokenType.falseLiteral,e.tokenType.nullLiteral,e.tokenType.stringLiteral,e.tokenType.trueLiteral,e.tokenType.numberLiteral,e.tokenType.leftBrace,e.tokenType.leftBracket,e.tokenType.identifier)}},_readIdentifierExpression:function(){var n=o.BaseInterpreter.prototype._readIdentifierExpression.call(this);return new h(n)},_readObjectQueryExpression:function(){var r=this._current.value,i,n,t;this._read(e.tokenType.identifier);this._read(e.tokenType.leftParentheses);i=this._current.value;this._read(e.tokenType.stringLiteral);this._read(e.tokenType.rightParentheses);n=new l(r,i);switch(this._current.type){case e.tokenType.dot:case e.tokenType.leftBracket:return t=[n],this._readAccessExpressions(t),new h(t);default:return n}}},{supportedForProcessing:!1})})}),y=function(n,t,i){var r=e.lexer(n),u=new o.OptionsInterpreter(r,n,t||{},i||{});return u.run()},p,l,h;Object.defineProperty(y,"_BaseInterpreter",{get:function(){return o.BaseInterpreter}});p=function(n){var t=e.lexer(n),i=new o.OptionsParser(t,n);return i.run()};l=t.Class.define(function(n,t){this.target=n;this.arg0Value=t});l.supportedForProcessing=!1;h=t.Class.define(function(n){this.parts=n});h.supportedForProcessing=!1;t.Namespace._moduleDefine(n,"WinJS.UI",{optionsParser:y,_optionsParser:p,_CallExpression:l,_IdentifierExpression:h})});t("WinJS/ControlProcessor",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_Resources","./Core/_WriteProfilerMark","./ControlProcessor/_OptionsParser","./Promise","./Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function l(n){var i=function(i){for(var f,u,r=n;r;){if(r.msParentSelectorScope&&(u=r.parentNode,u&&(f=h._matchesSelector(u,i)?u:u.querySelector(i))))break;r=r.parentNode}return f||t.document.querySelector(i)};return g(i)}function a(n,i){return new s(function(r,e){var y,h,c,s,a;try{h=n.getAttribute("data-win-options");h&&(y=o.optionsParser(h,t,{select:l(n)}));s=1;i.length>2&&s++;a=function(){s--;0===s&&(n.winControl=n.winControl||c,r(c))};c=new i(n,y,a);a()}catch(v){u.log&&u.log(f._formatString(d.errorActivatingControl,v&&v.message),"winjs controls","error");e(v)}})}function v(n,i){return new s(function(r,u){var v,b,f,l,h,s,tt;e("WinJS.UI:processAll,StartTM");n=n||t.document.body;var w=0,k="[data-win-control]",d=n.querySelectorAll(k),o=[];for(!i&&c(n)&&o.push(n),f=0,l=d.length;l>f;f++)o.push(d[f]);if(0===o.length)return e("WinJS.UI:processAll,StopTM"),void r(n);for(var g=function(){w-=1;0>w&&(e("WinJS.UI:processAll,StopTM"),r(n))},nt=new Array(o.length),f=0,l=o.length;l>f;f++)s=o[f],b=s.winControl,b?v=b.constructor:nt[f]=v=c(s),v&&v.isDeclarativeControlContainer&&(f+=s.querySelectorAll(k).length);for(e("WinJS.UI:processAllActivateControls,StartTM"),f=0,l=o.length;l>f;f++)h=nt[f],s=o[f],h&&!s.winControl&&(w++,a(s,h).then(g,function(n){e("WinJS.UI:processAll,StopTM");u(n)}),h.isDeclarativeControlContainer&&"function"==typeof h.isDeclarativeControlContainer)&&(tt=p(h.isDeclarativeControlContainer),tt(s.winControl,y));e("WinJS.UI:processAllActivateControls,StopTM");g()})}function c(n){if(n.getAttribute){var i=n.getAttribute("data-win-control");if(i)return r._getMemberFiltered(i.trim(),t,p)}}function b(n,t){return l(t)(n)}function y(n,t){return w?v(n,t):r.ready().then(function(){return w=!0,v(n,t)})}function k(n){if(n&&n.winControl)return s.as(n.winControl);var t=c(n);return t?a(n,t):s.as()}if(t.document){var d={get errorActivatingControl(){return"Error activating control: {0}"}},g=r.markSupportedForProcessing,p=r.requireSupportedForProcessing,w=!1;i.Namespace._moduleDefine(n,"WinJS.UI",{scopedSelect:b,processAll:y,process:k})}});t("WinJS/Utilities/_ElementListUtilities",["exports","../Core/_Global","../Core/_Base","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e){"use strict";t.document&&i.Namespace._moduleDefine(n,"WinJS.Utilities",{QueryCollection:i.Class.derive(Array,function(n){n&&this.include(n)},{forEach:function(n,t){return Array.prototype.forEach.apply(this,[n,t]),this},get:function(n){return this[n]},setAttribute:function(n,t){return this.forEach(function(i){i.setAttribute(n,t)}),this},getAttribute:function(n){if(this.length>0)return this[0].getAttribute(n)},addClass:function(n){return this.forEach(function(t){e.addClass(t,n)}),this},hasClass:function(n){return this.length>0?e.hasClass(this[0],n):!1},removeClass:function(n){return this.forEach(function(t){e.removeClass(t,n)}),this},toggleClass:function(n){return this.forEach(function(t){e.toggleClass(t,n)}),this},listen:function(n,t,i){return this.forEach(function(r){r.addEventListener(n,t,i)}),this},removeEventListener:function(n,t,i){return this.forEach(function(r){r.removeEventListener(n,t,i)}),this},setStyle:function(n,t){return this.forEach(function(i){i.style[n]=t}),this},clearStyle:function(n){return this.forEach(function(t){t.style[n]=""}),this},query:function(t){var i=new n.QueryCollection;return this.forEach(function(n){i.include(n.querySelectorAll(t))}),i},include:function(n){if("number"==typeof n.length)for(var t=0;t<n.length;t++)this.push(n[t]);else n.DOCUMENT_FRAGMENT_NODE&&n.nodeType===n.DOCUMENT_FRAGMENT_NODE?this.include(n.childNodes):this.push(n)},control:function(n,t){return n&&"function"==typeof n?this.forEach(function(i){i.winControl=new n(i,t)}):(t=n,this.forEach(function(n){r.process(n).done(function(n){n&&f.setOptions(n,t)})})),this},template:function(t,i,r){var e,o,f;return t instanceof n.QueryCollection&&(t=t[0]),e=t.winControl,null!==i&&void 0!==i&&i.forEach||(i=[i]),r=r||function(){},o=this,f=[],i.forEach(function(n){o.forEach(function(t){f.push(e.render(n,t))})}),r(u.join(f)),this}},{supportedForProcessing:!1}),query:function(i,r){return new n.QueryCollection((r||t.document).querySelectorAll(i))},id:function(i){var r=t.document.getElementById(i);return new n.QueryCollection(r?[r]:[])},children:function(t){return new n.QueryCollection(t.children)}})});t("WinJS/Utilities/_Hoverable",["exports","../Core/_Global"],function(n,t){"use strict";if(t.document&&(t.document.documentElement.classList.add("win-hoverable"),n.isHoverable=!0,!t.MSPointerEvent)){var i=function(){t.document.removeEventListener("touchstart",i);t.document.documentElement.classList.remove("win-hoverable");n.isHoverable=!1};t.document.addEventListener("touchstart",i)}});t("WinJS/Utilities/_ParallelWorkQueue",["exports","../Core/_Base","../Promise","../Scheduler"],function(n,t,i,r){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_ParallelWorkQueue:t.Namespace._lazy(function(){return t.Class.define(function(n){function o(){f--;e||r.schedule(s,r.Priority.normal,null,"WinJS._ParallelWorkQueue.runNext")}function s(){for(e++;n>f;f++){var i,r;do i=u.shift(),r=i&&t[i];while(i&&!r);if(!r)break;delete t[i];try{r().then(o,o)}catch(s){o()}}e--}function h(n,r,f){var o,e="w"+c++;return new i(function(i,h,c){var l=function(){return o=n().then(i,h,c)};l.data=r;t[e]=l;f?u.unshift(e):u.push(e);s()},function(){delete t[e];o&&o.cancel()})}var c=0,t={},u=[],f,e;n=n||3;f=0;e=0;this.sort=function(n){u.sort(function(i,r){return i=t[i],r=t[r],void 0===i&&void 0===r?0:void 0===i?1:void 0===r?-1:n(i.data,r.data)})};this.queue=h},{},{supportedForProcessing:!1})})})});t("WinJS/Utilities/_VersionManager",["exports","../Core/_Base","../_Signal"],function(n,t,i){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_VersionManager:t.Namespace._lazy(function(){return t.Class.define(function(){this._unlocked=new i;this._unlocked.complete()},{_cancelCount:0,_notificationCount:0,_updateCount:0,_version:0,locked:{get:function(){return 0!==this._notificationCount||0!==this._updateCount}},noOutstandingNotifications:{get:function(){return 0===this._notificationCount}},version:{get:function(){return this._version}},unlocked:{get:function(){return this._unlocked.promise}},_dispose:function(){this._unlocked&&(this._unlocked.cancel(),this._unlocked=null)},beginUpdating:function(){this._checkLocked();this._updateCount++},endUpdating:function(){this._updateCount--;this._checkUnlocked()},beginNotifications:function(){this._checkLocked();this._notificationCount++},endNotifications:function(){this._notificationCount--;this._checkUnlocked()},_checkLocked:function(){this.locked||(this._dispose(),this._unlocked=new i)},_checkUnlocked:function(){this.locked||this._unlocked.complete()},receivedNotification:function(){if(this._version++,this._cancel){var n=this._cancel;this._cancel=null;n.forEach(function(n){n&&n.cancel()})}},cancelOnNotification:function(n){return this._cancel||(this._cancel=[],this._cancelCount=0),this._cancel[this._cancelCount++]=n,this._cancelCount-1},clearCancelOnNotification:function(n){this._cancel&&delete this._cancel[n]}},{supportedForProcessing:!1})})})});t("WinJS/Utilities/_ItemsManager",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../_Signal","../Scheduler","../Utilities/_ElementUtilities","./_ParallelWorkQueue","./_VersionManager"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function d(n){return et(function(t,i){return t.then(function(t){return t?n(t,i):null})})}function it(n,t){var i=!1,r=!1;return n.isOnScreen().then(function(n){i=n}),t.isOnScreen().then(function(n){r=n}),(i?0:1)-(r?0:1)}function k(n){var i,r,t,u;if(!/^blob:/i.test(n)&&(v[n]=!0,p.push(n),p.length>tt))for(i=p,v={},p=[],r=0,t=i.length-1;t>=0&&nt>r;t--)u=i[t],v[u]||(v[u]=!0,r++)}function rt(n,i,r){var u=ht++;return w=w||new l._ParallelWorkQueue(6),w.queue(function(){return new o(function(r,f){h.schedule(function(u){i||(i=t.document.createElement("img"));var e=v[n];e?(k(n),i.src=n,r(i)):u.setPromise(new o(function(u){var e=t.document.createElement("img"),o=function(){e.removeEventListener("load",s,!1);e.removeEventListener("error",h,!1);i.src=n;var t=new Date;t-g>st&&(g=t,w.sort(it))},s=function(){u(c)},h=function(){u(l)},c=function(){k(n);o();r(i)},l=function(){o();f(i)};e.addEventListener("load",s,!1);e.addEventListener("error",h,!1);e.src=n}))},h.Priority.normal,null,"WinJS.UI._ImageLoader._image"+u)})},r)}function ut(n){return v[n]}function ft(){return t.document.createElement("div")}var et=r.markSupportedForProcessing,y=c._uniqueID,ot=d(function(n){var i,r;return c._isDOMElement(n.data)?n.data:(i=n.data,void 0===i?i="undefined":null===i?i="null":"object"==typeof i&&(i=JSON.stringify(i)),r=t.document.createElement("span"),r.textContent=i.toString(),r)});i.Namespace._moduleDefine(n,"WinJS.UI",{_normalizeRendererReturn:function(n){var t;return n?"object"==typeof n&&n.element?(t=o.as(n.element),t.then(function(t){return{element:t,renderComplete:o.as(n.renderComplete)}})):(t=o.as(n),t.then(function(n){return{element:n,renderComplete:o.as()}})):{element:null,renderComplete:o.as()}},simpleItemRenderer:d,_trivialHtmlRenderer:ot});var w,b={get listDataSourceIsInvalid(){return"Invalid argument: dataSource must be an object."},get itemRendererIsInvalid(){return"Invalid argument: itemRenderer must be a function."},get itemIsInvalid(){return"Invalid argument: item must be a DOM element that was returned by the Items Manager, and has not been replaced or released."}},g=new Date,st=64,ht=0,v={},p=[],nt=250,tt=1e3;i.Namespace._moduleDefine(n,"WinJS.UI",{_seenUrl:k,_getSeenUrls:function(){return v},_getSeenUrlsMRU:function(){return p},_seenUrlsMaxSize:nt,_seenUrlsMRUMaxSize:tt});i.Namespace._moduleDefine(n,"WinJS.UI",{_createItemsManager:i.Namespace._lazy(function(){var t=i.Class.define(function(n){this._itemsManager=n},{beginNotifications:function(){this._itemsManager._versionManager.beginNotifications();this._itemsManager._beginNotifications()},inserted:function(n,t,i){this._itemsManager._versionManager.receivedNotification();this._itemsManager._inserted(n,t,i)},changed:function(n,t){this._itemsManager._versionManager.receivedNotification();this._itemsManager._changed(n,t)},moved:function(n,t,i){this._itemsManager._versionManager.receivedNotification();this._itemsManager._moved(n,t,i)},removed:function(n,t){this._itemsManager._versionManager.receivedNotification();this._itemsManager._removed(n,t)},countChanged:function(n,t){this._itemsManager._versionManager.receivedNotification();this._itemsManager._countChanged(n,t)},indexChanged:function(n,t,i){this._itemsManager._versionManager.receivedNotification();this._itemsManager._indexChanged(n,t,i)},affectedRange:function(n){this._itemsManager._versionManager.receivedNotification();this._itemsManager._affectedRange(n)},endNotifications:function(){this._itemsManager._versionManager.endNotifications();this._itemsManager._endNotifications()},reload:function(){this._itemsManager._versionManager.receivedNotification();this._itemsManager._reload()}},{supportedForProcessing:!1}),r=i.Class.define(function(n,i,r,f){if(!n)throw new u("WinJS.UI.ItemsManager.ListDataSourceIsInvalid",b.listDataSourceIsInvalid);if(!i)throw new u("WinJS.UI.ItemsManager.ItemRendererIsInvalid",b.itemRendererIsInvalid);this.$pipeline_callbacksMap={};this._listDataSource=n;this.dataSource=this._listDataSource;this._elementNotificationHandler=r;this._listBinding=this._listDataSource.createListBinding(new t(this));f&&(f.ownerElement&&(this._ownerElement=f.ownerElement),this._profilerId=f.profilerId,this._versionManager=f.versionManager||new a._VersionManager);this._indexInView=f&&f.indexInView;this._itemRenderer=i;this._viewCallsReady=f&&f.viewCallsReady;this._elementMap={};this._handleMap={};this._jobOwner=h.createOwnerToken();this._notificationsSent=!1;this._listBinding.last&&(this.lastItem=function(){return this._elementForItem(this._listBinding.last())})},{_itemFromItemPromise:function(n){return this._waitForElement(this._elementForItem(n))},_itemFromItemPromiseThrottled:function(n){return this._waitForElement(this._elementForItem(n,!0))},_itemAtIndex:function(n){var t=this._itemPromiseAtIndex(n);this._itemFromItemPromise(t).then(null,function(n){return t.cancel(),o.wrapError(n)})},_itemPromiseAtIndex:function(n){return this._listBinding.fromIndex(n)},_waitForElement:function(n){var t=this;return new o(function(i){if(n)if(t.isPlaceholder(n)){var r=y(n),u=t.$pipeline_callbacksMap[r];u?u.push(i):t.$pipeline_callbacksMap[r]=[i]}else i(n);else i(n)})},_updateElement:function(n,t){var i=y(t),r=this.$pipeline_callbacksMap[i];r&&(delete this.$pipeline_callbacksMap[i],r.forEach(function(t){t(n)}))},_firstItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.first()))},_lastItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.last()))},_previousItem:function(n){return this._listBinding.jumpToItem(this._itemFromElement(n)),this._waitForElement(this._elementForItem(this._listBinding.previous()))},_nextItem:function(n){return this._listBinding.jumpToItem(this._itemFromElement(n)),this._waitForElement(this._elementForItem(this._listBinding.next()))},_itemFromPromise:function(n){return this._waitForElement(this._elementForItem(n))},isPlaceholder:function(n){return!!this._recordFromElement(n).elementIsPlaceholder},itemObject:function(n){return this._itemFromElement(n)},release:function(){this._listBinding.release();this._elementNotificationHandler=null;this._listBinding=null;this._jobOwner.cancelAll();this._released=!0},releaseItemPromise:function(n){var i=n.handle,t=this._handleMap[i];t?this._releaseRecord(t):n.cancel()},releaseItem:function(n){var t=this._elementMap[y(n)];this._releaseRecord(t)},_releaseRecord:function(n){n&&(n.renderPromise&&n.renderPromise.cancel(),n.itemPromise&&n.itemPromise.cancel(),n.imagePromises&&n.imagePromises.forEach(function(n){n.cancel()}),n.itemReadyPromise&&n.itemReadyPromise.cancel(),n.renderComplete&&n.renderComplete.cancel(),this._removeEntryFromElementMap(n.element),this._removeEntryFromHandleMap(n.itemPromise.handle,n),n.item&&this._listBinding.releaseItem(n.item))},refresh:function(){return this._listDataSource.invalidateAll()},_handlerToNotifyCaresAboutItemAvailable:function(){return!(!this._elementNotificationHandler||!this._elementNotificationHandler.itemAvailable)},_handlerToNotify:function(){return this._notificationsSent||(this._notificationsSent=!0,this._elementNotificationHandler&&this._elementNotificationHandler.beginNotifications&&this._elementNotificationHandler.beginNotifications()),this._elementNotificationHandler},_defineIndexProperty:function(n,t,i){i.indexObserved=!1;Object.defineProperty(n,"index",{get:function(){return i.indexObserved=!0,t.index}})},_renderPlaceholder:function(n){var t=ft({});return n.elementIsPlaceholder=!0,t},_renderItem:function(t,i,r){function y(){t.then(function(n){u._writeProfilerMark(p+",StartTM");e.complete(n);u._writeProfilerMark(p+",StopTM")})}var u=this,k=u._indexInView||function(){return!0},e=new s,c=new s,p="_renderItem("+i.item.index+"):itemPromise",w=!0,l=!1,f,a,v,b;return t.then(function(n){l=!0;w&&e.complete(n)}),w=!1,f=e.promise.then(function(n){if(n){var t=Object.create(n);return u._defineIndexProperty(t,n,i),t.ready=c.promise,t.isOnScreen=function(){return o.wrap(k(n.index))},t.loadImage=function(n,r){var u=rt(n,r,t);return i.imagePromises?i.imagePromises.push(u):i.imagePromises=[u],u},t.isImageCached=ut,t}return o.cancel}),l||(r?(i.stage0=t,i.startStage1=function(){i.startStage1=null;y()}):y()),f.handle=t.handle,i.itemPromise=f,i.itemReadyPromise=c.promise,i.readyComplete=!1,a="_renderItem("+i.item.index+(l?"):syncItemPromise":"):placeholder"),v="_renderItem("+i.item.index+"):itemReady",this._writeProfilerMark(a+",StartTM"),b=o.as(u._itemRenderer(f,i.element)).then(n._normalizeRendererReturn).then(function(n){return u._released?o.cancel:(f.then(function(n){if(i.pendingReady=function(){i.pendingReady&&(i.pendingReady=null,i.readyComplete=!0,u._writeProfilerMark(v+",StartTM"),c.complete(n),u._writeProfilerMark(v+",StopTM"))},!u._viewCallsReady){var t=h.schedule(i.pendingReady,h.Priority.normal,i,"WinJS.UI._ItemsManager._pendingReady");t.owner=u._jobOwner}}),n)}),this._writeProfilerMark(a+",StopTM"),b},_replaceElement:function(n,t){this._removeEntryFromElementMap(n.element);n.element=t;this._addEntryToElementMap(t,n)},_changeElement:function(n,t,i){n.renderPromise=null;var r=n.element,u=n.item;n.newItem&&(n.item=n.newItem,n.newItem=null);this._replaceElement(n,t);n.item&&n.elementIsPlaceholder&&!i?(n.elementDelayed=null,n.elementIsPlaceholder=!1,this._updateElement(n.element,r),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(n.element,r)):this._handlerToNotify().changed(t,r,u)},_elementForItem:function(n,t){var r,u=n.handle,i=this._recordFromHandle(u,!0);if(!u)return null;if(i)r=i.element;else{i={item:n,itemPromise:n};this._addEntryToHandleMap(u,i);var f=this,e=!1,o=!1,s=f._renderItem(n,i,t).then(function(t){var u=t.element;i.renderComplete=t.renderComplete;n.then(function(n){i.item=n;n||(e=!0,r=null)});o=!0;i.renderPromise=null;u&&(r?f._presentElements(i,u):r=u)});e||(o||(i.renderPromise=s),r||(r=this._renderPlaceholder(i)),i.element=r,this._addEntryToElementMap(r,i),n.retain())}return r},_addEntryToElementMap:function(n,t){this._elementMap[y(n)]=t},_removeEntryFromElementMap:function(n){delete this._elementMap[y(n)]},_recordFromElement:function(n){var t=this._elementMap[y(n)];if(!t)throw this._writeProfilerMark("_recordFromElement:ItemIsInvalidError,info"),new u("WinJS.UI.ItemsManager.ItemIsInvalid",b.itemIsInvalid);return t},_addEntryToHandleMap:function(n,t){this._handleMap[n]=t},_removeEntryFromHandleMap:function(n){delete this._handleMap[n]},_handleInHandleMap:function(n){return!!this._handleMap[n]},_recordFromHandle:function(n,t){var i=this._handleMap[n];if(!i&&!t)throw new u("WinJS.UI.ItemsManager.ItemIsInvalid",b.itemIsInvalid);return i},_foreachRecord:function(n){var t=this._handleMap,i,r;for(i in t)r=t[i],n(r)},_itemFromElement:function(n){return this._recordFromElement(n).item},_elementFromHandle:function(n){if(n){var t=this._recordFromHandle(n,!0);if(t&&t.element)return t.element}return null},_inserted:function(n,t,i){this._handlerToNotify().inserted(n,t,i)},_changed:function(n,t){var i,r,u;this._handleInHandleMap(t.handle)&&(i=this._recordFromHandle(t.handle),i.renderPromise&&i.renderPromise.cancel(),i.itemPromise&&i.itemPromise.cancel(),i.imagePromises&&i.imagePromises.forEach(function(n){n.cancel()}),i.itemReadyPromise&&i.itemReadyPromise.cancel(),i.renderComplete&&i.renderComplete.cancel(),i.newItem=n,r=this,u=o.as(n),u.handle=i.itemPromise.handle,i.renderPromise=this._renderItem(u,i).then(function(n){i.renderComplete=n.renderComplete;r._changeElement(i,n.element,!1);r._presentElements(i)}))},_moved:function(n,t,i){var r=this._elementFromHandle(n.handle),u=this._elementFromHandle(t),f=this._elementFromHandle(i);this._handlerToNotify().moved(r,u,f,n);this._presentAllElements()},_removed:function(n,t){if(this._handleInHandleMap(n)){var i=this._elementFromHandle(n);this._handlerToNotify().removed(i,t,n);this.releaseItem(i);this._presentAllElements()}else this._handlerToNotify().removed(null,t,n)},_countChanged:function(n,t){this._elementNotificationHandler&&this._elementNotificationHandler.countChanged&&this._handlerToNotify().countChanged(n,t)},_indexChanged:function(n,t,i){var s,r,u,f,e;this._handleInHandleMap(n)&&(r=this._recordFromHandle(n),r.indexObserved&&(r.elementIsPlaceholder?this._changeElement(r,this._renderPlaceholder(r),!0):r.item.index!==t&&(r.renderPromise&&r.renderPromise.cancel(),r.renderComplete&&r.renderComplete.cancel(),u=r.newItem||r.item,u.index=t,f=o.as(u),f.handle=r.itemPromise.handle,e=this,r.renderPromise=this._renderItem(f,r).then(function(n){r.renderComplete=n.renderComplete;e._changeElement(r,n.element,!1);e._presentElements(r)}))),s=r.element);this._elementNotificationHandler&&this._elementNotificationHandler.indexChanged&&this._handlerToNotify().indexChanged(s,t,i)},_affectedRange:function(n){this._elementNotificationHandler&&this._elementNotificationHandler.updateAffectedRange&&this._handlerToNotify().updateAffectedRange(n)},_beginNotifications:function(){this._externalBegin=!0;this._handlerToNotify()},_endNotifications:function(){this._notificationsSent&&(this._notificationsSent=!1,this._externalBegin=!1,this._elementNotificationHandler&&this._elementNotificationHandler.endNotifications&&this._elementNotificationHandler.endNotifications())},_reload:function(){this._elementNotificationHandler&&this._elementNotificationHandler.reload&&this._elementNotificationHandler.reload()},_postEndNotifications:function(){if(this._notificationsSent&&!this._externalBegin&&!this._endNotificationsPosted){this._endNotificationsPosted=!0;var n=this;h.schedule(function(){n._endNotificationsPosted=!1;n._endNotifications()},h.Priority.high,null,"WinJS.UI._ItemsManager._postEndNotifications")}},_presentElement:function(n){var t=n.element;this._replaceElement(n,n.elementDelayed);n.elementDelayed=null;n.elementIsPlaceholder=!1;this._updateElement(n.element,t);this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(n.element,t)},_presentElements:function(n,t){t&&(n.elementDelayed=t);this._listBinding.jumpToItem(n.item);n.elementDelayed&&this._presentElement(n);this._postEndNotifications()},_presentAllElements:function(){var n=this;this._foreachRecord(function(t){t.elementDelayed&&n._presentElement(t)})},_writeProfilerMark:function(n){var t="WinJS.UI._ItemsManager:"+(this._profilerId?this._profilerId+":":":")+n;e(t)}},{supportedForProcessing:!1});return function(n,t,i,u){return new r(n,t,i,u)}})})});t("WinJS/Utilities/_TabContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","./_ElementUtilities"],function(n,t,i,r,u){"use strict";function f(n,i,r,u){var f=t.document.createEvent("UIEvent");return f.initUIEvent(i,!1,!!u,t,r?1:0),!n.dispatchEvent(f)}function h(n){var r=t.getComputedStyle(n),i,u;return"none"===r.display||"hidden"===r.visibility?t.NodeFilter.FILTER_REJECT:n._tabContainer?t.NodeFilter.FILTER_ACCEPT:n.parentNode&&n.parentNode._tabContainer?(i=n.parentNode._tabContainer.childFocus,i&&n.contains(i)?e(n)>=0?t.NodeFilter.FILTER_ACCEPT:t.NodeFilter.FILTER_SKIP:t.NodeFilter.FILTER_REJECT):(u=e(n),u>=0?t.NodeFilter.FILTER_ACCEPT:t.NodeFilter.FILTER_SKIP)}function s(n){function i(){if(n.currentNode._tabContainer)t=t.concat(s(n));else if(e(n.currentNode)>=0&&t.push(n.currentNode),n.firstChild()){do i();while(n.nextSibling());n.parentNode()}}var r=n.currentNode,u=r._tabContainer.childFocus,t=[];return u?(n.currentNode=u,i(),n.currentNode=r,t):[]}function c(n,i){function s(){var n=t.document.createElement("DIV");return n.tabIndex=i?i:0,n.setAttribute("aria-hidden",!0),n}var e=n.parentNode,u=s(),r,o;e.insertBefore(u,n);r=s();e.insertBefore(r,n.nextSibling);u.addEventListener("focus",function(){f(n,"onTabEnter",!0)},!0);r.addEventListener("focus",function(){f(n,"onTabEnter",!1)},!0);this._catcherBegin=u;this._catcherEnd=r;o=1;this.addRef=function(){o++};this.release=function(){return 0==--o&&(u.parentElement&&e.removeChild(u),r.parentElement&&e.removeChild(r)),o};this.updateTabIndex=function(n){u.tabIndex=n;r.tabIndex=n}}if(t.document){var e=u.getTabIndex,o={attach:function(n,t){return n["win-trackTabHelperObject"]?n["win-trackTabHelperObject"].addRef():n["win-trackTabHelperObject"]=new c(n,t),n["win-trackTabHelperObject"]},detach:function(n){n["win-trackTabHelperObject"].release()||delete n["win-trackTabHelperObject"]}};i.Namespace._moduleDefine(n,"WinJS.UI",{TrackTabBehavior:o,TabContainer:i.Class.define(function(n){this._element=n;this._tabIndex=0;n._tabContainer=this;null===n.getAttribute("tabindex")&&(n.tabIndex=-1);var t=this;n.addEventListener("onTabEnter",function(i){var r=f(t._element,"onTabEntered",i.detail,!0);r||(t.childFocus?t.childFocus.focus():n.focus())});n.addEventListener("keydown",function(n){var e=n.target,i,a,v,c,l;if(n.keyCode===u.Key.tab&&(i=!n.shiftKey,a=t._hasMoreElementsInTabOrder(e,i),!a)){if(v=f(t._element,"onTabExiting",i,!0),v)return n.stopPropagation(),void n.preventDefault();for(var o=t._element.querySelectorAll("a[href],area[href],button,command,input,link,menuitem,object,select,textarea,th[sorted],[tabindex]"),y=o.length,s=[],h=0;y>h;h++)c=o[h],s.push(c.tabIndex),c.tabIndex=-1;t._elementTabHelper[i?"_catcherEnd":"_catcherBegin"].tabIndex=-1;l=function(){e.removeEventListener("blur",l,!1);for(var n=0;y>n;n++)-1!==s[n]&&(o[n].tabIndex=s[n]);t._elementTabHelper._catcherBegin.tabIndex=t._tabIndex;t._elementTabHelper._catcherEnd.tabIndex=t._tabIndex};e.addEventListener("blur",l,!1);r._yieldForEvents(function(){f(t._element,"onTabExit",i)})}});this._elementTabHelper=o.attach(n,this._tabIndex);this._elementTabHelper._catcherBegin.tabIndex=0;this._elementTabHelper._catcherEnd.tabIndex=0},{dispose:function(){o.detach(this._element,this._tabIndex)},childFocus:{set:function(n){n!==this._focusElement&&(this._focusElement=n&&n.parentNode?n:null)},get:function(){return this._focusElement}},tabIndex:{set:function(n){this._tabIndex=n;this._elementTabHelper.updateTabIndex(n)},get:function(){return this._tabIndex}},_element:null,_skipper:function(n){n.stopPropagation();n.preventDefault()},_hasMoreElementsInTabOrder:function(n,i){if(!this.childFocus)return!1;for(var f=t.document.createTreeWalker(this._element,t.NodeFilter.SHOW_ELEMENT,h,!1),u=s(f),r=0;r<u.length;r++)if(u[r]===n)return i?r<u.length-1:r>0;return!1},_focusElement:null},{supportedForProcessing:!1})})}});t("WinJS/Utilities/_KeyboardBehavior",["exports","../Core/_Global","../Core/_Base","./_Control","./_ElementUtilities","./_TabContainer"],function(n,t,i,r,u,f){"use strict";if(t.document){var e=!1;u._addEventListener(t,"pointerdown",function(){e&&(e=!1)},!0);t.addEventListener("keydown",function(){e||(e=!0)},!0);i.Namespace._moduleDefine(n,"WinJS.UI",{_keyboardSeenLast:{get:function(){return e},set:function(n){e=n}},_WinKeyboard:function(t){u._addEventListener(t,"pointerdown",function(n){u.removeClass(n.target,"win-keyboard")},!0);t.addEventListener("keydown",function(n){u.addClass(n.target,"win-keyboard")},!0);u._addEventListener(t,"focusin",function(t){n._keyboardSeenLast&&u.addClass(t.target,"win-keyboard")},!1);u._addEventListener(t,"focusout",function(n){u.removeClass(n.target,"win-keyboard")},!1)},_KeyboardBehavior:i.Namespace._lazy(function(){var n=u.Key,e=i.Class.define(function(n,i){n=n||t.document.createElement("DIV");i=i||{};n._keyboardBehavior=this;this._element=n;this._fixedDirection=e.FixedDirection.width;this._fixedSize=1;this._currentIndex=0;r.setOptions(this,i);this._tabContainer=new f.TabContainer(this.scroller||this._element);this._tabContainer.tabIndex=0;this._element.children.length>0&&(this._tabContainer.childFocus=this._getFocusInto(this._element.children[0]));this._element.addEventListener("keydown",this._keyDownHandler.bind(this));u._addEventListener(this._element,"pointerdown",this._MSPointerDownHandler.bind(this))},{element:{get:function(){return this._element}},fixedDirection:{get:function(){return this._fixedDirection},set:function(n){this._fixedDirection=n}},fixedSize:{get:function(){return this._fixedSize},set:function(n){+n===n&&(n=Math.max(1,n),this._fixedSize=n)}},currentIndex:{get:function(){return this._element.children.length>0?this._currentIndex:-1},set:function(n){if(+n===n){var t=this._element.children.length;n=Math.max(0,Math.min(t-1,n));this._currentIndex=n;this._tabContainer.childFocus=this._getFocusInto(this._element.children[n])}}},getAdjacent:{get:function(){return this._getAdjacent},set:function(n){this._getAdjacent=n}},scroller:{get:function(){return this._scroller},set:function(n){this._scroller=n}},_keyDownHandler:function(i){var o;if(!i.altKey){if(u._matchesSelector(i.target,".win-interactive, .win-interactive *"))return;var f=!1,r=this.currentIndex,h=this._element.children.length-1,c="rtl"===t.getComputedStyle(this._element).direction,l=c?n.rightArrow:n.leftArrow,a=c?n.leftArrow:n.rightArrow,s=this.getAdjacent&&this.getAdjacent(r,i.keyCode);+s===s?(f=!0,r=s):(o=r%this.fixedSize,i.keyCode===l?(f=!0,this.fixedDirection===e.FixedDirection.width?0!==o&&r--:r>=this.fixedSize&&(r-=this.fixedSize)):i.keyCode===a?(f=!0,this.fixedDirection===e.FixedDirection.width?o!==this.fixedSize-1&&r++:r+this.fixedSize-o<=h&&(r+=this.fixedSize)):i.keyCode===n.upArrow?(f=!0,this.fixedDirection===e.FixedDirection.height?0!==o&&r--:r>=this.fixedSize&&(r-=this.fixedSize)):i.keyCode===n.downArrow?(f=!0,this.fixedDirection===e.FixedDirection.height?o!==this.fixedSize-1&&r++:r+this.fixedSize-o<=h&&(r+=this.fixedSize)):i.keyCode===n.home?(f=!0,r=0):i.keyCode===n.end?(f=!0,r=this._element.children.length-1):i.keyCode===n.pageUp?f=!0:i.keyCode===n.pageDown&&(f=!0));r=Math.max(0,Math.min(this._element.children.length-1,r));r!==this.currentIndex&&(this._focus(r,i.keyCode),(i.keyCode===l||i.keyCode===a||i.keyCode===n.upArrow||i.keyCode===n.downArrow)&&i.stopPropagation());f&&i.preventDefault()}},_getFocusInto:function(n,t){return n&&n.winControl&&n.winControl._getFocusInto?n.winControl._getFocusInto(t):n},_focus:function(n,t){n=+n===n?n:this.currentIndex;var i=this._element.children[n];i&&(i=this._getFocusInto(i,t),this.currentIndex=n,u._setActive(i,this.scroller))},_MSPointerDownHandler:function(n){var t=n.target,i;if(t!==this.element){for(;t.parentNode!==this.element;)t=t.parentNode;for(i=-1;t;)i++,t=t.previousElementSibling;this.currentIndex=i}}},{FixedDirection:{height:"height",width:"width"}});return e})})}});t("WinJS/Utilities/_SafeHtml",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources"],function(n,t,i,r){"use strict";var e,o,s,h,c,l,a={get nonStaticHTML(){return"Unable to add dynamic content. A script attempted to inject dynamic content, or elements previously modified dynamically, that might be unsafe. For example, using the innerHTML property or the document.write method to add a script element will generate this exception. If the content is safe and from a trusted source, use a method to explicitly manipulate elements and attributes, such as createElement, or use setInnerHTMLUnsafe (or other unsafe method)."}},u,f;e=o=function(n,t){n.innerHTML=t};s=h=function(n,t){n.outerHTML=t};c=l=function(n,t,i){n.insertAdjacentHTML(t,i)};u=t.MSApp;u?(o=function(n,t){u.execUnsafeLocalFunction(function(){n.innerHTML=t})},h=function(n,t){u.execUnsafeLocalFunction(function(){n.outerHTML=t})},l=function(n,t,i){u.execUnsafeLocalFunction(function(){n.insertAdjacentHTML(t,i)})}):t.msIsStaticHTML&&(f=function(n){if(!t.msIsStaticHTML(n))throw new r("WinJS.Utitilies.NonStaticHTML",a.nonStaticHTML);},e=function(n,t){f(t);n.innerHTML=t},s=function(n,t){f(t);n.outerHTML=t},c=function(n,t,i){f(i);n.insertAdjacentHTML(t,i)});i.Namespace._moduleDefine(n,"WinJS.Utilities",{setInnerHTML:e,setInnerHTMLUnsafe:o,setOuterHTML:s,setOuterHTMLUnsafe:h,insertAdjacentHTML:c,insertAdjacentHTMLUnsafe:l})});t("WinJS/Utilities/_Select",["exports","../Core/_Base","./_SafeHtml"],function(n,t,i){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_Select:t.Namespace._lazy(function(){function r(n){return n.replace(o,function(n){return s[n]||""})}function u(n){return n.replace(h,"")}function f(n){return this[n]}function e(){return this.length}function n(n){return n.getValue||(n.getValue=f),n.getLength||(n.getLength=e),n}var o=/[&<>'"]/g,s={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},h=/[\u200e\u200f]/g;return t.Class.define(function(t,i){this._dataSource=n(i.dataSource);this._index=i.index||0;this._domElement=t;this._domElement.tabIndex=0;i.disabled&&this.setDisabled(i.disabled);var r=this;this._domElement.addEventListener("change",function(){r._index=r._domElement.selectedIndex},!1);this._createSelectElement()},{_index:0,_dataSource:null,dataSource:{get:function(){return this._dataSource},set:function(t){this._dataSource=n(t);this._domElement&&this._createSelectElement()}},setDisabled:function(n){n?this._domElement.setAttribute("disabled","disabled"):this._domElement.removeAttribute("disabled")},_createSelectElement:function(){for(var e=this._dataSource.getLength(),t="",n=0;e>n;n++){var o=""+this._dataSource.getValue(n),f=r(o),s=u(f);t+="<option value='"+s+"'>"+f+"<\/option>"}i.setInnerHTMLUnsafe(this._domElement,t);this._domElement.selectedIndex=this._index},index:{get:function(){return Math.max(0,Math.min(this._index,this._dataSource.getLength()-1))},set:function(n){if(this._index!==n){this._index=n;var t=this._domElement;t&&t.selectedIndex!==n&&(t.selectedIndex=n)}}},value:{get:function(){return this._dataSource.getValue(this.index)}}})})})});t("WinJS/Utilities/_UI",["exports","../Core/_BaseCoreUtils","../Core/_Base"],function(n,t,i){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{eventHandler:function(n){return t.markSupportedForProcessing(n)},Orientation:{horizontal:"horizontal",vertical:"vertical"},CountResult:{unknown:"unknown"},CountError:{noResponse:"noResponse"},DataSourceStatus:{ready:"ready",waiting:"waiting",failure:"failure"},FetchError:{noResponse:"noResponse",doesNotExist:"doesNotExist"},EditError:{noResponse:"noResponse",canceled:"canceled",notPermitted:"notPermitted",noLongerMeaningful:"noLongerMeaningful"},ObjectType:{item:"item",groupHeader:"groupHeader"},SelectionMode:{none:"none",single:"single",multi:"multi"},TapBehavior:{directSelect:"directSelect",toggleSelect:"toggleSelect",invokeOnly:"invokeOnly",none:"none"},SwipeBehavior:{select:"select",none:"none"},GroupHeaderTapBehavior:{invoke:"invoke",none:"none"}})});t("WinJS/Utilities/_Xhr",["../Core/_Global","../Core/_Base","../Promise","../Scheduler"],function(n,t,i,r){"use strict";function u(n,t,i){r.schedule(function(){n(t)},i,null,"WinJS.xhr")}function f(){}function e(t){var e;return new i(function(i,o,s){var h=r.currentPriority;e=new n.XMLHttpRequest;e.onreadystatechange=function(){return e._canceled?void(e.onreadystatechange=f):void(4===e.readyState?(e.status>=200&&e.status<300||0===e.status?u(i,e,h):u(o,e,h),e.onreadystatechange=f):u(s,e,h))};e.open(t.type||"GET",t.url,!0,t.user,t.password);e.responseType=t.responseType||"";Object.keys(t.headers||{}).forEach(function(n){e.setRequestHeader(n,t.headers[n])});t.customRequestInitializer&&t.customRequestInitializer(e);void 0===t.data?e.send():e.send(t.data)},function(){e.onreadystatechange=f;e._canceled=!0;e.abort()})}return t.Namespace.define("WinJS",{xhr:e}),e});t("WinJS/Utilities",["./Utilities/_Control","./Utilities/_Dispose","./Utilities/_ElementListUtilities","./Utilities/_ElementUtilities","./Utilities/_Hoverable","./Utilities/_ItemsManager","./Utilities/_KeyboardBehavior","./Utilities/_ParallelWorkQueue","./Utilities/_SafeHtml","./Utilities/_Select","./Utilities/_TabContainer","./Utilities/_UI","./Utilities/_VersionManager","./Utilities/_Xhr"],function(){});t("WinJS/Fragments",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./Core/_WriteProfilerMark","./Promise","./Utilities/_ElementUtilities","./Utilities/_SafeHtml","./Utilities/_Xhr"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function ft(n,i,r,u){var e=n.src,h=!e,o,f,c;if(h&&(e=i+"script["+r+"]"),e=e.toLowerCase(),!(e in w))return o=null,w[e]=!0,f=t.document.createElement("script"),(n.language&&f.setAttribute("language","javascript"),f.setAttribute("type",n.type),f.setAttribute("async","false"),n.id&&f.setAttribute("id",n.id),h)?(c=n.text,o=u.then(function(){f.text=c}).then(null,function(){})):o=new s(function(t){f.onload=f.onerror=function(){t()};f.setAttribute("src",n.src)}),y.appendChild(f),{promise:o,inline:h}}function et(n,t,i){var r=(t+"script["+i+"]").toLowerCase();r in rt||(rt[r]=!0,y.appendChild(n.cloneNode(!0)))}function ot(n){var i=n.href.toLowerCase(),t;i in b||(b[i]=!0,t=n.cloneNode(!1),t.href=n.href,y.appendChild(t))}function g(n,i){var r,u;if("string"==typeof n)return ht(n,i);if(r={docfrag:h.data(n).docFragment},!r.docfrag){for(u=t.document.createDocumentFragment();n.childNodes.length>0;)u.appendChild(n.childNodes[0]);r.docfrag=h.data(n).docFragment=u;n.setAttribute("data-win-hasfragment","")}return i&&it(n),s.as(r)}function st(n,t){return pt(n,t).then(function(){return n.document?ct(t,n):n}).then(function(){return n.document&&delete n.document,n})}function ht(n,t){var r=n.toLowerCase(),i=v[r],u;return i?(t&&delete v[r],i.promise?i.promise:s.as(i)):(i={},t||(v[r]=i),u=i.promise=st(i,n),i.promise.then(function(){delete i.promise}),u)}function ct(n,i){var r=i.document,u=r.body,h=[],f,e,o;for(a(r.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),ot),a(r.getElementsByTagName("style"),function(t,i){et(t,n,i)}),f=s.as(),a(r.getElementsByTagName("script"),function(t,i){var r=ft(t,n,i,f);r&&(r.inline||(f=r.promise),h.push(r.promise))}),a(u.getElementsByTagName("img"),function(n){n.src=n.src}),a(u.getElementsByTagName("a"),function(n){if(""!==n.href){var t=n.getAttribute("href");t&&"#"!==t[0]&&(n.href=n.href)}}),e=u.getElementsByTagName("script");e.length>0;)o=e[0],o.parentNode.removeChild(o);return s.join(h).then(function(){for(var n=t.document.createDocumentFragment(),u=t.document.importNode(r.body,!0);u.childNodes.length>0;)n.appendChild(u.childNodes[0]);return i.docfrag=n,i})}function nt(){ut||(ut=!0,a(y.querySelectorAll("script"),function(n){w[n.src.toLowerCase()]=!0}),a(y.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),function(n){b[n.href.toLowerCase()]=!0}))}function lt(n,t){return tt(n,t,!0)}function tt(n,i,r){var f=(n instanceof t.HTMLElement?u._getProfilerMarkIdentifier(n):" href='"+n+"'")+"["+ ++kt+"]";return p("WinJS.UI.Fragments:render"+f+",StartTM"),nt(),g(n,!r).then(function(n){var u=n.docfrag,t,e;for(r&&(u=u.cloneNode(!0)),t=u.firstChild;t;)1===t.nodeType&&(t.msParentSelectorScope=!0),t=t.nextSibling;return i?(i.appendChild(u),e=i):e=u,p("WinJS.UI.Fragments:render"+f+",StopTM"),e})}function at(n,t){return tt(n,t,!1)}function vt(n){return nt(),g(n).then(function(n){return n.docfrag})}function it(n){n?"string"==typeof n?delete v[n.toLowerCase()]:(delete h.data(n).docFragment,n.removeAttribute("data-win-hasfragment")):v={}}function yt(n){var r;if(u.hasWinRT){r=t.document.createElement("a");r.href=n;var e=r.href,o=new i.Windows.Foundation.Uri(e),s=o.schemeName;if("ms-appx"!==s)throw new f("WinJS.UI.Fragments.InvalidUri",bt.invalidFragmentUri);return e}return n}function pt(n,i){var r,u,f;return i=k(i),r=t.document.implementation.createHTMLDocument("frag"),u=r.createElement("base"),r.head.appendChild(u),f=r.createElement("a"),r.body.appendChild(f),u.href=t.document.location.href,f.setAttribute("href",i),u.href=f.href,n.document=r,d(i).then(function(n){c.setInnerHTMLUnsafe(r.documentElement,n);r.head.appendChild(u)})}function wt(n){return l({url:n}).then(function(n){return n.responseText})}var bt={get invalidFragmentUri(){return"Unsupported uri for fragment loading. Fragments in the local context can only load from package content or local sources. To load fragments from other sources, use a web context."}};if(t.document){var a=function(n,t){for(var i=0,r=n.length;r>i;i++)t(n[i],i)},y=t.document.head||t.document.getElementsByTagName("head")[0],w={},rt={},b={},ut=!1,v={},kt=1,p=o,k=yt,d=wt;r.Namespace._moduleDefine(n,"WinJS.UI.Fragments",{renderCopy:lt,render:at,cache:vt,clearCache:it,_cacheStore:{get:function(){return v}},_forceLocal:{get:function(){return k},set:function(n){k=n}},_getFragmentContents:{get:function(){return d},set:function(n){d=n}},_writeProfilerMark:{get:function(){return p},set:function(n){p=n}}})}});t("WinJS/Application/_State",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise"],function(n,t,i,r,u,f){"use strict";function o(){var t,u,f,e=r.Class.define(function(n){this.folder=n;this._path=n.path;n.tryGetItemAsync&&(this._tryGetItemAsync=n.tryGetItemAsync.bind(n))},{_tryGetItemAsync:function(n){return this.folder.getFileAsync(n).then(null,function(){return!1})},exists:function(n){return this._tryGetItemAsync(n).then(function(n){return n?!0:!1})},remove:function(n){return this._tryGetItemAsync(n).then(function(n){return n?n.deleteAsync():!1}).then(null,function(){return!1})},writeText:function(n,t){var r=i.Windows.Storage,u=this;return u.folder.createFileAsync(n,r.CreationCollisionOption.openIfExists).then(function(n){return r.FileIO.writeTextAsync(n,t)})},readText:function(n,t){var r=i.Windows.Storage;return this._tryGetItemAsync(n).then(function(n){return n?r.FileIO.readTextAsync(n):t}).then(null,function(){return t})}},{supportedForProcessing:!1});r.Namespace._moduleDefine(n,"WinJS.Application",{local:{get:function(){return t||(t=new e(i.Windows.Storage.ApplicationData.current.localFolder)),t}},temp:{get:function(){return u||(u=new e(i.Windows.Storage.ApplicationData.current.temporaryFolder)),u}},roaming:{get:function(){return f||(f=new e(i.Windows.Storage.ApplicationData.current.roamingFolder)),f}}})}function s(){var t=r.Class.define(function(){this.storage={}},{exists:function(n){return f.as(void 0!==this.storage[n])},remove:function(n){return delete this.storage[n],f.as()},writeText:function(n,t){return this.storage[n]=t,f.as(t.length)},readText:function(n,t){var i=this.storage[n];return f.as("string"==typeof i?i:t)}},{supportedForProcessing:!1});r.Namespace._moduleDefine(n,"WinJS.Application",{local:new t,temp:new t,roaming:new t})}i.Windows.Storage.FileIO&&i.Windows.Storage.ApplicationData&&i.Windows.Storage.CreationCollisionOption?o():s();var e={};r.Namespace._moduleDefine(n,"WinJS.Application",{sessionState:{get:function(){return e},set:function(n){e=n}},_loadState:function(t){return 3===t.previousExecutionState?n.local.readText("_sessionState.json","{}").then(function(t){var i=JSON.parse(t);i&&Object.keys(i).length>0&&(n._sessionStateLoaded=!0);n.sessionState=i}).then(null,function(){n.sessionState={}}):f.as()},_oncheckpoint:function(i,r){var u,f;if(!(t.MSApp&&t.MSApp.getViewOpener&&t.MSApp.getViewOpener())&&(u=n.sessionState,u&&Object.keys(u).length>0||n._sessionStateLoaded)){try{f=JSON.stringify(u)}catch(e){f="";r.queueEvent({type:"error",detail:e})}i.setPromise(n.local.writeText("_sessionState.json",f).then(null,function(n){r.queueEvent({type:"error",detail:n})}))}}})});t("WinJS/Navigation",["exports","./Core/_Base","./Core/_Events","./Core/_WriteProfilerMark","./Promise"],function(n,t,i,r,u){"use strict";var h="navigated",c="navigating",l="beforenavigate",p=t.Class.mix(t.Class.define(null,{},{supportedForProcessing:!1}),i.eventMixin),e=new p,f={backStack:[],current:{location:"",initialPlaceholder:!0},forwardStack:[]},s=i._createEventProperty,a=function(n){return r("WinJS.Navigation:navigation,StartTM"),u.as().then(function(){var t=u.as(),i=e.dispatchEvent(l,{setPromise:function(n){t=t.then(function(){return n})},location:n.location,state:n.state});return t.then(function(n){return i||n})})},v=function(n){return u.as().then(function(){var t=u.as();return e.dispatchEvent(c,{setPromise:function(n){t=t.then(function(){return n})},location:f.current.location,state:f.current.state,delta:n}),t})},o=function(n,t){r("WinJS.Navigation:navigation,StopTM");var i=u.as(),o={value:n,location:f.current.location,state:f.current.state,setPromise:function(n){i=i.then(function(){return n})}};return!n&&t&&(o.error=t),e.dispatchEvent(h,o),i},y=function(n,t,i,r){return n=Math.min(n,t.length),n>0?a(t[t.length-n]).then(function(u){if(u)return!1;for(i.push(f.current);n-1>0;)n--,i.push(t.pop());return f.current=t.pop(),v(r).then(o,function(n){throw o(void 0,n||!0),n;}).then(function(){return!0})}):u.wrap(!1)};t.Namespace._moduleDefine(n,"WinJS.Navigation",{canGoForward:{get:function(){return f.forwardStack.length>0}},canGoBack:{get:function(){return f.backStack.length>0}},location:{get:function(){return f.current.location}},state:{get:function(){return f.current.state},set:function(n){f.current.state=n}},history:{get:function(){return f},set:function(n){f=n;f.backStack=f.backStack||[];f.forwardStack=f.forwardStack||[];f.current=f.current||{location:"",initialPlaceholder:!0};f.current.location=f.current.location||""}},forward:function(n){return n=n||1,y(n,f.forwardStack,f.backStack,n)},back:function(n){return n=n||1,y(n,f.backStack,f.forwardStack,-n)},navigate:function(n,t){var i={location:n,state:t};return a(i).then(function(n){return n?!1:(f.current.initialPlaceholder||f.backStack.push(f.current),f.forwardStack=[],f.current=i,v().then(o,function(n){throw o(void 0,n||!0),n;}).then(function(){return!0}))})},addEventListener:function(n,t,i){e.addEventListener(n,t,i)},removeEventListener:function(n,t,i){e.removeEventListener(n,t,i)},onnavigated:s(h),onnavigating:s(c),onbeforenavigate:s(l)})});t("WinJS/Application",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_Events","./Core/_Log","./Core/_WriteProfilerMark","./Application/_State","./Navigation","./Promise","./_Signal","./Scheduler","./Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function ht(n){var i,r;try{r=[];i=JSON.stringify(n,function(n,i){return i===t?"[window]":i instanceof t.HTMLElement?"[HTMLElement]":"function"==typeof i?"[function]":"object"==typeof i?null===i?i:-1===r.indexOf(i)?(r.push(i),i):"[circular]":i})}catch(u){i=JSON.stringify("[object]")}return i}function ct(n){t.MSApp&&t.MSApp.terminateApp(n)}function lt(n){var t="def"+vi++;return{deferral:k[t]=n.getDeferral(),id:t}}function oi(n,t){t&&(n=k[t],delete k[t]);n&&n.complete()}function at(){k&&(Object.keys(k).forEach(function(n){k[n].complete()}),k={})}function it(n){function u(t){return e("WinJS.Application:Event_"+n.type+",StopTM"),n._deferral&&oi(n._deferral,n._deferralID),t}var i,r,t;e("WinJS.Application:Event_"+n.type+",StartTM");i=h.as();n.setPromise=function(n){i=i.then(function(){return n})};n.detail=n.detail||{};"object"==typeof n.detail&&(n.detail.setPromise=n.setPromise);try{d._listeners&&(r=!1,t=d._listeners[n.type],t&&t.forEach(function(t){r=t.listener(n)||r}));t=yi[n.type];t&&t.forEach(function(t){t(n,r)})}catch(f){v({type:g,detail:f})}return i.then(u,function(n){return n=u(n),n&&"Canceled"===n.name?void 0:h.wrapError(n)})}function si(){return p||(p=new c,p.promise.done(function(){p=null},function(){p=null})),p}function vt(n){function t(n){v({type:g,detail:n})}return 0===n.length?si().promise:it(n.shift()).then(null,t)}function ut(n){function i(){return ut}var t=n.job._queue;0===t.length&&nt.length>0&&(t=n.job._queue=ft());n.setPromise(vt(t).then(i,i))}function hi(){function r(){i=!0}for(var t,n=[],i=!0;i;)0===n.length&&nt.length>0&&(n=ft()),i=!1,t=vt(n),t.done(r,r);tt=l.schedule(function(n){function i(){return ut}n.setPromise(t.then(i,i))},l.Priority.high,null,"WinJS.Application._pumpEventQueue");tt._queue=n}function v(n){e("WinJS.Application:Event_"+n.type+" queued,Info");nt.push(n);st&&p&&p.complete(ut)}function ft(){var n=nt;return nt=[],n}function yt(n){var t=lt(n.activatedOperation);o._loadState(n).then(function(){v({type:ot,detail:n,_deferral:t.deferral,_deferralID:t.id})})}function pt(n){var t=lt(n.suspendingOperation);v({type:et,_deferral:t.deferral,_deferralID:t.id})}function ci(){if(v({type:ti}),!t.document||!i.Windows.UI.WebUI.WebUIApplication){var n={arguments:"",kind:"Windows.Launch",previousExecutionState:0};o._loadState(n).then(function(){v({type:ot,detail:n})})}}function wt(){at();v({type:ni})}function bt(t){var f={},r,e,u,i;for(r in t)f[r]=t[r];u=!0;i=n._terminateApp;try{n._terminateApp=function(n,t){u=!1;e=n;i!==ct&&i(n,t)};it({type:g,detail:{error:f,errorLine:t.lineno,errorCharacter:t.colno,errorUrl:t.filename,errorMessage:t.message}})}finally{n._terminateApp=i}return u}function kt(n){var t=n.detail,i=t.id,r,u;if(t.parent)return void(t.handler&&w&&delete w[i]);t.exception instanceof Error&&(r={stack:t.exception.stack,message:t.exception.message},t.exception=r);u=!w;w=w||[];w[i]=t;u&&l.schedule(function(){var n=w;w=null;n.forEach(function(n){v({type:g,detail:n})})},l.Priority.high,null,"WinJS.Application._queuePromiseErrors")}function dt(n){var t={e:n,applicationcommands:void 0};d.dispatchEvent(ri,t)}function gt(n){var t={type:ui};Object.defineProperty(t,"_winRTBackPressedEvent",{value:n,enumerable:!1});it(t)}function li(){var n,r;rt||((rt=!0,t.addEventListener("beforeunload",wt,!1),t.document)&&((t.addEventListener("error",bt,!1),i.Windows.UI.WebUI.WebUIApplication)&&(n=i.Windows.UI.WebUI.WebUIApplication,n.addEventListener("activated",yt,!1),n.addEventListener("suspending",pt,!1)),i.Windows.UI.ApplicationSettings.SettingsPane&&(r=i.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView(),r.addEventListener("commandsrequested",dt)),i.Windows.Phone.UI.Input.HardwareButtons&&i.Windows.Phone.UI.Input.HardwareButtons.addEventListener("backpressed",gt)),h.addEventListener("error",kt))}function ai(){var n,r;rt&&((rt=!1,t.removeEventListener("beforeunload",wt,!1),t.document)&&(i.Windows.UI.WebUI.WebUIApplication&&(t.removeEventListener("error",bt,!1),n=i.Windows.UI.WebUI.WebUIApplication,n.removeEventListener("activated",yt,!1),n.removeEventListener("suspending",pt,!1)),i.Windows.UI.ApplicationSettings.SettingsPane&&(r=i.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView(),r.removeEventListener("commandsrequested",dt)),i.Windows.Phone.UI.Input.HardwareButtons&&i.Windows.Phone.UI.Input.HardwareButtons.removeEventListener("backpressed",gt)),h.removeEventListener("error",kt))}var y;t.Debug&&(t.Debug.setNonUserCodeExceptions=!0);var w,et="checkpoint",ni="unload",ot="activated",ti="loaded",ii="ready",g="error",ri="settings",ui="backclick",nt=[],tt=null,p=null,st=!1,rt=!1,fi=r.Class.mix(r.Class.define(null,{},{supportedForProcessing:!1}),u.eventMixin),d=new fi,b=u._createEventProperty,k={},vi=0,ei=ct,yi={activated:[function(){v({type:ii})}],checkpoint:[function(t){o._oncheckpoint(t,n)}],error:[function(i,r){if(!r&&(f.log&&f.log(ht(i),"winjs","error"),t.document&&n._terminateApp)){var u=i.detail,e=u&&(u.number||u.exception&&(u.exception.number||u.exception.code)||u.error&&u.error.number||u.errorCode||0),o={description:ht(u),stack:u&&(u.stack||u.exception&&(u.exception.stack||u.exception.message)||u.error&&u.error.stack||null),errorNumber:e,number:e};n._terminateApp(o,i)}}],backclick:[function(n,t){t?n._winRTBackPressedEvent.handled=!0:s.canGoBack&&(s.back(),n._winRTBackPressedEvent.handled=!0)}]};t.document&&t.document.addEventListener("DOMContentLoaded",ci,!1);y=r.Namespace._moduleDefine(n,"WinJS.Application",{stop:function(){y.onactivated=null;y.oncheckpoint=null;y.onerror=null;y.onloaded=null;y.onready=null;y.onsettings=null;y.onunload=null;y.onbackclick=null;d=new fi;o.sessionState={};st=!1;ft();tt&&tt.cancel();tt=null;p=null;ai();at()},addEventListener:function(n,t,i){d.addEventListener(n,t,i)},removeEventListener:function(n,t,i){d.removeEventListener(n,t,i)},checkpoint:function(){v({type:et})},start:function(){li();st=!0;hi()},queueEvent:v,_dispatchEvent:it,_terminateApp:{get:function(){return ei},set:function(n){ei=n}},_applicationListener:r.Namespace._lazy(function(){return new a._GenericListener("Application",y)}),oncheckpoint:b(et),onunload:b(ni),onactivated:b(ot),onloaded:b(ti),onready:b(ii),onsettings:b(ri),onerror:b(g),onbackclick:b(ui)})});t("WinJS/Animations/_Constants",["exports","../Core/_Base"],function(n,t){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{PageNavigationAnimation:{turnstile:"turnstile",slide:"slide",enterPage:"enterPage",continuum:"continuum"}})});t("WinJS/Animations/_TransitionAnimation",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise","../Scheduler","../Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o){"use strict";function w(n){return Array.isArray(n)||n instanceof t.NodeList||n instanceof t.HTMLCollection?n:n?[n]:[]}function st(){return++ft,"WinJSUIAnimation"+ft}function ht(n){return"WinJSUIAnimation"===n.substring(0,16)}function b(n){t.getComputedStyle(n,null).opacity}function k(t,i){return function(r){var f={},e,u;for(e in r)u=r[e],"function"==typeof u&&(u=u(t,i)),f[e]=u;return f.exactTiming||(f.delay+=n._libraryDelay),f}}function ct(n,t){var r=n+"|"+t,i=y[r];i&&i(yt)}function d(n,t,i){y[n+"|"+t]=i}function g(n,t){delete y[n+"|"+t]}function nt(n,t,i,r,u){var f=u.styleCaches[t]||new pt(t,u,i),e,o;return f.cref+=r.length,r.forEach(function(n){ct(t,n.property)}),(u.isTransition||r.some(function(n){return f.removed[n[u.nameField]]}))&&(b(n),f.removed={}),e=r.map(function(n){return n[u.nameField]+" "+u.props.map(function(t){return(t[1]?n[t[1]]:"")+t[2]}).join(" ")}).join(", "),o=r.map(function(n){return n[u.nameField]}).join(", "),""!==f.names&&(e=f.names+", "+e,o=f.names+", "+o),i[u.shorthandProp]=e,f.names=o,f}function tt(n,t){t?n():e.schedule(function(){n()},e.Priority.normal,null,"WinJS.UI._Animation._completeAnimationPromise")}function lt(n,i,r,e,s){var l,a,y,v;r.length>0&&(l=n.style,a=o._uniqueID(n),(h||(h=t.document.createElement("DIV").style),r=r.map(k(i,n)),r.forEach(function(n){var t=u._getCamelCasedName(n.property);n.hasOwnProperty("from")&&(l[t]=n.from);h[t]=n.to;n.to=h[t];n.propertyScriptName=t}),s)?(y=nt(n,a,l,r,wt),v=n.disabled?t.document:n,r.forEach(function(i){var r;e.push(new f(function(f){var e,o,s;r=function(r){e&&(v.removeEventListener(u._browserEventEquivalents.transitionEnd,e,!1),g(a,i.property),y.removeName(l,i.propertyScriptName,r?n:null,i.skipStylesReset),t.clearTimeout(s),e=null);tt(f,r===c)};e=function(t){t.target===n&&t.propertyName===i.property&&r()};d(a,i.property,r);v.addEventListener(u._browserEventEquivalents.transitionEnd,e,!1);o=0;l[i.propertyScriptName]!==i.to&&(l[i.propertyScriptName]=i.to,o=50);s=t.setTimeout(function(){s=t.setTimeout(r,i.delay+i.duration)},o)},function(){r(c)}))})):r.forEach(function(n){l[n.propertyScriptName]=n.to}))}function at(n,i,r,e,h){var v,a,l,y,w;if(h&&r.length>0){v=n.style;a=o._uniqueID(n);r=r.map(k(i,n));y=n.disabled?t.document:n;r.forEach(function(n){if(n.keyframe)n.keyframe=s.animationPrefix+n.keyframe;else{l||(l=t.document.createElement("STYLE"),t.document.documentElement.appendChild(l));n.keyframe=st();var i="@"+s.keyframes+" "+n.keyframe+" { from {"+n.property+":"+n.from+";} to {"+n.property+":"+n.to+";}}";l.sheet.insertRule(i,0)}});var it=nt(n,a,v,r,bt),p=[],b=[];r.forEach(function(i){var r;b.push(new f(function(f){var e,o;r=function(n){e&&(y.removeEventListener(u._browserEventEquivalents.animationEnd,e,!1),t.clearTimeout(o),e=null);tt(f,n===c)};e=function(t){t.target===n&&t.animationName===i.keyframe&&r()};d(a,i.property,r);p.push({id:a,property:i.property,style:v,keyframe:i.keyframe});o=t.setTimeout(function(){o=t.setTimeout(r,i.delay+i.duration)},50);y.addEventListener(u._browserEventEquivalents.animationEnd,e,!1)},function(){r(c)}))});l&&t.setTimeout(function(){var n=l.parentElement;n&&n.removeChild(l)},50);w=function(){for(var n,t=0;t<p.length;t++)n=p[t],g(n.id,n.property),it.removeName(n.style,n.keyframe)};e.push(f.join(b).then(w,w))}}function vt(){v||(v=i.Windows.UI.ViewManagement.UISettings?new i.Windows.UI.ViewManagement.UISettings:{animationsEnabled:!0})}function it(t,i,r){var h;try{for(var c=n.isAnimationEnabled(),o=w(t),l=w(i),s=[],u=0;u<o.length;u++)if(Array.isArray(o[u]))for(h=0;h<o[u].length;h++)r(o[u][h],u,l,s,c);else r(o[u],u,l,s,c);return s.length?f.join(s):e.schedulePromiseNormal(null,"WinJS.UI._Animation._completeActionPromise").then(null,function(){})}catch(a){return f.wrapError(a)}}function rt(n){return Array.isArray(n)?n.map(function(n){return rt(n)}):n?(n.delay=l(n.delay),n.duration=l(n.duration),n):void 0}function ut(n){return a?rt(n):n}if(t.document){var h,v,s=u._browserStyleEquivalents,ft=0,y=[],yt=1,c=2,pt=r.Class.define(function(n,t,i){this.cref=0;this.id=n;this.desc=t;this.removed={};this.prevStyles=t.props.map(function(n){return i[n[0]]});this.prevNames=this.names=i[t.nameProp];t.styleCaches[n]=this},{destroy:function(n,t){var i=this.desc;delete i.styleCaches[this.id];t||(""===this.prevNames&&this.prevStyles.every(function(n){return""===n})?n[i.shorthandProp]="":(i.props.forEach(function(t,i){n[t[0]]=this.prevStyles[i]},this),n[i.nameProp]=this.prevNames))},removeName:function(n,t,i,r){var u=this.names,f=u.split(", "),e=f.lastIndexOf(t);e>=0&&(f.splice(e,1),this.names=u=f.join(", "),""===u&&this.desc.isTransition&&(u="none"));--this.cref?(n[this.desc.nameProp]=u,ht(t)||(this.removed[t]=!0)):(i&&"none"===u&&(n[this.desc.nameProp]=u,b(i)),this.destroy(n,r))}}),wt={shorthandProp:s.transition.scriptName,nameProp:s["transition-property"].scriptName,nameField:"property",props:[[s["transition-duration"].scriptName,"duration","ms"],[s["transition-timing-function"].scriptName,"timing",""],[s["transition-delay"].scriptName,"delay","ms"]],isTransition:!0,styleCaches:[]},bt={shorthandProp:s.animation.scriptName,nameProp:s["animation-name"].scriptName,nameField:"keyframe",props:[[s["animation-duration"].scriptName,"duration","ms"],[s["animation-timing-function"].scriptName,"timing",""],[s["animation-delay"].scriptName,"delay","ms"],[s["animation-iteration-count"].scriptName,"","1"],[s["animation-direction"].scriptName,"","normal"],[s["animation-fill-mode"].scriptName,"","both"]],isTransition:!1,styleCaches:[]},p=0,et=function(){return vt(),p+v.animationsEnabled>0},l=function(n){return a?n/20:n},a=!1,ot=0;r.Namespace._moduleDefine(n,"WinJS.UI",{disableAnimations:function(){p--},enableAnimations:function(){p++},isAnimationEnabled:{get:function(){return et},set:function(n){et=n}},_libraryDelay:{get:function(){return ot},set:function(n){ot=n}},executeAnimation:function(n,t){return it(n,ut(t),at)},executeTransition:function(n,t){return it(n,ut(t),lt)},_animationTimeAdjustment:{get:function(){return l},set:function(n){l=n}}});r.Namespace._moduleDefine(n,"WinJS.Utilities",{_fastAnimations:{get:function(){return a},set:function(n){a=n}}})}});t("WinJS/Animations",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_WriteProfilerMark","./Animations/_Constants","./Animations/_TransitionAnimation","./Promise"],function(n,t,i,r,u,f,e,o){"use strict";function d(n,t,i){return n.keyframe?n.keyframe:!i||n.left!==t.left||n.top!==t.top||n.rtlflip&&!t.rtlflip?null:n.rtlflip?g(i):i}function rt(n,t){return t&&n.rtlflip?g(t):t}function g(n){var i=n+"-rtl";return function(r,u){return"ltr"===t.getComputedStyle(u).direction?n:i}}function v(n){return Array.isArray(n)||n instanceof t.NodeList||n instanceof t.HTMLCollection?n:n?[n]:[]}function nt(n){for(var r,u,f=[],i=0;i<n.length;i++)r={top:n[i].offsetTop,left:n[i].offsetLeft},u=t.getComputedStyle(n[i],null)[h.scriptName].split(","),6===u.length&&(r.left+=parseFloat(u[4]),r.top+=parseFloat(u[5])),f.push(r);return f}function a(n,t,i,r){return function(u){for(var f=n,e=0;u>e;e++)t*=i,f+=t;return r&&(f=Math.min(f,r)),f}}function tt(n,t){for(var i=0;i<t.length;i++)t[i].top-=n[i].offsetTop,t[i].left-=n[i].offsetLeft}function y(n,t,i){tt(n,t);for(var r=0;r<n.length;r++)(0!==t[r].top||0!==t[r].left)&&(n[r].style[h.scriptName]="translate("+t[r].left+"px, "+t[r].top+"px)");return e.executeTransition(n,i)}function b(n,t,i,r,u,f,o,s){function y(n,t,i){var u,f,r,e;if(n)if(u={left:t+"px",top:"0px"},f={left:i+"px",top:"0px"},+n.length===n.length)for(r=0,e=n.length;e>r;r++)w.push(n[r]),a.push(u),v.push(f);else w.push(n),a.push(u),v.push(f)}var w=[],a=[],v=[],p=200,b=0!==t?0>t?-p:p:0,k=0!==i?0>i?-p:p:0;return y(u,t,i),y(f,b,k),y(o,2*b,2*k),y(s,3*b,3*k),a=new l(a),v=new l(v),e.executeTransition(w,[{property:h.cssName,delay:0,duration:350,timing:n,from:c(a),to:c(v)},{property:"opacity",delay:0,duration:350,timing:r?"steps(1, start)":"steps(1, end)",from:r?0:1,to:r?1:0}])}function p(n,i,u){function o(){ut(n)}var f,s,h;for(n=v(n),i=v(i),f=0,s=n.length;s>f;f++)h="rtl"===t.getComputedStyle(n[f]).direction,n[f].style[r._browserStyleEquivalents["transform-origin"].scriptName]=i[Math.min(i.length-1,f)][h?"rtl":"ltr"];return e.executeTransition(n,u).then(o,o)}function ut(n){for(var t=0,i=n.length;i>t;t++)n[t].style[r._browserStyleEquivalents["transform-origin"].scriptName]="",n[t].style[h.scriptName]="",n[t].style.opacity=""}function c(n,i){return i=i||"",function(r,u){var e=n.getOffset(r),f=e.left;return e.rtlflip&&"rtl"===t.getComputedStyle(u).direction&&(f=f.toString(),f="-"===f.charAt(0)?f.substring(1):"-"+f),i+"translate("+f+", "+e.top+")"}}function it(n,t){return t=t||"",function(i){var r=n[i];return"translate("+r.left+"px, "+r.top+"px) "+t}}function ft(n,t){return function(i){var r=n[i];return 0===r.left&&0===r.top?t:null}}function w(n,t,i,r){var f=v(t),u=v(i),e=nt(u);return new n(f,u,e,r)}function k(n){for(var u=[],i=0,e=n.length;e>i;i++){var r=n[i].getBoundingClientRect(),o=-(40+r.left),s=40+(t.innerWidth-r.right),f=t.innerHeight/2-r.top;u.push({ltr:o+"px "+f+"px",rtl:s+"px "+f+"px"})}return u}function s(n){u("WinJS.UI.Animation:"+n)}var h=r._browserStyleEquivalents.transform,et=[{top:"0px",left:"11px",rtlflip:!0}],l=i.Class.define(function(n,t,i){i=i||et;Array.isArray(n)&&n.length>0?(this.offsetArray=n,1===n.length&&(this.keyframe=d(n[0],i[0],t))):n&&n.hasOwnProperty("top")&&n.hasOwnProperty("left")?(this.offsetArray=[n],this.keyframe=d(n,i[0],t)):(this.offsetArray=i,this.keyframe=rt(i[0],t))},{getOffset:function(n){return n>=this.offsetArray.length&&(n=this.offsetArray.length-1),this.offsetArray[n]}},{supportedForProcessing:!1}),ot=i.Class.define(function(n,t,i){this.revealedArray=n;this.affectedArray=t;this.offsetArray=i},{execute:function(){s("expandAnimation,StartTM");var n=e.executeAnimation(this.revealedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?200:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}),t=y(this.affectedArray,this.offsetArray,{property:h.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([n,t]).then(function(){s("expandAnimation,StopTM")})}},{supportedForProcessing:!1}),st=i.Class.define(function(n,t,i){this.hiddenArray=n;this.affectedArray=t;this.offsetArray=i},{execute:function(){s("collapseAnimation,StartTM");var n=e.executeAnimation(this.hiddenArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0}),t=y(this.affectedArray,this.offsetArray,{property:h.cssName,delay:this.hiddenArray.length>0?167:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([n,t]).then(function(){s("collapseAnimation,StopTM")})}},{supportedForProcessing:!1}),ht=i.Class.define(function(n,t,i){this.elementArray=t;this.offsetArray=i},{execute:function(){return s("repositionAnimation,StartTM"),y(this.elementArray,this.offsetArray,{property:h.cssName,delay:a(0,33,1,250),duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){s("repositionAnimation,StopTM")})}},{supportedForProcessing:!1}),ct=i.Class.define(function(n,t,i){this.addedArray=n;this.affectedArray=t;this.offsetArray=i},{execute:function(){s("addToListAnimation,StartTM");var n=this.affectedArray.length>0?240:0,t=e.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:h.cssName,delay:n,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:n,duration:120,timing:"linear",from:0,to:1}]),i=y(this.affectedArray,this.offsetArray,{property:h.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([t,i]).then(function(){s("addToListAnimation,StopTM")})}},{supportedForProcessing:!1}),lt=i.Class.define(function(n,t,i){this.deletedArray=n;this.remainingArray=t;this.offsetArray=i},{execute:function(){s("deleteFromListAnimation,StartTM");var n=e.executeAnimation(this.deletedArray,[{keyframe:"WinJS-scale-down",property:h.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:"none",to:"scale(0.85)"},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]),t=y(this.remainingArray,this.offsetArray,{property:h.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([n,t]).then(function(){s("deleteFromListAnimation,StopTM")})}},{supportedForProcessing:!1}),at=i.Class.define(function(n,t,i,r){this.addedArray=n;this.affectedArray=t;this.offsetArray=i;var u=v(r);this.deletedArray=u;this.deletedOffsetArray=nt(u)},{execute:function(){var n,t,i,r;return s("_updateListAnimation,StartTM"),tt(this.deletedArray,this.deletedOffsetArray),n=0,t=e.executeAnimation(this.deletedArray,[{keyframe:ft(this.deletedOffsetArray,"WinJS-scale-down"),property:h.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:it(this.deletedOffsetArray),to:it(this.deletedOffsetArray,"scale(0.85)")},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]),this.deletedArray.length>0&&(n+=60),i=y(this.affectedArray,this.offsetArray,{property:h.cssName,delay:n,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),this.affectedArray.length>0?n+=240:n&&(n+=60),r=e.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:h.cssName,delay:n,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:n,duration:120,timing:"linear",from:0,to:1}]),o.join([t,i,r]).then(function(){s("_updateListAnimation,StopTM")})}},{supportedForProcessing:!1}),vt=i.Class.define(function(n,t,i){this.addedArray=n;this.affectedArray=t;this.offsetArray=i},{execute:function(){s("addToSearchListAnimation,StartTM");var n=e.executeAnimation(this.addedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?240:0,duration:117,timing:"linear",from:0,to:1}),t=y(this.affectedArray,this.offsetArray,{property:h.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([n,t]).then(function(){s("addToSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),yt=i.Class.define(function(n,t,i){this.deletedArray=n;this.remainingArray=t;this.offsetArray=i},{execute:function(){s("deleteFromSearchListAnimation,StartTM");var n=e.executeAnimation(this.deletedArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:93,timing:"linear",from:1,to:0}),t=y(this.remainingArray,this.offsetArray,{property:h.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([n,t]).then(function(){s("deleteFromSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),pt=i.Class.define(function(n,t,i){this.elementArray=t;this.offsetArray=i},{execute:function(){return s("peekAnimation,StartTM"),y(this.elementArray,this.offsetArray,{property:h.cssName,delay:0,duration:2e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){s("peekAnimation,StopTM")})}},{supportedForProcessing:!1});i.Namespace._moduleDefine(n,"WinJS.UI.Animation",{createExpandAnimation:function(n,t){return w(ot,n,t)},createCollapseAnimation:function(n,t){return w(st,n,t)},createRepositionAnimation:function(n){return w(ht,null,n)},fadeIn:function(n){return s("fadeIn,StartTM"),e.executeTransition(n,{property:"opacity",delay:0,duration:250,timing:"linear",from:0,to:1}).then(function(){s("fadeIn,StopTM")})},fadeOut:function(n){return s("fadeOut,StartTM"),e.executeTransition(n,{property:"opacity",delay:0,duration:167,timing:"linear",to:0}).then(function(){s("fadeOut,StopTM")})},createAddToListAnimation:function(n,t){return w(ct,n,t)},createDeleteFromListAnimation:function(n,t){return w(lt,n,t)},_createUpdateListAnimation:function(n,t,i){return w(at,n,i,t)},createAddToSearchListAnimation:function(n,t){return w(vt,n,t)},createDeleteFromSearchListAnimation:function(n,t){return w(yt,n,t)},showEdgeUI:function(n,t,i){s("showEdgeUI,StartTM");var r=new l(t,"WinJS-showEdgeUI",[{top:"-70px",left:"0px"}]);return e[i&&"transition"===i.mechanism?"executeTransition":"executeAnimation"](n,{keyframe:r.keyframe,property:h.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:r.keyframe||c(r),to:"none"}).then(function(){s("showEdgeUI,StopTM")})},showPanel:function(n,t){s("showPanel,StartTM");var i=new l(t,"WinJS-showPanel",[{top:"0px",left:"364px",rtlflip:!0}]);return e.executeAnimation(n,{keyframe:i.keyframe,property:h.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||c(i),to:"none"}).then(function(){s("showPanel,StopTM")})},hideEdgeUI:function(n,t,i){s("hideEdgeUI,StartTM");var r=new l(t,"WinJS-hideEdgeUI",[{top:"-70px",left:"0px"}]);return e[i&&"transition"===i.mechanism?"executeTransition":"executeAnimation"](n,{keyframe:r.keyframe,property:h.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:r.keyframe||c(r)}).then(function(){s("hideEdgeUI,StopTM")})},hidePanel:function(n,t){s("hidePanel,StartTM");var i=new l(t,"WinJS-hidePanel",[{top:"0px",left:"364px",rtlflip:!0}]);return e.executeAnimation(n,{keyframe:i.keyframe,property:h.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:i.keyframe||c(i)}).then(function(){s("hidePanel,StopTM")})},showPopup:function(n,t){s("showPopup,StartTM");var i=new l(t,"WinJS-showPopup",[{top:"50px",left:"0px"}]);return e.executeAnimation(n,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:83,duration:83,timing:"linear",from:0,to:1},{keyframe:i.keyframe,property:h.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||c(i),to:"none"}]).then(function(){s("showPopup,StopTM")})},hidePopup:function(n){return s("hidePopup,StartTM"),e.executeAnimation(n,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:83,timing:"linear",from:1,to:0}).then(function(){s("hidePopup,StopTM")})},pointerDown:function(n){return s("pointerDown,StartTM"),e.executeTransition(n,{property:h.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.975, 0.975)"}).then(function(){s("pointerDown,StopTM")})},pointerUp:function(n){return s("pointerUp,StartTM"),e.executeTransition(n,{property:h.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){s("pointerUp,StopTM")})},dragSourceStart:function(n,t){s("dragSourceStart,StartTM");var i=e.executeTransition(n,[{property:h.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(1.05)"},{property:"opacity",delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:.65}]),r=e.executeTransition(t,{property:h.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"});return o.join([i,r]).then(function(){s("dragSourceStart,StopTM")})},dragSourceEnd:function(n,t,i){s("dragSourceEnd,StartTM");var r=new l(t,"WinJS-dragSourceEnd"),u=e.executeTransition(n,[{property:h.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:1}]),f=e.executeAnimation(n,{keyframe:r.keyframe,property:h.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:r.keyframe||c(r,"scale(1.05) "),to:"none"}),a=e.executeTransition(i,{property:h.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return o.join([u,f,a]).then(function(){s("dragSourceEnd,StopTM")})},enterContent:function(n,t,i){var u,r,f,a;return s("enterContent,StartTM"),r=new l(t,"WinJS-enterContent",[{top:"0px",left:"40px",rtlflip:!0}]),i&&"transition"===i.mechanism?u=e.executeTransition(n,[{property:h.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:c(r),to:"none"},{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}]):(f=e.executeAnimation(n,{keyframe:r.keyframe,property:h.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:r.keyframe||c(r),to:"none"}),a=e.executeTransition(n,{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}),u=o.join([f,a])),u.then(function(){s("enterContent,StopTM")})},exitContent:function(n,t){s("exitContent,StartTM");var i=new l(t,"WinJS-exit",[{top:"0px",left:"0px"}]),r=e.executeAnimation(n,t&&{keyframe:i.keyframe,property:h.cssName,delay:0,duration:117,timing:"linear",from:"none",to:i.keyframe||c(i)}),u=e.executeTransition(n,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return o.join([r,u]).then(function(){s("exitContent,StopTM")})},dragBetweenEnter:function(n,t){s("dragBetweenEnter,StartTM");var i=new l(t,null,[{top:"-40px",left:"0px"},{top:"40px",left:"0px"}]);return e.executeTransition(n,{property:h.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:c(i,"scale(0.95) ")}).then(function(){s("dragBetweenEnter,StopTM")})},dragBetweenLeave:function(n){return s("dragBetweenLeave,StartTM"),e.executeTransition(n,{property:h.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"}).then(function(){s("dragBetweenLeave,StopTM")})},swipeSelect:function(n,t){s("swipeSelect,StartTM");var i=e.executeTransition(n,{property:h.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),r=e.executeAnimation(t,{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return o.join([i,r]).then(function(){s("swipeSelect,StopTM")})},swipeDeselect:function(n,t){s("swipeDeselect,StartTM");var i=e.executeTransition(n,{property:h.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),r=e.executeAnimation(t,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0});return o.join([i,r]).then(function(){s("swipeDeselect,StopTM")})},swipeReveal:function(n,t){s("swipeReveal,StartTM");var i=new l(t,null,[{top:"25px",left:"0px"}]);return e.executeTransition(n,{property:h.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:c(i)}).then(function(){s("swipeReveal,StopTM")})},enterPage:function(n,t){s("enterPage,StartTM");var i=new l(t,"WinJS-enterPage",[{top:"0px",left:"100px",rtlflip:!0}]),r=e.executeAnimation(n,{keyframe:i.keyframe,property:h.cssName,delay:a(0,83,1,333),duration:1e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||c(i),to:"none"}),u=e.executeTransition(n,{property:"opacity",delay:a(0,83,1,333),duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return o.join([r,u]).then(function(){s("enterPage,StopTM")})},exitPage:function(n,t){s("exitPage,StartTM");var i=new l(t,"WinJS-exit",[{top:"0px",left:"0px"}]),r=e.executeAnimation(n,t&&{keyframe:i.keyframe,property:h.cssName,delay:0,duration:117,timing:"linear",from:"none",to:i.keyframe||c(i)}),u=e.executeTransition(n,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return o.join([r,u]).then(function(){s("exitPage,StopTM")})},crossFade:function(n,t){s("crossFade,StartTM");var i=e.executeTransition(n,{property:"opacity",delay:0,duration:167,timing:"linear",to:1}),r=e.executeTransition(t,{property:"opacity",delay:0,duration:167,timing:"linear",to:0});return o.join([i,r]).then(function(){s("crossFade,StopTM")})},createPeekAnimation:function(n){return w(pt,null,n)},updateBadge:function(n,t){s("updateBadge,StartTM");var i=new l(t,"WinJS-updateBadge",[{top:"24px",left:"0px"}]);return e.executeAnimation(n,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1},{keyframe:i.keyframe,property:h.cssName,delay:0,duration:1333,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||c(i),to:"none"}]).then(function(){s("updateBadge,StopTM")})},turnstileForwardIn:function(n){s("turnstileForwardIn,StartTM");n=v(n);var t=k(n);return p(n,t,[{property:h.cssName,delay:a(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(80deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:a(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){s("turnstileForwardIn,StopTM")})},turnstileForwardOut:function(n){s("turnstileForwardOut,StartTM");n=v(n);var t=k(n);return p(n,t,[{property:h.cssName,delay:a(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(600px) rotateY(0deg)",to:"perspective(600px) rotateY(-50deg)"},{property:"opacity",delay:a(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){s("turnstileForwardOut,StopTM")})},turnstileBackwardIn:function(n){s("turnstileBackwardIn,StartTM");n=v(n);var t=k(n);return p(n,t,[{property:h.cssName,delay:a(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(-50deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:a(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){s("turnstileBackwardIn,StopTM")})},turnstileBackwardOut:function(n){s("turnstileBackwardOut,StartTM");n=v(n);var t=k(n);return p(n,t,[{property:h.cssName,delay:a(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(800px) rotateY(0deg)",to:"perspective(800px) rotateY(80deg)"},{property:"opacity",delay:a(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){s("turnstileBackwardOut,StopTM")})},slideDown:function(n){return s("slideDown,StartTM"),p(n,{ltr:"",rtl:""},[{property:h.cssName,delay:0,duration:250,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"translate(0px, 0px)",to:"translate(0px, 200px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){s("slideDown,StopTM")})},slideUp:function(n){return s("slideUp,StartTM"),p(n,{ltr:"",rtl:""},[{property:h.cssName,delay:0,duration:350,timing:"cubic-bezier(0.17,0.79,0.215,1.0025)",from:"translate(0px, 200px)",to:"translate(0px, 0px)"},{property:"opacity",delay:a(0,34,1,1e3),duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){s("slideUp,StopTM")})},slideRightIn:function(n,i,r,u){return s("slideRightIn,StartTM"),b("cubic-bezier(0.17,0.79,0.215,1.0025)",-t.innerWidth,0,!0,n,i,r,u).then(function(){s("slideRightIn,StopTM")})},slideRightOut:function(n,i,r,u){return s("slideRightOut,StartTM"),b("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,t.innerWidth,!1,n,i,r,u).then(function(){s("slideRightOut,StopTM")})},slideLeftIn:function(n,i,r,u){return s("slideLeftIn,StartTM"),b("cubic-bezier(0.17,0.79,0.215,1.0025)",t.innerWidth,0,!0,n,i,r,u).then(function(){s("slideLeftIn,StopTM")})},slideLeftOut:function(n,i,r,u){return s("slideLeftOut,StartTM"),b("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,-t.innerWidth,!1,n,i,r,u).then(function(){s("slideLeftOut,StopTM")})},continuumForwardIn:function(n,t,i){return s("continuumForwardIn,StartTM"),o.join([e.executeTransition(n,[{property:h.cssName,delay:0,duration:350,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(0.5, 0.5)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),e.executeTransition(t,[{property:h.cssName,delay:0,duration:350,timing:"cubic-bezier(0.24,1.15,0.11,1.1575)",from:"translate(0px, 225px)",to:"translate(0px, 0px)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),p(i,{ltr:"0px 50%",rtl:"100% 50%"},[{property:h.cssName,delay:0,duration:350,timing:"cubic-bezier(0,0.62,0.8225,0.9625)",from:"rotateX(80deg) scale(1.5, 1.5)",to:"rotateX(0deg) scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){s("continuumForwardIn,StopTM")})},continuumForwardOut:function(n,t){return s("continuumForwardOut,StartTM"),o.join([e.executeTransition(n,[{property:h.cssName,delay:0,duration:120,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(1.1, 1.1)"},{property:"opacity",delay:0,duration:120,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]),p(t,{ltr:"0px 100%",rtl:"100% 100%"},[{property:h.cssName,delay:0,duration:152,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"rotateX(0deg) scale(1.0, 1.0) translate(0px, 0px)",to:"rotateX(80deg) scale(1.5, 1.5) translate(0px, 150px)"},{property:"opacity",delay:0,duration:152,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}])]).then(function(){s("continuumForwardOut,StopTM")})},continuumBackwardIn:function(n,t){return s("continuumBackwardIn,StartTM"),o.join([e.executeTransition(n,[{property:h.cssName,delay:0,duration:200,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(1.25, 1.25)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:200,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),p(t,{ltr:"0px 50%",rtl:"100% 50%"},[{property:h.cssName,delay:0,duration:250,timing:"cubic-bezier(0.2975, 0.7325, 0.4725, 0.99)",from:"rotateX(80deg) translate(0px, -100px)",to:"rotateX(0deg) translate(0px, 0px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){s("continuumBackwardIn,StopTM")})},continuumBackwardOut:function(n){return s("continuumBackwardOut,StartTM"),e.executeTransition(n,[{property:h.cssName,delay:0,duration:167,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(0.5, 0.5)"},{property:"opacity",delay:0,duration:167,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){s("continuumBackwardOut,StopTM")})},createPageNavigationAnimations:function(){function t(){return o.wrap()}return{exit:t,entrance:n.enterPage}}})});t("WinJS/Binding/_BindingParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../ControlProcessor/_OptionsLexer","../ControlProcessor/_OptionsParser"],function(n,t,i,r,u,f,e,o,s){"use strict";function a(n,t){e("WinJS.Binding:bindingParser,StartTM");var i=h.lexer(n),r=new c.BindingInterpreter(i,n,t||{}),u=r.run();return e("WinJS.Binding:bindingParser,StopTM"),u}function v(n){e("WinJS.Binding:bindingParser,StartTM");var t=h.lexer(n),i=new c.BindingParser(t,n),r=i.run();return e("WinJS.Binding:bindingParser,StopTM"),r}var l={get invalidBinding(){return"Invalid binding:'{0}'. Expected to be '<destProp>:<sourceProp>;'. {1}"},get bindingInitializerNotFound(){return"Initializer not found:'{0}'"}},h=t.Namespace.defineWithParent(null,null,{lexer:t.Namespace._lazy(function(){return o._optionsLexer}),tokenType:t.Namespace._lazy(function(){return o._optionsLexer.tokenType})}),y=i.requireSupportedForProcessing,c=t.Namespace.defineWithParent(null,null,{BindingInterpreter:t.Namespace._lazy(function(){return t.Class.derive(s.optionsParser._BaseInterpreter,function(n,t,i){this._initialize(n,t,i)},{_error:function(n){throw new r("WinJS.Binding.ParseError",f._formatString(l.invalidBinding,this._originalSource,n));},_evaluateInitializerName:function(){if(this._current.type===h.tokenType.identifier){var n=this._evaluateIdentifierExpression();return u.log&&!n&&u.log(f._formatString(l.bindingInitializerNotFound,this._originalSource),"winjs binding","error"),y(n)}},_evaluateValue:function(){switch(this._current.type){case h.tokenType.stringLiteral:case h.tokenType.numberLiteral:var n=this._current.value;return this._read(),n;default:return void this._unexpectedToken(h.tokenType.stringLiteral,h.tokenType.numberLiteral)}},_readBindDeclarations:function(){for(var n=[];;)switch(this._current.type){case h.tokenType.identifier:case h.tokenType.thisKeyword:n.push(this._readBindDeclaration());break;case h.tokenType.semicolon:this._read();break;case h.tokenType.eof:return n;default:return void this._unexpectedToken(h.tokenType.identifier,h.tokenType.semicolon,h.tokenType.eof)}},_readBindDeclaration:function(){var i=this._readDestinationPropertyName(),n,t;return this._read(h.tokenType.colon),n=this._readSourcePropertyName(),t=this._evaluateInitializerName(),{destination:i,source:n,initializer:t}},_readDestinationPropertyName:function(){return this._readIdentifierExpression()},_readSourcePropertyName:function(){return this._readIdentifierExpression()},run:function(){return this._readBindDeclarations()}},{supportedForProcessing:!1})}),BindingParser:t.Namespace._lazy(function(){return t.Class.derive(c.BindingInterpreter,function(n,t){this._initialize(n,t,{})},{_readInitializerName:function(){if(this._current.type===h.tokenType.identifier)return this._readIdentifierExpression()},_readBindDeclaration:function(){var i=this._readDestinationPropertyName(),n,t;return this._read(h.tokenType.colon),n=this._readSourcePropertyName(),t=this._readInitializerName(),{destination:i,source:n,initializer:t}}},{supportedForProcessing:!1})})});t.Namespace._moduleDefine(n,"WinJS.Binding",{_bindingParser:a,_bindingParser2:v})});t("WinJS/Binding/_DomWeakRefTable",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Scheduler"],function(n,t,i,r,u,f){"use strict";function c(){var n,r,t,u,i;for(0===s&&(o=0),t=Object.keys(e),u=Date.now()-a,n=0,r=t.length;r>n;n++)i=t[n],e[i].time<u&&delete e[i];y()}function p(){t.Debug&&t.Debug.debuggerEnabled&&h||o||(0===s?(f.schedule(c,f.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),o=1):o=t.setInterval(c,s))}function y(){t.Debug&&t.Debug.debuggerEnabled&&h||(0===s?o||0!==Object.keys(e).length&&(f.schedule(c,f.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),o=1):o&&0===Object.keys(e).length&&(t.clearInterval(o),o=0))}function w(n,t){return e[t]={element:n,time:Date.now()},p(),t}function b(n){var r,i;return v?(i=e[n],i?i.element:t.document.getElementById(n)):(r=t.document.getElementById(n),r?(delete e[n],y()):(i=e[n],i&&(i.time=Date.now(),r=i.element)),r)}var l;if(i.Windows.Foundation.Uri&&i.msSetWeakWinRTProperty&&i.msGetWeakWinRTProperty)return l=new i.Windows.Foundation.Uri("about://blank"),void r.Namespace._moduleDefine(n,"WinJS.Utilities",{_createWeakRef:function(n,t){return i.msSetWeakWinRTProperty(l,t,n),t},_getWeakRefElement:function(n){return i.msGetWeakWinRTProperty(l,n)}});var o,s=500,a=1e3,e={},h=!0,v=!1;r.Namespace._moduleDefine(n,"WinJS.Utilities",{_DOMWeakRefTable_noTimeoutUnderDebugger:{get:function(){return h},set:function(n){h=n}},_DOMWeakRefTable_sweepPeriod:{get:function(){return s},set:function(n){s=n}},_DOMWeakRefTable_timeout:{get:function(){return a},set:function(n){a=n}},_DOMWeakRefTable_tableSize:{get:function(){return Object.keys(e).length}},_DOMWeakRefTable_fastLoadPath:{get:function(){return v},set:function(n){v=n}},_createWeakRef:w,_getWeakRefElement:b})});t("WinJS/Binding/_Data",["exports","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Promise","../Scheduler","./_DomWeakRefTable"],function(n,t,i,r,u,f,e,o,s,h){"use strict";var a={get exceptionFromBindingInitializer(){return"Exception thrown from binding initializer: {0}"},get propertyIsUndefined(){return"{0} is undefined"},get unsupportedDataTypeForBinding(){return"Unsupported data type"}},v={_listeners:null,_pendingNotifications:null,_notifyId:0,_getObservable:function(){return this},_cancel:function(n){var r=this._pendingNotifications,f=!1,u,t,i;if(r)for(u=Object.keys(r),t=u.length-1;t>=0;t--)i=r[u[t]],i.target===n&&(i.promise&&(i.promise.cancel(),i.promise=null),delete r[u[t]],f=!0);return f},notify:function(n,t,i){var u=this._listeners&&this._listeners[n],r;if(u){r=this;r._cancel(n);r._pendingNotifications=r._pendingNotifications||{};var c=r._notifyId++,h=r._pendingNotifications[c]={target:n},l=function(){delete r._pendingNotifications[c]};return h.promise=s.schedulePromiseNormal(null,"WinJS.Binding.observableMixin.notify").then(function(){for(var n=0,r=u.length;r>n&&h.promise;n++)try{u[n](t,i)}catch(o){f.log&&f.log(e._formatString(a.exceptionFromBindingInitializer,o.toString()),"winjs binding","error")}return l(),t}),h.promise}return o.as()},bind:function(n,t){this._listeners=this._listeners||{};for(var i=this._listeners[n]=this._listeners[n]||[],u=!1,r=0,f=i.length;f>r;r++)if(i[r]===t){u=!0;break}return u||(i.push(t),t(p(this[n]))),this},unbind:function(n,t){var i,f,r,o,u,e;if(this._listeners=this._listeners||{},n&&t){if(i=this._listeners[n],i){for(r=0,o=i.length;o>r;r++)i[r]!==t&&(f=f||[]).push(i[r]);this._listeners[n]=f}}else n?(this._cancel(n),delete this._listeners[n]):(u=this,u._pendingNotifications&&(e=u._pendingNotifications,u._pendingNotifications={},Object.keys(e).forEach(function(n){var t=e[n];t.promise&&t.promise.cancel()})),this._listeners={});return this}},c={_backingData:null,_initObservable:function(n){this._backingData=n||{}},getProperty:function(n){var t=this._backingData[n];return f.log&&void 0===t&&f.log(e._formatString(a.propertyIsUndefined,n),"winjs binding","warn"),l(t)},setProperty:function(n,t){return this.updateProperty(n,t),this},addProperty:function(n,t){return this[n]||Object.defineProperty(this,n,{get:function(){return this.getProperty(n)},set:function(t){this.setProperty(n,t)},enumerable:!0,configurable:!0}),this.setProperty(n,t)},updateProperty:function(n,t){var r=this._backingData[n],i=p(t);return r!==i&&(this._backingData[n]=i,this._backingData[n]===i)?this.notify(n,i,r):o.as()},removeProperty:function(n){var t,i=this._backingData[n];try{delete this._backingData[n]}catch(r){}try{delete this[n]}catch(r){}return this.notify(n,t,i),this}};Object.keys(v).forEach(function(n){c[n]=v[n]});var d=function(n,t){return k(n,t)},g=0,w=function(){return"bindHandler"+g++},b=function(n,i){if(!t.msGetWeakWinRTProperty)return n;var r=w();return h._getWeakRefElement(i)[r]=n,function(n,t){var u=h._getWeakRefElement(i);u&&u[r](n,t)}},k=function(n,t,i){function o(){r&&r.forEach(function(n){n.source.unbind(n.prop,n.listener)});r=null}function e(n){u[n]&&(u[n].complexBind.cancel(),delete u[n])}var f,u,r;return(n=l(n),!n)?{cancel:function(){},empty:!0}:(i||(i=w(),f={},h._createWeakRef(f,i)),u={},r=null,Object.keys(t).forEach(function(o){var s=t[o],h;s instanceof Function?(s=b(s,i),s.bindState=f,r=r||[],r.push({source:n,prop:o,listener:s}),n.bind(o,s)):(h=function(n){var t,r;e(o);t=k(l(n),s,i);t.empty&&(r=function(n){Object.keys(n).forEach(function(t){var i=n[t];i instanceof Function?i(void 0,void 0):r(i)})},r(s));u[o]={source:n,complexBind:t}},h=b(h,i),h.bindState=f,r=r||[],r.push({source:n,prop:o,listener:h}),n.bind(o,h))}),{cancel:function(){o();Object.keys(u).forEach(function(n){e(n)})}})},nt=i.Class.mix(function(n){this._initObservable(n);Object.defineProperties(this,y(n))},c),y=function(n){function i(n){t[n]={get:function(){return this.getProperty(n)},set:function(t){this.setProperty(n,t)},enumerable:!0,configurable:!0}}for(var t={};n&&n!==Object.prototype;)Object.keys(n).forEach(i),n=Object.getPrototypeOf(n);return t},tt=function(n){if(!(!n||"object"!=typeof n||n instanceof Date||Array.isArray(n)))return i.Class.mix(function(t){this._initObservable(t||Object.create(n))},c,y(n));if(r.validation)throw new u("WinJS.Binding.UnsupportedDataType",e._formatString(a.unsupportedDataTypeForBinding));},l=function(n){var i,t;return n?(i=typeof n,"object"!==i||n instanceof Date||Array.isArray(n))?n:n._getObservable?n._getObservable():(t=new nt(n),t.backingData=n,Object.defineProperty(n,"_getObservable",{value:function(){return t},enumerable:!1,writable:!1}),t):n},p=function(n){return n&&n.backingData?n.backingData:n};i.Namespace._moduleDefine(n,"WinJS.Binding",{mixin:{value:c,enumerable:!1,writable:!0,configurable:!0},dynamicObservableMixin:{value:c,enumerable:!0,writable:!0,configurable:!0},observableMixin:{value:v,enumerable:!0,writable:!0,configurable:!0},expandProperties:y,define:tt,as:l,unwrap:p,bind:d})});t("WinJS/Binding/_Declarative",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","./_BindingParser","./_Data","./_DomWeakRefTable"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function st(n,t){var i=n._autoDispose;i&&i.push(t)}function ht(n){n._autoDispose=(n._autoDispose||[]).filter(function(n){return n()})}function d(n,t){return n?n.winBindingToken===t?n:void(e.log&&e.log(o._formatString(y.duplicateBindingDetected,n.id),"winjs binding","error")):n}function g(n){if(n.winBindingToken)return n.winBindingToken;var t="_win_bind"+gt++;return Object.defineProperty(n,"winBindingToken",{configurable:!1,writable:!1,enumerable:!1,value:t}),t}function ct(n,t,i,r,u,f,e){var o=n.initializer,s;if(o&&(o=o.winControl||o["data-win-control"]||o),o instanceof Function)return s=o(r,n.source,u,n.destination),e&&(s&&s.cancel?e.bindings.push(function(){s.cancel()}):e.nocache=!0),s;o&&o.render&&(f.count++,e&&(e.nocache=!0),p(o.render).call(o,w(r,n.source),u).then(function(){f.checkComplete()}))}function lt(n,t,i,r,u,f){var s,c=!0,l=!1,h,a,p;return ht(r),h=function(){if(!l){var i=d(v._getWeakRefElement(n),t);return i||(e.log&&e.log(o._formatString(y.elementNotFound,n),"winjs binding","info"),s&&s.cancel()),i}},a=function(n){var t=h();t&&k(t,u.destination,n);c&&(i.checkComplete(),c=!1)},(st(r,h),s=tt(r,u.source,a))&&(p=s.cancel,s.cancel=function(){return l=!0,p.call(s)},f&&f.bindings.push(function(){s.cancel()})),s}function at(n,i,r,u,f,e,o){var s;return u!==t&&(u=a.as(u)),u._getObservable&&(s=u._getObservable()),s?(e.count++,lt(i,r,e,s,n,o)):void k(f,n.destination,w(u,n.source))}function rt(n,t){for(var s,r,i=n.length-1;i>=0;i--)if(s=n[i],r=s.destination,1===r.length&&"id"===r[0]){if(u.validation)throw new f("WinJS.Binding.IdBindingNotSupported",o._formatString(y.idBindingNotSupported,t));e.log&&e.log(o._formatString(y.idBindingNotSupported,t),"winjs binding","error");n.splice(i,1)}return n}function vt(n,i){if(i){var r,u=i.expressions[n];return u||(r=rt(l._bindingParser(n,t),n),i.expressions[n]=r),r||(r=u),r}return rt(l._bindingParser(n,t),n)}function yt(n,i,r,u,f,e){var pt,d,a,wt,o,nt,bt,h,tt,kt,b,rt,l,k,ft,et,dt,ht,ot;s("WinJS.Binding:processAll,StartTM");var st,y={count:0,checkComplete:function(){this.count--;0===this.count&&(s("WinJS.Binding:processAll,StopTM"),e())}},w=n||t.document.body,lt="[data-win-bind],[data-win-control]",yt=w.querySelectorAll(lt);!r&&(w.getAttribute("data-win-bind")||w.winControl)&&(st=w);y.count++;pt=i||t;v._DOMWeakRefTable_fastLoadPath=!0;try{for(d=c.data(w),d.winBindings=d.winBindings||[],a=st?-1:0,wt=yt.length;wt>a;a++)if(o=0>a?st:yt[a],o.winControl&&o.winControl.constructor&&o.winControl.constructor.isDeclarativeControlContainer&&(a+=o.querySelectorAll(lt).length,nt=o.winControl.constructor.isDeclarativeControlContainer,"function"==typeof nt&&(nt=p(nt))(o.winControl,function(n){return ut(n,i,!1,u,f)})),o.hasAttribute("data-win-bind")){if(bt=o.getAttribute("data-win-bind"),h=vt(bt,u),!h.implemented){for(tt=0,kt=h.length;kt>tt;tt++)b=h[tt],b.initializer=b.initializer||f,b.implementation=b.initializer?ct:at;h.implemented=!0}for(y.count++,rt=g(o),l=it?rt:o.id,l||(o.id=l=rt),v._createWeakRef(o,l),k=c.data(o),k.winBindings=null,u&&u.elements&&(ft=u.elements[l],ft||(u.elements[l]=ft={bindings:[]})),et=0,dt=h.length;dt>et;et++)ht=h[et],ot=ht.implementation(ht,l,rt,pt,o,y,ft),ot&&(k.winBindings=k.winBindings||[],k.winBindings.push(ot),d.winBindings.push(ot));y.count--}}finally{v._DOMWeakRefTable_fastLoadPath=!1}y.checkComplete()}function ut(n,t,i,r,u){return new h(function(f,e,o){yt(n,t,i,r,u,f,e,o)}).then(null,function(n){return e.log&&e.log(o._formatString(y.errorInitializingBindings,n&&n.message),"winjs binding","error"),h.wrapError(n)})}function ft(n){var i=function(i,r,u,f,s){var l=g(u),h=it?l:u.id,nt,rt,c,b;if(h||(u.id=h=l),v._createWeakRef(u,h),i!==t&&(i=a.as(i)),i._getObservable&&(nt=i._getObservable()),nt)return rt=0,c=tt(a.as(i),r,function(t){if(1!=++rt||t!==s){var i=d(v._getWeakRefElement(h),l);i?k(i,f,n(p(t))):c&&(e.log&&e.log(o._formatString(y.elementNotFound,h),"winjs binding","info"),c.cancel())}}),c;b=w(i,r);b!==s&&k(u,f,n(b))};return ot(i)}function w(n,i){if(n!==t&&(n=p(n)),i)for(var r=0,u=i.length;u>r&&null!==n&&void 0!==n;r++)n=p(n[i[r]]);return n}function k(n,i,r){var u,s,f;for(p(r),n=p(n),u=0,s=i.length-1;s>u;u++){if(n=p(n[i[u]]),!n)return void(e.log&&e.log(o._formatString(y.propertyDoesNotExist,i[u],i.join(".")),"winjs binding","error"));if(n instanceof t.Node)return void(e.log&&e.log(o._formatString(y.nestedDOMElementBindingNotSupported,i[u],i.join(".")),"winjs binding","error"))}if(0===i.length)return void(e.log&&e.log(y.cannotBindToThis,"winjs binding","error"));f=i[i.length-1];e.log&&void 0===n[f]&&e.log(o._formatString(y.creatingNewProperty,f,i.join(".")),"winjs binding","warn");n[f]=r}function nt(n,t,i){return n=p(n),t&&1===t.length&&t[0]?void n.setAttribute(t[0],i):void(e.log&&e.log(y.attributeBindingSingleProperty,"winjs binding","error"))}function pt(n,i,r,u,f){var c=g(r),s=it?c:r.id,l,k,h,b;if(s||(r.id=s=c),v._createWeakRef(r,s),n!==t&&(n=a.as(n)),n._getObservable&&(l=n._getObservable()),l)return k=0,h=tt(l,i,function(n){if(1!=++k||n!==f){var t=d(v._getWeakRefElement(s),c);t?nt(t,u,p(n)):h&&(e.log&&e.log(o._formatString(y.elementNotFound,s),"winjs binding","info"),h.cancel())}}),h;b=w(n,i);b!==f&&nt(r,u,b)}function wt(n,t,i,r){return nt(i,r,w(n,t))}function bt(n,t,i){i=p(i);var r=w(n,t);Array.isArray(r)?r.forEach(function(n){c.addClass(i,n)}):r&&c.addClass(i,r)}function kt(n,t,i,r,u){return ni(n,t,i,r,u)}function tt(n,t,i){if(t.length>1){for(var f={},r=f,u=0,e=t.length-1;e>u;u++)r=r[t[u]]={};return r[t[t.length-1]]=i,a.bind(n,f,!0)}return 1===t.length?(n.bind(t[0],i,!0),{cancel:function(){n.unbind(t[0],i);this.cancel=et}}):void i(n)}function et(){}function dt(n,t,i,r){return k(i,r,w(n,t)),{cancel:et}}function b(n){return ot(n)}var gt=1e3*Math.random()>>0,it=i.msSetWeakWinRTProperty&&i.msGetWeakWinRTProperty,y={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get creatingNewProperty(){return"Creating new property {0}. Full path:{1}"},get duplicateBindingDetected(){return"Binding against element with id {0} failed because a duplicate id was detected."},get elementNotFound(){return"Element not found:{0}"},get errorInitializingBindings(){return"Error initializing bindings: {0}"},get propertyDoesNotExist(){return"{0} doesn't exist. Full path:{1}"},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"},get nestedDOMElementBindingNotSupported(){return"Binding through a property {0} of type HTMLElement is not supported, Full path:{1}."}},ot=u.markSupportedForProcessing,p=u.requireSupportedForProcessing,ni=ft(function(n){return n});r.Namespace._moduleDefine(n,"WinJS.Binding",{processAll:ut,oneTime:b(dt),defaultBind:b(kt),converter:ft,initializer:b,getValue:w,setAttribute:b(pt),setAttributeOneTime:b(wt),addClassOneTime:b(bt)})});t("WinJS/Binding",["./Binding/_BindingParser","./Binding/_Data","./Binding/_Declarative","./Binding/_DomWeakRefTable"],function(){});t("WinJS/BindingTemplate/_DataTemplateCompiler",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Binding/_BindingParser","../Binding/_Declarative","../ControlProcessor","../ControlProcessor/_OptionsParser","../Fragments","../Promise","../_Signal","../Utilities/_Dispose","../Utilities/_SafeHtml","../Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";if(t.document){var k={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"}};i.Namespace._moduleDefine(n,"WinJS.Binding",{_TemplateCompiler:i.Namespace._lazy(function(){function bi(n,t,i){var r=b.data(n).bindTokens;r&&r.forEach(function(n){n&&n.cancel&&n.cancel()});t&&t.cancel();i&&i.cancel()}function ki(n,t){return function(i){return h.processAll(i,n,!1,null,t)}}function di(n){return n=rt(n),n instanceof t.Node?null:n}function ot(n,t){var i=-1!==n.indexOf("\n"),r=arguments;return n.replace(br,function(f,e,o,s,h,c,l){var v,y,a;if(h||c)throw new u("Format:MalformedInputString","Did you forget to escape a: "+(h||c)+" at: "+l);if(e)return"{";if(o)return"}";if(y=+s,v=y===+y?r[y+1]:t[s],void 0===v)throw new u("Format:MissingPart","Missing part '"+s+"'");if(i){for(a=l;a>0&&" "===n[--a];);a>=0&&"\n"===n[a]&&(v=tt(l-a-1,v))}return v})}function tt(n,t){for(var i="",r=0;n>r;r++)i+=" ";return t.split("\n").map(function(n,t){return t?i+n:n}).join("\n")}function it(n){return n.trim()}function et(n){return n.join(";\n")}function ni(n){return n.join(", ")||"empty"}function st(t){return t.map(function(t){return t.match(dt)?"."+t:+t===t?ot("[{0}]",t):ot("[{0}]",n(t))}).join("")}function ti(t,i,r,u){var i=i.map(function(t){return t.match(dt)?"."+t:(+t===t&&(t=+t),gi(n(t)))}).map(function(n){return ot("{filter}({temp} = {temp}{part})",{filter:u,temp:r,part:n})});return i.unshift(ii(vt(r,t))),i.push(r),ii(i.join(" && "))}function n(n){return JSON.stringify(n)}function at(n){return n?"new Array("+ +n+")":"[]"}function vt(n,t){return""+n+" = "+t}function ii(n){return"("+n+")"}function gi(n){return"["+n+"]"}function nr(t){return t.match(dt)?t:+t===t?+t:n(t)}function tr(n){return n=""+n,n.replace(pr,function(n){return wr[n]||" "})}function ri(n,t,i){return new String(i?""+n+t+"_"+i:""+n+t)}function ui(n){return n.replace(/\\n/g,"\\n\\\n")}function ir(n){return Object.keys(n)}function fi(n){return Object.keys(n).map(function(t){return n[t]})}function ei(n,t){return oi([n,t])}function oi(n){for(var r,u={},t=0,o=n.length;o>t;t++)for(var f=n[t],e=Object.keys(f),i=0,s=e.length;s>i;i++)r=e[i],u[r]=f[r];return u}function rr(n){return n.reduce(function(n,t){return n?rt(n[t]):null},t)}function ht(n,t,i,r){var u=n.children,f,e,s,o,h;if(u){for(f=Object.keys(u),t&&i&&i(n,t,f.length),e=0,s=f.length;s>e;e++)o=f[e],h=u[o],ht(h,o,i,r);t&&r&&r(n,t,Object.keys(u).length)}else t&&i&&i(n,t,0),t&&r&&r(n,t,0)}function ft(n){return n.replace(/^\s*$/gm,"").replace(/^(.*[^\s])( *)$/gm,function(n,t){return t})}var ur=v._cancelBlocker,si=h.defaultBind,yt=h.oneTime,fr=h.setAttribute,pt=h.setAttributeOneTime,hi=h.addClassOneTime,er=v.as,rt=r.requireSupportedForProcessing,or=w.insertAdjacentHTMLUnsafe,sr=b.data,hr=p.markDisposable,cr=c.processAll,lr=h.processAll,ar=l._optionsParser,wt=l._CallExpression,bt=l._IdentifierExpression,vr=s._bindingParser2,yr=c.scopedSelect,kt=o,dt=/^[A-Za-z]\w*$/,ci=/[^A-Za-z\w$]/g,pr=/[&<>'"]/g,wr={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},br=/({{)|(}})|{(\w+)}|({)|(})/g,kr=/^\s*;\s*$/,dr=/[A-Z]/g,ct=i.Class.define(function(n,t,i,r,u){var f=this;this.compiler=n;this.kind=i;this.base=new String(t);this.tree={children:{},parent:this.base,reference:function(){return f.base}};this.accessExpression=r;this.filter=u||""},{createPathExpression:function(n,t){if(n.length){var r=this,i=n.reduce(function(n,t){return n.children=n.children||{},n.children[t]=n.children[t]||{parent:n},n.children[t]},this.tree);return i.name=i.name||r.compiler.defineInstance(r.kind,t||"",function(){return r.accessExpression(i.parent.name?i.parent.name:i.parent.reference(),n.slice(-1)[0],i.parent.parent===r.base,r.filter,!0)}),i.name}return this.base},lower:function(){var n=this,t=[],i=function(t,i,r){return n.accessExpression(t.parent.name?t.parent.name:t.parent.reference(),i,t.parent.parent===n.base,n.filter,r)};ht(this.tree,"",function(r,u,f){t.push(u);f>1?(r.name=r.name||n.compiler.defineInstance(n.kind,t.join("_"),i.bind(null,r,u,!0)),r.reference=function(){return r.name}):1===f&&(r.reference=i.bind(null,r,u))},function(){t.pop()})},deadNodeElimination:function(){ht(this.tree,"",null,function(n,t,i){(!n.name||n.name.dead)&&0===i&&n.parent&&n.parent.children&&delete n.parent.children[t]})},definitions:function(){var n=[];return ht(this.tree,"",function(t){t.name&&n.push(t)}),n.map(function(n){return n.name.definition()})}}),ut={capture:"capture",temporary:"temporary",variable:"variable",data:"data",global:"global"},gr={capture:"c",temporary:"t",variable:"iv",data:"d",global:"g"},gt={imported:"import",variable:"variable"},nu={imported:"i",variable:"sv"},g={tree:"tree",text:"text",initializer:"initializer",template:"template",error:"error"},d={attribute:"attribute",booleanAttribute:"booleanAttribute",inlineStyle:"inlineStyle",textContent:"textContent"},li="imports",nt={initial:0,analyze:1,optimze:2,lower:3,compile:4,link:5,done:6},ai=i.Class.define(function(n,i){if(this._stage=nt.initial,this._staticVariables={},this._staticVariablesCount=0,this._instanceVariables={},this._instanceVariablesCount={},this._debugBreak=i.debugBreakOnRender,this._defaultInitializer=rt(i.defaultInitializer||si),this._optimizeTextBindings=!i.disableTextBindingOptimization,this._templateElement=n,this._templateContent=t.document.createElement(n.tagName),this._extractChild=i.extractChild||!1,this._controls=null,this._bindings=null,this._bindTokens=null,this._textBindingPrefix=null,this._textBindingId=0,this._suffix=[],this._htmlProcessors=[],this._profilerMarkIdentifier=i.profilerMarkIdentifier,this._captureCSE=new ct(this,"container",ut.capture,this.generateElementCaptureAccess.bind(this)),this._dataCSE=new ct(this,"data",ut.data,this.generateNormalAccess.bind(this),this.importFunctionSafe("dataSecurityCheck",rt)),this._globalCSE=new ct(this,this.importFunctionSafe("global",t),ut.global,this.generateNormalAccess.bind(this),this.importFunctionSafe("globalSecurityCheck",rt)),a.renderCopy(this._templateElement,this._templateContent),this._extractChild)for(;this._templateContent.childElementCount>1;)this._templateContent.removeChild(this._templateContent.lastElementChild)},{addClassOneTimeTextBinding:function(n){var t=this,i=this.createTextBindingHole(n.elementCapture.element.tagName,"class",++this._textBindingId);n.textBindingId=i;n.kind=g.text;n.elementCapture.element.classList.add(i);n.elementCapture.refCount--;n.definition=function(){return t.formatCode("{htmlEscape}({value})",{htmlEscape:t._staticVariables.htmlEscape,value:n.value()})}},addClassOneTimeTreeBinding:function(n){var t=this;n.pathExpression=this.bindingExpression(n);n.value=function(){return n.pathExpression};n.kind=g.tree;n.definition=function(){return t.formatCode("{element}.classList.add({value})",{element:n.elementCapture,value:n.value()})}},analyze:function(){if(this._stage>nt.analyze)throw"Illegal: once we have moved past analyze we cannot revist it";this._stage=nt.analyze;this._controls=this.gatherControls();this._bindings=this.gatherBindings();this._children=this.gatherChildren();this.cleanControlAndBindingAttributes();this.async&&this.createAsyncParts();this.nullableIdentifierAccessTemporary=this.defineInstance(ut.temporary);var t=this._templateContent.innerHTML;this._html=function(){return ui(n(t))};this._html.text=t},bindingExpression:function(n){return this._dataCSE.createPathExpression(n.source,n.source.join("_"))},capture:function(n){var t=n._capture,u,o,e;if(t)return t.refCount++,t;for(var r=[n],i=n.parentNode,f=n.tagName;i!==this._templateContent;)f=i.tagName+"_"+f,r.unshift(i),i=i.parentNode;for(u=0,o=r.length;o>u;u++)e=r[u],r[u]=Array.prototype.indexOf.call(i.children,e),i=e;return t=this._captureCSE.createPathExpression(r,f.toLowerCase()),t.element=n,t.element._capture=t,t.refCount=1,t},cleanControlAndBindingAttributes:function(){for(var n,i=this._templateContent.querySelectorAll("[data-win-bind],[data-win-control]"),t=0,r=i.length;r>t;t++)n=i[t],n.isDeclarativeControlContainer&&(t+=n.querySelectorAll("[data-win-bind],[data-win-control]").length),n.removeAttribute("data-win-bind"),n.removeAttribute("data-win-control"),n.removeAttribute("data-win-options")},compile:function(t,i,r){var u,o,f,s,e,l;if(this._stage>nt.compile)throw"Illegal: once we have moved past compile we cannot revist it";this._stage=nt.compile;u=this;this._returnedElement=this._extractChild?"container.firstElementChild":"container";s=this._controls.map(function(t){var f,r,i;return(f=t.async?"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options}, controlDone)":"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options})",r=u.formatCode(f,{target:t.elementCapture,SafeConstructor:t.SafeConstructor,options:u.generateOptionsLiteral(t.optionsParsed,t.elementCapture)}),t.isDeclarativeControlContainer&&"function"==typeof t.isDeclarativeControlContainer.imported)?(i=[r],i.push(u.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedControlProcessing})",{target:t.elementCapture,isDeclarativeControlContainer:t.isDeclarativeControlContainer,delayedControlProcessing:u._staticVariables.ui_processAll})),i.push(u.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedBindingProcessing}(data, {templateDefaultInitializer}))",{target:t.elementCapture,isDeclarativeControlContainer:t.isDeclarativeControlContainer,delayedBindingProcessing:u._staticVariables.delayedBindingProcessing,templateDefaultInitializer:u._staticVariables.templateDefaultInitializer||n(null)})),i.join(";\n")):r});e=this._bindings.map(function(t){switch(t.kind){case g.template:return u.formatCode("({nestedTemplates}[{nestedTemplate}] = {template}.render({path}, {dest}))",{nestedTemplates:u._nestedTemplates,nestedTemplate:n(t.nestedTemplate),template:t.template,path:t.pathExpression,dest:t.elementCapture});case g.initializer:var i;return i=t.initialValue?"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}, {initialValue}))":"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}))",u.formatCode(i,{bindTokens:u._bindTokens,bindToken:n(t.bindToken),initializer:t.initializer,sourceProperties:n(t.source),destProperties:n(t.destination),dest:t.elementCapture,initialValue:t.initialValue});case g.tree:return t.definition();case g.text:break;case g.error:break;default:throw"NYI";}});r?(o=e.filter(function(n,t){return!u._bindings[t].delayable}),f=e.filter(function(n,t){return u._bindings[t].delayable})):(o=e,f=[]);var h=fi(this._instanceVariables),a=h.filter(function(n){return n.kind===ut.variable}).map(function(n){return n.definition()}),v=this._captureCSE.definitions(),y=this._globalCSE.definitions(),p=this._dataCSE.definitions(),w=this._children.map(function(n){return u.formatCodeN("{0}.msParentSelectorScope = true",n)}),b=this._suffix.map(function(n){return n()}),c="";return r&&f.length&&(c=u.formatCode(uu,{delayed_binding_processing:et(f)})),l=u.formatCode(t,oi([this._staticVariables,i||{},{profilerMarkIdentifierStart:n("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StartTM"),profilerMarkIdentifierStop:n("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StopTM"),html:this._html(),tagName:n(this._templateElement.tagName),instance_variable_declarations:ni(h),global_definitions:et(y),data_definitions:et(p),instance_variable_definitions:et(a),capture_definitions:et(v),set_msParentSelectorScope:et(w),debug_break:this.generateDebugBreak(),control_processing:et(s),control_counter:this._controlCounter,binding_processing:et(o),renderComplete:c,suffix_statements:et(b),nestedTemplates:this._nestedTemplates,returnedElement:this._returnedElement}])),this.prettify(l)},createAsyncParts:function(){this._nestedTemplates=this._nestedTemplates||this.defineInstance(ut.variable,"nestedTemplates",function(){return at(0)});this._controlCounter=this._controlCounter||this.defineInstance(ut.variable,"controlCounter",function(){return n(1)})},createTextBindingHole:function(n,t,i){var r,u;if(!this._textBindingPrefix){for(r="";-1!==this._html.text.indexOf("textbinding"+r);)r=r||0,r++;this._textBindingPrefix="textbinding"+r;this._textBindingRegex=new RegExp("(#?"+this._textBindingPrefix+"_\\d+)")}return u=this._textBindingPrefix+"_"+i,"IMG"===n&&"src"===t&&(u="#"+u),u},deadCodeElimination:function(){var n=this;Object.keys(this._instanceVariables).forEach(function(t){var i=n._instanceVariables[t];i.kind===ut.capture&&(n._templateContent.contains(i.element)||(i.dead=!0),0===i.refCount&&(i.dead=!0),i.dead&&(i.definition=function(){},i.name=null,delete n._instanceVariables[t]))});this._controls=this._controls.filter(function(n){return!n.elementCapture.dead});this._bindings=this._bindings.filter(function(n){return!n.elementCapture.dead});this._captureCSE.deadNodeElimination()},defineInstance:function(n,t,i){if(this._stage>=nt.compile)throw"Illegal: define instance variable after compilation stage has started";var u=this._instanceVariablesCount[n]||0,f=t?t.replace(ci,"_"):"",r=ri(gr[n],u,f);return r.definition=function(){return vt(r,i())},r.kind=n,this._instanceVariables[r]=r,this._instanceVariablesCount[n]=u+1,r},defineStatic:function(n,t,i){var u,f,r;if(this._stage>=nt.link)throw"Illegal: define static variable after link stage has started";return t&&(u=this._staticVariables[t],u)?u:(f=t?t.replace(ci,"_"):"",r=ri(nu[n],this._staticVariablesCount,f),r.definition=function(){return vt(r,i())},r.kind=n,this._staticVariables[t||r]=r,this._staticVariablesCount++,r)},done:function(){if(this._stage>nt.done)throw"Illegal: once we have moved past done we cannot revist it";this._stage=nt.done},emitScopedSelect:function(t,i){return this.formatCode("{scopedSelect}({selector}, {element})",{scopedSelect:this._staticVariables.scopedSelect,selector:n(t),element:i})},emitOptionsNode:function(t,i,r){var o=this,u,e,f;if(t)switch(typeof t){case"object":if(Array.isArray(t)){for(i.push("["),u=0,e=t.length;e>u;u++)this.emitOptionsNode(t[u],i,r),i.push(",");i.push("]")}else t instanceof wt?i.push("select"===t.target?this.emitScopedSelect(t.arg0Value,r):n(null)):t instanceof bt&&t.parts[0]instanceof wt?(f=t.parts[0],i.push(ti("select"===f.target?this.emitScopedSelect(f.arg0Value,r):n(null),t.parts.slice(1),this.nullableIdentifierAccessTemporary,this.importFunctionSafe("requireSupportedForProcessing",rt)))):t instanceof bt?i.push(t.pathExpression):(i.push("{"),Object.keys(t).forEach(function(n){i.push(nr(n));i.push(":");o.emitOptionsNode(t[n],i,r);i.push(",")}),i.push("}"));break;default:i.push(n(t))}else i.push(n(null))},findGlobalIdentifierExpressions:function(n,t){t=t||[];var i=this;return Object.keys(n).forEach(function(r){var u=n[r];"object"==typeof u&&(u instanceof bt?u.parts[0]instanceof wt||t.push(u):i.findGlobalIdentifierExpressions(u,t))}),t},formatCodeN:function(){if(this._stage<nt.compile)throw"Illegal: format code at before compilation stage has started";return ot.apply(null,arguments)},formatCode:function(n,t){if(this._stage<nt.compile)throw"Illegal: format code at before compilation stage has started";return ot(n,t)},gatherBindings:function(){for(var i,o,s,h,c,u=-1,n=this,f=-1,e=[],l="[data-win-bind],[data-win-control]",a=this._templateContent.querySelectorAll(l),r=0,v=a.length;v>r;r++)i=a[r],(i.isDeclarativeControlContainer&&(r+=i.querySelectorAll(l).length),i.hasAttribute("data-win-bind"))&&(o=i.getAttribute("data-win-bind"),s=vr(o,t),s.forEach(function(t){if(t.initializer){var e=t.initializer.join("."),r=rr(t.initializer);r.render?(rt(r.render),t.template=n.importFunctionSafe(e,r),t.pathExpression=n.bindingExpression(t),t.nestedTemplate=++f,t.kind=g.template):r.winControl&&r.winControl.render?(rt(r.winControl.render),t.template=n.importFunctionSafe(e,r.winControl),t.pathExpression=n.bindingExpression(t),t.nestedTemplate=++f,t.kind=g.template):(t.initializer=n.importFunction(e,r),t.bindToken=++u,t.kind=g.initializer)}else t.initializer=n.importFunctionSafe("templateDefaultInitializer",n._defaultInitializer),t.bindToken=++u,t.kind=g.initializer;t.elementCapture=n.capture(i);t.bindingText=o}),e.push.apply(e,s));return h=f+1,h>0&&(this.async=!0,this._nestedTemplates=this.defineInstance(ut.variable,"nestedTemplates",function(){return at(h)})),c=u+1,c>0&&(this._bindTokens=this.defineInstance(ut.variable,"bindTokens",function(){return at(c)}),this._suffix.push(function(){return n.formatCode("{utilities_data}(returnedElement).bindTokens = {bindTokens}",{utilities_data:n._staticVariables.utilities_data,bindTokens:n._bindTokens})})),e},gatherChildren:function(){var n=this;return Array.prototype.map.call(this._templateContent.children,function(t){return n.capture(t)})},gatherControls:function(){for(var h,c,i,l,p,w=this,s=0,a=[],v="[data-win-control]",y=this._templateContent.querySelectorAll(v),f=0,b=y.length;b>f;f++){var u=y[f],e=u.getAttribute("data-win-control"),o=r._getMemberFiltered(e.trim(),t,rt);o&&(h=u.getAttribute("data-win-options")||n({}),c=o.length>2,c&&(s++,this.async=!0),i=o.isDeclarativeControlContainer,i&&("function"==typeof i&&(i=this.importFunction(e+"_isDeclarativeControlContainer",i)),u.isDeclarativeControlContainer=i,f+=u.querySelectorAll(v).length),l={elementCapture:this.capture(u),name:e,SafeConstructor:this.importFunctionSafe(e,o),async:c,optionsText:n(h),optionsParsed:ar(h),isDeclarativeControlContainer:i},a.push(l),p=this.findGlobalIdentifierExpressions(l.optionsParsed),p.forEach(function(n){n.pathExpression=w.globalExpression(n.parts)}))}return s>0&&(this._controlCounter=this.defineInstance(ut.variable,"controlCounter",function(){return n(s+1)})),a},generateElementCaptureAccess:function(n,t,i){if(i){var r=""+t=="0"?"":" + "+t;return this.formatCodeN("{0}.children[startIndex{1}]",n,r)}return this.formatCodeN("{0}.children[{1}]",n,t)},generateNormalAccess:function(n,t,i,r,u){var f;return n.indexOf(this.nullableIdentifierAccessTemporary)>=0?(f=u?"{left} && {filter}({temp}{right})":"{left} && ({temp} = {filter}({temp}{right}))",this.formatCode(f,{temp:this.nullableIdentifierAccessTemporary,left:n,right:st([t]),filter:r})):(f=u?"({temp} = {left}) && {filter}({temp}{right})":"({temp} = {left}) && ({temp} = {filter}({temp}{right}))",this.formatCode(f,{temp:this.nullableIdentifierAccessTemporary,left:n,right:st([t]),filter:r}))},generateOptionsLiteral:function(n,t){var i=[];return this.emitOptionsNode(n,i,t),i.join(" ")},generateDebugBreak:function(){if(this._debugBreak){var t=this.defineStatic(gt.variable,"debugCounter",function(){return n(0)});return this.formatCodeN("if (++{0} === 1) {{ debugger; }}",t)}return""},globalExpression:function(n){return this._globalCSE.createPathExpression(n,n.join("_"))},importFunction:function(n,t){return this.importFunctionSafe(n,rt(t))},importFunctionSafe:function(n,t){var r=this,i=this.defineStatic(gt.imported,n,function(){return r.formatCodeN("({0}{1})",li,st([n]))});if(i.imported&&i.imported!==t)throw"Duplicate import: '"+n+"'";return i.imported=t,i},importAll:function(n){return Object.keys(n).forEach(function(t){rt(n[t])}),this.importAllSafe(n)},importAllSafe:function(n){var t=this;return Object.keys(n).reduce(function(i,r){return i[r]=t.importFunctionSafe(r,n[r]),i},{})},link:function(n){if(this._stage>nt.link)throw"Illegal: once we have moved past link we cannot revist it";this._stage=nt.link;var t=this,r=ir(this._staticVariables).filter(function(n){return t._staticVariables[n].kind===gt.imported}).reduce(function(n,i){return n[i]=t._staticVariables[i].imported,n},{}),i=fi(this._staticVariables);return new Function(li,this.formatCode(eu,{static_variable_declarations:ni(i),static_variable_definitions:et(i.map(function(n){return n.definition()})),body:n.trim()}))(r)},lower:function(){if(this._stage>nt.lower)throw"Illegal: once we have moved past lower we cannot revist it";this._stage=nt.lower;this._captureCSE.lower();this._dataCSE.lower();this._globalCSE.lower()},markBindingAsError:function(n){n&&(n.kind=g.error,this.markBindingAsError(n.original))},oneTimeTextBinding:function(t){var e=this,u=this.oneTimeTextBindingAnalyze(t),f,r,i,o;if(u){t.original&&(f=t.original.initialValue);r=this.createTextBindingHole(t.elementCapture.element.tagName,u.attribute,++this._textBindingId);switch(t.textBindingId=r,t.kind=g.text,t.elementCapture.refCount--,t.definition=function(){var n;return n=f?"{htmlEscape}({initialValue})":"{htmlEscape}({getter})",e.formatCode(n,{htmlEscape:e._staticVariables.htmlEscape,getter:t.value(),initialValue:f})},u.kind){case d.attribute:t.elementCapture.element.setAttribute(u.attribute,r);break;case d.booleanAttribute:t.elementCapture.element.setAttribute(u.attribute,r);t.definition=function(){var i;return i=f?'({initialValue} ? {attribute} : "")':'({value} ? {attribute} : "")',e.formatCode(i,{value:t.value(),attribute:n(u.attribute),initialValue:f})};this._htmlProcessors.push(function(n){return n.replace(new RegExp(u.attribute+'="'+r+'"',"i"),r)});break;case d.textContent:t.elementCapture.element.textContent=r;break;case d.inlineStyle:i=t.elementCapture.element;i.msReplaceStyle||(i.msReplaceStyle=i.getAttribute("style")||"",""!==i.msReplaceStyle&&";"!==i.msReplaceStyle[i.msReplaceStyle.length-1]&&(i.msReplaceStyle=i.msReplaceStyle+";"),i.setAttribute("style","msReplaceStyle:'"+r+"'"),o=i.getAttribute("style"),this._htmlProcessors.push(function(n){return n.replace(o,i.msReplaceStyle)}));i.msReplaceStyle=i.msReplaceStyle+u.property+":"+r+";";break;default:throw"NYI";}}},oneTimeTextBindingAnalyze:function(n){var r=n.elementCapture.element,f=r.tagName,t=n.destination[0],i,u;switch(f){case"A":switch(t){case"href":return{kind:d.attribute,attribute:t}}break;case"IMG":switch(t){case"alt":case"src":case"width":case"height":return{kind:d.attribute,attribute:t}}break;case"SELECT":switch(t){case"disabled":case"multiple":case"required":return{kind:d.booleanAttribute,attribute:t};case"size":return{kind:d.attribute,attribute:t}}break;case"OPTION":switch(t){case"label":case"value":return{kind:d.attribute,attribute:t};case"disabled":case"selected":return{kind:d.booleanAttribute,attribute:t}}break;case"INPUT":switch(t){case"checked":switch(r.type){case"checkbox":case"radio":return{kind:d.booleanAttribute,attribute:t}}break;case"disabled":return{kind:d.booleanAttribute,attribute:t};case"max":case"maxLength":case"min":case"step":case"value":return{kind:d.attribute,attribute:t};case"size":switch(r.type){case"text":case"search":case"tel":case"url":case"email":case"password":return{kind:d.attribute,attribute:t}}break;case"readOnly":switch(r.type){case"hidden":case"range":case"color":case"checkbox":case"radio":case"file":case"button":break;default:return{kind:d.booleanAttribute,attribute:t}}}break;case"BUTTON":switch(t){case"disabled":return{kind:d.booleanAttribute,attribute:t};case"value":return{kind:d.attribute,attribute:t}}break;case"TEXTAREA":switch(t){case"disabled":case"readOnly":case"required":return{kind:d.booleanAttribute,attribute:t};case"cols":case"maxLength":case"placeholder":case"rows":case"wrap":return{kind:d.attribute,attribute:t}}}switch(t){case"className":return{kind:d.attribute,attribute:"class"};case"dir":case"lang":case"name":case"title":case"tabIndex":return{kind:d.attribute,attribute:t};case"style":if(n.destination.length>1){if(i=n.destination[1],"cssText"===i)return;if(u="string"==typeof r.style[i],u)return("m"===i[0]&&"s"===i[1]||"webkit"===i.substring(0,6))&&(i="-"+i),i=i.replace(dr,function(n){return"-"+n.toLowerCase()}),{kind:d.inlineStyle,property:i,attribute:"style"}}break;case"innerText":case"textContent":return{kind:d.textContent,attribute:"textContent"}}},oneTimeTreeBinding:function(n){if(1===n.destination.length&&"id"===n.destination[0]){if(r.validation)throw new u("WinJS.Binding.IdBindingNotSupported",e._formatString(k.idBindingNotSupported,n.bindingText));return f.log&&f.log(e._formatString(k.idBindingNotSupported,n.bindingText),"winjs binding","error"),void this.markBindingAsError(n)}if(0===n.destination.length)return f.log&&f.log(k.cannotBindToThis,"winjs binding","error"),void this.markBindingAsError(n);var t,i=this;n.pathExpression=this.bindingExpression(n);n.value=function(){return n.pathExpression};n.original&&(t=n.pathExpression,n.original.initialValue=t);n.kind=g.tree;n.definition=function(){var r;return r=t?"({targetPath} || {{}}){prop} = {initialValue}":"({targetPath} || {{}}){prop} = {sourcePath}",i.formatCode(r,{targetPath:ti(n.elementCapture,n.destination.slice(0,-1),i.nullableIdentifierAccessTemporary,i.importFunctionSafe("targetSecurityCheck",di)),prop:st(n.destination.slice(-1)),sourcePath:n.value(),initialValue:t})}},optimize:function(){var r,f,e,u,i,t;if(this._stage>nt.optimze)throw"Illegal: once we have moved past link we cannot revist it";for(this._stage=nt.optimze,i=0;i<this._bindings.length;i++)if(t=this._bindings[i],!t.template)switch(t.initializer.imported){case si:r=ei(t,{kind:g.tree,initializer:this.importFunctionSafe("init_oneTime",yt),original:t});r.elementCapture.refCount++;this.oneTimeTreeBinding(r);this._bindings.splice(i,0,r);t.delayable=!0;i++;break;case fr:r=ei(t,{kind:g.tree,initializer:this.importFunctionSafe("init_setAttributeOneTime",pt),original:t});r.elementCapture.refCount++;this.setAttributeOneTimeTreeBinding(r);this._bindings.splice(i,0,r);t.delayable=!0;i++;break;case yt:this.oneTimeTreeBinding(t);break;case pt:this.setAttributeOneTimeTreeBinding(t);break;case hi:this.addClassOneTimeTreeBinding(t);break;default:t.initializer&&(t.delayable=!!t.initializer.imported.delayable)}if(this._optimizeTextBindings){for(f={},i=0;i<this._bindings.length;i++)if(t=this._bindings[i],!t.template&&t.kind!==g.error){switch(t.initializer.imported){case yt:this.oneTimeTextBinding(t);break;case pt:this.setAttributeOneTimeTextBinding(t);break;case hi:this.addClassOneTimeTextBinding(t)}t.textBindingId&&(f[t.textBindingId]=t)}if(Object.keys(f).length){for(e=this._templateContent.innerHTML,e=this._htmlProcessors.reduce(function(n,t){return t(n)},e),u=e.split(this._textBindingRegex),i=1;i<u.length;i+=2)t=f[u[i]],u[i]=t.definition;this._html=function(){var t=u.map(function(t){return"string"==typeof t?n(t):t()}).join(" + ");return ui(t)}}}},prettify:function(n){var t=n.split("\n");return t.filter(function(n){return!kr.test(n)}).join("\n")},setAttributeOneTimeTextBinding:function(n){var t,i=this,r=n.destination[0],u=this.createTextBindingHole(n.elementCapture.element.tagName,r,++this._textBindingId);n.original&&(t=n.original.initialValue);n.textBindingId=u;n.kind=g.text;n.elementCapture.element.setAttribute(r,u);n.elementCapture.refCount--;n.definition=function(){var r;return r=t?"{htmlEscape}({initialValue})":"{htmlEscape}({value})",i.formatCode(r,{htmlEscape:i._staticVariables.htmlEscape,initialValue:t,value:n.value()})}},setAttributeOneTimeTreeBinding:function(t){if(1===t.destination.length&&"id"===t.destination[0]){if(r.validation)throw new u("WinJS.Binding.IdBindingNotSupported",e._formatString(k.idBindingNotSupported,t.bindingText));return f.log&&f.log(e._formatString(k.idBindingNotSupported,t.bindingText),"winjs binding","error"),void this.markBindingAsError(t)}if(1!==t.destination.length||!t.destination[0])return f.log&&f.log(k.attributeBindingSingleProperty,"winjs binding","error"),void this.markBindingAsError(t);var i,o=this;t.pathExpression=this.bindingExpression(t);t.value=function(){return t.pathExpression};t.original&&(i=this.defineInstance(ut.variable,"",t.value),t.original.initialValue=i);t.kind=g.tree;t.definition=function(){var r;return r=i?'{element}.setAttribute({attribute}, "" + {initialValue})':'{element}.setAttribute({attribute}, "" + {value})',o.formatCode(r,{element:t.elementCapture,attribute:n(t.destination[0]),initialValue:i,value:t.value()})}}},{_TreeCSE:ct,compile:function(n,i,r){var u,o,f,e,s,h;if(!(i instanceof t.HTMLElement))throw"Illegal";kt("WinJS.Binding.Template:compile"+r.profilerMarkIdentifier+",StartTM");u=new ai(i,r);u.analyze();o=u.importAllSafe({Signal:y,global:t,document:t.document,cancelBlocker:ur,promise_as:er,disposeInstance:bi,markDisposable:hr,ui_processAll:cr,binding_processAll:lr,insertAdjacentHTMLUnsafe:or,promise:v,utilities_data:sr,requireSupportedForProcessing:rt,htmlEscape:tr,scopedSelect:yr,delayedBindingProcessing:ki,writeProfilerMark:kt});u.optimize();u.deadCodeElimination();u.lower();switch(r.target){case"render":f=u.async?iu:tu;e=!1;break;case"renderItem":f=u.async?fu:ru;e=!0}return s=u.compile(f,o,e),h=u.link(s),u.done(),kt("WinJS.Binding.Template:compile"+r.profilerMarkIdentifier+",StopTM"),h}}),lt=ft('container.classList.add("win-template");                                                              \nvar html = {html};                                                                                      \n{insertAdjacentHTMLUnsafe}(container, "beforeend", html);                                             \nreturnedElement = {returnedElement};                                                                    \n                                                                                                        \n// Capture Definitions                                                                                  \n{capture_definitions};                                                                                  \n{set_msParentSelectorScope};                                                                            \n                                                                                                        \n'),vi=ft("// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \n// Binding Processing                                                                                   \n{binding_processing};                                                                                   \n                                                                                                        \nvar result = {promise_as}(returnedElement);                                                             \n"),yi=ft('var controlSignal = new {Signal}();                                                                     \nvar controlDone = function () {{ if (--{control_counter} === 0) {{ controlSignal.complete(); }} }};     \ncontrolDone();                                                                                          \n                                                                                                        \n// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \nvar result = controlSignal.promise.then(function () {{                                                  \n    // Binding Processing                                                                               \n    {binding_processing};                                                                               \n    return {promise}.join({nestedTemplates});                                                           \n}}).then(function () {{                                                                                 \n    return returnedElement;                                                                             \n}}).then(null, function (e) {{                                                                          \n    if (typeof e === "object" && e.name === "Canceled") {{ returnedElement.dispose(); }}            \n    return {promise}.wrapError(e);                                                                      \n}});                                                                                                    \n'),pi=ft("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result); }});       \n{suffix_statements};                                                                                    \n"),tu=ft('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data); }});                   \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+it(tt(4,lt))+"                                           \n                                                                                                        \n    "+it(tt(4,vi))+"                                      \n    "+it(tt(4,pi))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),iu=ft('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data, container); }});        \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+it(tt(4,lt))+"                                           \n                                                                                                        \n    "+it(tt(4,yi))+"                                 \n    "+it(tt(4,pi))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),wi=ft("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result, renderComplete); }});\n{suffix_statements};                                                                                    \n"),ru=ft('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+it(tt(8,lt))+"                                       \n                                                                                                        \n        "+it(tt(8,vi))+"                                  \n        "+it(tt(8,wi))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),uu=ft("renderComplete = element.then(function () {{                                                            \n    return itemPromise;                                                                                 \n}}).then(function (item) {{                                                                             \n    return item.ready || item;                                                                          \n}}).then(function (item) {{                                                                             \n    {delayed_binding_processing};                                                                       \n    return element;                                                                                     \n}});                                                                                                    \n"),fu=ft('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+it(tt(8,lt))+"                                       \n                                                                                                        \n        "+it(tt(8,yi))+"                             \n        "+it(tt(8,wi))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),eu=ft('"use strict";                                                                                         \n                                                                                                        \n// statics                                                                                              \nvar {static_variable_declarations};                                                                     \n{static_variable_definitions};                                                                          \n                                                                                                        \n// generated template rendering function                                                                \nreturn {body};                                                                                          \n');return ai})})}});t("WinJS/BindingTemplate",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_WriteProfilerMark","./Binding/_Declarative","./BindingTemplate/_DataTemplateCompiler","./ControlProcessor","./Fragments","./Promise","./Utilities/_Dispose","./Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";if(t.document){var y=l._cancelBlocker;r.Namespace._moduleDefine(n,"WinJS.Binding",{Template:r.Namespace._lazy(function(){function p(i,r,u){function d(){return v.removeClass(f,"win-loading"),e("WinJS.Binding:templateRender"+i._profilerMarkIdentifier+",StopTM"),p||f}var b,f,nt;e("WinJS.Binding:templateRender"+i._profilerMarkIdentifier+",StartTM");1==++i._counter&&(i.debugBreakOnRender||n._debugBreakOnRender);b=l.wrap();f=u||t.document.createElement(i.element.tagName);v.addClass(f,"win-template");v.addClass(f,"win-loading");var k,p,s=i,w=f.children.length,g=function(){var n=v.data(f).winBindings;n&&n.forEach(function(n){n.cancel()});b.cancel()};return i.extractChild?k=c.renderCopy(s.href||s.element,t.document.createElement(s.element.tagName)).then(function(n){var t=n.firstElementChild;return p=t,a.markDisposable(t,g),f.appendChild(t),t}):(a.markDisposable(f,g),k=c.renderCopy(s.href||s.element,f)),nt=k.then(function(){function c(){return n(h.processAll).then(function(){return y(r)}).then(function(t){return n(o.processAll,t,!p&&!w,s.bindingCache)}).then(null,function(n){return"object"==typeof n&&"Canceled"===n.name&&(p||f).dispose(),l.wrapError(n)})}var n,t,i,u;if(0===w)n=function(n,t,i,r){return n(p||f,t,i,r)};else if(t=f.children,t.length===w+1)n=function(n,i,r,u){return n(t[w],i,r,u)};else{for(var a=[],e=w,v=t.length;v>e;e++)a.push(t[e]);n=function(n,t,i,r){var u=[];return a.forEach(function(f){u.push(n(f,t,i,r))}),l.join(u)}}for(i=f.firstElementChild;i;)i.msParentSelectorScope=!0,i=i.nextElementSibling;return u=s.processTimeout,u?(0>u&&(u=0),l.timeout(u).then(function(){return b=c()})):b=c()}).then(d,function(n){return d(),l.wrapError(n)}),{element:k,renderComplete:nt}}var n=r.Class.define(function(n,i){this._element=n||t.document.createElement("div");this._element.winControl=this;this._profilerMarkIdentifier=u._getProfilerMarkIdentifier(this._element);e("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StartTM");var r=this;this._element.renderItem=function(n,t){return r._renderItemImpl(n,t)};i=i||{};this.href=i.href;this.enableRecycling=!!i.enableRecycling;this.processTimeout=i.processTimeout||0;this.bindingInitializer=i.bindingInitializer;this.debugBreakOnRender=i.debugBreakOnRender;this.disableOptimizedProcessing=i.disableOptimizedProcessing;this.extractChild=i.extractChild;this._counter=0;this._compile=!!i._compile;this.href||(this.element.style.display="none");this.bindingCache={expressions:{}};e("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StopTM")},{_shouldCompile:{get:function(){var i=!0;return i=i&&!n._interpretAll,i=i&&!this.disableOptimizedProcessing,i&&(i=i&&0===this.processTimeout,i=i&&(!this.href||this.href instanceof t.HTMLElement),i||f.log&&f.log("Cannot compile templates which use processTimeout or href properties","winjs binding","warn")),i}},bindingInitializer:{get:function(){return this._bindingInitializer},set:function(n){this._bindingInitializer=n;this._reset()}},debugBreakOnRender:{get:function(){return this._debugBreakOnRender},set:function(n){this._debugBreakOnRender=!!n;this._reset()}},disableOptimizedProcessing:{get:function(){return this._disableOptimizedProcessing},set:function(n){this._disableOptimizedProcessing=!!n;this._reset()}},element:{get:function(){return this._element}},extractChild:{get:function(){return this._extractChild},set:function(n){this._extractChild=!!n;this._reset()}},processTimeout:{get:function(){return this._processTimeout||0},set:function(n){this._processTimeout=n;this._reset()}},render:u.markSupportedForProcessing(function(n,t){return this._renderImpl(n,t)}),_renderImpl:function(n,t){if(this._shouldCompile)try{return this._renderImpl=this._compileTemplate({target:"render"}),this._renderImpl(n,t)}catch(r){return l.wrapError(r)}var i=p(this,n,t);return i.element.then(function(){return i.renderComplete})},_renderInterpreted:function(n,t){return p(this,n,t)},renderItem:function(n,t){return this._renderItemImpl(n,t)},_renderItemImpl:function(n,t){var u,i,f,r;if(this._shouldCompile)try{return this._renderItemImpl=this._compileTemplate({target:"renderItem"}),this._renderItemImpl(n)}catch(e){return{element:l.wrapError(e),renderComplete:l.wrapError(e)}}return(u=this,(this.enableRecycling&&!this.bindingCache.elements&&(this.bindingCache.elements={}),this.enableRecycling&&t&&t.msOriginalTemplate===this)&&(i=this.bindingCache.elements[t.id],f=!0,i&&(i.bindings.forEach(function(n){n()}),i.bindings=[],f=!i.nocache),f))?{element:t,renderComplete:n.then(function(n){return o.processAll(t,n.data,!0,u.bindingCache)})}:(r=p(this,n.then(function(n){return n.data})),r.element=r.element.then(function(n){return n.msOriginalTemplate=u,n}),r)},_compileTemplate:function(t){var u=this,f=s._TemplateCompiler.compile(this,this.href||this.element,{debugBreakOnRender:this.debugBreakOnRender||n._debugBreakOnRender,defaultInitializer:this.bindingInitializer||t.defaultInitializer,disableTextBindingOptimization:t.disableTextBindingOptimization||!1,target:t.target,extractChild:this.extractChild,profilerMarkIdentifier:this._profilerMarkIdentifier}),e=t.resetOnFragmentChange||i.Windows.ApplicationModel.DesignMode.designModeEnabled,r;return e&&(r=new v._MutationObserver(function(){u._reset();r.disconnect()}),r.observe(v.data(this.element).docFragment,{childList:!0,attributes:!0,characterData:!0,subtree:!0})),f},_reset:function(){delete this._renderImpl;delete this._renderItemImpl}},{isDeclarativeControlContainer:{value:!0,writable:!1,configurable:!1},render:{value:function(t,i,r){return new n(null,{href:t}).render(i,r)}}});return n})})}});t("WinJS/BindingList/_BindingListDataSource",["exports","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Binding/_DomWeakRefTable","../Promise","../Scheduler","../Utilities/_UI"],function(n,t,i,r,u,f,e,o){"use strict";i.Namespace._moduleDefine(n,"WinJS.Binding",{_BindingListDataSource:i.Namespace._lazy(function(){function c(n,t){for(var i,r=n.length;r-1>t;)if(i=n.getItem(++t),i)return i.key;return null}function l(n,t){for(;t>0;){var i=n.getItem(--t);if(i)return i.key}return null}function y(n,t){Object.keys(t).forEach(function(i){n.addEventListener(i,t[i])})}function p(n,t){Object.keys(t).forEach(function(i){n.removeEventListener(i,t[i])})}function h(n,t){return t?new et(n,t):new v}function w(n,t,i){return t?new ot(n,t,i):new v}function s(n,t,i){return t&&n._annotateWithIndex(t,i)}function b(n,t){return this._list.unshift(t),this.itemFromIndex(0)}function k(t,i,r){var u=this._list.indexOfKey(r);return-1===u?n.noLongerMeaningful:(this._list.splice(u,0,i),this.itemFromIndex(u))}function d(t,i,r){var u=this._list.indexOfKey(r);return-1===u?n.noLongerMeaningful:(u+=1,this._list.splice(u,0,i),this.itemFromIndex(u))}function g(n,t){return this._list.push(t),this.itemFromIndex(this._list.length-1)}function nt(t,i){var r=this._list.indexOfKey(t);return-1===r?n.noLongerMeaningful:(this._list.setAt(r,i),this.itemFromIndex(r))}function tt(t){var r=this._list.indexOfKey(t),i;return-1===r?n.noLongerMeaningful:(i=0,this._list.move(r,i),this.itemFromIndex(i))}function it(t,i){var u=this._list.indexOfKey(t),r=this._list.indexOfKey(i);return-1===u||-1===r?n.noLongerMeaningful:(r=r>u?r-1:r,this._list.move(u,r),this.itemFromIndex(r))}function rt(t,i){var u=this._list.indexOfKey(t),r=this._list.indexOfKey(i);return-1===u||-1===r?n.noLongerMeaningful:(r=r>=u?r:r+1,this._list.move(u,r),this.itemFromIndex(r))}function ut(t){var r=this._list.indexOfKey(t),i;return-1===r?n.noLongerMeaningful:(i=this._list.length-1,this._list.move(r,i),this.itemFromIndex(i))}function ft(t){var i=this._list.indexOfKey(t);return-1===i?n.noLongerMeaningful:(this._list.splice(i,1),f.wrap())}var n={get noLongerMeaningful(){return f.wrapError(new r(o.EditError.noLongerMeaningful))}},a=f.wrap().constructor,v=i.Class.derive(a,function(){this._value=null},{release:function(){},retain:function(){return this}},{supportedForProcessing:!1}),et=i.Class.derive(a,function(n,t){this._value=t;this._listBinding=n},{handle:{get:function(){return this._value.key}},index:{get:function(){return this._value.index}},release:function(){this._listBinding._release(this._value,this._listBinding._list.indexOfKey(this._value.key))},retain:function(){return this._listBinding._addRef(this._value,this._listBinding._list.indexOfKey(this._value.key)),this}},{supportedForProcessing:!1}),ot=i.Class.derive(f,function(n,t,i){var r=this;this._item=t;this._listBinding=n;f.call(this,function(u){e.schedule(function(){return n._released?void r.cancel():void u(t)},e.Priority.normal,null,"WinJS.Binding.List."+i)})},{handle:{get:function(){return this._item.key}},index:{get:function(){return this._item.index}},release:function(){this._listBinding._release(this._item,this._listBinding._list.indexOfKey(this._item.key))},retain:function(){return this._listBinding._addRef(this._item,this._listBinding._list.indexOfKey(this._item.key)),this}},{supportedForProcessing:!1}),st=i.Class.define(function(n,i,r,f){var o,e;this._dataSource=n;this._list=i;this._editsCount=0;this._notificationHandler=r;this._pos=-1;this._retained=[];this._retained.length=i.length;this._retainedKeys={};this._affectedRange=null;o=null;(t.msSetWeakWinRTProperty&&t.msGetWeakWinRTProperty||(o=this),r)&&(e=function(n,t){var i=u._getWeakRefElement(f)||o;return i?(i["_"+n](t),!0):!1},this._handlers={itemchanged:function s(n){e("itemchanged",n)||i.removeEventListener("itemchanged",s)},iteminserted:function h(n){e("iteminserted",n)||i.removeEventListener("iteminserted",h)},itemmoved:function c(n){e("itemmoved",n)||i.removeEventListener("itemmoved",c)},itemremoved:function l(n){e("itemremoved",n)||i.removeEventListener("itemremoved",l)},reload:function a(){e("reload")||i.removeEventListener("reload",a)}},y(this._list,this._handlers))},{_itemchanged:function(n){var e=n.detail.key,i=n.detail.index,t,r,u,f;this._updateAffectedRange(i,"changed");t=n.detail.newItem;r=this._retained[i];r?(u=this._notificationHandler,r.index!==i&&(f=r.index,r.index=i,u&&u.indexChanged&&u.indexChanged(t.key,i,f)),t=s(this._list,t,i),t._retainedCount=r._retainedCount,this._retained[i]=t,this._retainedKeys[e]=t,this._beginEdits(this._list.length),u&&u.changed&&u.changed(t,r),this._endEdits()):(this._beginEdits(this._list.length),this._endEdits())},_iteminserted:function(n){var t=n.detail.index,r,i;this._updateAffectedRange(t,"inserted");this._beginEdits(this._list.length-1);t<=this._pos&&(this._pos=Math.min(this._pos+1,this._list.length));r=this._retained;(r.splice(t,0,0),delete r[t],this._shouldNotify(t)||1===this._list.length)&&(i=this._notificationHandler,i&&i.inserted&&i.inserted(h(this,s(this._list,this._list.getItem(t),t)),l(this._list,t),c(this._list,t)));this._endEdits()},_itemmoved:function(n){var r=n.detail.oldIndex,t=n.detail.newIndex,u,i;this._updateAffectedRange(r,"moved");this._updateAffectedRange(t,"moved");this._beginEdits(this._list.length);(r<this._pos||t<=this._pos)&&(t>this._pos?this._pos=Math.max(-1,this._pos-1):r>this._pos&&(this._pos=Math.min(this._pos+1,this._list.length)));u=this._retained;i=u.splice(r,1)[0];u.splice(t,0,i);i||(delete u[t],i=s(this._list,this._list.getItem(t),t));i._moved=!0;this._addRef(i,t);this._endEdits()},_itemremoved:function(n){var r=n.detail.key,t=n.detail.index,i;this._updateAffectedRange(t,"removed");this._beginEdits(this._list.length+1);t<this._pos&&(this._pos=Math.max(-1,this._pos-1));var u=this._retained,f=this._retainedKeys,e=t in u;u.splice(t,1);delete f[r];i=this._notificationHandler;e&&i&&i.removed&&i.removed(r,!1);this._endEdits()},_reload:function(){this._retained=[];this._retainedKeys={};var n=this._notificationHandler;n&&n.reload&&n.reload()},_addRef:function(n,t){t in this._retained?this._retained[t]._retainedCount++:(this._retained[t]=n,this._retainedKeys[n.key]=n,n._retainedCount=1)},_release:function(n,t){var i=this._retained[t];i&&(1===i._retainedCount?(delete this._retained[t],delete this._retainedKeys[i.key]):i._retainedCount--)},_shouldNotify:function(n){var t=this._retained;return n in t||n+1 in t||n-1 in t},_updateAffectedRange:function(n,t){if(this._notificationHandler.affectedRange){var i=n,r="removed"!==t?n+1:n;if(this._affectedRange){switch(t){case"inserted":n<=this._affectedRange.end&&++this._affectedRange.end;break;case"removed":n<this._affectedRange.end&&--this._affectedRange.end}this._affectedRange.start=Math.min(this._affectedRange.start,i);this._affectedRange.end=Math.max(this._affectedRange.end,r)}else this._affectedRange={start:i,end:r}}},_notifyAffectedRange:function(){this._affectedRange&&(this._notificationHandler&&this._notificationHandler.affectedRange&&this._notificationHandler.affectedRange(this._affectedRange),this._affectedRange=null)},_notifyCountChanged:function(){var t=this._countAtBeginEdits,i=this._list.length,n;t!==i&&(n=this._notificationHandler,n&&n.countChanged&&n.countChanged(i,t))},_notifyIndicesChanged:function(){for(var n,r,f,i,u=this._retained,t=0,e=u.length;e>t;t++)n=u[t],n&&n.index!==t&&(r=t,f=n.index,n.index=r,i=this._notificationHandler,i&&i.indexChanged&&i.indexChanged(n.key,r,f))},_notifyMoved:function(){for(var t,i,r=this._retained,n=0,u=r.length;u>n;n++)t=r[n],t&&t._moved&&(t._moved=!1,this._release(t,n),this._shouldNotify(n))&&(i=this._notificationHandler,i&&i.moved&&i.moved(h(this,t),l(this._list,n),c(this._list,n)))},_beginEdits:function(n,t){var i,r;this._editsCount++;i=this._notificationHandler;1===this._editsCount&&i&&(t||(this._editsCount++,r=this,e.schedule(function(){r._endEdits()},e.Priority.high,null,"WinJS.Binding.List._endEdits")),i.beginNotifications&&i.beginNotifications(),this._countAtBeginEdits=n)},_endEdits:function(){this._editsCount--;var n=this._notificationHandler;0===this._editsCount&&n&&(this._notifyIndicesChanged(),this._notifyMoved(),this._notifyCountChanged(),this._notifyAffectedRange(),n.endNotifications&&n.endNotifications())},jumpToItem:function(n){var t=this._list.indexOfKey(n.handle);return-1===t?f.wrap(null):(this._pos=t,this.current())},current:function(){return this.fromIndex(this._pos)},previous:function(){return this._pos=Math.max(-1,this._pos-1),this._fromIndex(this._pos,!0,"previous")},next:function(){return this._pos=Math.min(this._pos+1,this._list.length),this._fromIndex(this._pos,!0,"next")},releaseItem:function(n){n.release?n.release():this._release(n,this._list.indexOfKey(n.key))},release:function(){this._notificationHandler&&p(this._list,this._handlers);this._notificationHandler=null;this._dataSource._releaseBinding(this);this._released=!0},first:function(){return this.fromIndex(0)},last:function(){return this.fromIndex(this._list.length-1)},fromKey:function(n){var t,i=this._retainedKeys;return t=n in i?i[n]:s(this._list,this._list.getItemFromKey(n),this._list.indexOfKey(n)),h(this,t)},fromIndex:function(n){return this._fromIndex(n,!1,"fromIndex")},_fromIndex:function(n,t,i){var r,u=this._retained;return r=n in u?u[n]:s(this._list,this._list.getItem(n),n),t?w(this,r,i):h(this,r)}},{supportedForProcessing:!1}),ht=0;return i.Class.define(function(n){this._usingWeakRef=t.msSetWeakWinRTProperty&&t.msGetWeakWinRTProperty;this._bindings={};this._list=n;n.unshift&&(this.insertAtStart=b);n.push&&(this.insertAtEnd=g);n.setAt&&(this.change=nt);n.splice&&(this.insertAfter=d,this.insertBefore=k,this.remove=ft);n.move&&(this.moveAfter=rt,this.moveBefore=it,this.moveToEnd=ut,this.moveToStart=tt)},{_releaseBinding:function(n){delete this._bindings[n._id]},addEventListener:function(){},removeEventListener:function(){},createListBinding:function(n){var t="ds_"+ ++ht,i=new st(this,this._list,n,t);return i._id=t,this._usingWeakRef?(u._createWeakRef(i,t),this._bindings[t]=t):this._bindings[t]=i,i},getCount:function(){return f.wrap(this._list.length)},itemFromKey:function(n){var t=this._list,i=s(t,t.getItemFromKey(n),-1);return Object.defineProperty(i,"index",{get:function(){return t.indexOfKey(n)},enumerable:!1,configurable:!0}),f.wrap(i)},itemFromIndex:function(n){return f.wrap(s(this._list,this._list.getItem(n),n))},list:{get:function(){return this._list}},beginEdits:function(){var n=this._list.length;this._forEachBinding(function(t){t._beginEdits(n,!0)})},endEdits:function(){this._forEachBinding(function(n){n._endEdits()})},_forEachBinding:function(n){var t,i,r,f;if(this._usingWeakRef)for(t=[],Object.keys(this._bindings).forEach(function(i){var r=u._getWeakRefElement(i);r?n(r):t.push(i)}),i=0,r=t.length;r>i;i++)delete this._bindings[t[i]];else f=this,Object.keys(this._bindings).forEach(function(t){n(f._bindings[t])})},invalidateAll:function(){return f.wrap()},moveAfter:void 0,moveBefore:void 0,moveToEnd:void 0,moveToStart:void 0},{supportedForProcessing:!1})})})});t("WinJS/BindingList",["exports","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Resources","./Binding/_Data","./BindingList/_BindingListDataSource"],function(n,t,i,r,u,f,e,o){"use strict";function l(n){return Array.prototype.slice.call(n,0)}function c(n){return{handle:n.handle,key:n.key,data:n.data,groupKey:n.groupKey,groupSize:n.groupSize,firstItemKey:n.firstItemKey,firstItemIndexHint:n.firstItemIndexHint}}function s(n){if(void 0!==n)return+n}function y(n,t){function u(t,i){for(;i>t;t++)n[t]=r[t]}function i(n,t){if(!(2>t-n)){var r=Math.floor((t+n)/2);i(n,r);i(r,t);f(n,r,t);u(n,t)}}function f(i,u,f){for(var e=i,o=u,s=i;f>s;s++)u>e&&(o>=f||t(n[e],n[o])<=0)?(r[s]=n[e],e++):(r[s]=n[o],o++)}var r=new Array(n.length);return i(0,n.length),n}var v={get sparseArrayNotSupported(){return"Sparse arrays are not supported with proxy: true"},get illegalListLength(){return"List length must be assigned a finite positive number"}},a=u._createEventProperty,p={},h=t.Namespace.defineWithParent(null,null,{ListBase:t.Namespace._lazy(function(){var n=t.Class.define(null,{_annotateWithIndex:function(n,t){var i=c(n);return i.index=t,i},onitemchanged:a("itemchanged"),oniteminserted:a("iteminserted"),onitemmoved:a("itemmoved"),onitemmutated:a("itemmutated"),onitemremoved:a("itemremoved"),onreload:a("reload"),_notifyItemChanged:function(n,t,i,r,u,f){this._listeners&&this._listeners.itemchanged&&this.dispatchEvent("itemchanged",{key:n,index:t,oldValue:i,newValue:r,oldItem:u,newItem:f})},_notifyItemInserted:function(n,t,i){this._listeners&&this._listeners.iteminserted&&this.dispatchEvent("iteminserted",{key:n,index:t,value:i});var r=this.length;r!==this._lastNotifyLength&&(this.notify("length",r,this._lastNotifyLength),this._lastNotifyLength=r)},_notifyItemMoved:function(n,t,i,r){this._listeners&&this._listeners.itemmoved&&this.dispatchEvent("itemmoved",{key:n,oldIndex:t,newIndex:i,value:r})},_notifyItemMutated:function(n,t,i){this._listeners&&this._listeners.itemmutated&&this.dispatchEvent("itemmutated",{key:n,value:t,item:i})},_notifyItemRemoved:function(n,t,i,r){this._listeners&&this._listeners.itemremoved&&this.dispatchEvent("itemremoved",{key:n,index:t,value:i,item:r});var u=this.length;u!==this._lastNotifyLength&&(this.notify("length",u,this._lastNotifyLength),this._lastNotifyLength=u)},_notifyReload:function(){if(this._listeners&&this._listeners.reload&&this.dispatchEvent("reload"),n!==this._lastNotifyLength){var n=this.length;this.notify("length",n,this._lastNotifyLength);this._lastNotifyLength=n}},_normalizeIndex:function(n){return n=s(n),0>n?this.length+n:n},_notifyMutatedFromKey:function(n){var t=this.getItemFromKey(n);this._notifyItemMutated(n,t.data,t)},notifyReload:function(){this._notifyReload()},getAt:function(n){n=s(n);var t=this.getItem(n);return t&&t.data},_getArray:function(){for(var t,i=new Array(this.length),n=0,r=this.length;r>n;n++)t=this.getItem(n),t&&(i[n]=t.data);return i},_getFromKey:function(n){var t=this.getItemFromKey(n);return t&&t.data},_getKey:function(n){n=s(n);var t=this.getItem(n);return t&&t.key},concat:function(){var n=this._getArray();return n.concat.apply(n,arguments)},join:function(n){return this._getArray().join(n||",")},slice:function(n,t){return this._getArray().slice(n,t)},indexOf:function(n,t){var i,u,r;for(t=s(t),t=Math.max(0,this._normalizeIndex(t)||0),i=t,u=this.length;u>i;i++)if(r=this.getItem(i),r&&r.data===n)return i;return-1},lastIndexOf:function(n,t){var r,i,u;for(t=s(t),r=this.length,t=Math.min(this._normalizeIndex(void 0!==t?t:r),r-1),i=t;i>=0;i--)if(u=this.getItem(i),u&&u.data===n)return i;return-1},every:function(n,t){return this._getArray().every(n,t)},filter:function(n,t){return this._getArray().filter(n,t)},forEach:function(n,t){this._getArray().forEach(n,t)},map:function(n,t){return this._getArray().map(n,t)},some:function(n,t){return this._getArray().some(n,t)},reduce:function(n,t){return arguments.length>1?this._getArray().reduce(n,t):this._getArray().reduce(n)},reduceRight:function(n,t){return arguments.length>1?this._getArray().reduceRight(n,t):this._getArray().reduceRight(n)},createFiltered:function(n){return new h.FilteredListProjection(this,n)},createGrouped:function(n,t,i){return new h.GroupedSortedListProjection(this,n,t,i)},createSorted:function(n){return new h.SortedListProjection(this,n)},dataSource:{get:function(){return this._dataSource=this._dataSource||new o._BindingListDataSource(this)}}},{supportedForProcessing:!1});return t.Class.mix(n,e.observableMixin),t.Class.mix(n,u.eventMixin),n}),ListBaseWithMutators:t.Namespace._lazy(function(){return t.Class.derive(h.ListBase,null,{pop:function(){return this.splice(-1,1)[0]},push:function(n){if(1===arguments.length)return this.splice(this.length,0,n),this.length;var t=l(arguments);return t.splice(0,0,this.length,0),this.splice.apply(this,t),this.length},shift:function(){return this.splice(0,1)[0]},unshift:function(n){if(1===arguments.length)this.splice(0,0,n);else{var t=l(arguments);t.splice(0,0,0,0);this.splice.apply(this,t)}return this.length}},{supportedForProcessing:!1})}),ListProjection:t.Namespace._lazy(function(){return t.Class.derive(h.ListBaseWithMutators,null,{_list:null,_myListeners:null,_addListListener:function(n,t){var i={name:n,handler:t.bind(this)};this._myListeners=this._myListeners||[];this._myListeners.push(i);this._list.addEventListener(n,i.handler)},dispose:function(){var f=this._list,r=this._myListeners,t,u,i;for(this._myListeners=[],t=0,u=r.length;u>t;t++)i=r[t],f.removeEventListener(i.name,i.handler);this._list=new n.List;this._listReload()},getItemFromKey:function(n){return this._list.getItemFromKey(n)},move:function(n,t){n=s(n);t=s(t);n===t||0>n||0>t||n>=this.length||t>=this.length||(n=this._list.indexOfKey(this._getKey(n)),t=this._list.indexOfKey(this._getKey(t)),this._list.move(n,t))},_notifyMutatedFromKey:function(n){this._list._notifyMutatedFromKey(n)},splice:function(n){n=s(n);n=Math.max(0,this._normalizeIndex(n));var t=l(arguments);return n===this.length?(t[0]=this._list.length,this._list.splice.apply(this._list,t)):(t[0]=this._getKey(n),this._spliceFromKey.apply(this,t))},_setAtKey:function(n,t){this._list._setAtKey(n,t)}},{supportedForProcessing:!1})}),FilteredListProjection:t.Namespace._lazy(function(){return t.Class.derive(h.ListProjection,function(n,t){this._list=n;this._addListListener("itemchanged",this._listItemChanged);this._addListListener("iteminserted",this._listItemInserted);this._addListListener("itemmutated",this._listItemMutated);this._addListListener("itemmoved",this._listItemMoved);this._addListListener("itemremoved",this._listItemRemoved);this._addListListener("reload",this._listReload);this._filter=t;this._initFilteredKeys()},{_filter:null,_filteredKeys:null,_initFilteredKeys:function(){for(var n,u=this._filter,i=this._list,r=[],t=0,f=i.length;f>t;t++)n=i.getItem(t),n&&u(n.data)&&r.push(n.key);this._filteredKeys=r},_findInsertionPosition:function(n,t){for(var r,i,f,e,u=this._filter;--t>=0;)if(i=this._list.getItem(t),i&&u(i.data)){r=i.key;break}return f=this._filteredKeys,e=r?f.indexOf(r)+1:0,e},_listItemChanged:function(n){var t=n.detail.key,e=n.detail.index,i=n.detail.oldValue,r=n.detail.newValue,o=n.detail.oldItem,l=n.detail.newItem,s=this._filter,u=s(i),f=s(r),h,c;u&&f?(h=this._filteredKeys,c=h.indexOf(t),this._notifyItemChanged(t,c,i,r,o,l)):u&&!f?this._listItemRemoved({detail:{key:t,index:e,value:i,item:o}}):!u&&f&&this._listItemInserted({detail:{key:t,index:e,value:r}})},_listItemInserted:function(n){var t=n.detail.key,f=n.detail.index,r=n.detail.value,e=this._filter,i,u;e(r)&&(i=this._findInsertionPosition(t,f),u=this._filteredKeys,u.splice(i,0,t),this._notifyItemInserted(t,i,r))},_listItemMoved:function(n){var t=n.detail.key,f=n.detail.newIndex,e=n.detail.value,i=this._filteredKeys,r=i.indexOf(t),u;-1!==r&&(i.splice(r,1),u=this._findInsertionPosition(t,f),i.splice(u,0,t),this._notifyItemMoved(t,r,u,e))},_listItemMutated:function(n){var t=n.detail.key,i=n.detail.value,e=n.detail.item,s=this._filter,o=this._filteredKeys,r=o.indexOf(t),u=-1!==r,f=s(i);u&&f?this._notifyItemMutated(t,i,e):u&&!f?(o.splice(r,1),this._notifyItemRemoved(t,r,i,e)):!u&&f&&this._listItemInserted({detail:{key:t,index:this._list.indexOfKey(t),value:i}})},_listItemRemoved:function(n){var i=n.detail.key,u=n.detail.value,f=n.detail.item,r=this._filteredKeys,t=r.indexOf(i);-1!==t&&(r.splice(t,1),this._notifyItemRemoved(i,t,u,f))},_listReload:function(){this._initFilteredKeys();this._notifyReload()},length:{get:function(){return this._filteredKeys.length},set:function(n){if(!("number"==typeof n&&n>=0))throw new r("WinJS.Binding.List.IllegalLength",v.illegalListLength);var t=this.length;t>n&&this.splice(n,t-n)}},getItem:function(n){return n=s(n),this.getItemFromKey(this._filteredKeys[n])},indexOfKey:function(n){return this._filteredKeys.indexOf(n)},notifyMutated:function(n){return n=s(n),this._notifyMutatedFromKey(this._filteredKeys[n])},setAt:function(n,t){n=s(n);this._setAtKey(this._filteredKeys[n],t)},_spliceFromKey:function(n,t){var r,u,n,s;if(arguments.length>2&&(r=l(arguments),r[1]=0,this._list._spliceFromKey.apply(this._list,r)),u=[],t){for(var e=[],f=this._filteredKeys,o=f.indexOf(n),i=o,h=f.length;h>i&&t>i-o;i++)n=f[i],e.push(n);s=this;e.forEach(function(n){u.push(s._list._spliceFromKey(n,1)[0])})}return u}},{supportedForProcessing:!1})}),SortedListProjection:t.Namespace._lazy(function(){return t.Class.derive(h.ListProjection,function(n,t){this._list=n;this._addListListener("itemchanged",this._listItemChanged);this._addListListener("iteminserted",this._listItemInserted);this._addListListener("itemmoved",this._listItemMoved);this._addListListener("itemmutated",this._listItemMutated);this._addListListener("itemremoved",this._listItemRemoved);this._addListListener("reload",this._listReload);this._sortFunction=t;this._initSortedKeys()},{_sortFunction:null,_sortedKeys:null,_initSortedKeys:function(){for(var i,u,f,n=this._list,r=[],t=0,e=n.length;e>t;t++)i=n.getItem(t),i&&(r[t]=i.key);u=this._sortFunction;f=y(r,function(t,i){return t=n.getItemFromKey(t).data,i=n.getItemFromKey(i).data,u(t,i)});this._sortedKeys=f},_findInsertionPos:function(n,t,i,r,u){for(var s,l,h,a=this._sortFunction,c=this._sortedKeys,f=Math.max(0,r||-1),o=Math.min(c.length,u||Number.MAX_VALUE),e=f;o>=f;){if(e=(f+o)/2>>>0,s=c[e],!s)break;if(l=this.getItemFromKey(s),h=a(l.data,i),0>h)f=e+1;else{if(0===h)return this._findStableInsertionPos(n,t,f,o,e,i);o=e-1}}return f},_findBeginningOfGroup:function(n,t,i,r,u){for(var f=0,e=n;e>=f;){n=(f+e)/2>>>0;var o=r[n],s=i.getItemFromKey(o),h=t(s.data,u);0>h?f=n+1:e=n-1}return f},_findEndOfGroup:function(n,t,i,r,u){for(var o,s,h,f=n,e=r.length;e>=f;){if(n=(f+e)/2>>>0,o=r[n],!o)return r.length;s=i.getItemFromKey(o);h=t(s.data,u);0>=h?f=n+1:e=n-1}return f},_findStableInsertionPos:function(n,t,i,r,u,f){var h=this._list,c=h.length,l=this._sortFunction,s=this._sortedKeys,e,o;if(c/2>t){for(e=t-1;e>=0;e--)if(o=h.getItem(e),0===l(o.data,f))return c-i>r?s.indexOf(o.key,i)+1:s.lastIndexOf(o.key,r)+1;return this._findBeginningOfGroup(u,l,h,s,f)}for(e=t+1;c>e;e++)if(o=h.getItem(e),0===l(o.data,f))return c-i>r?s.indexOf(o.key,i):s.lastIndexOf(o.key,r);return this._findEndOfGroup(u,l,h,s,f)},_listItemChanged:function(n){var t=n.detail.key,i=n.detail.newValue,r=n.detail.oldValue,f=this._sortFunction,u;0===f(r,i)?(u=this.indexOfKey(t),this._notifyItemChanged(t,u,r,i,n.detail.oldItem,n.detail.newItem)):(this._listItemRemoved({detail:{key:t,index:n.detail.index,value:n.detail.oldValue,item:n.detail.oldItem}}),this._listItemInserted({detail:{key:t,index:n.detail.index,value:n.detail.newValue}}))},_listItemInserted:function(n,t,i){var r=n.detail.key,e=n.detail.index,u=n.detail.value,f=this._findInsertionPos(r,e,u,t,i);this._sortedKeys.splice(f,0,r);this._notifyItemInserted(r,f,u)},_listItemMoved:function(n,t,i){var r=n.detail.key,s=n.detail.newIndex,o=n.detail.value,f=this._sortedKeys,e=f.indexOf(r,t),u;f.splice(e,1);u=this._findInsertionPos(r,s,o,t,i);f.splice(u,0,r);u!==e&&this._notifyItemMoved(r,e,u,o)},_listItemMutated:function(n){var t=n.detail.key,i=n.detail.value,f=n.detail.item,r=this._list.indexOfKey(t),u=this._sortedKeys.indexOf(t),e;return this._sortedKeys.splice(u,1),e=this._findInsertionPos(t,r,i),this._sortedKeys.splice(u,0,t),u===e?void this._notifyItemMutated(t,i,f):(this._listItemRemoved({detail:{key:t,index:r,value:i,item:f}}),void this._listItemInserted({detail:{key:t,index:r,value:i}}))},_listItemRemoved:function(n,t){var i=n.detail.key,f=n.detail.value,e=n.detail.item,r=this._sortedKeys,u=r.indexOf(i,t);r.splice(u,1);this._notifyItemRemoved(i,u,f,e)},_listReload:function(){this._initSortedKeys();this._notifyReload()},length:{get:function(){return this._sortedKeys.length},set:function(n){if(!("number"==typeof n&&n>=0))throw new r("WinJS.Binding.List.IllegalLength",v.illegalListLength);var t=this.length;t>n&&this.splice(n,t-n)}},getItem:function(n){return n=s(n),this.getItemFromKey(this._sortedKeys[n])},indexOfKey:function(n){return this._sortedKeys.indexOf(n)},notifyMutated:function(n){n=s(n);this._notifyMutatedFromKey(this._sortedKeys[n])},setAt:function(n,t){n=s(n);this._setAtKey(this._sortedKeys[n],t)},_spliceFromKey:function(n,t){var r,u,s;if(arguments.length>2&&(r=l(arguments),r[1]=0,this._list._spliceFromKey.apply(this._list,r)),u=[],t){for(var e=[],f=this._sortedKeys,o=f.indexOf(n),i=o,h=f.length;h>i&&t>i-o;i++)e.push(f[i]);s=this;e.forEach(function(n){u.push(s._list._spliceFromKey(n,1)[0])})}return u}},{supportedForProcessing:!1})}),GroupedSortedListProjection:t.Namespace._lazy(function(){return t.Class.derive(h.SortedListProjection,function(n,t,i,r){this._list=n;this._addListListener("itemchanged",this._listGroupedItemChanged);this._addListListener("iteminserted",this._listGroupedItemInserted);this._addListListener("itemmoved",this._listGroupedItemMoved);this._addListListener("itemmutated",this._listGroupedItemMutated);this._addListListener("itemremoved",this._listGroupedItemRemoved);this._addListListener("reload",this._listReload);this._sortFunction=function(n,i){return n=t(n),i=t(i),r?r(n,i):i>n?-1:n===i?0:1};this._groupKeyOf=t;this._groupDataOf=i;this._initSortedKeys();this._initGroupedItems()},{_groupKeyOf:null,_groupDataOf:null,_groupedItems:null,_initGroupedItems:function(){for(var n,i={},r=this._list,u=this._groupKeyOf,t=0,f=r.length;f>t;t++)n=c(r.getItem(t)),n.groupKey=u(n.data),i[n.key]=n;this._groupedItems=i},_groupsProjection:null,_listGroupedItemChanged:function(n){var i=n.detail.key,e=n.detail.oldValue,r=n.detail.newValue,o=this._groupedItems,u=o[i],t=c(u),f;t.data=r;t.groupKey=this._groupKeyOf(r);o[i]=t;u.groupKey===t.groupKey?(f=this.indexOfKey(i),this._notifyItemChanged(i,f,e,r,u,t)):(f=n.detail.index,this._listItemChanged({detail:{key:i,index:f,oldValue:e,newValue:r,oldItem:u,newItem:t}}))},_listGroupedItemInserted:function(n){var i=n.detail.key,u=n.detail.value,f=this._groupKeyOf(u),r,e,t;this._groupedItems[i]={handle:i,key:i,data:u,groupKey:f};this._groupsProjection&&(t=this._groupsProjection._groupItems[f],t&&(r=t.firstItemIndexHint,e=r+t.groupSize));this._listItemInserted(n,r,e)},_listGroupedItemMoved:function(n){var t,r,u=this._groupedItems[n.detail.key].groupKey,i;this._groupsProjection&&(i=this._groupsProjection._groupItems[u],t=i.firstItemIndexHint,r=t+i.groupSize);this._listItemMoved(n,t,r)},_listGroupedItemMutated:function(n){var t=n.detail.key,i=n.detail.value,e=this._groupedItems,r=e[t],o=this._groupKeyOf(i),u,f;r.groupKey===o?this._notifyItemMutated(t,i,r):(u=c(r),u.groupKey=o,e[t]=u,f=this._list.indexOfKey(t),this._listItemRemoved({detail:{key:t,index:f,value:i,item:r}}),this._listItemInserted({detail:{key:t,index:f,value:i}}))},_listGroupedItemRemoved:function(n){var t=n.detail.key,o=n.detail.index,s=n.detail.value,u=this._groupedItems,f=u[t],i,e,r;delete u[t];this._groupsProjection&&(r=this._groupsProjection._groupItems[f.groupKey],i=r.firstItemIndexHint,e=i+r.groupSize);this._listItemRemoved({detail:{key:t,index:o,value:s,item:f}},i,e)},_listReload:function(){this._initGroupedItems();h.SortedListProjection.prototype._listReload.call(this)},groups:{get:function(){return null===this._groupsProjection&&(this._groupsProjection=new h.GroupsListProjection(this,this._groupKeyOf,this._groupDataOf)),this._groupsProjection}},getItemFromKey:function(n){return this._groupedItems[n]}},{supportedForProcessing:!1})}),GroupsListProjection:t.Namespace._lazy(function(){return t.Class.derive(h.ListBase,function(n,t,i){this._list=n;this._addListListener("itemchanged",this._listItemChanged);this._addListListener("iteminserted",this._listItemInserted);this._addListListener("itemmoved",this._listItemMoved);this._addListListener("itemremoved",this._listItemRemoved);this._addListListener("reload",this._listReload);this._groupKeyOf=t;this._groupDataOf=i;this._initGroupKeysAndItems()},{_list:null,_addListListener:function(n,t){this._list.addEventListener(n,t.bind(this))},_groupDataOf:null,_groupKeyOf:null,_groupOf:function(n){return this.getItemFromKey(this._groupKeyOf(n.data))},_groupKeys:null,_groupItems:null,_initGroupKeysAndItems:function(){for(var u,n,i,h=this._groupDataOf,f=this._list,e={},o=[],s=null,t=null,r=0,c=f.length;c>r;r++)u=f.getItem(r),n=u.groupKey,n!==s?(t&&(t.groupSize=i),i=1,s=n,t={handle:n,key:n,data:h(u.data),firstItemKey:u.key,firstItemIndexHint:r},e[n]=t,o.push(n)):i++;t&&(t.groupSize=i);this._groupKeys=o;this._groupItems=e},_listItemChanged:function(n){var u=n.detail.key,e=n.detail.index,o=n.detail.newValue,s=this._list,i=s.getItemFromKey(u).groupKey,f=this._groupItems,r=f[i],t;r.firstItemIndexHint===e&&(t=c(r),t.data=this._groupDataOf(o),t.firstItemKey=u,f[i]=t,this._notifyItemChanged(i,this._groupKeys.indexOf(i),r.data,t.data,r,t))},_listItemInserted:function(n){var e,r,t,i,h,a=n.detail.key,l=n.detail.index,v=n.detail.value,y=this._list,u=y.getItemFromKey(a).groupKey,o=this._groupItems,s=this._groupKeys,f=o[u];if(f)r=f,t=c(r),t.groupSize++,r.firstItemIndexHint===l&&(t.groupData=this._groupDataOf(v),t.firstItemKey=a,t.firstItemIndexHint=l),o[u]=t,e=s.indexOf(u),this._notifyItemChanged(u,e,r.data,t.data,r,t);else{for(i=0,h=s.length;h>i&&(f=o[s[i]],!(f.firstItemIndexHint>=l));i++);e=i;f={handle:u,key:u,data:this._groupDataOf(v),groupSize:1,firstItemKey:a,firstItemIndexHint:l};s.splice(e,0,u);o[u]=f;this._notifyItemInserted(u,e,f.data)}for(i=e+1,h=s.length;h>i;i++)r=o[s[i]],t=c(r),t.firstItemIndexHint++,o[t.key]=t,this._notifyItemChanged(t.key,i,r.data,t.data,r,t)},_listItemMoved:function(n){var o=n.detail.key,s=n.detail.oldIndex,h=n.detail.newIndex,f=this._list,r=f.getItemFromKey(o).groupKey,e=this._groupItems,t=e[r],u,i;(t.firstItemIndexHint===h||t.firstItemIndexHint===s)&&(u=f.getItem(t.firstItemIndexHint),i=c(t),i.data=this._groupDataOf(u.data),i.firstItemKey=u.key,e[r]=i,this._notifyItemChanged(r,this._groupKeys.indexOf(r),t.data,i.data,t,i))},_listItemRemoved:function(n){var i,t,l=n.detail.index,v=n.detail.item,u=this._groupItems,o=this._groupKeys,r=v.groupKey,s=u[r],f=o.indexOf(r),h,e,a;for(1===s.groupSize?(o.splice(f,1),delete u[r],this._notifyItemRemoved(r,f,s.data,s),f--):((i=s,t=c(i),t.groupSize--,i.firstItemIndexHint===l)&&(h=this._list.getItem(l),t.data=this._groupDataOf(h.data),t.firstItemKey=h.key),u[r]=t,this._notifyItemChanged(r,f,i.data,t.data,i,t)),e=f+1,a=o.length;a>e;e++)i=u[o[e]],t=c(i),t.firstItemIndexHint--,u[t.key]=t,this._notifyItemChanged(t.key,e,i.data,t.data,i,t)},_listReload:function(){this._initGroupKeysAndItems();this._notifyReload()},length:{get:function(){return this._groupKeys.length}},getItem:function(n){return n=s(n),this._groupItems[this._groupKeys[n]]},getItemFromKey:function(n){return this._groupItems[n]},indexOfKey:function(n){return this._groupKeys.indexOf(n)}},{supportedForProcessing:!1})})});t.Namespace._moduleDefine(n,"WinJS.Binding",{List:t.Namespace._lazy(function(){return t.Class.derive(h.ListBaseWithMutators,function(n,t){var f,o;if(this._currentKey=0,this._keys=null,this._keyMap={},t=t||p,this._proxy=t.proxy,this._binding=t.binding,this._proxy){if(Object.keys(n).length!==n.length)throw new r("WinJS.Binding.List.NotSupported",v.sparseArrayNotSupported);this._data=n;this._currentKey=n.length}else if(n){for(var s=this._keyMap,u=0,i=0,h=n.length;h>i;i++)i in n&&(f=n[i],this._binding&&(f=e.as(f)),o=u.toString(),u++,s[o]={handle:o,key:o,data:f});u!==i&&this._initializeKeys();this._currentKey=u}},{_currentKey:0,_keys:null,_keyMap:null,_modifyingData:0,_initializeKeys:function(){var i,t,r;if(!this._keys){if(i=[],this._data)for(var f=this._keyMap,u=this._data,n=0,o=u.length;o>n;n++)n in u&&(t=n.toString(),(i[n]=t,t in f)||(r=u[n],this._binding&&(r=e.as(r)),f[t]={handle:t,key:t,data:r}));else Object.keys(this._keyMap).forEach(function(n){i[n>>>0]=n});this._keys=i}},_lazyPopulateEntry:function(n){var t,r,i;if(this._data&&n in this._data)return t=this._data[n],this._binding&&(t=e.as(t)),r=n.toString(),i={handle:r,key:r,data:t},this._keyMap[i.key]=i,i},_assignKey:function(){return(++this._currentKey).toString()},length:{get:function(){return this._data?this._data.length:this._keys?this._keys.length:this._currentKey},set:function(n){if(!("number"==typeof n&&n>=0))throw new r("WinJS.Binding.List.IllegalLength",v.illegalListLength);this._initializeKeys();var t=this.length;if(t>n?this.splice(n,t-n):n=t,this._data){this._modifyingData++;try{this._data.length=n}finally{this._modifyingData--}}this._keys&&(this._keys.length=n)}},getItem:function(n){var i,t;return n=s(n),this._keys?(t=this._keys[n],i=t&&this._keyMap[t]):(t=n.toString(),i=this._keyMap[t]||this._lazyPopulateEntry(n)),i},getItemFromKey:function(n){return this._keys||!this._data?this._keyMap[n]:this.getItem(n>>>0)},indexOfKey:function(n){var t=-1,i;return this._keys?t=this._keys.indexOf(n):(i=n>>>0,i<this._currentKey&&(t=i)),t},move:function(n,t){var r,i;if(n=s(n),t=s(t),this._initializeKeys(),!(n===t||0>n||0>t||n>=this.length||t>=this.length)){if(this._data){this._modifyingData++;try{r=this._data.splice(n,1)[0];this._data.splice(t,0,r)}finally{this._modifyingData--}}i=this._keys.splice(n,1)[0];this._keys.splice(t,0,i);this._notifyItemMoved(i,n,t,this.getItemFromKey(i).data)}},notifyMutated:function(n){n=s(n);var t=this._keys?this._keys[n]:n.toString();this._notifyMutatedFromKey(t)},setAt:function(n,t){var i;if(n=s(n),this._initializeKeys(),i=this.length,n===i)this.push(t);else if(i>n){if(this._data){this._modifyingData++;try{this._data[n]=t}finally{this._modifyingData--}}if(this._binding&&(t=e.as(t)),n in this._keys){var r=this._keys[n],u=this._keyMap[r],f=c(u);f.data=t;this._keyMap[r]=f;this._notifyItemChanged(r,n,u.data,t,u,f)}}},_setAtKey:function(n,t){this.setAt(this.indexOfKey(n),t)},reverse:function(){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.reverse()}finally{this._modifyingData--}}return this._keys.reverse(),this._notifyReload(),this},sort:function(n){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.sort(n)}finally{this._modifyingData--}}var t=this;return this._keys.sort(function(i,r){return i=t._keyMap[i],r=t._keyMap[r],n?n(i.data,r.data):(i=(i&&i.data||"").toString(),r=(i&&r.data||"").toString(),r>i?-1:i===r?0:1)}),this._notifyReload(),this},pop:function(){if(0!==this.length){this._initializeKeys();var n=this._keys.pop(),t=this._keyMap[n],i=t&&t.data;if(this._data){this._modifyingData++;try{this._data.pop()}finally{this._modifyingData--}}return delete this._keyMap[n],this._notifyItemRemoved(n,this._keys.length,i,t),i}},push:function(){var r,t,i,n;for(this._initializeKeys(),r=arguments.length,t=0;r>t;t++){if(i=arguments[t],this._binding&&(i=e.as(i)),n=this._assignKey(),this._keys.push(n),this._data){this._modifyingData++;try{this._data.push(arguments[t])}finally{this._modifyingData--}}this._keyMap[n]={handle:n,key:n,data:i};this._notifyItemInserted(n,this._keys.length-1,i)}return this.length},shift:function(){if(0!==this.length){this._initializeKeys();var n=this._keys.shift(),t=this._keyMap[n],i=t&&t.data;if(this._data){this._modifyingData++;try{this._data.shift()}finally{this._modifyingData--}}return delete this._keyMap[n],this._notifyItemRemoved(n,0,i,t),i}},unshift:function(){var r,t,i,n;for(this._initializeKeys(),r=arguments.length,t=r-1;t>=0;t--){if(i=arguments[t],this._binding&&(i=e.as(i)),n=this._assignKey(),this._keys.unshift(n),this._data){this._modifyingData++;try{this._data.unshift(arguments[t])}finally{this._modifyingData--}}this._keyMap[n]={handle:n,key:n,data:i};this._notifyItemInserted(n,0,i)}return this.length},splice:function(n,t){var o,i,a,u,f,r;for(n=s(n),this._initializeKeys(),n=Math.max(0,this._normalizeIndex(n)),t=Math.max(0,Math.min(t||0,this.length-n)),o=[];t;){var h=this._keys[n],c=this._keyMap[h],l=c&&c.data;if(o.push(l),this._keys.splice(n,1),this._data){this._modifyingData++;try{this._data.splice(n,1)}finally{this._modifyingData--}}delete this._keyMap[h];this._notifyItemRemoved(h,n,l,c);--t}if(arguments.length>2)for(i=2,a=arguments.length;a>i;i++){if(u=arguments[i],this._binding&&(u=e.as(u)),f=Math.min(n+i-2,this.length),r=this._assignKey(),this._keys.splice(f,0,r),this._data){this._modifyingData++;try{this._data.splice(f,0,arguments[i])}finally{this._modifyingData--}}this._keyMap[r]={handle:r,key:r,data:u};this._notifyItemInserted(r,f,u)}return o},_spliceFromKey:function(n){this._initializeKeys();var t=l(arguments);return t[0]=this._keys.indexOf(n),this.splice.apply(this,t)}},{supportedForProcessing:!1})})})});t("WinJS/Res",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./ControlProcessor/_OptionsParser","./Promise"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,i){var i,p,w,y,s,b,f,c,a;if(n=n||t.document.body,i=i||0,4>i){if(0===i&&n.getAttribute&&(p=n.getAttribute("data-win-res"),p&&(a=e.optionsParser(p),h(n,n,a,i))),w="[data-win-res],[data-win-control]",y=n.querySelectorAll(w),0===y.length)return o.as(n);for(s=0,b=y.length;b>s;s++)f=y[s],f.winControl&&f.winControl.constructor&&f.winControl.constructor.isDeclarativeControlContainer&&(c=f.winControl.constructor.isDeclarativeControlContainer,"function"==typeof c&&(c=v(c),c(f.winControl,l),s+=f.querySelectorAll(w).length)),f.hasAttribute("data-win-res")&&(a=e.optionsParser(f.getAttribute("data-win-res")),h(f,f,a,i))}else if(r.validation)throw new u("WinJS.Res.NestingExceeded","NestingExceeded");return o.as(n)}function y(n,t){for(var e=Object.keys(t),u=0,h=e.length;h>u;u++){var o=e[u],s=t[o],i=f.getString(s);i&&i.empty?r.validation&&c(s):(n.setAttribute(o,i.value),void 0!==i.lang&&void 0!==n.lang&&n.lang!==i.lang&&(n.lang=i.lang))}}function c(n){throw new u("WinJS.Res.NotFound",f._formatString("NotFound: {0}",n));}function h(n,t,i,u){var p=Object.keys(i),a,w,o,l,e;for(t=v(t),a=0,w=p.length;w>a;a++)o=p[a],l=i[o],"string"==typeof l?(e=f.getString(l),e&&e.empty?r.validation&&c(l):(t[o]=e.value,void 0!==e.lang&&void 0!==n.lang&&n.lang!==e.lang&&(n.lang=e.lang),"innerHTML"===o&&s(t,u+1))):n===t&&"attributes"===o?y(n,l):h(n,t[o],l,u)}function l(n){if(!a)return r.ready().then(function(){return a=!0,s(n)});try{return s(n)}catch(t){return o.wrapError(t)}}var a=!1,v=r.requireSupportedForProcessing;i.Namespace._moduleDefine(n,"WinJS.Resources",{processAll:l})});t("WinJS/Pages/_BasePage",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WriteProfilerMark","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n){var i=t.document.createElement("a");return i.href=n,i.href}function l(n){return t.document.location.href.toLowerCase()===n.toLowerCase()}function v(n,o){var v=a(n);return n=h(n),v||(v=i.Class.define(function(i,e,o,h){var c=this,a,p,v,y;this._disposed=!1;this.element=i=i||t.document.createElement("div");s.addClass(i,"win-disposable");i.msSourceLocation=n;this.uri=n;this.selfhost=l(n);i.winControl=this;s.addClass(i,"pagecontrol");a=" uri='"+n+"'"+r._getProfilerMarkIdentifier(this.element);u("WinJS.UI.Pages:createPage"+a+",StartTM");p=f.wrap().then(function(){return c.load(n)});v=p.then(function(n){return f.join({loadResult:n,initResult:c.init(i,e)})}).then(function(n){return c.render(i,e,n.loadResult)});this.elementReady=v.then(function(){return i});this.renderComplete=v.then(function(){return c.process(i,e)}).then(function(){return c.processed(i,e)}).then(function(){return c});y=function(){o&&o(c);u("WinJS.UI.Pages:createPage"+a+",StopTM")};this.renderComplete.then(y,y);this.renderComplete.then(function(){return h}).then(function(){c.ready(i,e)}).then(null,function(n){return c.error(n)})},p),v=i.Class.mix(v,e.DOMEventMixin),c[n.toLowerCase()]=v),o&&(v=i.Class.mix(v,o)),v.selfhost=l(n),v}function a(n){return n=h(n),c[n.toLowerCase()]}function y(n){n=h(n);delete c[n.toLowerCase()]}if(t.document){var c={},p={dispose:function(){this._disposed||(this._disposed=!0,o.disposeSubTree(this.element),this.element=null)},load:function(){},init:function(){},process:function(){},processed:function(){},render:function(){},ready:function(){},error:function(n){return f.wrapError(n)}};i.Namespace._moduleDefine(n,null,{abs:h,define:v,get:a,remove:y})}});t("WinJS/Pages",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./ControlProcessor","./Fragments","./Pages/_BasePage","./Promise"],function(n,t,i,r,u,f,e){"use strict";function o(n,u){var f=e.get(n);return f||(f=e.define(n,l)),u&&(f=i.Class.mix(f,u)),f.selfhost&&r.ready(function(){h(e.abs(n),t.document.body)},!0),f}function s(n){var t=e.get(n);return t||(t=o(n)),t}function c(n){f.clearCache(e.abs(n));e.remove(n)}function h(n,t,i,r){var u=s(n),f=new u(t,i,null,r);return f.renderComplete}if(t.document){var l={load:function(n){if(!this.selfhost)return f.renderCopy(e.abs(n))},process:function(n){return u.processAll(n)},render:function(n,t,i){return this.selfhost||n.appendChild(i),n}};i.Namespace._moduleDefine(n,"WinJS.UI.Pages",{define:o,get:s,_remove:c,render:h})}});t("WinJS/Controls/HtmlControl",["exports","../Core/_Global","../Core/_Base","../Pages"],function(n,t,i,r){"use strict";t.document&&i.Namespace._moduleDefine(n,"WinJS.UI",{HtmlControl:i.Class.define(function(n,t,i){r.render(t.uri,n,t).then(i,function(){i()})})})});t("WinJS/VirtualizedDataSource/_VirtualizedDataSourceImpl",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../_Signal","../Utilities/_UI"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{VirtualizedDataSource:i.Namespace._lazy(function(){function b(i,f){function hi(n){var t="WinJS.UI.VirtualizedDataSource:"+tc+":"+n+",StartTM";s(t);e.log&&e.log(t,"winjs vds","perf")}function ni(n){var t="WinJS.UI.VirtualizedDataSource:"+tc+":"+n+",StopTM";s(t);e.log&&e.log(t,"winjs vds","perf")}function kt(n){return"number"==typeof n&&n>=0}function ne(n){return kt(n)&&n===Math.floor(n)}function te(t){if(null===t)t=void 0;else if(void 0!==t&&!ne(t))throw new u("WinJS.UI.ListDataSource.InvalidIndexReturned",n.invalidIndexReturned);return t}function ie(t){if(null===t)t=void 0;else if(void 0!==t&&!ne(t)&&t!==y.unknown)throw new u("WinJS.UI.ListDataSource.InvalidCountReturned",n.invalidCountReturned);return t}function go(){var n=(lo++).toString(),t={handle:n,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return ii[n]=t,t}function re(){return go()}function ns(n,t){n.prev=t.prev;n.next=t;n.prev.next=n;t.prev=n}function ts(n){n.lastInSequence&&(delete n.lastInSequence,n.prev.lastInSequence=!0);n.firstInSequence&&(delete n.firstInSequence,n.next.firstInSequence=!0);n.prev.next=n.next;n.next.prev=n.prev}function pu(n){for(;!n.firstInSequence;)n=n.prev;return n}function is(n){for(;!n.lastInSequence;)n=n.next;return n}function wu(n,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=n.prev,i.next=n,t.prev.next=t,n.prev=i,!0}function hr(n,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=n,i.next=n.next,n.next=t,i.next.prev=i,!0}function lt(n){delete n.lastInSequence;delete n.next.firstInSequence}function pi(n){var t=n.next;n.lastInSequence=!0;t.firstInSequence=!0;t===w&&bi(w,void 0)}function bu(n,t,i,r){ns(n,t);var u=n.prev;u.lastInSequence&&(i?delete u.lastInSequence:n.firstInSequence=!0,r?delete t.firstInSequence:n.lastInSequence=!0)}function gr(n,t){n.key=t;ut[n.key]=n}function fi(n,t,i){+t===t&&(n.index=t,i[t]=n,fr||(n.firstInSequence&&n.prev&&n.prev.index===t-1&&lt(n.prev),n.lastInSequence&&n.next&&n.next.index===t+1&&lt(n)))}function ue(n,t){var i=t===tt?re():go();return ns(i,n),i}function rs(n,t,i){var r=ue(n,i);return r.firstInSequence=!0,r.lastInSequence=!0,fi(r,t,i),r}function fe(n,t){return rs(n,t,tt)}function nu(n,t){var i=ue(n,t);return delete n.firstInSequence,i.prev.index===i.index-1?delete i.prev.lastInSequence:i.firstInSequence=!0,fi(i,n.index-1,t),i}function tr(n,t){var i=ue(n.next,t);return delete n.lastInSequence,i.next.index===i.index+1?delete i.next.firstInSequence:i.lastInSequence=!0,fi(i,n.index+1,t),i}function rc(n,t,i,r){bu(n,t,i,r);ut[n.key]=n;void 0!==n.index&&(tt[n.index]=n)}function ee(n){var i,r,t;ts(n);n.key&&delete ut[n.key];void 0!==n.index&&tt[n.index]===n&&delete tt[n.index];i=n.bindingMap;for(r in i)t=i[r].handle,t&&ii[t]===n&&delete ii[t];ii[n.handle]===n&&delete ii[n.handle]}function oe(n){return!ii[n.handle]}function se(n,t,i,r,u){var f=u?null:t[n-1],e;if(f&&(f.next!==r||r.firstInSequence))f=f.next;else if(f=t[n+1],!f){for(f=i.next;;){if(f.firstInSequence&&(e=f),!(n>=f.index)||f===r)break;f=f.next}f!==r||r.firstInSequence||(f=e&&void 0===e.index?e:void 0)}return f}function ku(n){return!n.item&&!n.itemNew&&n!==w}function he(n,t){Object.defineProperty(n,"handle",{value:t,writable:!1,enumerable:!1,configurable:!0})}function ce(n,t,i){he(n,i);Object.defineProperty(n,"index",{get:function(){for(;t.slotMergedWith;)t=t.slotMergedWith;return t.index},enumerable:!1,configurable:!0})}function uc(t){if(void 0===t)return t;var i=JSON.stringify(t);if(void 0===i)throw new u("WinJS.UI.ListDataSource.ObjectIsNotValidJson",n.objectIsNotValidJson);return i}function us(n){return i.itemSignature?i.itemSignature(n.data):uc(n.data)}function tu(n){var t=n.itemNew;n.itemNew=null;t&&(t=Object.create(t),ce(t,n,n.handle),i.compareByIdentity||(n.signature=us(t)));n.item=t;delete n.indexRequested;delete n.keyRequested}function le(n){return n.bindingMap||n.cursorCount>0}function ae(n){return le(n)||n.fetchListeners||n.directFetchListeners}function ve(n){return ae(n)||!n.firstInSequence&&le(n.prev)||!n.lastInSequence&&le(n.next)||!pt&&(!n.firstInSequence&&n.prev!==b&&!(n.prev.item||n.prev.itemNew))|(!n.lastInSequence&&n.next!==w&&!(n.next.item||n.next.itemNew))}function ye(n){pi(n);ee(n)}function fc(){var i,r;if(!gt){(!gi||oe(gi))&&(gi=w.prev);for(var n=gi.prev,t=gi.next,u=0,f=function(n){n===w||ve(n)||(af>=u?u++:ye(n))};n||t;)n&&(i=n,n=i.prev,i!==b&&f(i)),t&&(r=t,t=r.next,r!==ft&&f(r));vu=0}}function iu(n){ae(n)||(vu++,gt||ui||(gi=n,vu>af&&!pf&&(pf=!0,c.schedule(function(){pf=!1;fc()},c.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested"))))}function cr(n){for(var t in ti)n(ti[t])}function pe(n,t){for(var i in n.bindingMap)t(n.bindingMap[i].bindingRecord,i)}function ir(n){return n.notificationsSent||(n.notificationsSent=!0,n.notificationHandler.beginNotifications&&n.notificationHandler.beginNotifications()),n.notificationHandler}function wi(){vi||au||cr(function(n){n.notificationsSent&&(n.notificationsSent=!1,n.notificationHandler.endNotifications&&n.notificationHandler.endNotifications())})}function ei(n,t){var u=n.bindingMap,i,r;return u&&(i=u[t],i&&(r=i.handle,r))?r:n.handle}function we(n,t){return n&&n.handle!==t&&(n=Object.create(n),he(n,t)),n}function du(n){var t=ht;ht=n;cr(function(n){n.notificationHandler&&n.notificationHandler.countChanged&&ir(n).countChanged(ht,t)})}function fs(n,t){pe(n,function(i,r){i.notificationHandler.indexChanged&&ir(i).indexChanged(ei(n,r),n.index,t)})}function bi(n,t){var i=n.index;if(void 0!==i&&tt[i]===n&&delete tt[i],+t===t)fi(n,t,tt);else{if(+i!==i)return;delete n.index}fs(n,i)}function es(n,t,i,r,u){var e={},f;if(!(!r&&t.lastInSequence||!u&&i.firstInSequence))if(t===b)if(i===w)for(f in ti)e[f]=ti[f];else for(f in i.bindingMap)e[f]=ti[f];else if(i===w||i.bindingMap)for(f in t.bindingMap)(i===w||i.bindingMap[f])&&(e[f]=ti[f]);for(f in n.bindingMap)e[f]=ti[f];return e}function be(n){var t,i=n.prev,r=n.next,f=es(n,i,r),u;for(t in f)u=f[t],u.notificationHandler&&ir(u).inserted(u.itemPromiseFromKnownSlot(n),i.lastInSequence||i===b?null:ei(i,t),r.firstInSequence||r===w?null:ei(r,t))}function ru(n){var t=n.item;tu(n);pe(n,function(i,r){var u=ei(n,r);ir(i).changed(we(n.item,u),we(t,u))})}function lr(n,t,i,r,u){var e,f=t.prev,o,s;if(t===n){if(!n.firstInSequence||!i)return;t=n.next}else if(f===n){if(!n.lastInSequence||!r)return;f=n.prev}if(!u){o=es(n,f,t,i,r);for(e in o)s=o[e],ir(s).moved(s.itemPromiseFromKnownSlot(n),(f.lastInSequence||f===n.prev)&&!i||f===b?null:ei(f,e),(t.firstInSequence||t===n.next)&&!r||t===w?null:ei(t,e));cr(function(t){t.adjustCurrentSlot(n)})}ts(n);bu(n,t,i,r)}function wt(n,t){uu(n,!0);pe(n,function(i,r){ir(i).removed(ei(n,r),t)});cr(function(t){t.adjustCurrentSlot(n)});ee(n)}function os(n){for(var t,i;!n.firstInSequence;)n=n.prev;do t=n.lastInSequence,i=n.next,wt(n,!0),n=i;while(!t)}function oi(n){var i,t;if(!n)return i;for(t=0;!n.firstInSequence;)t++,n=n.prev;return"number"==typeof n.indexNew?n.indexNew+t:"number"==typeof n.index?n.index+t:i}function ss(n,t){for(n=n.next;n;n=n.next)if(n.firstInSequence){var i=void 0!==n.indexNew?n.indexNew:n.index;void 0!==i&&(n.indexNew=i+t)}pr+=t;fr=!0;ui?nt():st++}function dt(n,t){var i,r;n.firstInSequence&&(0>t?(i=n.indexNew,void 0!==i?delete n.indexNew:i=n.index,n.lastInSequence||(n=n.next,void 0!==i&&(n.indexNew=i))):n.lastInSequence||(r=n.next,i=r.indexNew,void 0!==i?delete r.indexNew:i=r.index,void 0!==i&&(n.indexNew=i)));ss(n,t)}function ar(n,t){for(var r,i=b;i!==w;i=i.next)if(r=i.indexNew,void 0!==r&&r>=n){ss(i,t);break}}function ke(){for(var u,r,t,i,n=b;;n=n.next){if(n.firstInSequence){if(u=n,void 0!==n.indexNew){if(r=n.indexNew,delete n.indexNew,isNaN(r))break}else r=n.index;n!==b&&n.prev.index===r-1&&lt(n.prev)}if(n.lastInSequence)for(t=r,i=u;i!==n.next;i=i.next)t!==i.index&&bi(i,t),+t===t&&t++;if(n===w)break}for(;n!==ft;n=n.next)void 0!==n.index&&n!==w&&bi(n,void 0);fr=!1;pr&&+ht===ht&&(ot?ot.reset():du(ht+pr),pr=0)}function hs(n,t,i,r,u){if(n.item)return new h(function(t){u?u(t,n.item):t(n.item)});var f={listBindingID:r,retained:!1};return n[t]||(n[t]={}),n[t][i]=f,f.promise=new h(function(n,t){f.complete=u?function(t){u(n,t)}:n;f.error=t},function(){for(;n.slotMergedWith;)n=n.slotMergedWith;var r=n[t];if(r){if(delete r[i],Object.keys(r).length>0)return;delete n[t]}iu(n)}),f.promise}function gu(n,t){for(var i in t)t[i].complete(n)}function uu(n,t){var i=n.fetchListeners,r=n.directFetchListeners,u,f;(i||r)&&(tu(n),u=n.item,f=function(n){t?gu(u,n):br.push(function(){gu(u,n)})},r&&(n.directFetchListeners=null,f(r)),i&&(n.fetchListeners=null,f(i)),iu(n))}function nf(){var t=br,n,i;for(br=[],n=0,i=t.length;i>n;n++)t[n]()}function ec(n,t){var i=n.directFetchListeners,r;if(i){n.directFetchListeners=null;for(r in i)i[r].error(t);iu(n)}}function rr(n){return n.firstInSequence&&nu(n,tt),n.lastInSequence&&tr(n,tt),n.itemNew&&tu(n),yr(),n}function cs(n){if(!n.firstInSequence){var t=n.prev;return t===b?null:rr(t)}return rr(nu(n,tt))}function ls(n){if(!n.lastInSequence){var t=n.next;return t===w?null:rr(t)}return rr(tr(n,tt))}function de(n){return n?hs(n,"directFetchListeners",(ao++).toString()):h.wrap(null)}function tf(t){if("string"!=typeof t||!t)throw new u("WinJS.UI.ListDataSource.KeyIsInvalid",n.keyIsInvalid);}function as(n){var t=fe(ft);return gr(t,n),t.keyRequested=!0,t}function vs(n,t){tf(n);var i=ut[n];return i||(i=as(n),i.hints=t),rr(i)}function ys(t){var r,i;if("number"!=typeof t||0>t)throw new u("WinJS.UI.ListDataSource.IndexIsInvalid",n.indexIsInvalid);if(w.index<=t)return null;if(r=tt[t],!r){if(i=se(t,tt,b,w),!i)return null;i===w&&t>=w&&bi(w,void 0);r=i.prev.index===t-1?tr(i.prev,tt):i.index===t+1?nu(i,tt):fe(i,t)}return r.item||(r.indexRequested=!0),rr(r)}function ps(n){var t=fe(ft);return t.description=n,rr(t)}function ki(n){if(su=n,ou!==su){var i=function(){vf=!1;ou!==su&&(ou=su,fl.dispatchEvent(g,ou))};su===o.failure?i():vf||(vf=!0,t.setTimeout(i,40))}}function oc(n){var t=n.fetchID;return t&&wr[t]}function ge(n,t){n.fetchID=t}function rf(){var n=po;return po++,wr[n]=!0,n}function ci(n,t,i){var f=rf(),r,u;for(ge(n,f),r=n;!r.firstInSequence&&t>0;)r=r.prev,t--,ge(r,f);for(u=n;!u.lastInSequence&&i>0;)u=u.next,i--,ge(u,f);return f}function no(n){var t=n.items,r=n.offset,u=n.totalCount,i=n.absoluteIndex,f=n.atStart,e=n.atEnd,o;kt(i)&&(kt(u)&&(o=t.length,i-r+o===u&&(e=!0)),r===i&&(f=!0));f&&(t.unshift(kr),n.offset++);e&&t.push(er)}function uf(n,t,i){return delete wr[i],t!==st||oe(n)?(yr(),!1):!0}function vr(n,t,i,r){var f=st;i.then(function(i){if(!i.items||!i.items.length)return h.wrapError(new u(v.doesNotExist));var e="itemsFetched id="+t+" count="+i.items.length;hi(e);uf(n,f,t)&&(+r===r&&(i.absoluteIndex=r),no(i),oo(n,i.items,i.offset,i.totalCount,i.absoluteIndex));ni(e)}).then(null,function(i){uf(n,f,t)&&of(n,i)})}function ff(n,t,i,r){var f=st;r.then(function(r){if(!r.items||!r.items.length)return h.wrapError(new u(v.doesNotExist));var e="itemsFetched id="+i+" count="+r.items.length;hi(e);uf(t,f,i)&&(r.absoluteIndex=n,no(r),vc(n,t,r.items,r.offset,r.totalCount,r.absoluteIndex));ni(e)}).then(null,function(){uf(t,f,i)&&yc(n,t,f)})}function sc(n,t){var i=ci(n,0,t-1);si?vr(n,i,si(i,t),0):vr(n,i,pt(i,0,0,t-1),0)}function hc(n,t){var i=ci(n,t-1,0);vr(n,i,df(i,t))}function fu(n,t,i){var r=ci(n,t,i);vr(n,r,vt(r,n.key,t,i,n.hints))}function to(n,t,i){var u=n.index,r,o,f,s,e;if(t>u&&(t=u),pt)e=ci(n,t,i),vr(n,e,pt(e,u,t,i),u);else if(n.key)fu(n,t,i);else{for(f=b,s=u+1,r=n.prev;r!==b;r=r.prev)if(void 0!==r.index&&r.key){o=u-r.index;s>o&&(s=o,f=r);break}for(r=n.next;r!==w;r=r.next)if(void 0!==r.index&&r.key){o=r.index-u;s>o&&(s=o,f=r);break}if(f===b)e=ci(n,0,u+1),ff(0,n,e,si(e,u+1));else{var h=Math.max(f.index-u,0),c=Math.max(u-f.index,0),e=ci(f,h,c);ff(f.index,n,e,vt(e,f.key,h,c,n.hints))}}}function cc(n,t,i){var r=ci(n,t,i);vr(n,r,gf(r,n.description,t,i))}function lc(){var r;if(!ui){for(var i,t,u,s,e,h,f,c,l=!1,a=!1,n=b.next;n!==ft;){if(r=n.next,n!==w&&ku(n)&&(a=!0,i?t++:(i=n,t=1),oc(n)&&(l=!0),n.keyRequested&&!u&&(u=n,s=t-1),void 0===n.description||e||(e=n,h=t-1),n.indexRequested&&!f&&(f=n,c=t-1),n.lastInSequence||r===ft||!ku(r))){if(l)l=!1;else{if(vo=!1,!i.firstInSequence&&i.prev.key&&vt?fu(i.prev,0,t):!n.lastInSequence&&r.key&&vt?fu(r,t,0):i.prev!==b||i.firstInSequence||!si&&!pt?r===w&&!n.lastInSequence&&df?hc(n,t):u?fu(u,s,t-1-s):e?cc(e,h,t-1-h):f?to(f,c,t-1-c):"number"==typeof i.index?to(i,t-1,0):os(i):sc(i,t),vo)return void yr();if(ui)return}i=f=u=null}n=r}ki(a?o.waiting:o.ready)}}function yr(){yf||(yf=!0,c.schedule(function(){yf=!1;lc();wi()},c.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function ac(n){var t=n.itemNew,r,u;if(!t)return!1;r=n.item;for(u in r)switch(u){case"data":break;default:if(r[u]!==t[u])return!0}return i.compareByIdentity?r.data!==t.data:n.signature!==us(t)}function ws(n){ae(n)?ac(n)?ru(n):n.itemNew=null:n.item=null}function io(n){n.item?ws(n):uu(n)}function bs(n,t){n.key||gr(n,t.key);n.itemNew=t;io(n)}function di(n,t,i){var e=t.bindingMap,r,u,o,f,s;if(e)for(r in i)if(e[r]){u=t.fetchListeners;for(o in u)f=u[o],f.listBindingID===r&&f.retained&&(delete u[o],f.complete(null));s=e[r].bindingRecord;ir(s).removed(ei(t,r),!0,ei(n,r));t.bindingMap&&delete t.bindingMap[r]}}function eu(n,t){var o,f,e,u,i,r;n.index!==t.index&&(o=t.index,t.index=n.index,fs(t,o));t.slotMergedWith=n;f=t.bindingMap;for(e in f)n.bindingMap||(n.bindingMap={}),u=f[e],u.handle||(u.handle=t.handle),ii[u.handle]=n,n.bindingMap[e]=u;if(cr(function(i){i.adjustCurrentSlot(t,n)}),i=t.itemNew||t.item,i&&(i=Object.create(i),ce(i,n,n.handle),bs(n,i)),n.item)t.directFetchListeners&&br.push(function(){gu(n.item,t.directFetchListeners)}),t.fetchListeners&&br.push(function(){gu(n.item,t.fetchListeners)});else{for(r in t.directFetchListeners)n.directFetchListeners||(n.directFetchListeners={}),n.directFetchListeners[r]=t.directFetchListeners[r];for(r in t.fetchListeners)n.fetchListeners||(n.fetchListeners={}),n.fetchListeners[r]=t.fetchListeners[r]}n.itemNew&&uu(n);t.handle=(lo++).toString();pi(t);ee(t)}function ef(n,t,i){t&&t.key&&(i||(i=t.itemNew||t.item),delete t.key,delete ut[i.key],t.itemNew=null,t.item=null);i&&bs(n,i);t&&eu(n,t)}function ro(t){if("object"!=typeof t)throw new u("WinJS.UI.ListDataSource.InvalidItemReturned",n.invalidItemReturned);if(t===kr)return b;if(t===er)return w;if(t.key)return r.validation&&tf(t.key),ut[t.key];throw new u("WinJS.UI.ListDataSource.InvalidKeyReturned",n.invalidKeyReturned);}function uo(n,t){var i=ro(t);i===n&&(i=null);i&&di(n,i,n.bindingMap);ef(n,i,t)}function fo(n,t,i,r){var u,f;if(t&&n.key&&n.key!==t.key)return nt(),!1;if(u=tt[i],u)if(u===n)u=null;else{if(u.key&&(n.key||t&&u.key!==t.key))return nt(),!1;if(!n.key&&u.bindingMap)return!1}if(t)if(f=ut[t.key],f===n)f=null;else if(f&&f.bindingMap)return!1;return u?(di(n,u,n.bindingMap),delete tt[i],bi(n,i),n.prev.index===i-1&&lt(n.prev),n.next.index===i+1&&lt(n),r.slotNext=u.slotNext,t||(t=u.itemNew||u.item,t&&(f=ut[t.key]))):bi(n,i),f&&u!==f&&di(n,f,n.bindingMap),ef(n,f,t),u&&u!==f&&eu(n,u),!0}function ks(n,t,i){if(t.key&&n.key&&t.key!==n.key)return nt(),!1;for(var r in n.bindingMap)i[r]=!0;return di(n,t,i),ef(n,t),!0}function ds(n,t){for(var r,i={};n;){if(r=n.firstInSequence?null:n.prev,t.firstInSequence||t.prev!==b){if(t=t.firstInSequence?nu(t,tt):t.prev,!ks(t,n,i))return}else wt(n,!0);n=r}}function gs(n,t){for(var r,i={};n;){if(r=n.lastInSequence?null:n.next,t.lastInSequence||t.next!==w){if(t=t.lastInSequence?tr(t,tt):t.next,!ks(t,n,i))return}else wt(n,!0);n=r}}function nh(n){for(var t,i=0;i<n.length;i++)t=n[i],ds(t.slotBeforeSequence,t.slotFirstInSequence),gs(t.slotAfterSequence,t.slotLastInSequence)}function eo(n,t){function u(t){for(var u,i=w.prev;!(i.index<n)&&i!==t;)u=i.prev,void 0!==i.index&&wt(i,!0),i=u;r=0}for(var f,r=0,i=w.prev;!(i.index<n)||r>0;){if(f=i.prev,i===b){u(b);break}if(i.key){if(i.index>=n)return nt(),!1;if(!(i.index>=t))return vt?fu(i,0,r):to(i,0,r),!1;u(i)}else i.indexRequested||i.firstInSequence?u(f):r++;i=f}return!0}function oo(n,t,i,r,u){var f="WinJS.UI.ListDataSource.processResults";return hi(f),u=te(u),r=ie(r),gt?void ni(f):(fr&&ke(),!kt(r)&&r!==y.unknown||r===ht||w.firstInSequence?(vo=!0,function(){var e,o,f,c,v=t.length,l,y,a,k,g,rt,ut,d,p,h,s,ft,it,et;if("number"!=typeof u)for(e=0;v>e;e++)if(f=ro(t[e]),f&&void 0!==f.index){u=f.index+i-e;break}for("number"==typeof u&&t[v-1]===er?r=u-i+v-1:!kt(r)||void 0!==u&&null!==u||(u=r-(v-1)+i),kt(r)&&!eo(r,u-i)&&(r=void 0),l=new Array(v),e=0;v>e;e++){if(y=null,f=ro(t[e])){if(e>0&&!f.firstInSequence&&f.prev.key&&f.prev.key!==t[e-1].key||"number"==typeof u&&void 0!==f.index&&f.index!==u-i+e)return void nt();(f===b||f===w||f.bindingMap)&&(y=f)}if("number"==typeof u&&(f=tt[u-i+e])){if(f.key&&f.key!==t[e].key)return void nt();!y&&f.bindingMap&&(y=f)}if(e===i){if(n.key&&n.key!==t[e].key||"number"==typeof n.index&&"number"==typeof u&&n.index!==u)return void nt();y||(y=n)}l[e]=y}for(e=0;v>e;e++)f=l[e],f&&void 0!==f.index&&f!==b&&f!==w&&uo(f,t[e]);for(g=[],rt=!0,e=0;v>e;e++)if(f=l[e],f&&f!==w){if(ut=e,void 0===f.index){for(d={},fo(f,t[e],u-i+e,d),h=f,s=f,o=e-1;!h.firstInSequence&&(p=t[o],p!==kr);o--){if(ft=u-i+o,0>ft)break;if(!fo(h.prev,p,ft,d))break;h=h.prev;o>=0&&(l[o]=h)}for(o=e+1;!s.lastInSequence&&(p=t[o],p!==er&&o!==r||s.next===w)&&(s.next===w||fo(s.next,p,u-i+o,d))&&(s=s.next,v>o&&(l[o]=s),ut=o,s!==w);o++);if((a=h.firstInSequence?null:h.prev,k=s.lastInSequence?null:s.next,a&&pi(a),k&&pi(s),"number"==typeof u)?(s===w?a&&hr(w,pu(a),a):(it=d.slotNext,it||(it=se(s.index,tt,b,w,!0)),wu(it,h,s)),h.prev.index===h.index-1&&lt(h.prev),s.next.index===s.index+1&&lt(s)):rt||(c=l[e-1],c&&(h.prev!==c&&(s===w?(a&&hr(w,pu(a),a),wu(h,pu(c),c)):hr(c,h,s)),lt(c))),rt=!1,ri)return;g.push({slotBeforeSequence:a,slotFirstInSequence:h,slotLastInSequence:s,slotAfterSequence:k})}e!==i||f===n||oe(n)||(a=n.firstInSequence?null:n.prev,k=n.lastInSequence?null:n.next,di(f,n,f.bindingMap),eu(f,n),g.push({slotBeforeSequence:a,slotFirstInSequence:f,slotLastInSequence:f,slotAfterSequence:k}));e=ut}for(kt(r)&&w.index!==r&&bi(w,r),nh(g),e=0;v>e;e++)if(f=l[e]){for(o=e-1;o>=0;o--)et=l[o+1],uo(l[o]=et.firstInSequence?nu(l[o+1],tt):et.prev,t[o]);for(o=e+1;v>o;o++)c=l[o-1],f=l[o],f?f.firstInSequence&&(f.prev!==c&&hr(c,f,is(f)),lt(c)):uo(l[o]=c.lastInSequence?tr(c,tt):c.next,t[o]);break}delete n.description}(),ri||(void 0!==r&&r!==ht&&du(r),yr()),wi(),nf(),void ni(f)):(nt(),void ni(f)))}function of(n,t){switch(t.name){case v.noResponse:ki(o.failure);ec(n,t);break;case v.doesNotExist:n.indexRequested?eo(n.index):(n.keyRequested||n.description)&&os(n);wi();nt()}}function vc(n,t,i,r,f,e){var o,h,c,s;e=te(e);f=ie(f);o=n-r;h=i.length;t.index>=o&&t.index<o+h?oo(t,i,t.index-o,f,t.index):r===h-1&&n<t.index||kt(f)&&f<=t.index?of(t,new u(v.doesNotExist)):t.index<o?(s=ci(t,0,o-t.index),ff(o,t,s,vt(s,i[0].key,o-t.index,0))):(c=o+h-1,s=ci(t,t.index-c,0),ff(c,t,s,vt(s,i[h-1].key,0,t.index-c)))}function yc(n,t,i){switch(i.name){case v.doesNotExist:n===b.index?(eo(0),of(t,i)):nt();break;default:of(t,i)}}function pc(){for(var i,r,t=0;t<et.length&&"beginRefresh"!==et[t].kind;t++);for(i=t;i<et.length&&"beginRefresh"!==et[i].kind;i++);if(i>t&&i+(i-t)<et.length){for(var u=!0,f=i-t,r=0;f>r;r++)if(et[t+r].kind!==et[i+r].kind){u=!1;break}if(u&&e.log)for(e.log(n.refreshCycleIdentified,"winjs vds","error"),r=t;i>r;r++)e.log(""+(r-t)+": "+JSON.stringify(et[r]),"winjs vds","error");return u}}function th(){return++nc>k&&pc()?void ki(o.failure):(et[++sr%et.length]={kind:"beginRefresh"},bt={firstInSequence:!0,lastInSequence:!0,index:-1},at={firstInSequence:!0,lastInSequence:!0},bt.next=at,at.prev=bt,wo=!1,yt=void 0,wf={},nr={},ct={},ct[-1]=bt,void(dr={}))}function nt(){if(!ri){if(ri=!0,ki(o.waiting),lu)return lu=!1,void so();if(!gt){var n=++st;ui=!0;or=0;c.schedule(function(){var t,i;if(st===n){for(ri=!1,th(),t=b.next;t!==ft;)i=t.next,ve(t)||t===w||ye(t),t=i;eh()}},c.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function ih(){return yi=yi||new l,nt(),yi.promise}function rh(n,t){return delete wr[t],n!==st?!1:(or--,!0)}function ur(n,t,i,r,f){var e=st;or++;r.then(function(t){if(!t.items||!t.items.length)return h.wrapError(new u(v.doesNotExist));var r="itemsFetched id="+i+" count="+t.items.length;hi(r);rh(e,i)&&(no(t),dc(n,t.items,t.offset,t.totalCount,"number"==typeof f?f:t.absoluteIndex));ni(r)}).then(null,function(r){rh(e,i)&&gc(n,t,r)})}function wc(n,t,i,r){if(vt)ur(n.key,!1,t,vt(t,n.key,i,r,n.hints));else{var f=10,u=n.index;ct[u]&&ct[u].firstInSequence?ur(n.key,!1,t,pt(t,u-1,Math.min(i+f,u)-1,r+1+f),u-1):ct[u]&&ct[u].lastInSequence?ur(n.key,!1,t,pt(t,u+1,Math.min(i+f,u)+1,r-1+f),u+1):ur(n.key,!1,t,pt(t,u,Math.min(i+f,u),r+f),u)}}function bc(n){si?ur(null,!0,n,si(n,1),0):pt&&ur(null,!0,n,pt(n,0,0,0),0)}function uh(n){return wr[wf[n]]}function fh(n,t){for(var f,s,u,e,r,h=3,c=st,o=0,i=n;i!==ft;i=i.next)if(u||!i.key||dr[i.key]||uh(i.key)||(f=nr[i.key],(!f||f.firstInSequence||f.lastInSequence)&&(u=i,e=f,r=rf())),u){if(s=uh(i.key),dr[i.key]||nr[i.key]||s||(i.key&&(wf[i.key]=r),o++),i.lastInSequence||i.next===w||s){if(wc(u,r,!e||e.firstInSequence?h:0,o-1+h),!t)break;u=null;o=0}}else i.key&&ku(i)&&!dr[i.key]&&(nr[i.key]||(r=rf(),ur(i.key,!1,r,vt(r,i.key,1,1,i.hints))));0!==or||wo||st!==c||bc(rf())}function eh(){var n=st;do bo=!1,ko=!0,fh(b.next,!0),ko=!1;while(0===or&&bo&&st===n&&ui);0===or&&st===n&&ph()}function oh(n){var i=st,t;if(n){t=ut[n];t||(t=b.next);do bf=!1,kf=!0,fh(t,!1),kf=!1;while(bf&&st===i&&ui)}ko?bo=!0:0===or&&st===i&&eh()}function sh(t){if("object"==typeof t&&t){if(t===kr)return bt;if(t===er)return at;if(t.key)return nr[t.key];throw new u("WinJS.UI.ListDataSource.InvalidKeyReturned",n.invalidKeyReturned);}throw new u("WinJS.UI.ListDataSource.InvalidItemReturned",n.invalidItemReturned);}function hh(n,t){for(;void 0===n.index;){if(fi(n,t,ct),n.firstInSequence)return!0;n=n.prev;t--}return n.index!==t?(nt(),!1):!0}function ch(n,t){n.key=t.key;nr[n.key]=n;n.item=t}function kc(){for(var n=at;!n.firstInSequence;)if(n=n.prev,n===bt)return null;return n}function dc(n,t,i,r,u){var h,o,s,f,l,a,b,c,e,v,p,w;if(u=te(u),r=ie(r),h=!1,wo=!0,o=u-i,s=t[0],s.key===n&&(h=!0),f=sh(s),f){if(+o===o&&!hh(f,o))return}else{if(ct[o])return void nt();if(void 0!==u&&(l=ct[o-1])){if(!l.lastInSequence)return void nt();f=tr(l,ct)}else{if(a=+o===o?se(o,ct,bt,at):kc(bt,at),!a)return void nt();f=rs(a,o,ct)}ch(f,t[0])}for(b=t.length,c=1;b>c;c++){if(s=t[c],s.key===n&&(h=!0),e=sh(s),e){if(void 0!==f.index&&!hh(e,f.index+1))return;if(e!==f.next){if(!f.lastInSequence||!e.firstInSequence)return void nt();if(v=is(e),v!==at)hr(f,e,v);else{if(p=pu(f),p===bt)return void nt();wu(e,p,f)}lt(f)}else f.lastInSequence&&lt(f)}else{if(!f.lastInSequence)return void nt();e=tr(f,ct);ch(e,s)}f=e}if((h||(dr[n]=!0),kt(r)||at.firstInSequence)||(w=at.prev.index,void 0!==w&&(r=w+1)),kt(r)||r===y.unknown){if(kt(yt)){if(r!==yt)return void nt()}else yt=r;kt(yt)&&!ct[yt]&&fi(at,yt,ct)}kf?bf=!0:oh(n)}function gc(n,t,i){switch(i.name){case v.noResponse:ki(o.failure);break;case v.doesNotExist:t?(fi(at,0,ct),yt=0,ph()):(dr[n]=!0,kf?bf=!0:oh(n))}}function it(n){return n===bt?b:n===at?w:ut[n.key]}function li(n){return n===b?bt:n===w?at:nr[n.key]}function lh(n){lt(n);n.next.mergedForRefresh=!0}function ah(n,t){gr(t,n.key);t.itemNew=n.item}function nl(n,t,i){var r=re(),u;return ah(n,r),bu(r,t,i,!i),u=n.index,+u!==u&&(u=i?r.prev.index+1:t.next.index-1),fi(r,u,tt),r}function vh(n,t,i){n?(di(n,t,n.bindingMap),ef(n,t,i.item)):(ah(i,t),t.indexRequested&&io(t))}function sf(n,t,i){return t.key?!1:(n?(i.mergeWithPrev=!t.firstInSequence,i.mergeWithNext=!t.lastInSequence):i.stationary=!0,vh(n,t,i),!0)}function yh(n){var t,i;return n.indexRequested?t=n.index:(i=li(n),i&&(t=i.index)),t}function ph(){var i,st,n,c,k,y,t,d,rt,r,fi,ai,v,u,e,g,o,l,vr,vi,pr,vt,ei,iu,ki,bu,ru,fu,ou,h,wr,tf,oi,gt,ni,br,dr,ti,tr,si,a,hi,ci,ii,ir,hu,rr,ur,ot,ri,cu,lu,s,ff,kt,au,yu,f,pu,p,or,nu,cr,ef,ar,of;for(nc=0,et=new Array(100),sr=-1,fr=!0,wf={},o=[],l=[],v=0,t=bt;t;t=t.next)t.sequenceNumber=v,t.firstInSequence&&(h=t),t.lastInSequence&&(l[v]={first:h,last:t,matchingItems:0},v++);for(gi=null,vu=0,n=b.next;n!==ft;)t=nr[n.key],f=n.next,n!==w&&(ve(n)?n.key&&!t?wt(n,!1):0===yt||n.indexRequested&&n.index>=yt?wt(n,!0):n.item||n.keyRequested?n.itemNew=t.item:n.key&&(n.keyRequested||(delete ut[n.key],delete n.key),n.itemNew=null):ye(n)),n=f;for(n=b.next;n!==w;)f=n.next,n.indexRequested&&(t=ct[n.index],t&&vh(it(t),n,t)),n=f;for(iu=0,ki=[],rt=0,n=b;n!==ft;n=n.next){if(n.firstInSequence)for(h=n,pr=null,i=0;v>i;i++)ki[i]=0;if(n.indexRequested&&(pr=n),t=li(n),t&&ki[t.sequenceNumber]++,n.lastInSequence){for(vi=0,i=iu;v>i;i++)vi<ki[i]&&(vi=ki[i],vr=i);r={first:h,last:n,sequenceNew:vi>0?l[vr]:void 0,matchingItems:vi};pr&&(r.indexRequested=!0,r.stationarySlot=pr);o[rt]=r;n===w&&(vt=rt,ei=r);rt++;void 0!==l[vr].first.index&&(iu=vr)}}for(o[0].sequenceNew!==l[0]&&(pi(b),o[0].first=b.next,o.unshift({first:b,last:b,sequenceNew:l[0],matchingItems:1}),vt++,rt++),bu=!w.firstInSequence,ei.sequenceNew!==l[v-1]&&(pi(w.prev),ei.last=w.prev,vt++,o.splice(vt,0,{first:w,last:w,sequenceNew:l[v-1],matchingItems:1}),rt++,ei=o[vt]),i=0;rt>i;i++)u=o[i].sequenceNew,u&&u.matchingItems<o[i].matchingItems&&(u.matchingItems=o[i].matchingItems,u.sequenceOld=o[i]);for(l[v-1].sequenceOld=ei,ei.stationarySlot=w,l[0].sequenceOld=o[0],o[0].stationarySlot=b,i=0;vt>=i;i++)r=o[i],r.sequenceNew&&(ai=r.sequenceNew.sequenceOld)===fi&&fi.last!==w?(lh(ai.last),ai.last=r.last,delete o[i]):fi=r;for(fi=null,i=vt;i>=0;i--)r=o[i],r&&(r.sequenceNew&&(ai=r.sequenceNew.sequenceOld)===fi&&r.last!==w?(lh(r.last),ai.first=r.first,delete o[i]):fi=r);for(bu&&delete w.mergedForRefresh,ru=[],i=vt+1;rt>i;i++)if(r=o[i],r&&(!r.sequenceNew||r.sequenceNew.sequenceOld!==r)){var gu=!0,nt=null,dt=null,uu=0;for(t=li(r.first),t&&(nt=dt=t,uu=1),n=r.first;n!==r.last;n=n.next){if(ot=li(n.next),t&&ot&&(t.lastInSequence||t.next!==ot)){gu=!1;break}t&&!nt&&(nt=dt=t);ot&&nt&&(dt=ot,uu++);t=ot}if(gu&&nt&&void 0!==nt.index&&(nt.firstInSequence||(k=it(nt.prev),k&&(fu=k.index)),dt.lastInSequence||(y=it(dt.next),y&&(ou=y.index)),(!y||y.lastInSequence||y.mergedForRefresh)&&(void 0===fu||void 0===ou||ou-fu-1>=uu))){for(r.locationJustDetermined=!0,t=nt;t.locationJustDetermined=!0,t!==dt;t=t.next);h=it(nt);wr=it(dt);ru.push({slotBeforeSequence:h.firstInSequence?null:h.prev,slotFirstInSequence:h,slotLastInSequence:wr,slotAfterSequence:wr.lastInSequence?null:wr.next})}}for(i=0;rt>i;i++)if(r=o[i],!(!r||r.indexRequested||r.locationJustDetermined||r.sequenceNew&&r.sequenceNew.sequenceOld===r)){r.sequenceNew=null;n=r.first;do{if(tf=n===r.last,f=n.next,n!==b&&n!==w&&n!==ft&&!n.item&&!n.keyRequested)if(wt(n,!0),r.first===n){if(r.last===n){delete o[i];break}r.first=n.next}else r.last===n&&(r.last=n.prev);n=f}while(!tf)}for(i=0;v>i;i++){for(u=l[i],t=u.first;!it(t)&&!t.lastInSequence;t=t.next);if(t.lastInSequence&&!it(t))u.firstInner=u.lastInner=null;else{for(u.firstInner=t,t=u.last;!it(t);t=t.prev);u.lastInner=t}}for(i=0;v>i;i++)if(u=l[i],u&&u.firstInner&&(r=u.sequenceOld)){for(oi=0,n=r.first;!0&&(t=li(n),t&&t.sequenceNumber===u.firstInner.sequenceNumber&&(t.ordinal=oi),!n.lastInSequence);n=n.next,oi++);for(gt=[],t=u.firstInner;;t=t.next){if(oi=t.ordinal,void 0!==oi){for(ni=0,br=gt.length-1;br>=ni;)dr=Math.floor(.5*(ni+br)),gt[dr].ordinal<oi?ni=dr+1:br=dr-1;gt[ni]=t;ni>0&&(t.predecessor=gt[ni-1])}if(t===u.lastInner)break}for(ti=[],tr=gt.length,t=gt[tr-1],st=tr;st--;)t.stationary=!0,ti[st]=t,t=t.predecessor;for(r.stationarySlot=it(ti[0]),t=ti[0],n=it(t),c=n.prev,si=n.firstInSequence;!t.firstInSequence;)if(t=t.prev,d=it(t),!d||t.locationJustDetermined)for(;!si&&c!==b&&(n=c,c=n.prev,si=n.firstInSequence,!sf(d,n,t)););for(st=0;tr-1>st;st++){t=ti[st];n=it(t);var d,su=ti[st+1],gr=null,pt=it(su);for(f=n.next,t=t.next;t!==su&&!gr&&n!==pt;t=t.next)if(d=it(t),!d||t.locationJustDetermined)for(;f!==pt;){if(f.mergedForRefresh){gr=t.prev;break}if(n=f,f=n.next,sf(d,n,t))break}if(gr)for(c=pt.prev,t=su.prev;t!==gr&&pt!==n;t=t.prev)if(d=it(t),!d||t.locationJustDetermined)for(;c!==n&&(pt=c,c=pt.prev,!sf(d,pt,t)););for(;f!==pt;)n=f,f=n.next,n!==b&&ku(n)&&!n.keyRequested&&wt(n)}for(t=ti[tr-1],n=it(t),f=n.next,si=n.lastInSequence;!t.lastInSequence;)if(t=t.next,d=it(t),!d||t.locationJustDetermined)for(;!si&&f!==w&&(n=f,f=n.next,si=n.lastInSequence,!sf(d,n,t)););}for(i=0;v>i;i++)if(u=l[i],u.firstInner)for(c=null,t=u.firstInner;;t=t.next){if(n=it(t)){if(!t.stationary){if(hi=!1,ci=!1,c)a=c.next,hi=!0;else{for(ii=u.firstInner;!ii.stationary&&ii!==u.lastInner;ii=ii.next);if(ii.stationary)a=it(ii),ci=!0;else if(e=t.index,0===e)a=b.next,hi=!0;else if(void 0===e)a=ft;else{for(a=b.next,ir=null;;){if(a.firstInSequence&&(ir=a),e<a.index&&ir||a===w)break;a=a.next}!a.firstInSequence&&ir&&(a=ir)}}n.mergedForRefresh&&(delete n.mergedForRefresh,n.lastInSequence||(n.next.mergedForRefresh=!0));hi=hi||t.mergeWithPrev;ci=ci||t.mergeWithNext;hu=t.locationJustDetermined;lr(n,a,hi,ci,hu);hu&&ci&&(a.mergedForRefresh=!0)}c=n}if(t===u.lastInner)break}for(i=0;v>i;i++)if(u=l[i],u.firstInner)for(c=null,t=u.firstInner;;t=t.next){if(n=it(t),!n){if(c)rr=c.next;else{for(ur=u.firstInner;!it(ur);ur=ur.next);rr=it(ur)}n=nl(t,rr,!!c);ot=li(rr);rr.mergedForRefresh||ot&&ot.locationJustDetermined||(tu(n),be(n))}if(c=n,t===u.lastInner)break}for(tt=[],ri=-1,n=b,g=0;n!==ft;g++){if(f=n.next,(n.firstInSequence&&(h=n,g=0),void 0===ri)&&(cu=yh(n),void 0!==cu&&(ri=cu-g)),void 0!==ri&&!n.lastInSequence&&(lu=yh(n.next),void 0!==lu&&lu!==ri+g+1)){pi(n);for(var rf=!0,p=n.next,uf=!1;!uf&&p!==w;)or=p.next,uf=p.lastInSequence,lr(p,or,!rf,!1),rf=!1,p=or}if(n.lastInSequence){for(e=ri,s=h;s!==f;)ff=s.next,e>=yt&&s!==w?wt(s,!0):(kt=tt[e],e!==s.index?(delete tt[e],bi(s,e)):+e===e&&tt[e]!==s&&(tt[e]=s),s.itemNew&&io(s),kt&&(s.key?(di(s,kt,s.bindingMap),eu(s,kt),+e===e&&(tt[e]=s)):(di(kt,s,kt.bindingMap),eu(kt,s),+e===e&&(tt[e]=kt))),+e===e&&e++),s=ff;ri=void 0}n=f}for(yu=-2,n=b,g=0;n!==ft;g++){if(f=n.next,n.firstInSequence&&(h=n,g=0),delete n.mergedForRefresh,n.lastInSequence)if(void 0===h.index)k=h.prev,k&&(pu=li(k))&&!pu.lastInSequence&&(t=li(n))&&t.prev===pu?(hr(k,h,n),lt(k)):n===w||au||wu(ft,h,n);else{if(yu<n.index&&!au)yu=n.index;else{for(y=b.next;y.index<n.index;y=y.next);for(p=h;p!==f;)or=p.next,t=li(p),lr(p,y,y.prev.index===p.index-1,y.index===p.index+1,t&&t.locationJustDetermined),p=or}k=h.prev;k&&k.index===h.index-1&&lt(k)}n===w&&(au=!0);n=f}for(fr=!1,nh(ru),void 0!==yt&&yt!==ht&&du(yt),wi(),nu=[],i=0;v>i;i++){for(u=l[i],cr=[],n=null,g=0,t=u.first;!0&&(t===bt?cr.push(kr):t===at?cr.push(er):(cr.push(t.item),n||(n=it(t),ef=g)),!t.lastInSequence);t=t.next,g++);n&&nu.push({slot:n,results:cr,offset:ef})}for(th(),ui=!1,nf(),i=0;i<nu.length;i++)ar=nu[i],oo(ar.slot,ar.results,ar.offset,ht,ar.slot.index);yi&&(of=yi,yi=null,of.complete());yr()}function hf(n,t,i,r,u,f,e){var s=rt.prev,o={prev:s,next:rt,applyEdit:n,editType:t,complete:i,error:r,keyUpdate:u};s.next=o;rt.prev=o;gt=!0;(ri||ui)&&(st++,ui=!1,ri=!0);rt.next===o&&so();o.failed||(f(),o.undo=e);vi||ho()}function wh(){cu=!1;var n=rt.next.next;rt.next=n;n.prev=rt}function tl(){for(;rt.prev!==rt;){var n=rt.prev;n.error&&n.error(new u(p.canceled));n.undo&&!ri&&n.undo();rt.prev=n.prev}rt.next=rt;vi=!1;ho()}function il(n){function u(){lu||(r?yo=!0:so())}function f(i){var f,e,o;i&&(t&&t.key!==i.key?(e=i.key,n.undo?(f=t.slot)&&(o=f.key,o&&delete ut[o],gr(f,e),f.itemNew=i,f.item?(ru(f),wi()):uu(f)):t.key=e):n.editType===yu.change&&(f.itemNew=i,r||ws(f)));wh();n.complete&&n.complete(i);u()}function e(t){switch(t.Name){case p.noResponse:return ki(o.failure),lu=!0,void(cu=!1);case p.noLongerMeaningful:nt()}n.failed=!0;wh();tl();n.error&&n.error(t);u()}if(!cu){var r=!0,t=n.keyUpdate;i.beginEdits&&!hu&&(hu=!0,i.beginEdits());cu=!0;n.applyEdit().then(f,e);r=!1}}function so(){for(;rt.next!==rt;)if(yo=!1,il(rt.next),!yo)return;bh()}function ho(){ke();wi();nf();rt.next===rt&&bh()}function bh(){gt=!1;i.endEdits&&hu&&!vi&&(hu=!1,i.endEdits());ri?(ri=!1,nt()):yr()}function ai(n){return tf(n),ut[n]||as(n)}function co(n,t,i,r,u){var f=re();return bu(f,i,r,u),n&&gr(f,n),f.itemNew=t,dt(f,1),vi||au||(f.firstInSequence||"number"!=typeof f.prev.index?f.lastInSequence||"number"!=typeof f.next.index||fi(f,f.next.index-1,tt):fi(f,f.prev.index+1,tt)),tu(f),be(f),f}function cf(n,t,i,r,u){var f={key:n};return new h(function(n,e){hf(u,yu.insert,n,e,f,function(){if(i){var n={key:f.key,data:t};f.slot=co(f.key,n,i,r,!r)}},function(){var n=f.slot;n&&(dt(n,-1),wt(n,!1))})})}function lf(n,t,i,r){return new h(function(u,f){var h,e,o,s;hf(r,yu.move,u,f,null,function(){e=n.next;o=n.firstInSequence;s=n.lastInSequence;var r=n.prev;h=!("number"==typeof n.index||!o&&r.item||!s&&e.item);dt(n,-1);lr(n,t,i,!i);dt(n,1);h&&(pi(r),o||ds(r,n),s||gs(e,n))},function(){h?nt():(dt(n,-1),lr(n,e,!o,!s),dt(n,1))})})}function rl(){function n(){au||(ke(),wi(),nf())}this.invalidateAll=function(){return 0===ht?(this.reload(),h.wrap()):ih()};this.reload=function(){var n,i,r,t;for(ot&&ot.cancel(),yi&&yi.cancel(),n=b.next;n!==ft;n=n.next){i=n.fetchListeners;for(t in i)i[t].promise.cancel();r=n.directFetchListeners;for(t in r)r[t].promise.cancel()}kh();cr(function(n){n.notificationHandler&&n.notificationHandler.reload()})};this.beginNotifications=function(){au=!0};this.inserted=function(t,i,r,u){if(gt)nt();else{var o=t.key,e=ut[i],f=ut[r],s="string"==typeof i,h="string"==typeof r;if((s?f&&!f.firstInSequence&&(e=f.prev):h&&e&&!e.lastInSequence&&(f=e.next),(s||h)&&!e&&!f&&b.next===w)||ut[o]||e&&f&&(e.next!==f||e.lastInSequence||f.firstInSequence)||e&&(e.keyRequested||e.indexRequested)||f&&(f.keyRequested||f.indexRequested))return void nt();if(e||f)co(o,t,f?f:e.next,!!e,!!f);else if(b.next===w)co(o,t,b.next,!0,!0);else{if(void 0===u)return void nt();ar(u,1)}n()}};this.changed=function(t){if(gt)nt();else{var r=t.key,i=ut[r];i&&(i.keyRequested?nt():(i.itemNew=t,i.item&&(ru(i),n())))}};this.moved=function(t,i,r,u,f){if(gt)nt();else{var h=t.key,s=ut[h],o=ut[i],e=ut[r];s&&s.keyRequested||o&&o.keyRequested||e&&e.keyRequested?nt():s?o&&e&&(o.next!==e||o.lastInSequence||e.firstInSequence)?nt():o||e?(dt(s,-1),lr(s,e?e:o.next,!!o,!!e),dt(s,1),n()):(dt(s,-1),wt(s,!1),void 0!==u&&(f>u&&f--,ar(f,1)),n()):o||e?(void 0!==u&&(ar(u,-1),f>u&&f--),this.inserted(t,i,r,f)):void 0!==u&&(ar(u,-1),f>u&&f--,ar(f,1),n())}};this.removed=function(t,i){if(gt)nt();else{var r;r="string"==typeof t?ut[t]:tt[i];r?r.keyRequested?nt():(dt(r,-1),wt(r,!1),n()):void 0!==i&&(ar(i,-1),n())}};this.endNotifications=function(){au=!1;n()}}function kh(){ki(o.ready);ot=null;hu=!1;vi=!1;cu=!1;rt={};rt.next=rt;rt.prev=rt;gt=!1;lu=!1;pr=0;fr=!1;ul=0;wr={};br=[];ht=y.unknown;b={firstInSequence:!0,lastInSequence:!0,index:-1};w={firstInSequence:!0,lastInSequence:!0};ft={firstInSequence:!0,lastInSequence:!0};b.next=w;w.prev=b;w.next=ft;ft.prev=w;ii={};ut={};tt={};tt[-1]=b;vu=0;gi=null;pf=!1;ri=!1;ui=!1;yi=null}var dh,af,ou,su,vf,ti,gh,lo,ao,ot,vo,hu,vi,cu,rt,gt,yo,lu,au,pr,fr,ul,st,yf,po,wr,br,kr,er,ht,b,w,ft,ii,ut,tt,vu,gi,pf,ri,ui,yi,or,wo,yt,bt,at,wf,nr,ct,dr,bo,ko,bf,kf,vt,pt,si,df,gf,nc=0,et=new Array(100),sr=-1,ic;i.itemsFromKey&&(vt=function(n,t,r,u,f){var e="fetchItemsFromKey id="+n+" key="+t+" countBefore="+r+" countAfter="+u,o;return hi(e),et[++sr%et.length]={kind:"itemsFromKey",key:t,countBefore:r,countAfter:u},o=i.itemsFromKey(t,r,u,f),ni(e),o});i.itemsFromIndex&&(pt=function(n,t,r,u){var f="fetchItemsFromIndex id="+n+" index="+t+" countBefore="+r+" countAfter="+u,e;return hi(f),et[++sr%et.length]={kind:"itemsFromIndex",index:t,countBefore:r,countAfter:u},e=i.itemsFromIndex(t,r,u),ni(f),e});i.itemsFromStart&&(si=function(n,t){var r="fetchItemsFromStart id="+n+" count="+t,u;return hi(r),et[++sr%et.length]={kind:"itemsFromStart",count:t},u=i.itemsFromStart(t),ni(r),u});i.itemsFromEnd&&(df=function(n,t){var r="fetchItemsFromEnd id="+n+" count="+t,u;return hi(r),et[++sr%et.length]={kind:"itemsFromEnd",count:t},u=i.itemsFromEnd(t),ni(r),u});i.itemsFromDescription&&(gf=function(n,t,r,u){var f="fetchItemsFromDescription id="+n+" desc="+t+" countBefore="+r+" countAfter="+u,e;return hi(f),et[++sr%et.length]={kind:"itemsFromDescription",description:t,countBefore:r,countAfter:u},e=i.itemsFromDescription(t,r,u),ni(f),e});var tc=++d,fl=this,yu={insert:"insert",change:"change",move:"move",remove:"remove"};if(!i)throw new u("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",n.listDataAdapterIsInvalid);af=i.compareByIdentity?0:200;f&&"number"==typeof f.cacheSize&&(af=f.cacheSize);i.setNotificationHandler&&(dh=new rl,i.setNotificationHandler(dh));ou=o.ready;vf=!1;ti={};gh=0;lo=1;ao=0;st=0;yf=!1;po=1;kr={};er={};kh();this.createListBinding=function(n){function l(n){n&&n.cursorCount++}function e(n){n&&0==--n.cursorCount&&iu(n)}function o(n){l(n);e(t);t=n}function a(n,i){n===t&&(i||(i=!t||t.lastInSequence||t.next===w?null:t.next),o(i))}function s(n){var r=n.bindingMap,t=r[i].handle,u,f,e;delete n.bindingMap[i];u=!0;f=!0;for(e in r)if(u=!1,t&&r[e].handle===t){f=!1;break}t&&f&&delete ii[t];u&&(n.bindingMap=null,iu(n))}function v(n,t){var r,u;n.bindingMap||(n.bindingMap={});r=n.bindingMap[i];(r?r.count++:n.bindingMap[i]={bindingRecord:ti[i],count:1},n.fetchListeners)&&(u=n.fetchListeners[t],u&&(u.retained=!0))}function y(n){var t=ii[n],f,r,e,u;if(t&&(f=t.bindingMap[i],0==--f.count)){r=t.fetchListeners;for(e in r)u=r[e],u.listBindingID===i&&(u.retained=!1);s(t)}}function c(t){var f=ei(t,i),e=(ao++).toString(),r=hs(t,"fetchListeners",e,i,function(n,t){n(we(t,f))});return ce(r,t,f),n&&(r.retain=function(){return u._retainItem(t,e),r},r.release=function(){u._releaseItem(f)}),r}function r(t){var i;return!f&&t?i=c(t):(f?(i=new h(function(){}),i.cancel()):i=h.wrap(null),he(i,null),n&&(i.retain=function(){return i},i.release=function(){})),o(t),i}var i=(gh++).toString(),t=null,f=!1,u;return ti[i]={notificationHandler:n,notificationsSent:!1,adjustCurrentSlot:a,itemPromiseFromKnownSlot:c},u={_retainItem:function(n,t){v(n,t)},_releaseItem:function(n){y(n)},jumpToItem:function(n){return r(n?ii[n.handle]:null)},current:function(){return r(t)},previous:function(){return r(t?cs(t):null)},next:function(){return r(t?ls(t):null)},releaseItem:function(n){this._releaseItem(n.handle)},release:function(){var n,h,r,u,o;for(f=!0,e(t),t=null,n=b.next;n!==ft;){h=n.next;r=n.fetchListeners;for(u in r)o=r[u],o.listBindingID===i&&(o.promise.cancel(),delete r[u]);n.bindingMap&&n.bindingMap[i]&&s(n);n=h}delete ti[i]}},(si||pt)&&(u.first=function(){return r(ls(b))}),df&&(u.last=function(){return r(cs(w))}),vt&&(u.fromKey=function(n,t){return r(vs(n,t))}),(pt||si&&vt)&&(u.fromIndex=function(n){return r(ys(n))}),gf&&(u.fromDescription=function(n){return r(ps(n))}),u};this.invalidateAll=function(){return ih()};ic=function(n,t){var i=new l;n.then(function(n){i.complete(n)},function(n){i.error(n)});var e=i.promise.then(null,function(i){return"WinJS.UI.VirtualizedDataSource.resetCount"===i.name?(ot=null,n=t.getCount()):h.wrapError(i)}),f=0,r={get:function(){return f++,new h(function(n,t){e.then(n,t)},function(){0==--f&&(i.promise.cancel(),n.cancel(),r===ot&&(ot=null))})},reset:function(){i.error(new u("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){i.promise.cancel();n.cancel();r===ot&&(ot=null)}};return r};this.getCount=function(){if(i.getCount){var t=this;return h.wrap().then(function(){var n,r,u;return vi||gt?ht:(ot||(n=i.getCount(),n.then(function(){ot===r&&(ot=null);u=!0},function(){ot===r&&(ot=null);u=!0}),pr=0,u||(r=ot=ic(n,t))),ot?ot.get():n)}).then(function(t){if(!ne(t)&&void 0!==t)throw new u("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",n.invalidRequestedCountReturned);return t!==ht&&(ht===y.unknown?ht=t:(du(t),wi())),0===t&&(b.next!==w||w.next!==ft?nt():b.lastInSequence&&(lt(b),w.index=0)),t}).then(null,function(n){return n.name===a.CountError.noResponse?(ki(o.failure),ht):h.wrapError(n)})}return h.wrap(ht)};vt&&(this.itemFromKey=function(n,t){return de(vs(n,t))});(pt||si&&vt)&&(this.itemFromIndex=function(n){return de(ys(n))});gf&&(this.itemFromDescription=function(n){return de(ps(n))});this.beginEdits=function(){vi=!0};i.insertAtStart&&(this.insertAtStart=function(n,t){return cf(n,t,b.lastInSequence?null:b.next,!0,function(){return i.insertAtStart(n,t)})});i.insertBefore&&(this.insertBefore=function(n,t,r){var u=ai(r);return cf(n,t,u,!1,function(){return i.insertBefore(n,t,r,oi(u))})});i.insertAfter&&(this.insertAfter=function(n,t,r){var u=ai(r);return cf(n,t,u?u.next:null,!0,function(){return i.insertAfter(n,t,r,oi(u))})});i.insertAtEnd&&(this.insertAtEnd=function(n,t){return cf(n,t,w.firstInSequence?null:w,!1,function(){return i.insertAtEnd(n,t)})});i.change&&(this.change=function(n,t){var r=ai(n);return new h(function(u,f){var e;hf(function(){return i.change(n,t,oi(r))},yu.change,u,f,null,function(){e=r.item;r.itemNew={key:n,data:t};e?ru(r):uu(r)},function(){e?(r.itemNew=e,ru(r)):nt()})})});i.moveToStart&&(this.moveToStart=function(n){var t=ai(n);return lf(t,b.next,!0,function(){return i.moveToStart(n,oi(t))})});i.moveBefore&&(this.moveBefore=function(n,t){var r=ai(n),u=ai(t);return lf(r,u,!1,function(){return i.moveBefore(n,t,oi(r),oi(u))})});i.moveAfter&&(this.moveAfter=function(n,t){var r=ai(n),u=ai(t);return lf(r,u.next,!0,function(){return i.moveAfter(n,t,oi(r),oi(u))})});i.moveToEnd&&(this.moveToEnd=function(n){var t=ai(n);return lf(t,w,!1,function(){return i.moveToEnd(n,oi(t))})});i.remove&&(this.remove=function(n){tf(n);var t=ut[n];return new h(function(r,u){var f,e,o;hf(function(){return i.remove(n,oi(t))},yu.remove,r,u,null,function(){t&&(f=t.next,e=t.firstInSequence,o=t.lastInSequence,dt(t,-1),wt(t,!1))},function(){t&&(rc(t,f,!e,!o),dt(t,1),be(t))})})});this.endEdits=function(){vi=!1;ho()}}var k=100,d=1,o=a.DataSourceStatus,y=a.CountResult,v=a.FetchError,p=a.EditError,n={get listDataAdapterIsInvalid(){return"Invalid argument: listDataAdapter must be an object or an array."},get indexIsInvalid(){return"Invalid argument: index must be a non-negative integer."},get keyIsInvalid(){return"Invalid argument: key must be a string."},get invalidItemReturned(){return"Error: data adapter returned item that is not an object."},get invalidKeyReturned(){return"Error: data adapter returned item with undefined or null key."},get invalidIndexReturned(){return"Error: data adapter should return undefined, null or a non-negative integer for the index."},get invalidCountReturned(){return"Error: data adapter should return undefined, null, CountResult.unknown, or a non-negative integer for the count."},get invalidRequestedCountReturned(){return"Error: data adapter should return CountResult.unknown, CountResult.failure, or a non-negative integer for the count."},get refreshCycleIdentified(){return"refresh cycle found, likely data inconsistency"}},g="statuschanged",w=i.Class.define(function(){},{_baseDataSourceConstructor:b,_isVirtualizedDataSource:!0},{supportedForProcessing:!1});return i.Class.mix(w,f.eventMixin),w})})});t("WinJS/VirtualizedDataSource/_GroupDataSource",["exports","../Core/_Base","../Core/_ErrorFromName","../Promise","../Scheduler","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(n,t,i,r,u,f,e){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_GroupDataSource:t.Namespace._lazy(function(){function o(){return new i(f.FetchError.doesNotExist)}function n(n){return n&&n.firstReached&&n.lastReached}var s=101,h=t.Class.define(function(n){this._groupDataAdapter=n},{beginNotifications:function(){},inserted:function(n,t,i){this._groupDataAdapter._inserted(n,t,i)},changed:function(n,t){this._groupDataAdapter._changed(n,t)},moved:function(n,t,i){this._groupDataAdapter._moved(n,t,i)},removed:function(n,t){this._groupDataAdapter._removed(n,t)},countChanged:function(n,t){0===n&&0!==t&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(n,t,i){this._groupDataAdapter._indexChanged(n,t,i)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),c=t.Class.define(function(n,t,i,r){this._listBinding=n.createListBinding(new h(this));this._groupKey=t;this._groupData=i;this._initializeState();this._batchSize=s;this._count=null;r&&("number"==typeof r.groupCountEstimate&&(this._count=r.groupCountEstimate<0?null:Math.max(r.groupCountEstimate,1)),"number"==typeof r.batchSize&&(this._batchSize=r.batchSize+1));this._listBinding.last&&(this.itemsFromEnd=function(n){var t=this;return this._fetchItems(function(){return t._lastGroup},function(n){if(n)return!1;var i=t._count;return+i!==i?!0:i>0?!0:void 0},function(){t._fetchBatch(t._listBinding.last(),t._batchSize-1,0)},n-1,0)})},{setNotificationHandler:function(n){this._listDataNotificationHandler=n},compareByIdentity:!0,itemsFromKey:function(n,t,i,r){var u=this;return this._fetchItems(function(){return u._keyMap[n]},function(){var n=u._lastGroup;return n?+n.index!==n.index?!0:void 0:!0},function(){r=r||{};var t="string"==typeof r.groupMemberKey&&u._listBinding.fromKey?u._listBinding.fromKey(r.groupMemberKey):"number"==typeof r.groupMemberIndex&&u._listBinding.fromIndex?u._listBinding.fromIndex(r.groupMemberIndex):void 0!==r.groupMemberDescription&&u._listBinding.fromDescription?u._listBinding.fromDescription(r.groupMemberDescription):u._listBinding.first(),n=Math.floor(.5*(u._batchSize-1));u._fetchBatch(t,n,u._batchSize-1-n)},t,i)},itemsFromIndex:function(n,t,i){var r=this;return this._fetchItems(function(){return r._indexMap[n]},function(){var t=r._lastGroup;return t?+t.index!==t.index?!0:n<=t.index?!0:void 0:!0},function(){r._fetchNextIndex()},t,i)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return r.wrap(this._count);var n=this,t=new r(function(t){var i={initialBatch:function(){n._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(i){i&&(n._count=0);var r=n._count;return"number"==typeof r?(t(r),!0):!1}};n._fetchQueue.push(i);n._itemBatch||n._continueFetch(i)});return"number"==typeof this._count?r.wrap(this._count):t},invalidateGroups:function(){this._beginRefresh();this._initializeState()},_initializeState:function(){this._count=null;this._indexMax=null;this._keyMap={};this._indexMap={};this._lastGroup=null;this._handleMap={};this._fetchQueue=[];this._itemBatch=null;this._itemsToFetch=0;this._indicesChanged=!1},_releaseItem:function(n){delete this._handleMap[n.handle];this._listBinding.releaseItem(n)},_processBatch:function(){for(var t,o,r,i,f,e,v,l=null,n=null,h=null,c=0,a=!0,s=0;s<this._batchSize;s++){if(t=this._itemBatch[s],o=t?this._groupKey(t):null,t&&(a=!1),n&&null!==o&&o===n.key)c++,n.lastItem===l?(n.lastItem.handle!==n.firstItem.handle&&this._releaseItem(n.lastItem),n.lastItem=t,this._handleMap[t.handle]=n,n.size++):n.firstItem===t&&(n.firstItem.handle!==n.lastItem.handle&&this._releaseItem(n.firstItem),n.firstItem=h,this._handleMap[h.handle]=n,n.size+=c);else if(r=null,n&&(n.lastReached=!0,"number"==typeof n.index&&(r=n.index+1)),t){if(i=this._keyMap[o],i||(i={key:o,data:this._groupData(t),firstItem:t,lastItem:t,size:1},this._keyMap[i.key]=i,this._handleMap[t.handle]=i),s>0&&(i.firstReached=!0,n||(r=0)),"number"!=typeof i.index&&"number"==typeof r){for(f=i;f;f=this._nextGroup(f))f.index=r,this._indexMap[r]=f,r++;this._indexMax=r;"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}h=t;c=0;n=i}else n&&(this._lastGroup=n,"number"==typeof n.index&&(this._count=n.index+1),this._listDataNotificationHandler.invalidateAll(),n=null);l=t}for(e=this._fetchQueue[0];e&&e.complete(a);e=this._fetchQueue[0])this._fetchQueue.splice(0,1);e?(v=this,u.schedule(function(){v._continueFetch(e)},u.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")):this._itemBatch=null},_processPromise:function(n,t){n.retain();this._itemBatch[t]=n;var i=this;n.then(function(n){i._itemBatch[t]=n;0==--i._itemsToFetch&&i._processBatch()})},_fetchBatch:function(n,t){this._itemBatch=new Array(this._batchSize);this._itemsToFetch=this._batchSize;this._processPromise(n,t);var i;for(this._listBinding.jumpToItem(n),i=t-1;i>=0;i--)this._processPromise(this._listBinding.previous(),i);for(this._listBinding.jumpToItem(n),i=t+1;i<this._batchSize;i++)this._processPromise(this._listBinding.next(),i)},_fetchAdjacent:function(n,t){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(n.key):this._listBinding.fromIndex(n.index),t?0:this._batchSize-1,t?this._batchSize-1:0)},_fetchNextIndex:function(){var n=this._indexMap[this._indexMax-1];n?this._fetchAdjacent(n.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(t){var i,r,u;t.initialBatch?(t.initialBatch(),t.initialBatch=null):(i=t.getGroup(),i?i.firstReached?i.lastReached?t.countBefore>0&&0!==i.index&&!n(r=this._previousGroup(i))?this._fetchAdjacent(r&&r.lastReached?r.firstItem:i.firstItem,!1):(u=this._nextGroup(i),this._fetchAdjacent(u&&u.firstReached?u.lastItem:i.lastItem,!0)):this._fetchAdjacent(i.lastItem,!0):this._fetchAdjacent(i.firstItem,!1):this._fetchNextIndex())},_fetchComplete:function(t,i,r,u,e){var s,h,c,o,a,v,p,w,l;if(n(t)&&(s=this._previousGroup(t),(u||n(s)||0===t.index||0===i)&&(h=this._nextGroup(t),u||n(h)||this._lastGroup===t||0===r))){for(c=0,o=t;i>c&&(s=this._previousGroup(o),n(s));)o=s,c++;for(a=0,v=t;r>a&&(h=this._nextGroup(v),n(h));)v=h,a++;for(var b=c+1+a,k=new Array(b),y=0;b>y;y++)p={key:o.key,data:o.data,firstItemKey:o.firstItem.key,groupSize:o.size},w=o.firstItem.index,"number"==typeof w&&(p.firstItemIndexHint=w),k[y]=p,o=this._nextGroup(o);return l={items:k,offset:c},l.totalCount="number"==typeof this._count?this._count:f.CountResult.unknown,"number"==typeof t.index&&(l.absoluteIndex=t.index),v===this._lastGroup&&(l.atEnd=!0),e(l),!0}return!1},_fetchItems:function(n,t,i,u,f){var e=this;return new r(function(r,s){function a(i){var l=n();return l?e._fetchComplete(l,u,f,h,r,s):h&&!t(i)?(s(o()),!0):c>2?(s(o()),!0):(i?c++:c=0,!1)}var v=n(),h=!v,c=0,l;a()||(l={initialBatch:h?i:null,getGroup:n,countBefore:u,countAfter:f,complete:a},e._fetchQueue.push(l),e._itemBatch||e._continueFetch(l))})},_previousGroup:function(n){return n&&n.firstReached?(this._listBinding.jumpToItem(n.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(n){return n&&n.lastReached?(this._listBinding.jumpToItem(n.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(n){this._count=null;this._lastGroup=null;"number"==typeof n.index&&(this._indexMax=n.index>0?n.index:null);for(var t=n;t&&"number"==typeof t.index;t=this._nextGroup(t))delete this._indexMap[t.index],t.index=null},_releaseGroup:function(n){this._invalidateIndices(n);delete this._keyMap[n.key];this._lastGroup===n&&(this._lastGroup=null);n.firstItem!==n.lastItem&&this._releaseItem(n.firstItem);this._releaseItem(n.lastItem)},_beginRefresh:function(){var t,n;if(this._fetchQueue=[],this._itemBatch){for(t=0;t<this._batchSize;t++)n=this._itemBatch[t],n&&(n.cancel&&n.cancel(),this._listBinding.releaseItem(n));this._itemBatch=null}this._itemsToFetch=0;this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(n,t,i){var r=this._handleMap[t],u=this._handleMap[i],f=null;r&&(r.lastReached&&t===r.lastItem.handle&&(f=this._groupKey(n))!==r.key?this._lastGroup===r&&(this._lastGroup=null,this._count=null):this._releaseGroup(r),this._beginRefresh());u&&u!==r&&(this._invalidateIndices(u),u.firstReached&&i===u.firstItem.handle&&(null!==f?f:this._groupKey(n))!==u.key||this._releaseGroup(u),this._beginRefresh())},_processRemoval:function(n){var t=this._handleMap[n],i,r;if(t&&(n===t.firstItem.handle||n===t.lastItem.handle))this._releaseGroup(t),this._beginRefresh();else if(this._itemBatch)for(i=0;i<this._batchSize;i++)if(r=this._itemBatch[i],r&&r.handle===n){this._beginRefresh();break}},_inserted:function(n,t,i){var r=this;n.then(function(n){r._processInsertion(n,t,i)})},_changed:function(n,t){var i=this._handleMap[n.handle],r,u;(i&&n.handle===i.firstItem.handle&&(this._releaseGroup(i),this._beginRefresh()),this._groupKey(n)!==this._groupKey(t))&&(this._listBinding.jumpToItem(n),r=this._listBinding.previous().handle,this._listBinding.jumpToItem(n),u=this._listBinding.next().handle,this._processRemoval(n.handle),this._processInsertion(n,r,u))},_moved:function(n,t,i){this._processRemoval(n.handle);var r=this;n.then(function(n){r._processInsertion(n,t,i)})},_removed:function(n,t){t||this._processRemoval(n)},_indexChanged:function(n,t,i){"number"==typeof i&&(this._indicesChanged=!0)},_endNotifications:function(){var i,n,t;if(this._indicesChanged){this._indicesChanged=!1;for(i in this._keyMap)n=this._keyMap[i],n.firstReached&&n.lastReached&&(t=n.lastItem.index+1-n.firstItem.index,isNaN(t)||(n.size=t));this._beginRefresh()}},_reload:function(){this._initializeState();this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return t.Class.derive(e.VirtualizedDataSource,function(n,t,i,r){var u=new c(n,t,i,r);this._baseDataSourceConstructor(u);this.extensions={invalidateGroups:function(){u.invalidateGroups()}}},{},{supportedForProcessing:!1})})})});t("WinJS/VirtualizedDataSource/_GroupedItemDataSource",["../Core/_Base","./_GroupDataSource"],function(n,t){"use strict";n.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(n,i,r,u){function s(n){if(n){var t=Object.create(n);return t.groupKey=i(n),r&&(t.groupData=r(n)),t}return null}function f(n){var t=Object.create(n);return t.then=function(t,i,r){return n.then(function(n){return t(s(n))},i,r)},t}var e=Object.create(n),o;e.createListBinding=function(t){var r;t?(r=Object.create(t),r.inserted=function(n,i,r){return t.inserted(f(n),i,r)},r.changed=function(n,i){return t.changed(s(n),s(i))},r.moved=function(n,i,r){return t.moved(f(n),i,r)}):r=null;for(var i=n.createListBinding(r),u=Object.create(i),o=["first","last","fromDescription","jumpToItem","current"],e=0,h=o.length;h>e;e++)!function(n){i[n]&&(u[n]=function(){return f(i[n].apply(i,arguments))})}(o[e]);return i.fromKey&&(u.fromKey=function(n){return f(i.fromKey(n))}),i.fromIndex&&(u.fromIndex=function(n){return f(i.fromIndex(n))}),u.prev=function(){return f(i.prev())},u.next=function(){return f(i.next())},u};for(var c=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],h=0,l=c.length;l>h;h++)!function(t){n[t]&&(e[t]=function(){return f(n[t].apply(n,arguments))})}(c[h]);return["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){n[t]&&(e[t]=function(){return n[t].apply(n,arguments)})}),o=null,Object.defineProperty(e,"groups",{get:function(){return o||(o=new t._GroupDataSource(n,i,r,u)),o},enumerable:!0,configurable:!0}),e}})});t("WinJS/VirtualizedDataSource/_StorageDataSource",["exports","../Core/_WinRT","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_WriteProfilerMark","../Animations","../Promise","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(n,t,i,r,u,f,e,o,s,h){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{StorageDataSource:r.Namespace._lazy(function(){var n=r.Class.define(function(n,i){var o;f("WinJS.UI.StorageDataSource:constructor,StartTM");var e,u=t.Windows.Storage.FileProperties.ThumbnailMode.singleItem,r=256,s=t.Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,h=!0;if(("Pictures"===n?(u=t.Windows.Storage.FileProperties.ThumbnailMode.picturesView,e=t.Windows.Storage.KnownFolders.picturesLibrary,r=190):"Music"===n?(u=t.Windows.Storage.FileProperties.ThumbnailMode.musicView,e=t.Windows.Storage.KnownFolders.musicLibrary,r=256):"Documents"===n?(u=t.Windows.Storage.FileProperties.ThumbnailMode.documentsView,e=t.Windows.Storage.KnownFolders.documentsLibrary,r=40):"Videos"===n&&(u=t.Windows.Storage.FileProperties.ThumbnailMode.videosView,e=t.Windows.Storage.KnownFolders.videosLibrary,r=190),e)?(o=new t.Windows.Storage.Search.QueryOptions,o.folderDepth=t.Windows.Storage.Search.FolderDepth.deep,o.indexerOption=t.Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=e.createFileQueryWithOptions(o)):this._query=n,i){if("number"==typeof i.mode&&(u=i.mode),"number"==typeof i.requestedThumbnailSize)r=Math.max(1,Math.min(i.requestedThumbnailSize,1024));else switch(u){case t.Windows.Storage.FileProperties.ThumbnailMode.picturesView:case t.Windows.Storage.FileProperties.ThumbnailMode.videosView:r=190;break;case t.Windows.Storage.FileProperties.ThumbnailMode.documentsView:case t.Windows.Storage.FileProperties.ThumbnailMode.listView:r=40;break;case t.Windows.Storage.FileProperties.ThumbnailMode.musicView:case t.Windows.Storage.FileProperties.ThumbnailMode.singleItem:r=256}"number"==typeof i.thumbnailOptions&&(s=i.thumbnailOptions);"boolean"==typeof i.waitForFileLoad&&(h=!i.waitForFileLoad)}this._loader=new t.Windows.Storage.BulkAccess.FileInformationFactory(this._query,u,r,s,h);this.compareByIdentity=!1;this.firstDataRequest=!0;f("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(n){this._notificationHandler=n;this._query.addEventListener("contentschanged",function(){n.invalidateAll()});this._query.addEventListener("optionschanged",function(){n.invalidateAll()})},itemsFromEnd:function(n){var t=this;return f("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(i){return 0===i?o.wrapError(new u(s.FetchError.doesNotExist)):t.itemsFromIndex(i-1,Math.min(i-1,n-1),1)})},itemsFromIndex:function(n,t,i){function l(n){e._notificationHandler.changed(e._item(n.target))}var c;t+i>64&&(t=Math.min(t,32),i=64-(t+1));var h=n-t,r=t+1+i,e=this;return e.firstDataRequest&&(e.firstDataRequest=!1,r=Math.max(r,32)),c="WinJS.UI.StorageDataSource:itemsFromIndex("+h+"-"+(h+r-1)+")",f(c+",StartTM"),this._loader.getItemsAsync(h,r).then(function(i){var a=i.size,p,y,v,w;if(t>=a)return o.wrapError(new u(s.FetchError.doesNotExist));for(p=new Array(a),y=new Array(a),i.getMany(0,y),v=0;a>v;v++)p[v]=e._item(y[v]),y[v].addEventListener("propertiesupdated",l);return w={items:p,offset:t,absoluteIndex:n},r>a&&(w.totalCount=h+a),f(c+",StopTM"),w})},itemsFromDescription:function(n,t,i){var r=this;return f("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(n).then(function(n){return r.itemsFromIndex(n,t,i)})},getCount:function(){return f("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(n){return n.folderRelativeId},_item:function(n){return{key:n.path||n.folderRelativeId,data:n}}},{supportedForProcessing:!1});return r.Class.derive(h.VirtualizedDataSource,function(t,i){this._baseDataSourceConstructor(new n(t,i))},{},{loadThumbnail:function(n,r){var s,u,h=!1;return new o(function(c){var a=r?!0:!1,l=function(l){if(l){var v=i.URL.createObjectURL(l,{oneTimeOnly:!0});u=u?u.then(function(t){return n.loadImage(v,t)}):n.loadImage(v,r).then(function(t){return n.isOnScreen().then(function(n){var i;return n&&a?i=e.fadeIn(t).then(function(){return t}):(t.style.opacity=1,i=o.wrap(t)),i})});l.type===t.Windows.Storage.FileProperties.ThumbnailType.icon||l.returnedSmallerCachedSize||(f("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),n.data.removeEventListener("thumbnailupdated",s),h=!1,u=u.then(function(n){s=null;u=null;c(n)}))}};s=function(n){h&&l(n.target.thumbnail)};n.data.addEventListener("thumbnailupdated",s);h=!0;l(n.data.thumbnail)},function(){n.data.removeEventListener("thumbnailupdated",s);h=!1;s=null;u&&(u.cancel(),u=null)})},supportedForProcessing:!1})})})});t("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_VirtualizedDataSourceImpl","./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource","./VirtualizedDataSource/_StorageDataSource"],function(){});t("require-style",{load:function(n){throw new Error("Dynamic load not allowed: "+n);}});t("require-style!less/styles-intrinsic",[],function(){});t("require-style!less/colors-intrinsic",[],function(){});t("WinJS/Controls/IntrinsicControls",["../Utilities/_Hoverable","require-style!less/styles-intrinsic","require-style!less/colors-intrinsic"],function(){});t("WinJS/Controls/ItemContainer/_Constants",["exports","../../Core/_Base"],function(n,t){"use strict";var i={},r,u;i._listViewClass="win-listview";i._listViewSupportsCrossSlideClass="win-listview-supports-cross-slide";i._viewportClass="win-viewport";i._rtlListViewClass="win-rtl";i._horizontalClass="win-horizontal";i._verticalClass="win-vertical";i._scrollableClass="win-surface";i._itemsContainerClass="win-itemscontainer";i._padderClass="win-itemscontainer-padder";i._proxyClass="_win-proxy";i._itemClass="win-item";i._itemBoxClass="win-itembox";i._itemsBlockClass="win-itemsblock";i._containerClass="win-container";i._containerEvenClass="win-container-even";i._containerOddClass="win-container-odd";i._backdropClass="win-backdrop";i._footprintClass="win-footprint";i._groupsClass="win-groups";i._selectedClass="win-selected";i._swipeableClass="win-swipeable";i._swipeClass="win-swipe";i._selectionBorderClass="win-selectionborder";i._selectionBackgroundClass="win-selectionbackground";i._selectionCheckmarkClass="win-selectioncheckmark";i._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground";i._pressedClass="win-pressed";i._headerClass="win-groupheader";i._headerContainerClass="win-groupheadercontainer";i._groupLeaderClass="win-groupleader";i._progressClass="win-progress";i._selectionHintClass="win-selectionhint";i._revealedClass="win-revealed";i._itemFocusClass="win-focused";i._itemFocusOutlineClass="win-focusedoutline";i._zoomingXClass="win-zooming-x";i._zoomingYClass="win-zooming-y";i._listLayoutClass="win-listlayout";i._gridLayoutClass="win-gridlayout";i._headerPositionTopClass="win-headerpositiontop";i._headerPositionLeftClass="win-headerpositionleft";i._structuralNodesClass="win-structuralnodes";i._uniformGridLayoutClass="win-uniformgridlayout";i._uniformListLayoutClass="win-uniformlistlayout";i._cellSpanningGridLayoutClass="win-cellspanninggridlayout";i._laidOutClass="win-laidout";i._nonDraggableClass="win-nondraggable";i._nonSelectableClass="win-nonselectable";i._nonSwipeableClass="win-nonswipeable";i._dragOverClass="win-dragover";i._dragSourceClass="win-dragsource";i._clipClass="win-clip";i._selectionModeClass="win-selectionmode";i._noCSSGrid="win-nocssgrid";i._INVALID_INDEX=-1;i._UNINITIALIZED=-1;i._LEFT_MSPOINTER_BUTTON=0;i._RIGHT_MSPOINTER_BUTTON=2;i._TAP_END_THRESHOLD=10;i._DEFAULT_PAGES_TO_LOAD=5;i._DEFAULT_PAGE_LOAD_THRESHOLD=2;i._MIN_AUTOSCROLL_RATE=150;i._MAX_AUTOSCROLL_RATE=1500;i._AUTOSCROLL_THRESHOLD=100;i._AUTOSCROLL_DELAY=50;i._DEFERRED_ACTION=250;i._DEFERRED_SCROLL_END=250;i._VERTICAL_SWIPE_SELECTION_THRESHOLD=39;i._VERTICAL_SWIPE_SPEED_BUMP_START=0;i._VERTICAL_SWIPE_SPEED_BUMP_END=127;i._VERTICAL_SWIPE_SELF_REVEAL_GESTURE=15;i._HORIZONTAL_SWIPE_SELECTION_THRESHOLD=27;i._HORIZONTAL_SWIPE_SPEED_BUMP_START=0;i._HORIZONTAL_SWIPE_SPEED_BUMP_END=150;i._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE=23;i._SELECTION_CHECKMARK="";i._LISTVIEW_PROGRESS_DELAY=2e3;r={uninitialized:0,low:1,medium:2,high:3};u={rebuild:0,remeasure:1,relayout:2,realize:3};i._ScrollToPriority=r;i._ViewChange=u;t.Namespace._moduleDefine(n,"WinJS.UI",i)});t("WinJS/Controls/ItemContainer/_ItemEventsHandler",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function b(n){var t=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return{x:n.x/t,y:n.y/t,z:n.z/t}}function p(n,t){var i=b(t),r=Math.cos(n),u=Math.sin(n),f=[r+i.x*i.x*(1-r),i.x*i.y*(1-r)-i.z*u,i.x*i.z*(1-r)+i.y*u,0,i.y*i.x*(1-r)+i.z*u,r+i.y*i.y*(1-r),i.y*i.z*(1-r)-i.x*u,0,i.z*i.x*(1-r)-i.y*u,i.z*i.y*(1-r)+i.x*u,r+i.z*i.z*(1-r),0,0,0,0,1];return f=f.map(function(n){return n.toFixed(8)}),"matrix3d("+f.join(",")+")"}function w(n,t,i){var r=h._clamp((n-i.left)/i.width,0,1),u=h._clamp((t-i.top)/i.height,0,1),o={x:u-.5,y:-(r-.5),z:.0001},f=Math.abs(r-.5)+Math.abs(u-.5),s=f*k,e=1-(1-f)*d;return"perspective(800px) scale("+e+", "+e+") "+p(s,o)}var y=u._browserStyleEquivalents.transform,k=.15,d=.025,v=h._uniqueID,a=h._MSManipulationEvent;r.Namespace._moduleDefine(n,"WinJS.UI",{_rotationTransform3d:p,_tiltTransform:w,_ItemEventsHandler:r.Namespace._lazy(function(){function p(n,t){return n.querySelector("."+t)}function b(n,i){var r=t.document.createElement("div");return r.className=n,i||r.setAttribute("aria-hidden",!0),r}var k=h._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",n=r.Class.define(function(n){if(this._site=n,this._work=[],this._animations={},this._selectionHintTracker={},this._swipeClassTracker={},!u.isPhone&&this._selectionAllowed()){var i=this;t.setTimeout(function(){i._gestureRecognizer||n.isZombie()||(i._gestureRecognizer=i._createGestureRecognizer())},500)}},{dispose:function(){this._disposed||(this._disposed=!0,this._gestureRecognizer=null,h._removeEventListener(t,"pointerup",this._resetPointerDownStateBound),h._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound))},onMSManipulationStateChanged:function(n){var t=n.currentState,r,i;t!==a.MS_MANIPULATION_STATE_PRESELECT||this._site.pressedItemBox||(r=this._site.indexForItemElement(n.target),(this._site.pressedEntity={type:c.ObjectType.item,index:r},this._site.pressedEntity.index!==l._INVALID_INDEX)&&(this._site.pressedItemBox=this._site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=this._site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=u.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null,i=this._site.verifySelectionAllowed(this._site.pressedEntity),this._canSelect=i.canSelect,this._canTapSelect=i.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._canSelect&&this._addSelectionHint()));this._canSelect&&(t===a.MS_MANIPULATION_STATE_PRESELECT||t===a.MS_MANIPULATION_STATE_COMMITTED||t===a.MS_MANIPULATION_STATE_CANCELLED||t===a.MS_MANIPULATION_STATE_SELECTING||t===a.MS_MANIPULATION_STATE_DRAGGING)&&this._dispatchSwipeBehavior(t);(t===a.MS_MANIPULATION_STATE_COMMITTED||t===a.MS_MANIPULATION_STATE_CANCELLED||t===a.MS_MANIPULATION_STATE_STOPPED)&&this.resetPointerDownState()},onPointerDown:function(n){var v,o,r,e,p,s,y;f("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");r=this._site;e=n.pointerType===k;(r.pressedElement=n.target,i.Windows.UI.Input.PointerPoint)?(p=this._getCurrentPoint(n),s=p.properties,e||s.isInverted||s.isEraser||s.isMiddleButtonPressed?v=o=!1:(o=s.isRightButtonPressed,v=!o&&s.isLeftButtonPressed)):(v=n.button===l._LEFT_MSPOINTER_BUTTON,o=n.button===l._RIGHT_MSPOINTER_BUTTON);this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this);this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this);this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this);this._swipeBehaviorState=a.MS_MANIPULATION_STATE_STOPPED;var g=r.swipeBehavior===c.SwipeBehavior.select,w=this._isInteractive(n.target),b=r.indexForItemElement(n.target),d=r.indexForHeaderElement(n.target),nt=!w&&b!==l._INVALID_INDEX;if((e||v||this._selectionAllowed()&&g&&o)&&this._site.pressedEntity.index===l._INVALID_INDEX&&!w&&(this._site.pressedEntity=d===l._INVALID_INDEX?{type:c.ObjectType.item,index:b}:{type:c.ObjectType.groupHeader,index:d},this._site.pressedEntity.index!==l._INVALID_INDEX)&&(this._site.pressedPosition=h._getCursorPos(n),y=r.verifySelectionAllowed(this._site.pressedEntity),this._canSelect=y.canSelect,this._canTapSelect=y.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._site.pressedEntity.type!==c.ObjectType.groupHeader?(this._site.pressedItemBox=r.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=r.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=u.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,!1,n),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),e||(h._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),h._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(n.target),u.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,!1,n)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),e||(h._addEventListener(t,"pointerup",this._resetPointerDownStateBound,!1),h._addEventListener(t,"pointercancel",this._resetPointerDownStateBound,!1)),this._canSelect&&!u.isPhone&&(this._gestureRecognizer||(this._gestureRecognizer=this._createGestureRecognizer()),this._addSelectionHint()),this._pointerId=n.pointerId,this._pointerRightButton=o,this._pointerTriggeredSRG=!1,this._gestureRecognizer&&e))try{this._gestureRecognizer.addPointer(this._pointerId)}catch(tt){this._gestureRecognizer.stop()}if(nt&&e)try{h._setPointerCapture(r.canvasProxy,n.pointerId)}catch(tt){return void f("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type!==c.ObjectType.groupHeader&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==l._INVALID_INDEX&&r.selection._getFocused().index!==l._INVALID_INDEX&&r.selection._pivot===l._INVALID_INDEX&&(r.selection._pivot=r.selection._getFocused().index);f("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(n){this._site.pressedContainer&&this._pointerId===n.pointerId&&this._togglePressed(!0,!1,n)},onPointerLeave:function(n){this._site.pressedContainer&&this._pointerId===n.pointerId&&this._togglePressed(!1,!0,n)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),h._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),h._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(n){var t,i;this._skipClick||(t={type:c.ObjectType.item,index:this._site.indexForItemElement(n.target)},(t.index===l._INVALID_INDEX&&(t.index=this._site.indexForHeaderElement(n.target),t.index!==l._INVALID_INDEX&&(t.type=c.ObjectType.groupHeader)),t.index!==l._INVALID_INDEX&&(h.hasClass(n.target,this._site.accessibleItemClass)||h.hasClass(n.target,l._headerClass)))&&(i=this._site.verifySelectionAllowed(t),i.canTapSelect&&this.handleTap(t),this._site.fireInvokeEvent(t,n.target)))},onPointerUp:function(n){var t,o,s,i,e,p;f("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");t=this._site;this._skipClick=!0;o=this;s=this._site.swipeBehavior===c.SwipeBehavior.select;u._yieldForEvents(function(){o._skipClick=!1});try{h._releasePointerCapture(t.canvasProxy,n.pointerId)}catch(nt){}var v=n.pointerType===k,r=this._releasedElement(n),w=t.indexForItemElement(r),y=t.indexForHeaderElement(r&&h.hasClass(r,l._headerContainerClass)?t.pressedHeader:r);if(this._pointerId===n.pointerId){if(i=y===l._INVALID_INDEX?{type:c.ObjectType.item,index:w}:{type:c.ObjectType.groupHeader,index:y},this._resetPressedContainer(),this._site.pressedEntity.type!==c.ObjectType.groupHeader&&i.type!==c.ObjectType.groupHeader&&this._site.pressedContainer&&this._site.pressedEntity.index===i.index)if(n.shiftKey||(t.selection._pivot=l._INVALID_INDEX),n.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&t.selection._pivot!==l._INVALID_INDEX){var b=Math.min(this._site.pressedEntity.index,t.selection._pivot),d=Math.max(this._site.pressedEntity.index,t.selection._pivot),g=this._pointerRightButton||n.ctrlKey||t.tapBehavior===c.TapBehavior.toggleSelect;t.selectRange(b,d,g)}}else(n.ctrlKey||this._selectionAllowed()&&s&&this._pointerRightButton)&&this.handleSwipeBehavior(this._site.pressedEntity.index);(this._site.pressedHeader||this._site.pressedContainer)&&this._swipeBehaviorState!==a.MS_MANIPULATION_STATE_COMMITTED&&(e=h._getCursorPos(n),p=Math.abs(e.left-this._site.pressedPosition.left)<=l._TAP_END_THRESHOLD&&Math.abs(e.top-this._site.pressedPosition.top)<=l._TAP_END_THRESHOLD,this._endSelfRevealGesture(),this._clearItem(this._site.pressedEntity,this._isSelected(this._site.pressedEntity.index)),this._pointerRightButton||this._pointerTriggeredSRG||n.ctrlKey||n.shiftKey||!(v&&p||!v&&this._site.pressedEntity.index===i.index&&this._site.pressedEntity.type===i.type)||(i.type===c.ObjectType.groupHeader?(this._site.pressedHeader=t.headerAtIndex(i.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=t.itemBoxAtIndex(i.index),this._site.pressedContainer=t.containerAtIndex(i.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader)));this._site.pressedEntity.index!==l._INVALID_INDEX&&t.changeFocus(this._site.pressedEntity,!0,!1,!0);this.resetPointerDownState()}f("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(n){this._pointerId===n.pointerId&&this._swipeBehaviorState!==a.MS_MANIPULATION_STATE_PRESELECT&&(f("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(n){this._pointerId===n.pointerId&&this._swipeBehaviorState!==a.MS_MANIPULATION_STATE_PRESELECT&&(f("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(n){var t=this._site.containerFromElement(n.target);this._selectionAllowed()&&t&&!this._isInteractive(n.target)&&n.preventDefault()},onMSHoldVisual:function(n){this._isInteractive(n.target)||n.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},handleSwipeBehavior:function(n){this._selectionAllowed(n)&&this._toggleItemSelection(n)},handleTap:function(n){if(n.type!==c.ObjectType.groupHeader){var t=this._site,i=t.selection;this._selectionAllowed(n.index)&&this._selectOnTap()&&(t.tapBehavior===c.TapBehavior.toggleSelect?this._toggleItemSelection(n.index):t.selectionMode!==c.SelectionMode.multi&&i._isIncluded(n.index)||i.set(n.index))}},_toggleItemSelection:function(n){var i=this._site,t=i.selection,r=t._isIncluded(n);i.selectionMode===c.SelectionMode.single?r?t.clear():t.set(n):r?t.remove(n):t.add(n)},_getCurrentPoint:function(n){return i.Windows.UI.Input.PointerPoint.getCurrentPoint(n.pointerId)},_containedInElementWithClass:function(n,t){if(n.parentNode)for(var r=n.parentNode.querySelectorAll("."+t+", ."+t+" *"),i=0,u=r.length;u>i;i++)if(r[i]===n)return!0;return!1},_isSelected:function(n){return!this._swipeBehaviorSelectionChanged&&this._site.selection._isIncluded(n)||this._swipeBehaviorSelectionChanged&&this.swipeBehaviorSelected},_isInteractive:function(n){return this._containedInElementWithClass(n,"win-interactive")},_togglePressed:function(n,t,i){function k(n){""===r._site.animatedElement.style[y.scriptName]?(r._site.animatedElement.style[y.scriptName]=n,r._site.animatedElementScaleTransform=r._site.animatedElement.style[y.scriptName]):r._site.animatedElementScaleTransform=""}function d(n,t){f("WinJS.UI._ItemEventsHandler:removePressedUI,info");h.removeClass(n,l._pressedClass);u.isPhone?r._containsTransform(n,t)&&o.executeTransition(n,{property:y.cssName,delay:0,duration:500,timing:"cubic-bezier(0.7025,0,0.9225,-0.115)",to:n.style[y.scriptName].replace(t,"")}):r._removeTransform(n,t)}var r=this,v=this._site.pressedEntity.type===c.ObjectType.groupHeader,g,nt,e,p,a,b;(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),u.isPhone&&!v&&h.hasClass(this._site.pressedItemBox,l._nonSelectableClass)||this._staticMode(v))||(n?h.hasClass(this._site.animatedElement,l._pressedClass)||((f("WinJS.UI._ItemEventsHandler:applyPressedUI,info"),h.addClass(this._site.animatedElement,l._pressedClass),i&&u.isPhone)?(g=v?r._site.pressedHeader:r._site.pressedContainer,nt=w(i.clientX,i.clientY,g.getBoundingClientRect()),this._site.animatedDownPromise=s.timeout(50).then(function(){k(nt)})):(e=.975,p=7,this._site.getItemPosition(this._site.pressedEntity).then(function(n){n.contentWidth>0&&(e=Math.max(e,1-p/n.contentWidth));n.contentHeight>0&&(e=Math.max(e,1-p/n.contentHeight))},function(){}),k("scale("+e+","+e+")"))):h.hasClass(this._site.animatedElement,l._pressedClass)&&(a=this._site.animatedElement,b=this._site.animatedElementScaleTransform,t?d(a,b):u._setImmediate(function(){h.hasClass(a,l._pressedClass)&&d(a,b)})))},_containsTransform:function(n,t){return t&&-1!==n.style[y.scriptName].indexOf(t)},_removeTransform:function(n,t){this._containsTransform(n,t)&&(n.style[y.scriptName]=n.style[y.scriptName].replace(t,""))},_endSwipeBehavior:function(){var t,i,r,u,n;if((this._swipeBehaviorState===a.MS_MANIPULATION_STATE_PRESELECT||this._swipeBehaviorState===a.MS_MANIPULATION_STATE_SELECTING||this._swipeBehaviorState===a.MS_MANIPULATION_STATE_DRAGGING||this._swipeBehaviorState===a.MS_MANIPULATION_STATE_COMMITTED||this._swipeBehaviorState===a.MS_MANIPULATION_STATE_CANCELLED)&&this._site.pressedEntity.type!==c.ObjectType.groupHeader&&(this._flushUIBatches(),t=this._selectionHint,this._selectionHint=null,this._site.pressedItemBox)){if(i=this._site.pressedEntity.index,r=this._site.selection._isIncluded(i),r)for(u=h._getElementsByClasses(this._site.pressedItemBox,[l._selectionCheckmarkClass,l._selectionCheckmarkBackgroundClass]),n=0;n<u.length;n++)u[n].style.opacity=1;this._clearItem(this._site.pressedEntity,r);t&&this._removeSelectionHint(t);delete this._animations[i]}},_createGestureRecognizer:function(){var t=this._site.eventHandlerRoot,i=h._createGestureRecognizer(),n;return i.target=t,n=this,t.addEventListener("MSGestureHold",function(t){-1!==n._site.pressedEntity.index&&t.detail===h._MSGestureEvent.MSGESTURE_FLAG_BEGIN&&n._startSelfRevealGesture()}),i},_dispatchSwipeBehavior:function(n){var t;if(this._site.pressedEntity.type!==c.ObjectType.groupHeader&&this._site.swipeBehavior===c.SwipeBehavior.select){if((this._site.selection._pivot=l._INVALID_INDEX,this._site.pressedItemBox)&&(t=this._site.pressedEntity.index,this._swipeBehaviorState!==n))if(n===a.MS_MANIPULATION_STATE_DRAGGING&&this._canSelect)this._animateSelectionChange(this._site.selection._isIncluded(t)),this._removeSelectionHint(this._selectionHint);else if(n===a.MS_MANIPULATION_STATE_PRESELECT){f("WinJS.UI._ItemEventsHandler:crossSlidingStarted,info");var r=this._site,e=r.itemAtIndex(t),o=r.selection._isIncluded(t);this._selfRevealGesture?(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null):this._canSelect&&this._prepareItem(this._site.pressedEntity,e,o);this._swipeBehaviorState!==a.MS_MANIPULATION_STATE_SELECTING?(this._site.animatedElement&&h.hasClass(this._site.animatedElement,l._pressedClass)&&(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),h.removeClass(this._site.animatedElement,l._pressedClass),this._removeTransform(this._site.animatedElement,this._site.animatedElementScaleTransform)),this._showSelectionHintCheckmark()):this._animateSelectionChange(this._site.selection._isIncluded(t))}else if(n===a.MS_MANIPULATION_STATE_COMMITTED){f("WinJS.UI._ItemEventsHandler:crossSlidingCompleted,info");var r=this._site,i=r.selection,s=this._swipeBehaviorSelectionChanged,u=this.swipeBehaviorSelected;this._swipeBehaviorState===a.MS_MANIPULATION_STATE_SELECTING&&s&&this._selectionAllowed()&&r.swipeBehavior===c.SwipeBehavior.select&&(r.selectionMode===c.SelectionMode.single?u?i.set(t):i._isIncluded(t)&&i.remove(t):u?i.add(t):i._isIncluded(t)&&i.remove(t));this._endSwipeBehavior()}else n===a.MS_MANIPULATION_STATE_SELECTING&&this._canSelect?this._animateSelectionChange(!this._site.selection._isIncluded(t)):this._swipeBehaviorState===a.MS_MANIPULATION_STATE_SELECTING&&this._canSelect&&this._animateSelectionChange(this._site.selection._isIncluded(t),n===a.MS_MANIPULATION_STATE_CANCELLED);this._swipeBehaviorState=n}},_resetPointerDownStateForPointerId:function(n){this._pointerId===n.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._gestureRecognizer&&(this._endSelfRevealGesture(),this._endSwipeBehavior());this._site.pressedElement=null;h._removeEventListener(t,"pointerup",this._resetPointerDownStateBound);h._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound);this._resetPressedContainer();this._site.pressedContainer=null;this._site.animatedElement=null;this._site.pressedHeader=null;this._site.pressedItemBox=null;this._removeSelectionHint(this._selectionHint);this._selectionHint=null;this._site.pressedEntity={type:c.ObjectType.item,index:l._INVALID_INDEX};this._pointerId=null},_startSelfRevealGesture:function(){if(this._canSelect&&this._site.swipeBehavior===c.SwipeBehavior.select){f("WinJS.UI._ItemEventsHandler:playSelfRevealGesture,info");var n=this,t=this._site,r=this._site.pressedEntity.index,i=t.itemBoxAtIndex(r),a=t.selection._isIncluded(r),u=!1,v=function(){var n,r;return t.horizontal?(n=l._VERTICAL_SWIPE_SELF_REVEAL_GESTURE+"px",r="0px"):(n="0px",r=(t.rtl()?"":"-")+l._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE+"px"),e.swipeReveal(i,{top:n,left:r})},o=function(){return u?s.wrap():e.swipeReveal(i,{top:"0px",left:"0px"})},h=function(i){t.isZombie()||(i&&n._removeSelectionHint(i),n._clearItem(t.pressedEntity,t.selection._isIncluded(r)))},p=function(){n._selfRevealGesture._promise.cancel();u=!0;var t=n._selectionHint;return n._selectionHint=null,o().then(function(){i.style[y.scriptName]="";h(t)})};this._prepareItem(this._site.pressedEntity,i,a);this._showSelectionHintCheckmark();this._pointerTriggeredSRG=!0;this._selfRevealGesture={finishAnimation:p,_promise:v().then(o).then(function(){u||(n._hideSelectionHintCheckmark(),h(),n._selfRevealGesture=null)})}}},_endSelfRevealGesture:function(){this._selfRevealGesture&&(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null)},_prepareItem:function(t,i,r){function o(n){e._swipeClassTracker[v(n)]?e._swipeClassTracker[v(n)]++:(h.addClass(n,l._swipeClass),e._swipeClassTracker[v(n)]=1)}var a;if(t.type!==c.ObjectType.groupHeader){var e=this,u=this._site,f=t.index;r?(a=u.containerAtIndex(f),o(a)):(this._animations[f]||s.wrap()).then(function(){if(!u.isZombie()&&t.type!==c.ObjectType.groupHeader&&-1!==u.pressedEntity.index){f=u.pressedEntity.index;var a=u.itemAtIndex(f),i=u.itemBoxAtIndex(f),r=u.containerAtIndex(f);if(o(r),!h._isSelectionRendered(i)){n.renderSelection(i,a,!0,r);h.removeClass(i,l._selectedClass);h.removeClass(r,l._selectedClass);for(var s=i.querySelectorAll(h._selectionPartsSelector),e=0,v=s.length;v>e;e++)s[e].style.opacity=0}}})}},_clearItem:function(t,i){function f(n){var t=--e._swipeClassTracker[v(n)];return t?!1:(delete e._swipeClassTracker[v(n)],h.removeClass(n,l._swipeClass),!0)}function y(n){var t=n.parentNode;t&&h.hasClass(t,l._itemsBlockClass)&&f(t)}var a;if(t.type===c.ObjectType.item){var e=this,u=this._site,r=u.containerAtIndex(t.index),o=u.itemBoxAtIndex(t.index),s=u.itemAtIndex(t.index);r&&o&&s&&(a=f(r),y(r),a&&n.renderSelection(o,s,i,!0,r))}},_animateSelectionChange:function(n,t){function u(){var t=n?"addClass":"removeClass",i;(h[t](o,l._selectedClass),h[t](e,l._selectedClass),r._selectionHint)&&(i=p(r._selectionHint,l._selectionHintClass),i&&h[t](i,l._revealedClass))}var r=this,e=this._site.pressedContainer,o=this._site.pressedItemBox,i;this._swipeBehaviorSelectionChanged=!0;this.swipeBehaviorSelected=n;i=h._getElementsByClasses(this._site.pressedItemBox,[l._selectionBorderClass,l._selectionBackgroundClass]);(!n||t)&&(i=i.concat(h._getElementsByClasses(this._site.pressedItemBox,[l._selectionCheckmarkBackgroundClass,l._selectionCheckmarkClass])));f("WinJS.UI._ItemEventsHandler:"+(n?"hitSelectThreshold":"hitUnselectThreshold")+",info");this._applyUIInBatches(function(){f("WinJS.UI._ItemEventsHandler:"+(n?"apply":"remove")+"SelectionVisual,info");for(var r=n?1:0,t=0;t<i.length;t++)i[t].style.opacity=r;u()})},_showSelectionHintCheckmark:function(){if(this._selectionHint){var n=p(this._selectionHint,l._selectionHintClass);n&&(n.style.display="block")}},_hideSelectionHintCheckmark:function(){if(this._selectionHint){var n=p(this._selectionHint,l._selectionHintClass);n&&(n.style.display="none")}},_addSelectionHint:function(){var n,i,r,u;this._site.pressedEntity.type!==c.ObjectType.groupHeader&&(i=this._site,i.customFootprintParent?(n=this._selectionHint=t.document.createElement("div"),n.className=l._containerClass,r=this,i.getItemPosition(this._site.pressedEntity).then(function(t){if(!i.isZombie()&&r._selectionHint&&r._selectionHint===n){var u=n.style,f=";position:absolute;"+(i.rtl()?"right:":"left:")+t.left+"px;top:"+t.top+"px;width:"+t.contentWidth+"px;height:"+t.contentHeight+"px";u.cssText+=f;i.customFootprintParent.insertBefore(r._selectionHint,r._site.pressedItemBox)}},function(){})):n=this._selectionHint=this._site.pressedContainer,this._selectionHintTracker[v(n)]?this._selectionHintTracker[v(n)]++:((h.addClass(n,l._footprintClass),i.selection._isIncluded(this._site.pressedEntity.index))||(u=t.document.createElement("div"),u.className=l._selectionHintClass,u.textContent=l._SELECTION_CHECKMARK,u.style.display="none",this._selectionHint.insertBefore(u,this._selectionHint.firstElementChild)),this._selectionHintTracker[v(n)]=1))},_removeSelectionHint:function(n){var i,t;n&&(i=--this._selectionHintTracker[v(n)],i||((delete this._selectionHintTracker[v(n)],this._site.customFootprintParent)?n.parentNode&&n.parentNode.removeChild(n):(h.removeClass(n,l._footprintClass),t=p(n,l._selectionHintClass),t&&t.parentNode.removeChild(t))))},_releasedElement:function(n){return t.document.elementFromPoint(n.clientX,n.clientY)},_applyUIInBatches:function(n){function i(){t._work.length>0?(t._flushUIBatches(),t._paintedThisFrame=u._requestAnimationFrame(i.bind(t))):t._paintedThisFrame=null}var t=this;this._work.push(n);this._paintedThisFrame||i()},_flushUIBatches:function(){var t,n;if(this._work.length>0)for(t=this._work,this._work=[],n=0;n<t.length;n++)t[n]()},_selectionAllowed:function(n){var t=void 0!==n?this._site.itemAtIndex(n):null,i=!(t&&h.hasClass(t,l._nonSelectableClass));return i&&this._site.selectionMode!==c.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===c.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===c.TapBehavior.toggleSelect||this._site.tapBehavior===c.TapBehavior.directSelect},_staticMode:function(n){return n?this._site.headerTapBehavior===c.GroupHeaderTapBehavior.none:this._site.tapBehavior===c.TapBehavior.none&&this._site.selectionMode===c.SelectionMode.none}},{setAriaSelected:function(n,t){var i="true"===n.getAttribute("aria-selected");t!==i&&n.setAttribute("aria-selected",t)},renderSelection:function(t,i,r,u,f){var o,e,s;if(n._selectionTemplate||(n._selectionTemplate=[],n._selectionTemplate.push(b(l._selectionBackgroundClass)),n._selectionTemplate.push(b(l._selectionBorderClass)),n._selectionTemplate.push(b(l._selectionCheckmarkBackgroundClass)),o=b(l._selectionCheckmarkClass),o.textContent=l._SELECTION_CHECKMARK,n._selectionTemplate.push(o)),r!==h._isSelectionRendered(t)){if(r)for(t.insertBefore(n._selectionTemplate[0].cloneNode(!0),t.firstElementChild),e=1,s=n._selectionTemplate.length;s>e;e++)t.appendChild(n._selectionTemplate[e].cloneNode(!0));else for(var c=t.querySelectorAll(h._selectionPartsSelector),e=0,s=c.length;s>e;e++)t.removeChild(c[e]);h[r?"addClass":"removeClass"](t,l._selectedClass);f&&h[r?"addClass":"removeClass"](f,l._selectedClass)}u&&n.setAriaSelected(i,r)}});return n})})});t("WinJS/Controls/ListView/_SelectionManager",["exports","../../Core/_Global","../../Core/_Base","../../Promise","../../_Signal","../../Utilities/_UI","../ItemContainer/_Constants"],function(n,t,i,r,u,f,e){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{_ItemSet:i.Namespace._lazy(function(){var t=i.Class.define(function(n,t,i){this._listView=n;this._ranges=t;this._itemsCount=i});return t.prototype={getRanges:function(){for(var n,i=[],t=0,r=this._ranges.length;r>t;t++)n=this._ranges[t],i.push({firstIndex:n.firstIndex,lastIndex:n.lastIndex,firstKey:n.firstKey,lastKey:n.lastKey});return i},getItems:function(){return n.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var t,i=0,n=0,r=this._ranges.length;r>n;n++)t=this._ranges[n],i+=t.lastIndex-t.firstIndex+1;return i},getIndices:function(){for(var i,n,r=[],t=0,u=this._ranges.length;u>t;t++)for(i=this._ranges[t],n=i.firstIndex;n<=i.lastIndex;n++)r.push(n);return r}},t}),getItemsFromRanges:function(n,t){function f(){for(var u,n,f=[],i=0,e=t.length;e>i;i++)for(u=t[i],n=u.firstIndex;n<=u.lastIndex;n++)f.push(n);return r.wrap(f)}var i=n.createListBinding(),u=[];return f().then(function(n){for(var t=0;t<n.length;t++)u.push(i.fromIndex(n[t]));return r.join(u).then(function(n){return i.release(),n})})},_Selection:i.Namespace._lazy(function(){function t(n){return n&&0===n.firstIndex&&n.lastIndex===Number.MAX_VALUE}return i.Class.derive(n._ItemSet,function(n,t){this._listView=n;this._itemsCount=-1;this._ranges=[];t&&this.set(t)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],r.wrap()},set:function(n){if(t(n))return this.selectAll();this._releaseRanges(this._ranges);this._ranges=[];var i=this;return this._execute("_set",n).then(function(){return i._ranges.sort(function(n,t){return n.firstIndex-t.firstIndex}),i._ensureKeys()}).then(function(){return i._ensureCount()})},add:function(n){if(t(n))return this.selectAll();var i=this;return this._execute("_add",n).then(function(){return i._ensureKeys()}).then(function(){return i._ensureCount()})},remove:function(n){var t=this;return this._execute("_remove",n).then(function(){return t._ensureKeys()})},selectAll:function(){var n=this;return n._ensureCount().then(function(){if(n._itemsCount){var t={firstIndex:0,lastIndex:n._itemsCount-1};return n._retainRange(t),n._releaseRanges(n._ranges),n._ranges=[t],n._ensureKeys()}})},_execute:function(n,t){function u(n,t,i){var r={};return r["first"+n]=t,r["last"+n]=i,r}function o(t){var i=f._getListBinding(),u=r.join([i.fromKey(t.firstKey),i.fromKey(t.lastKey)]).then(function(i){return i[0]&&i[1]&&(t.firstIndex=i[0].index,t.lastIndex=i[1].index,f[n](t)),t});c.push(u)}for(var i,f=this,s=!!f._getListBinding().fromKey,h=Array.isArray(t)?t:[t],c=[r.wrap()],e=0,l=h.length;l>e;e++)i=h[e],"number"==typeof i?this[n](u("Index",i,i)):i&&(s&&void 0!==i.key?o(u("Key",i.key,i.key)):s&&void 0!==i.firstKey&&void 0!==i.lastKey?o(u("Key",i.firstKey,i.lastKey)):void 0!==i.index&&"number"==typeof i.index?this[n](u("Index",i.index,i.index)):void 0!==i.firstIndex&&void 0!==i.lastIndex&&"number"==typeof i.firstIndex&&"number"==typeof i.lastIndex&&this[n](u("Index",i.firstIndex,i.lastIndex)));return r.join(c)},_set:function(n){this._retainRange(n);this._ranges.push(n)},_add:function(n){for(var s,h,r,t,o,c=this,u=null,f=function(n,t){t.lastIndex>n.lastIndex&&(n.lastIndex=t.lastIndex,n.lastKey=t.lastKey,n.lastPromise&&n.lastPromise.release(),n.lastPromise=c._getListBinding().fromIndex(n.lastIndex).retain())},i=0,e=this._ranges.length;e>i;i++){if(r=this._ranges[i],n.firstIndex<r.firstIndex){o=u&&n.firstIndex<u.lastIndex+1;o?(t=i-1,f(u,n)):(this._insertRange(i,n),t=i);break}if(n.firstIndex===r.firstIndex){f(r,n);t=i;break}u=r}if(void 0===t)s=this._ranges.length?this._ranges[this._ranges.length-1]:null,h=s&&n.firstIndex<s.lastIndex+1,h?f(s,n):(this._retainRange(n),this._ranges.push(n));else{for(u=null,i=t+1,e=this._ranges.length;e>i;i++){if(r=this._ranges[i],n.lastIndex<r.firstIndex){o=u&&u.lastIndex>n.lastIndex;o&&f(this._ranges[t],u);this._removeRanges(t+1,i-t-1);break}if(n.lastIndex===r.firstIndex){f(this._ranges[t],r);this._removeRanges(t+1,i-t);break}u=r}i>=e&&(f(this._ranges[t],this._ranges[e-1]),this._removeRanges(t+1,e-t-1))}},_remove:function(n){function r(n){return f._getListBinding().fromIndex(n).retain()}for(var t,f=this,i=[],u=0,e=this._ranges.length;e>u;u++)t=this._ranges[u],t.lastIndex<n.firstIndex||t.firstIndex>n.lastIndex?i.push(t):t.firstIndex<n.firstIndex&&t.lastIndex>=n.firstIndex&&t.lastIndex<=n.lastIndex?(i.push({firstIndex:t.firstIndex,firstKey:t.firstKey,firstPromise:t.firstPromise,lastIndex:n.firstIndex-1,lastPromise:r(n.firstIndex-1)}),t.lastPromise.release()):t.lastIndex>n.lastIndex&&t.firstIndex>=n.firstIndex&&t.firstIndex<=n.lastIndex?(i.push({firstIndex:n.lastIndex+1,firstPromise:r(n.lastIndex+1),lastIndex:t.lastIndex,lastKey:t.lastKey,lastPromise:t.lastPromise}),t.firstPromise.release()):t.firstIndex<n.firstIndex&&t.lastIndex>n.lastIndex?(i.push({firstIndex:t.firstIndex,firstKey:t.firstKey,firstPromise:t.firstPromise,lastIndex:n.firstIndex-1,lastPromise:r(n.firstIndex-1)}),i.push({firstIndex:n.lastIndex+1,firstPromise:r(n.lastIndex+1),lastIndex:t.lastIndex,lastKey:t.lastKey,lastPromise:t.lastPromise})):(t.firstPromise.release(),t.lastPromise.release());this._ranges=i},_ensureKeys:function(){for(var i,n=[r.wrap()],u=this,f=function(n,t){var u=n+"Key",i;return t[u]?r.wrap():(i=t[n+"Promise"],i.then(function(n){n&&(t[u]=n.key)}),i)},t=0,e=this._ranges.length;e>t;t++)i=this._ranges[t],n.push(f("first",i)),n.push(f("last",i));return r.join(n).then(function(){u._ranges=u._ranges.filter(function(n){return n.firstKey&&n.lastKey})}),r.join(n)},_mergeRanges:function(n,t){n.lastIndex=t.lastIndex;n.lastKey=t.lastKey},_isIncluded:function(n){var t,r,i;if(this.isEverything())return!0;for(t=0,r=this._ranges.length;r>t;t++)if(i=this._ranges[t],i.firstIndex<=n&&n<=i.lastIndex)return!0;return!1},_ensureCount:function(){var n=this;return this._listView._itemsCount().then(function(t){n._itemsCount=t})},_insertRange:function(n,t){this._retainRange(t);this._ranges.splice(n,0,t)},_removeRanges:function(n,t){for(var i=0;t>i;i++)this._releaseRange(this._ranges[n+i]);this._ranges.splice(n,t)},_retainRange:function(n){n.firstPromise||(n.firstPromise=this._getListBinding().fromIndex(n.firstIndex).retain());n.lastPromise||(n.lastPromise=this._getListBinding().fromIndex(n.lastIndex).retain())},_retainRanges:function(){for(var n=0,t=this._ranges.length;t>n;n++)this._retainRange(this._ranges[n])},_releaseRange:function(n){n.firstPromise.release();n.lastPromise.release()},_releaseRanges:function(n){for(var t=0,i=n.length;i>t;++t)this._releaseRange(n[t])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:i.Namespace._lazy(function(){var i=function(t){this._listView=t;this._selected=new n._Selection(this._listView);this._pivot=e._INVALID_INDEX;this._focused={type:f.ObjectType.item,index:0};this._pendingChange=r.wrap()};return i.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(t){var f=this,i=new u;return this._synchronize(i).then(function(){var u=new n._Selection(f._listView);return u.set(t).then(function(){f._set(u);i.complete()},function(n){return u.clear(),i.complete(),r.wrapError(n)})})},clear:function(){var i=this,t=new u;return this._synchronize(t).then(function(){var u=new n._Selection(i._listView);return u.clear().then(function(){i._set(u);t.complete()},function(n){return u.clear(),t.complete(),r.wrapError(n)})})},add:function(n){var i=this,t=new u;return this._synchronize(t).then(function(){var u=i._cloneSelection();return u.add(n).then(function(){i._set(u);t.complete()},function(n){return u.clear(),t.complete(),r.wrapError(n)})})},remove:function(n){var i=this,t=new u;return this._synchronize(t).then(function(){var u=i._cloneSelection();return u.remove(n).then(function(){i._set(u);t.complete()},function(n){return u.clear(),t.complete(),r.wrapError(n)})})},selectAll:function(){var i=this,t=new u;return this._synchronize(t).then(function(){var u=new n._Selection(i._listView);return u.selectAll().then(function(){i._set(u);t.complete()},function(n){return u.clear(),t.complete(),r.wrapError(n)})})},_synchronize:function(n){var t=this;return this._listView._versionManager.unlocked.then(function(){var i=t._pendingChange;return t._pendingChange=r.join([i,n.promise]).then(function(){}),i})},_reset:function(){this._pivot=e._INVALID_INDEX;this._setFocused({type:f.ObjectType.item,index:0},this._keyboardFocused());this._pendingChange.cancel();this._pendingChange=r.wrap();this._selected.clear();this._selected=new n._Selection(this._listView)},_dispose:function(){this._selected.clear();this._selected=null;this._listView=null},_set:function(n){var t=this;return this._fireSelectionChanging(n).then(function(i){return i?(t._selected.clear(),t._selected=n,t._listView._updateSelection(),t._fireSelectionChanged()):n.clear(),i})},_fireSelectionChanging:function(n){var i=t.document.createEvent("CustomEvent"),u=r.wrap(),f;return i.initCustomEvent("selectionchanging",!0,!0,{newSelection:n,preventTapBehavior:function(){},setPromise:function(n){u=n}}),f=this._listView._element.dispatchEvent(i),u.then(function(){return f})},_fireSelectionChanged:function(){var n=t.document.createEvent("CustomEvent");n.initCustomEvent("selectionchanged",!0,!1,null);this._listView._element.dispatchEvent(n)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(n,t){this._focused={type:n.type,index:n.index};this._focusedByKeyboard=t},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(n){this._selected._itemsCount=n},_isIncluded:function(n){return this._selected._isIncluded(n)},_cloneSelection:function(){var t=new n._Selection(this._listView);return t._ranges=this._selected.getRanges(),t._itemsCount=this._selected._itemsCount,t._retainRanges(),t}},i.supportedForProcessing=!1,i})})});t("WinJS/Controls/ListView/_BrowseMode",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Animations","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_SelectionManager"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";var l=r._browserStyleEquivalents.transform.scriptName;i.Namespace._moduleDefine(n,"WinJS.UI",{_SelectionMode:i.Namespace._lazy(function(){function u(n,t,i){return Math.max(n,Math.min(t,i))}function n(n,i,r){var u=t.document.createEvent("CustomEvent");return u.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:i.index,oldFocusType:i.type,newFocus:r.index,newFocusType:r.type}),n.dispatchEvent(u)}return i.Class.define(function(n){this.inboundFocusHandled=!1;this._pressedContainer=null;this._pressedItemBox=null;this._pressedHeader=null;this._pressedEntity={type:o.ObjectType.item,index:s._INVALID_INDEX};this._pressedPosition=null;this.initialize(n)},{_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose();this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(n){function u(t,i){var r=function(i){return n._view.getAdjacent(i,t)};return r.clampToBounds=i,r}var t,i,r;this.site=n;this._keyboardNavigationHandlers={};this._keyboardAcceleratorHandlers={};t=this.site;i=this;this._itemEventsHandler=new h._ItemEventsHandler(Object.create({containerFromElement:function(n){return t._view.items.containerFrom(n)},indexForItemElement:function(n){return t._view.items.index(n)},indexForHeaderElement:function(n){return t._groups.index(n)},itemBoxAtIndex:function(n){return t._view.items.itemBoxAt(n)},itemAtIndex:function(n){return t._view.items.itemAt(n)},headerAtIndex:function(n){return t._groups.group(n).header},headerFromElement:function(n){return t._groups.headerFrom(n)},containerAtIndex:function(n){return t._view.items.containerAt(n)},isZombie:function(){return t._isZombie()},getItemPosition:function(n){return t._getItemPosition(n)},rtl:function(){return t._rtl()},fireInvokeEvent:function(n,t){return i._fireInvokeEvent(n,t)},verifySelectionAllowed:function(n){return i._verifySelectionAllowed(n)},changeFocus:function(n,i,r,u,f){return t._changeFocus(n,i,r,u,f)},selectRange:function(n,t,r){return i._selectRange(n,t,r)}},{pressedEntity:{enumerable:!0,get:function(){return i._pressedEntity},set:function(n){i._pressedEntity=n}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return i._pressedContainerScaleTransform},set:function(n){i._pressedContainerScaleTransform=n}},pressedContainer:{enumerable:!0,get:function(){return i._pressedContainer},set:function(n){i._pressedContainer=n}},pressedItemBox:{enumerable:!0,get:function(){return i._pressedItemBox},set:function(n){i._pressedItemBox=n}},pressedHeader:{enumerable:!0,get:function(){return i._pressedHeader},set:function(n){return i._pressedHeader=n}},pressedPosition:{enumerable:!0,get:function(){return i._pressedPosition},set:function(n){i._pressedPosition=n}},pressedElement:{enumerable:!0,set:function(n){i._pressedElement=n}},swipeBehavior:{enumerable:!0,get:function(){return t._swipeBehavior}},eventHandlerRoot:{enumerable:!0,get:function(){return t._viewport}},selectionMode:{enumerable:!0,get:function(){return t._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return s._itemClass}},canvasProxy:{enumerable:!0,get:function(){return t._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return t._tap}},headerTapBehavior:{enumerable:!0,get:function(){return t._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return t.itemsDraggable||t.itemsReorderable}},selection:{enumerable:!0,get:function(){return t._selection}},horizontal:{enumerable:!0,get:function(){return t._horizontal()}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));r=e.Key;this._keyboardNavigationHandlers[r.upArrow]=u(r.upArrow);this._keyboardNavigationHandlers[r.downArrow]=u(r.downArrow);this._keyboardNavigationHandlers[r.leftArrow]=u(r.leftArrow);this._keyboardNavigationHandlers[r.rightArrow]=u(r.rightArrow);this._keyboardNavigationHandlers[r.pageUp]=u(r.pageUp,!0);this._keyboardNavigationHandlers[r.pageDown]=u(r.pageDown,!0);this._keyboardNavigationHandlers[r.home]=function(n){return f.wrap({type:n.type,index:0})};this._keyboardNavigationHandlers[r.end]=function(n){return n.type===o.ObjectType.groupHeader?f.wrap({type:n.type,index:t._groups.length()-1}):i.site._view.finalItem().then(function(t){return{type:n.type,index:t}},function(n){return f.wrapError(n)})};this._keyboardAcceleratorHandlers[r.a]=function(){i.site._multiSelection()&&i._selectAll()}},staticMode:function(){return this.site._tap===o.TapBehavior.none&&this.site._selectionMode===o.SelectionMode.none},itemUnrealized:function(n,t){if(this._pressedEntity.type!==o.ObjectType.groupHeader&&(this._pressedEntity.index===n&&this._resetPointerDownState(),this._itemBeingDragged(n)))for(var i=this._draggedItemBoxes.length-1;i>=0;i--)this._draggedItemBoxes[i]===t&&(e.removeClass(t,s._dragSourceClass),this._draggedItemBoxes.splice(i,1))},_fireInvokeEvent:function(n,i){function r(r,f){var s=r.createListBinding(),e=s.fromIndex(n.index),h=f?"groupheaderinvoked":"iteminvoked",o;e.done(function(){s.release()});o=t.document.createEvent("CustomEvent");o.initCustomEvent(h,!0,!0,f?{groupHeaderPromise:e,groupHeaderIndex:n.index}:{itemPromise:e,itemIndex:n.index});i.dispatchEvent(o)&&u.site._defaultInvoke(n)}if(i){var u=this;n.type===o.ObjectType.groupHeader?this.site._groupHeaderTap===o.GroupHeaderTapBehavior.invoke&&n.index!==s._INVALID_INDEX&&r(this.site.groupDataSource,!0):this.site._tap!==o.TapBehavior.none&&n.index!==s._INVALID_INDEX&&r(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(n){var k,h;if(n.type===o.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var u=n.index,i=this.site,c=this.site._view.items.itemAt(u);if(!i._selectionAllowed()||!i._selectOnTap()&&i._swipeBehavior!==o.SwipeBehavior.select||c&&e.hasClass(c,s._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var l=i._selection._isIncluded(u),a=!i._multiSelection(),r=i._selection._cloneSelection();l?a?r.clear():r.remove(u):a?r.set(u):r.add(u);var v,y=t.document.createEvent("CustomEvent"),p=f.wrap(),w=!1,b=!1;return y.initCustomEvent("selectionchanging",!0,!0,{newSelection:r,preventTapBehavior:function(){b=!0},setPromise:function(n){p=n}}),k=i._element.dispatchEvent(y),p.then(function(){w=!0;v=r._isIncluded(u);r.clear()}),h=k&&w&&(l||v),{canSelect:h,canTapSelect:h&&!b}},_containedInElementWithClass:function(n,t){if(n.parentNode)for(var r=n.parentNode.querySelectorAll("."+t+", ."+t+" *"),i=0,u=r.length;u>i;i++)if(r[i]===n)return!0;return!1},_isDraggable:function(n){return!this._containedInElementWithClass(n,s._nonDraggableClass)},_isInteractive:function(n){return this._containedInElementWithClass(n,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onMSManipulationStateChanged:function(n){this._itemEventsHandler.onMSManipulationStateChanged(n)},onPointerDown:function(n){this._itemEventsHandler.onPointerDown(n)},onclick:function(n){this._itemEventsHandler.onClick(n)},onPointerUp:function(n){this._itemEventsHandler.onPointerUp(n)},onPointerCancel:function(n){this._itemEventsHandler.onPointerCancel(n)},onLostPointerCapture:function(n){this._itemEventsHandler.onLostPointerCapture(n)},onContextMenu:function(n){this._itemEventsHandler.onContextMenu(n)},onMSHoldVisual:function(n){this._itemEventsHandler.onMSHoldVisual(n)},onDataChanged:function(n){this._itemEventsHandler.onDataChanged(n)},_removeTransform:function(n,t){t&&-1!==n.style[l].indexOf(t)&&(n.style[l]=n.style[l].replace(t,""))},_selectAll:function(){var n=[];this.site._view.items.each(function(t,i){i&&e.hasClass(i,s._nonSelectableClass)&&n.push(t)});this.site._selection.selectAll();n.length>0&&this.site._selection.remove(n)},_selectRange:function(n,t,i){for(var o,f=[],r=-1,u=n;t>=u;u++)o=this.site._view.items.itemAt(u),o&&e.hasClass(o,s._nonSelectableClass)?-1!==r&&(f.push({firstIndex:r,lastIndex:u-1}),r=-1):-1===r&&(r=u);-1!==r&&f.push({firstIndex:r,lastIndex:t});f.length>0&&this.site._selection[i?"add":"set"](f)},onDragStart:function(n){var f,h,u,l,i,a;(this._pressedEntity={type:o.ObjectType.item,index:this.site._view.items.index(n.target)},this.site._selection._pivot=s._INVALID_INDEX,this._pressedEntity.index===s._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(n.target)||this._pressedElement&&this._isInteractive(this._pressedElement))?n.preventDefault():(this._dragging=!0,this._dragDataTransfer=n.dataTransfer,this._pressedPosition=e._getCursorPos(n),this._dragInfo=null,this._lastEnteredElement=n.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new c._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}])),f=this.site.itemsReorderable,h=t.document.createEvent("CustomEvent"),(h.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:n.dataTransfer,dragInfo:this._dragInfo}),n.dataTransfer.setData("text",""),n.dataTransfer.setDragImage)&&(u=this.site._view.items.itemDataAt(this._pressedEntity.index),u&&u.container&&(l=u.container.getBoundingClientRect(),n.dataTransfer.setDragImage(u.container,n.clientX-l.left,n.clientY-l.top))),this.site.element.dispatchEvent(h),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(n.dataTransfer)&&(f=!0,this._dragUnderstood=!0)),f&&(this._addedDragOverClass=!0,e.addClass(this.site._element,s._dragOverClass)),this._draggedItemBoxes=[],i=this,a=n.target,a.addEventListener("dragend",function v(n){a.removeEventListener("dragend",v);i.onDragEnd(n)}),r._yieldForDomModification(function(){var n;if(i._dragging)for(var r=i._dragInfo.getIndices(),t=0,u=r.length;u>t;t++)n=i.site._view.items.itemDataAt(r[t]),n&&n.itemBox&&i._addDragSourceClass(n.itemBox)}))},onDragEnter:function(n){var i=this._dragUnderstood;this._lastEnteredElement=n.target;this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);this._firedDragEnter||this._fireDragEnterEvent(n.dataTransfer)&&(i=!0);(i||this._dragging&&this.site.itemsReorderable)&&(n.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,e.addClass(this.site._element,s._dragOverClass)));this._pointerLeftRegion=!1},onDragLeave:function(n){n.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var n=t.document.createEvent("CustomEvent");n.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo});this.site.element.dispatchEvent(n)},_fireDragEnterEvent:function(n){var i=t.document.createEvent("CustomEvent"),r;return i.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:n}),r=!this.site.element.dispatchEvent(i),this._firedDragEnter=!0,r},_fireDragBetweenEvent:function(n,i,r){var u=t.document.createEvent("CustomEvent");return u.initCustomEvent("itemdragbetween",!0,!0,{index:n,insertAfterIndex:i,dataTransfer:r}),this.site.element.dispatchEvent(u)},_fireDropEvent:function(n,i,r){var u=t.document.createEvent("CustomEvent");return u.initCustomEvent("itemdragdrop",!0,!0,{index:n,insertAfterIndex:i,dataTransfer:r}),this.site.element.dispatchEvent(u)},_handleExitEvent:function(){this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var n=this;this._exitEventTimer=t.setTimeout(function(){if(!n.site._disposed&&n._pointerLeftRegion){if(n.site._layout.dragLeave&&n.site._layout.dragLeave(),n._pointerLeftRegion=!1,n._dragUnderstood=!1,n._lastEnteredElement=null,n._lastInsertPoint=null,n._dragBetweenDisabled=!1,n._firedDragEnter){var i=t.document.createEvent("CustomEvent");i.initCustomEvent("itemdragleave",!0,!1,{});n.site.element.dispatchEvent(i);n._firedDragEnter=!1}n._addedDragOverClass&&(n._addedDragOverClass=!1,e.removeClass(n.site._element,s._dragOverClass));n._exitEventTimer=0;n._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(n,i){var r={left:0,top:0};try{r=n.getBoundingClientRect()}catch(a){}var u=t.getComputedStyle(n,null),s=parseInt(u.paddingLeft),h=parseInt(u.paddingTop),c=parseInt(u.borderLeftWidth),l=parseInt(u.borderTopWidth),f=i.clientX,e=i.clientY,o={x:+f===f?f-r.left-s-c:0,y:+e===e?e-r.top-h-l:0};return this.site._rtl()&&(o.x=r.right-r.left-o.x),o},_getPositionInCanvasSpace:function(n){var i=this.site._horizontal()?this.site.scrollPosition:0,r=this.site._horizontal()?0:this.site.scrollPosition,t=this._getEventPositionInElementSpace(this.site.element,n);return{x:t.x+i,y:t.y+r}},_itemBeingDragged:function(n){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(n)||!this._draggingUnselectedItem&&this.site._isSelected(n):!1},_addDragSourceClass:function(n){this._draggedItemBoxes.push(n);e.addClass(n,s._dragSourceClass);n.parentNode&&e.addClass(n.parentNode,s._footprintClass)},renderDragSourceOnRealizedItem:function(n,t){this._itemBeingDragged(n)&&this._addDragSourceClass(t)},onDragOver:function(n){var i,r,t;this._dragUnderstood&&(this._pointerLeftRegion=!1,n.preventDefault(),i=this._getPositionInCanvasSpace(n),r=this._getEventPositionInElementSpace(this.site.element,n),(this._checkAutoScroll(r.x,r.y),this.site._layout.hitTest)&&(this._autoScrollFrame?this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null):(t=this.site._view.hitTest(i.x,i.y),t.insertAfterIndex=u(-1,this.site._cachedCount-1,t.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===t.insertAfterIndex&&this._lastInsertPoint.index===t.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(t.index,t.insertAfterIndex,n.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(i.x,i.y,this._dragInfo)),this._lastInsertPoint=t)))},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,e.removeClass(this.site._element,s._dragOverClass)),this._draggedItemBoxes){for(var n=0,t=this._draggedItemBoxes.length;t>n;n++)e.removeClass(this._draggedItemBoxes[n],s._dragSourceClass),this._draggedItemBoxes[n].parentNode&&e.removeClass(this._draggedItemBoxes[n].parentNode,s._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave();this._dragging=!1;this._dragInfo=null;this._draggingUnselectedItem=!1;this._dragDataTransfer=null;this._lastInsertPoint=null;this._resetPointerDownState();this._lastEnteredElement=null;this._dragBetweenDisabled=!1;this._firedDragEnter=!1;this._dragUnderstood=!1;this._stopAutoScroll()},onDragEnd:function(){var n=t.document.createEvent("CustomEvent");n.initCustomEvent("itemdragend",!0,!1,{});this.site.element.dispatchEvent(n);this._clearDragProperties()},_findFirstAvailableInsertPoint:function(n,t,i){for(var e=n.getIndices(),r=-1,o=this.site._cachedCount,s=e.length,h=-1,u=t,f=0;s>f;f++)if(e[f]===u){r=f;h=f;break}for(;r>=0&&u>=0;)i?(u++,s>r&&e[r+1]===u&&o>u?r++:u>=o?(i=!1,u=t,r=h):r=-1):(u--,r>0&&e[r-1]===u?r--:r=-1);return u},_reorderItems:function(n,t,i,r,u){var f=this.site,e=function(n){i?f._selection.remove({key:n[0].key}):f._selection.set({firstKey:n[0].key,lastKey:n[n.length-1].key});u&&f.ensureVisible(f._selection._getFocused())};t.getItems().then(function(t){var i=f.itemDataSource,u,o;if(-1===n){for(i.beginEdits(),u=t.length-1;u>=0;u--)i.moveToStart(t[u].key);i.endEdits();e(t)}else o=i.createListBinding(),o.fromIndex(n).then(function(n){var f,u;if(o.release(),i.beginEdits(),r)for(u=0,f=t.length;f>u;u++)i.moveBefore(t[u].key,n.key);else for(u=t.length-1;u>=0;u--)i.moveAfter(t[u].key,n.key);i.endEdits();e(t)})})},onDrop:function(n){var i,f;if(this._draggedItemBoxes)for(i=0,f=this._draggedItemBoxes.length;f>i;i++)this._draggedItemBoxes[i].parentNode&&e.removeClass(this._draggedItemBoxes[i].parentNode,s._footprintClass);if(!this._dragBetweenDisabled){var o=this._getPositionInCanvasSpace(n),r=this.site._view.hitTest(o.x,o.y),t=u(-1,this.site._cachedCount-1,r.insertAfterIndex),h=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===t&&this._lastInsertPoint.index===r.index||(h=this._fireDragBetweenEvent(r.index,t,n.dataTransfer)),h&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(r.index,t,n.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;t=this._findFirstAvailableInsertPoint(this._dragInfo,t,!1);this._reorderItems(t,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties();n.preventDefault()},_checkAutoScroll:function(n,i){var h=this.site._getViewportLength(),c=this.site._horizontal(),o=c?n:i,a=this.site._viewport[c?"scrollWidth":"scrollHeight"],l=Math.floor(this.site.scrollPosition),f=0,u;(o<s._AUTOSCROLL_THRESHOLD?f=o-s._AUTOSCROLL_THRESHOLD:o>h-s._AUTOSCROLL_THRESHOLD&&(f=o-(h-s._AUTOSCROLL_THRESHOLD)),f=Math.round(f/s._AUTOSCROLL_THRESHOLD*(s._MAX_AUTOSCROLL_RATE-s._MIN_AUTOSCROLL_RATE)),(0===l&&0>f||l>=a-h&&f>0)&&(f=0),0===f)?this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0):this._autoScrollDelay||this._autoScrollFrame||(u=this,this._autoScrollDelay=t.setTimeout(function(){if(u._autoScrollRate){u._lastDragTimeout=r._now();var n=function(){var i,t,f;!u._autoScrollRate&&u._autoScrollFrame||u.site._disposed?u._stopAutoScroll():(i=r._now(),t=u._autoScrollRate*((i-u._lastDragTimeout)/1e3),t=0>t?Math.min(-1,t):Math.max(1,t),f={},f[u.site._scrollProperty]=u.site._viewportScrollPosition+t,e.setScrollPosition(u.site._viewport,f),u._lastDragTimeout=i,u._autoScrollFrame=r._requestAnimationFrame(n))};u._autoScrollFrame=r._requestAnimationFrame(n)}},s._AUTOSCROLL_DELAY));this._autoScrollRate=f},_stopAutoScroll:function(){this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);this._autoScrollRate=0;this._autoScrollFrame=0},onKeyDown:function(t){function rt(t,u,e){function h(h){var l=!0,c=!1,v;return(e?t.index=Math.max(0,Math.min(h,t.index)):(t.index<0||t.index>h)&&(c=!0),c||r.index===t.index&&r.type===t.type)||(v=n(i._element,r,t),v&&(l=!1,a._setNewFocusItemOffsetPromise&&a._setNewFocusItemOffsetPromise.cancel(),i._batchViewUpdates(s._ViewChange.realize,s._ScrollToPriority.high,function(){return a._setNewFocusItemOffsetPromise=i._getItemOffset(r,!0).then(function(n){n=i._convertFromCanvasCoordinates(n);var e=n.end<=i.scrollPosition||n.begin>=i.scrollPosition+i._getViewportLength()-1;return a._setNewFocusItemOffsetPromise=i._getItemOffset(t).then(function(n){a._setNewFocusItemOffsetPromise=null;var o={position:i.scrollPosition,direction:"right"};return e&&(i._selection._setFocused(t,!0),n=i._convertFromCanvasCoordinates(n),t.index>r.index?(o.direction="right",o.position=n.end-i._getViewportLength()):(o.direction="left",o.position=n.begin)),i._changeFocus(t,u,d,e,!0),e?o:f.cancel},function(n){return i._changeFocus(t,u,d,!0,!0),f.wrapError(n)}),a._setNewFocusItemOffsetPromise},function(n){return i._changeFocus(t,u,d,!0,!0),f.wrapError(n)}),a._setNewFocusItemOffsetPromise},!0))),l&&(i._selection._setFocused(r,!0),i.ensureVisible(r)),c?{type:o.ObjectType.item,index:s._INVALID_INDEX}:t}return t.type!==o.ObjectType.groupHeader?lt.finalItem().then(h):f.wrap(i._groups.length()-1).then(h)}var a=this,i=this.site,ut=i._swipeBehavior===o.SwipeBehavior.select,lt=i._view,r=i._selection._getFocused(),k=!0,d=t.ctrlKey,l=e.Key,h=t.keyCode,ft=i._rtl(),tt,u,y,it,w,nt,b,ct;if(!this._isInteractive(t.target)){if(t.ctrlKey&&!t.altKey&&!t.shiftKey&&this._keyboardAcceleratorHandlers[h]&&this._keyboardAcceleratorHandlers[h](),i.itemsReorderable&&!t.ctrlKey&&t.altKey&&t.shiftKey&&r.type===o.ObjectType.item&&(h===l.leftArrow||h===l.rightArrow||h===l.upArrow||h===l.downArrow)){var p=i._selection,v=r.index,et=!1,ot=!0;if(!p.isEverything()&&(p._isIncluded(v)||(tt=i._view.items.itemAt(v),tt&&e.hasClass(tt,s._nonDraggableClass)?ot=!1:(et=!0,p=new c._Selection(this.site,[{firstIndex:v,lastIndex:v}]))),ot)){u=v;h===l.rightArrow?u+=ft?-1:1:h===l.leftArrow?u+=ft?1:-1:h===l.upArrow?u--:u++;y=u>v;it=y;y&&u>=this.site._cachedCount&&(it=!1,u=this.site._cachedCount-1);u=this._findFirstAvailableInsertPoint(p,u,it);u=Math.min(Math.max(-1,u),this.site._cachedCount-1);var g=u-(y||-1===u?0:1),st=u,ht=this.site._groupsEnabled();if(ht&&(w=this.site._groups,nt=u>-1?w.groupFromItem(u):0,y?w.group(nt).startIndex===u&&g--:nt<w.length()-1&&u===w.group(nt+1).startIndex-1&&g++),this._fireDragBetweenEvent(st,g,null)&&this._fireDropEvent(st,g,null)){if(ht)return;this._reorderItems(u,p,et,!y,!0)}}}else t.altKey?k=!1:this._keyboardNavigationHandlers[h]?this._keyboardNavigationHandlers[h](r).then(function(n){var u=a._keyboardNavigationHandlers[h].clampToBounds;n.type!==o.ObjectType.groupHeader&&t.shiftKey&&i._selectionAllowed()&&i._multiSelection()?(i._selection._pivot===s._INVALID_INDEX&&(i._selection._pivot=r.index),rt(n,!0,u).then(function(n){if(n.index!==s._INVALID_INDEX){var r=Math.min(n.index,i._selection._pivot),u=Math.max(n.index,i._selection._pivot),f=t.ctrlKey||i._tap===o.TapBehavior.toggleSelect;a._selectRange(r,u,f)}})):(i._selection._pivot=s._INVALID_INDEX,rt(n,!1,u))}):t.ctrlKey||h!==l.enter?r.type!==o.ObjectType.groupHeader&&(t.ctrlKey&&h===l.enter||ut&&t.shiftKey&&h===l.F10||ut&&h===l.menu||h===l.space)?(this._itemEventsHandler.handleSwipeBehavior(r.index),i._changeFocus(r,!0,d,!1,!0)):h===l.escape&&i._selection.count()>0?(i._selection._pivot=s._INVALID_INDEX,i._selection.clear()):k=!1:(b=r.type===o.ObjectType.groupHeader?i._groups.group(r.index).header:i._view.items.itemBoxAt(r.index),b&&(r.type===o.ObjectType.groupHeader?(this._pressedHeader=b,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=b,this._pressedContainer=i._view.items.containerAt(r.index),this._pressedHeader=null),ct=this._verifySelectionAllowed(r),ct.canTapSelect&&this._itemEventsHandler.handleTap(r),this._fireInvokeEvent(r,b)));this._keyDownHandled=k;k&&(t.stopPropagation(),t.preventDefault())}h===l.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(n){this._keyDownHandled&&(n.stopPropagation(),n.preventDefault())},onTabEntered:function(t){var u;if(0!==this.site._groups.length()){var i=this.site,r=i._selection._getFocused(),f=t.detail,e=!i._hasKeyboardFocus||t.target===i._viewport;e&&((this.inboundFocusHandled=!0,r.index=r.index===s._INVALID_INDEX?0:r.index,f||!this.site._supportsGroupHeaderKeyboarding)?(u={type:o.ObjectType.item},r.type===o.ObjectType.groupHeader?(u.index=i._groupFocusCache.getIndexForGroup(r.index),n(i._element,r,u)?i._changeFocus(u,!0,!1,!1,!0):i._changeFocus(r,!0,!1,!1,!0)):(u.index=r.index,i._changeFocus(u,!0,!1,!1,!0)),t.preventDefault()):(u={type:o.ObjectType.groupHeader},r.type!==o.ObjectType.groupHeader?(u.index=i._groups.groupFromItem(r.index),n(i._element,r,u)?i._changeFocus(u,!0,!1,!1,!0):i._changeFocus(r,!0,!1,!1,!0)):(u.index=r.index,i._changeFocus(u,!0,!1,!1,!0)),t.preventDefault()))}},onTabExiting:function(t){var u;if(this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var i=this.site,r=i._selection._getFocused(),f=t.detail;f&&r.type!==o.ObjectType.groupHeader?(u={type:o.ObjectType.groupHeader,index:i._groups.groupFromItem(r.index)},n(i._element,r,u)&&(i._changeFocus(u,!0,!1,!1,!0),t.preventDefault())):f||r.type!==o.ObjectType.groupHeader||(u={type:o.ObjectType.item,index:i._groupFocusCache.getIndexForGroup(r.index)},n(i._element,r,u)&&(i._changeFocus(u,!0,!1,!1,!0),t.preventDefault()))}}})})})});t("WinJS/Controls/ListView/_ErrorMessages",["exports","../../Core/_Base","../../Core/_Resources"],function(n,t){"use strict";t.Namespace._moduleDefine(n,null,{modeIsInvalid:{get:function(){return"Invalid argument: mode must be one of following values: 'none', 'single' or 'multi'."}},loadingBehaviorIsDeprecated:{get:function(){return"Invalid configuration: loadingBehavior is deprecated. The control will default this property to 'randomAccess'. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoad is deprecated. The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadThresholdIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoadThreshold is deprecated.  The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},automaticallyLoadPagesIsDeprecated:{get:function(){return"Invalid configuration: automaticallyLoadPages is deprecated. The control will default this property to false. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},invalidTemplate:{get:function(){return"Invalid template: Templates must be created before being passed to the ListView, and must contain a valid tree of elements."}},loadMorePagesIsDeprecated:{get:function(){return"loadMorePages is deprecated. Invoking this function will not have any effect. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},disableBackdropIsDeprecated:{get:function(){return"Invalid configuration: disableBackdrop is deprecated. Style: .win-listview .win-container.win-backdrop { background-color:transparent; } instead."}},backdropColorIsDeprecated:{get:function(){return"Invalid configuration: backdropColor is deprecated. Style: .win-listview .win-container.win-backdrop { rgba(155,155,155,0.23); } instead."}},itemInfoIsDeprecated:{get:function(){return"GridLayout.itemInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},groupInfoIsDeprecated:{get:function(){return"GridLayout.groupInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},resetItemIsDeprecated:{get:function(){return"resetItem may be altered or unavailable in future versions. Instead, mark the element as disposable using WinJS.Utilities.markDisposable."}},resetGroupHeaderIsDeprecated:{get:function(){return"resetGroupHeader may be altered or unavailable in future versions. Instead, mark the header element as disposable using WinJS.Utilities.markDisposable."}},maxRowsIsDeprecated:{get:function(){return"GridLayout.maxRows may be altered or unavailable in future versions. Instead, use the maximumRowsOrColumns property."}}})});t("WinJS/Controls/ListView/_GroupFocusCache",["exports","../../Core/_Base"],function(n,t){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_GroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(function(n){this._listView=n;this.clear()},{updateCache:function(n,t,i){i=""+i;this._itemToIndex[t]=i;this._groupToItem[n]=t},deleteItem:function(n){var i;if(this._itemToIndex[n])for(var r=this,u=Object.keys(this._groupToItem),t=0,f=u.length;f>t;t++)if(i=u[t],r._groupToItem[i]===n){r.deleteGroup(i);break}},deleteGroup:function(n){var t=this._groupToItem[n];t&&delete this._itemToIndex[t];delete this._groupToItem[n]},updateItemIndex:function(n,t){this._itemToIndex[n]&&(this._itemToIndex[n]=""+t)},getIndexForGroup:function(n){var i=this._listView._groups.group(n).key,t=this._groupToItem[i];return t&&this._itemToIndex[t]?+this._itemToIndex[t]:this._listView._groups.fromKey(i).group.startIndex},clear:function(){this._groupToItem={};this._itemToIndex={}}})}),_UnsupportedGroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(null,{updateCache:function(){},deleteItem:function(){},deleteGroup:function(){},updateItemIndex:function(){},getIndexForGroup:function(){return 0},clear:function(){}})})})});t("WinJS/Controls/ListView/_GroupsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_ItemsManager","../../Utilities/_UI","../ItemContainer/_Constants"],function(n,t,i,r,u,f,e,o){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_GroupsContainerBase:t.Namespace._lazy(function(){return t.Class.define(function(){},{index:function(n){var i=this.headerFrom(n),t,r;if(i)for(t=0,r=this.groups.length;r>t;t++)if(i===this.groups[t].header)return t;return o._INVALID_INDEX},headerFrom:function(n){for(;n&&!u.hasClass(n,o._headerClass);)n=n.parentNode;return n},requestHeader:function(n){this._waitingHeaderRequests=this._waitingHeaderRequests||{};this._waitingHeaderRequests[n]||(this._waitingHeaderRequests[n]=[]);var t=this;return new i(function(i){var r=t.groups[n];r&&r.header?i(r.header):t._waitingHeaderRequests[n].push(i)})},notify:function(n,t){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[n]){for(var r=this._waitingHeaderRequests[n],i=0,u=r.length;u>i;i++)r[i](t);this._waitingHeaderRequests[n]=[]}},groupFromImpl:function(n,t,i){if(n>t)return null;var r=n+Math.floor((t-n)/2),u=this.groups[r];return i(u,r)?this.groupFromImpl(n,r-1,i):t>r&&!i(this.groups[r+1],r+1)?this.groupFromImpl(r+1,t,i):r},groupFrom:function(n){if(this.groups.length>0){var t=this.groups.length-1,i=this.groups[t];return n(i,t)?this.groupFromImpl(0,this.groups.length-1,n):t}return null},groupFromItem:function(n){return this.groupFrom(function(t){return n<t.startIndex})},groupFromOffset:function(n){return this.groupFrom(function(t){return n<t.offset})},group:function(n){return this.groups[n]},length:function(){return this.groups.length},cleanUp:function(){var n,i,t;if(this.listBinding){for(n=0,i=this.groups.length;i>n;n++)t=this.groups[n],t.userData&&this.listBinding.releaseItem(t.userData);this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var n=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return i.join(n.pendingChanges)}).then(function(){if(n._listView._ifZombieDispose())return i.cancel}).then(function(){n.ignoreChanges=!1},function(t){return n.ignoreChanges=!1,i.wrapError(t)})},fromKey:function(n){for(var i,t=0,r=this.groups.length;r>t;t++)if(i=this.groups[t],i.key===n)return{group:i,index:t};return null},fromHandle:function(n){for(var i,t=0,r=this.groups.length;r>t;t++)if(i=this.groups[t],i.handle===n)return{group:i,index:t};return null}})}),_UnvirtualizedGroupsContainer:t.Namespace._lazy(function(){return t.Class.derive(n._GroupsContainerBase,function(n,t){this._listView=n;this.groupDataSource=t;this.groups=[];this.pendingChanges=[];this.dirty=!0;var i=this,f={beginNotifications:function(){i._listView._versionManager.beginNotifications()},endNotifications:function(){i._listView._versionManager.endNotifications();i._listView._ifZombieDispose()||!i.ignoreChanges&&i._listView._groupsChanged&&i._listView._scheduleUpdate()},indexChanged:function(){i._listView._versionManager.receivedNotification();i._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(n){i._listView._versionManager.receivedNotification();i._listView._writeProfilerMark("groupCountChanged("+n+"),info");i._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(n){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){var t=i.fromKey(n.key);t&&(i._listView._writeProfilerMark("groupChanged("+t.index+"),info"),t.group.userData=n,t.group.startIndex=n.firstItemIndexHint,this.markToRemove(t.group));this.scheduleUpdate()}},removed:function(n){var t,r;(i._listView._versionManager.receivedNotification(),i._listView._groupRemoved(n),i._listView._ifZombieDispose())||(t=i.fromHandle(n),t&&(i._listView._writeProfilerMark("groupRemoved("+t.index+"),info"),i.groups.splice(t.index,1),r=i.groups.indexOf(t.group,t.index),r>-1&&i.groups.splice(r,1),this.markToRemove(t.group)),this.scheduleUpdate())},inserted:function(n,t,r){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupInserted,info");var u=this;n.retain().then(function(f){var e,o;(e=t||r||i.groups.length?u.findIndex(t,r):0,-1!==e)&&(o={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:n.handle},i.groups.splice(e,0,o));u.scheduleUpdate()});i.pendingChanges.push(n)}},moved:function(n,t,r){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupMoved,info");var u=this;n.then(function(f){var o=u.findIndex(t,r),e=i.fromKey(f.key),s;e?(i.groups.splice(e.index,1),-1!==o&&(e.index<o&&o--,e.group.key=f.key,e.group.userData=f,e.group.startIndex=f.firstItemIndexHint,i.groups.splice(o,0,e.group))):-1!==o&&(s={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:n.handle},i.groups.splice(o,0,s),n.retain());u.scheduleUpdate()});i.pendingChanges.push(n)}},reload:function(){i._listView._versionManager.receivedNotification();i._listView._ifZombieDispose()||i._listView._processReload()},markToRemove:function(n){if(n.header){var t=n.header;n.header=null;n.left=-1;n.width=-1;n.decorator=null;n.tabIndex=-1;t.tabIndex=-1;i._listView._groupsToRemove[u._uniqueID(t)]={group:n,header:t}}},scheduleUpdate:function(){i.dirty=!0;i.ignoreChanges||(i._listView._groupsChanged=!0)},findIndex:function(n,t){var r,u=-1;return n&&(r=i.fromHandle(n),r&&(u=r.index+1)),-1===u&&t&&(r=i.fromHandle(t),r&&(u=r.index)),u},removeElements:function(n){if(n.header){var t=n.header.parentNode;t&&(r.disposeSubTree(n.header),t.removeChild(n.header));n.header=null;n.left=-1;n.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(f)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel();this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var n=this;return this.initializePromise=this.groupDataSource.getCount().then(function(t){for(var u=[],r=0;t>r;r++)u.push(n.listBinding.fromIndex(r).retain());return i.join(u)}).then(function(t){var r,u,i;for(n.groups=[],r=0,u=t.length;u>r;r++)i=t[r],n.groups.push({key:i.key,startIndex:i.firstItemIndexHint,handle:i.handle,userData:i});n._listView._writeProfilerMark("GroupsContainer_initialize groups("+t.length+"),info");n._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(t){return n._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),i.wrapError(t)}),this.initializePromise},renderGroup:function(n){if(this._listView.groupHeaderTemplate){var t=this.groups[n];return i.wrap(this._listView._groupHeaderRenderer(i.wrap(t.userData))).then(f._normalizeRendererReturn)}return i.wrap(null)},setDomElement:function(n,t){this.groups[n].header=t;this.notify(n,t)},removeElements:function(){for(var f,o=this._listView._groupsToRemove||{},s=Object.keys(o),t=!1,i=this._listView._selection._getFocused(),u=0,c=s.length;c>u;u++){var h=o[s[u]],n=h.header,l=h.group;(t||i.type!==e.ObjectType.groupHeader||l.userData.index!==i.index||(this._listView._unsetFocusOnItem(),t=!0),n)&&(f=n.parentNode,f&&(r._disposeElement(n),f.removeChild(n)))}t&&this._listView._setFocusOnItem(i);this._listView._groupsToRemove={}},resetGroups:function(){for(var t,i=this.groups.slice(0),n=0,r=i.length;r>n;n++)t=i[n],this.listBinding&&t.userData&&this.listBinding.releaseItem(t.userData);this.groups.length=0;this.dirty=!0}})}),_NoGroups:t.Namespace._lazy(function(){return t.Class.derive(n._GroupsContainerBase,function(n){this._listView=n;this.groups=[{startIndex:0}];this.dirty=!0},{synchronizeGroups:function(){return i.wrap()},addItem:function(){return i.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}];delete this.pinnedItem;delete this.pinnedOffset;this.dirty=!0},renderGroup:function(){return i.wrap(null)},ensureFirstGroup:function(){return i.wrap(this.groups[0])},groupOf:function(){return i.wrap(this.groups[0])},removeElements:function(){}})})})});t("WinJS/Controls/ListView/_Helpers",["exports","../../Core/_Base","../ItemContainer/_Constants","../../Animations"],function(n,t,i,r){"use strict";function f(n){return Array.prototype.slice.call(n)}function u(n,t){if("string"==typeof n)return u([n],t);var i=new Array(Math.floor(t/n.length)+1).join(n.join(""));return i+n.slice(0,t%n.length).join("")}function e(n,t){var r=i._containerEvenClass,f=i._containerOddClass,e=t%2==0?[r,f]:[f,r],o=["<div class='win-container "+e[0]+" win-backdrop'><\/div>","<div class='win-container "+e[1]+" win-backdrop'><\/div>"];return u(o,n)}t.Namespace._moduleDefine(n,"WinJS.UI",{_nodeListToArray:f,_repeat:u,_stripedContainers:e,_ListViewAnimationHelper:{fadeInElement:function(n){return r.fadeIn(n)},fadeOutElement:function(n){return r.fadeOut(n)},animateEntrance:function(n,t){return r.enterContent(n,[{left:t?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"})}}})});t("WinJS/Controls/ListView/_ItemsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_ElementUtilities","../ItemContainer/_Constants"],function(n,t,i,r,u){"use strict";t.Namespace._moduleDefine(n,"WinJS.UI",{_ItemsContainer:t.Namespace._lazy(function(){var n=function(n){this.site=n;this._itemData={};this.waitingItemRequests={}};return n.prototype={requestItem:function(n){this.waitingItemRequests[n]||(this.waitingItemRequests[n]=[]);var t=this;return new i(function(i){var r=t._itemData[n];r&&!r.detached&&r.element?i(r.element):t.waitingItemRequests[n].push(i)})},removeItem:function(n){delete this._itemData[n]},removeItems:function(){this._itemData={};this.waitingItemRequests={}},setItemAt:function(n,t){this._itemData[n]=t;t.detached||this.notify(n,t)},notify:function(n,t){if(this.waitingItemRequests[n]){for(var r=this.waitingItemRequests[n],i=0;i<r.length;i++)r[i](t.element);this.waitingItemRequests[n]=[]}},elementAvailable:function(n){var t=this._itemData[n];t.detached=!1;this.notify(n,t)},itemAt:function(n){var t=this._itemData[n];return t?t.element:null},itemDataAt:function(n){return this._itemData[n]},containerAt:function(n){var t=this._itemData[n];return t?t.container:null},itemBoxAt:function(n){var t=this._itemData[n];return t?t.itemBox:null},itemBoxFrom:function(n){for(;n&&!r.hasClass(n,u._itemBoxClass);)n=n.parentNode;return n},containerFrom:function(n){for(;n&&!r.hasClass(n,u._containerClass);)n=n.parentNode;return n},index:function(n){var i=this.containerFrom(n),t;if(i)for(t in this._itemData)if(this._itemData[t].container===i)return parseInt(t,10);return u._INVALID_INDEX},each:function(n){var t,i;for(t in this._itemData)this._itemData.hasOwnProperty(t)&&(i=this._itemData[t],n(parseInt(t,10),i.element,i))},eachIndex:function(n){for(var t in this._itemData)if(n(parseInt(t,10)))break},count:function(){return Object.keys(this._itemData).length}},n})})});t("WinJS/Controls/ListView/_Layouts",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations/_TransitionAnimation","../../Promise","../../Scheduler","../../_Signal","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","./_ErrorMessages"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function yt(n){return"_win-dynamic-"+n+"-"+ri++}function ni(){for(var n,i,r=lt.sheet.cssRules,u=at.length,t=0;u>t;t++)for(i="."+at[t]+" ",n=r.length-1;n>=0;n--)-1!==r[n].selectorText.indexOf(i)&&lt.sheet.deleteRule(n);at=[]}function pt(n,t,i,r){ni();var f="."+p._listViewClass+" ."+n+" "+i+" { "+r+"}",u="_addDynamicCssRule:"+n+",info";t?t._writeProfilerMark(u):e("WinJS.UI.ListView:Layout"+u);lt.sheet.insertRule(f,0)}function ft(n){at.push(n)}function it(n,t,i){return Math.max(n,Math.min(t,i))}function rt(n,i){return a.convertToPixels(n,t.getComputedStyle(n,null)[i])}function ut(n,t){return rt(t,"margin"+n)+rt(t,"border"+n+"Width")+rt(t,"padding"+n)}function et(n){return ut("Top",n)+ut("Bottom",n)}function ot(n){return ut("Left",n)+ut("Right",n)}function st(n,t){var i,u,r,f;if(n.items)for(i=0,u=n.items.length;u>i;i++)t(n.items[i],i);else for(r=0,f=0;r<n.itemsBlocks.length;r++)for(var e=n.itemsBlocks[r],i=0,u=e.items.length;u>i;i++)t(e.items[i],f++)}function gt(n,t){if(0>t)return null;if(n.items)return t<n.items.length?n.items[t]:null;var r=n.itemsBlocks[0].items.length,i=Math.floor(t/r),u=t%r;return i<n.itemsBlocks.length&&u<n.itemsBlocks[i].items.length?n.itemsBlocks[i].items[u]:null}function ti(n,t){for(var r,i=0,u=t.length;u>i;i++)if(t[i].itemsContainer.element===n){r=t[i].itemsContainer;break}return r}function ht(n){var t,i;return n.itemsBlocks?(t=n.itemsBlocks.length,i=t>0?n.itemsBlocks[0].items.length*(t-1)+n.itemsBlocks[t-1].items.length:0):i=n.items.length,i}function ii(n){var i,r,f,u;return dt||(i=t.document.createElement("div"),i.style.width="500px",i.style.visibility="hidden",r=t.document.createElement("div"),r.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",v.setInnerHTMLUnsafe(r,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'><\/div><div style='width: 100px; height: 100px'><\/div><div style='width: 100px; height: 100px'><\/div><\/div>"),i.appendChild(r),n.viewport.insertBefore(i,n.viewport.firstChild),f=i.offsetWidth>0,u=200,f&&(dt={supportsCSSGrid:!!("-ms-grid-row"in t.document.documentElement.style),nestedFlexTooLarge:r.firstElementChild.offsetWidth>u,nestedFlexTooSmall:r.firstElementChild.offsetWidth<u}),n.viewport.removeChild(i)),dt}function wt(n){return s.is(n)?{realizedRangeComplete:n,layoutComplete:n}:"object"==typeof n&&n&&n.layoutComplete?n:{realizedRangeComplete:s.wrap(),layoutComplete:s.wrap()}}function ct(n){return{left:rt(n,"marginLeft"),right:rt(n,"marginRight"),top:rt(n,"marginTop"),bottom:rt(n,"marginBottom")}}var b=a.Key,nt=a._uniqueID,bt={get itemInfoIsInvalid(){return"Invalid argument: An itemInfo function must be provided which returns an object with numeric width and height properties."},get groupInfoResultIsInvalid(){return"Invalid result: groupInfo result for cell spanning groups must include the following numeric properties: cellWidth and cellHeight."}},lt=t.document.createElement("style"),g,k;t.document.head.appendChild(lt);var ri=0,at=[],ui=r._browserStyleEquivalents,d=ui.transform,tt=r._browserStyleEquivalents.transition.scriptName,vt=d.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",kt=12,dt=null;i.Namespace._moduleDefine(n,"WinJS.UI",{Layout:i.Class.define(function(){}),_LayoutCommon:i.Namespace._lazy(function(){return i.Class.derive(n.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(n){this._groupHeaderPosition=n;this._invalidateLayout()}},initialize:function(n,t){n._writeProfilerMark("Layout:initialize,info");this._inListMode||a.addClass(n.surface,p._gridLayoutClass);this._backdropColorClassName&&a.addClass(n.surface,this._backdropColorClassName);this._disableBackdropClassName&&a.addClass(n.surface,this._disableBackdropClassName);this._groups=[];this._groupMap={};this._oldGroupHeaderPosition=null;this._usingStructuralNodes=!1;this._site=n;this._groupsEnabled=t;this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(n){this._orientation=n;this._horizontal="horizontal"===n;this._invalidateLayout()}},uninitialize:function(){function t(n){for(var i=n.length,t=0;i>t;t++)n[t].cleanUp(!0)}var n="Layout:uninitialize,info";this._elementsToMeasure={};this._site?(this._site._writeProfilerMark(n),a.removeClass(this._site.surface,p._gridLayoutClass),a.removeClass(this._site.surface,p._headerPositionTopClass),a.removeClass(this._site.surface,p._headerPositionLeftClass),a.removeClass(this._site.surface,p._structuralNodesClass),this._site.surface.style.cssText="",this._groups&&(t(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=null,this._backdropColorClassName&&(a.removeClass(this._site.surface,this._backdropColorClassName),ft(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(a.removeClass(this._site.surface,this._disableBackdropClassName),ft(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):e("WinJS.UI.ListView:"+n)},numberOfItemsPerItemsBlock:{get:function(){function i(){for(var i=t._site.groupCount,n=0;i>n;n++)if(t._isCellSpanning(n))return!1;return!0}var t=this;return t._measureItem(0).then(function(){return t._sizes.viewportContentSize!==t._getViewportCrossSize()&&t._viewportSizeChanged(t._getViewportCrossSize()),t._envInfo.nestedFlexTooLarge||t._envInfo.nestedFlexTooSmall||!i()?(t._usingStructuralNodes=!1,null):(t._usingStructuralNodes=n._LayoutCommon._barsPerItemsBlock>0,n._LayoutCommon._barsPerItemsBlock*t._itemsPerBar)})}},layout:function(n,t,i,r){function l(n){function t(n){if(u._usingStructuralNodes){var t=[];return n.itemsBlocks.forEach(function(n){t=t.concat(n.items.slice(0))}),t}return n.items.slice(0)}return{element:n.element,items:t(n)}}function v(){function d(n,t){var i=n.enableCellSpanning?g.CellSpanningGroup:g.UniformGroup;return new i(u,t)}for(var nt=u._groups.length>0?u._getRealizationRange():null,o=[],p=[],w={},b={},c=0,tt=n.length,y,e,k,r,i=0;tt>i;i++){var a=null,h=u._getGroupInfo(i),v=u._site.groupFromIndex(i).key,f=u._groupMap[v],it=f instanceof g.CellSpanningGroup,rt=h.enableCellSpanning;f&&(it!==rt?w[v]=!0:(y=Math.max(0,t.firstIndex-f.startIndex),e=u._rangeForGroup(f,nt),e&&y<=e.lastIndex&&(a={firstIndex:Math.max(y,e.firstIndex),lastIndex:e.lastIndex})));r=d(h,n[i].itemsContainer.element);k=r.prepareLayoutWithCopyOfTree?r.prepareLayoutWithCopyOfTree(l(n[i].itemsContainer),a,f,{groupInfo:h,startIndex:c}):r.prepareLayout(ht(n[i].itemsContainer),a,f,{groupInfo:h,startIndex:c});p.push(k);c+=r.count;o.push(r);b[v]=r}return s.join(p).then(function(){for(var t,i=0,n=0,r=o.length;r>n;n++)t=o[n],t.offset=i,i+=u._getGroupSize(t);Object.keys(u._groupMap).forEach(function(n){var t=!w[n];u._groupMap[n].cleanUp(t)});u._groups=o;u._groupMap=b})}function h(n,i,r){var o,f=u._groups[n],s=Math.max(0,t.firstIndex-f.startIndex),e=u._rangeForGroup(f,i);return r?void f.layoutRealizedRange(s,e):(e||(o=f.startIndex+f.count-1<i.firstIndex),f.layoutUnrealizedRange(s,e,o))}function y(){if(0!==u._groups.length)for(var r=u._getRealizationRange(),e=n.length,o=f.groupIndexFromItemIndex(t.firstIndex),i=o;e>i;i++)h(i,r,!0),u._layoutGroup(i)}function w(){if(0===u._groups.length)return s.wrap();for(var i=u._getRealizationRange(),l=f.groupIndexFromItemIndex(i.firstIndex-1),a=f.groupIndexFromItemIndex(i.lastIndex+1),c=f.groupIndexFromItemIndex(t.firstIndex),o=[],v=u._groups.length,r=!1,e=l,n=Math.max(c,a),n=Math.max(e+1,n);!r;)r=!0,e>=c&&(o.push(h(e,i,!1)),r=!1,e--),v>n&&(o.push(h(n,i,!1)),r=!1,n++);return s.join(o)}var c,u=this,f=u._site,e="Layout.layout",o=e+":realizedRange";return u._site._writeProfilerMark(e+",StartTM"),u._site._writeProfilerMark(o+",StartTM"),c=u._measureItem(0).then(function(){return a[u._usingStructuralNodes?"addClass":"removeClass"](u._site.surface,p._structuralNodesClass),u._sizes.viewportContentSize!==u._getViewportCrossSize()&&u._viewportSizeChanged(u._getViewportCrossSize()),u._cacheRemovedElements(i,u._cachedItemRecords,u._cachedInsertedItemRecords,u._cachedRemovedItems,!1),u._cacheRemovedElements(r,u._cachedHeaderRecords,u._cachedInsertedHeaderRecords,u._cachedRemovedHeaders,!0),v()}).then(function(){var t,e;u._syncDomWithGroupHeaderPosition(n);t=0;u._groups.length>0&&(e=u._groups[u._groups.length-1],t=e.offset+u._getGroupSize(e));u._horizontal?(u._groupsEnabled&&u._groupHeaderPosition===k.left?f.surface.style.cssText+=";height:"+u._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+u._sizes.headerContainerWidth+"px auto)["+n.length+"]":f.surface.style.height=u._sizes.surfaceContentSize+"px",(u._envInfo.nestedFlexTooLarge||u._envInfo.nestedFlexTooSmall)&&(f.surface.style.width=t+"px")):(u._groupsEnabled&&u._groupHeaderPosition===k.top?f.surface.style.cssText+=";width:"+u._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+u._sizes.headerContainerHeight+"px auto)["+n.length+"]":f.surface.style.width=u._sizes.surfaceContentSize+"px",(u._envInfo.nestedFlexTooLarge||u._envInfo.nestedFlexTooSmall)&&(f.surface.style.height=t+"px"));y();u._layoutAnimations(i,r);u._site._writeProfilerMark(o+":complete,info");u._site._writeProfilerMark(o+",StopTM")},function(n){return u._site._writeProfilerMark(o+":canceled,info"),u._site._writeProfilerMark(o+",StopTM"),s.wrapError(n)}),u._layoutPromise=c.then(function(){return w().then(function(){u._site._writeProfilerMark(e+":complete,info");u._site._writeProfilerMark(e+",StopTM")},function(n){return u._site._writeProfilerMark(e+":canceled,info"),u._site._writeProfilerMark(e+",StopTM"),s.wrapError(n)})}),{realizedRangeComplete:c,layoutComplete:u._layoutPromise}},itemsFromRange:function(n,t){return this._rangeContainsItems(n,t)?{firstIndex:this._firstItemFromRange(n),lastIndex:this._lastItemFromRange(t)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(t,i){function o(){var s={type:t.type,index:t.index-u.startIndex},h=u.getAdjacent(s,e),n,c;if("boundary"===h){var i=r._groups[f-1],o=r._groups[f+1],l=r._groups.length-1;if(e===b.leftArrow){if(0===f)return t;if(i instanceof g.UniformGroup&&u instanceof g.UniformGroup){var n=r._indexToCoordinate(s.index),c=r._horizontal?n.row:n.column,a=Math.floor((i.count-1)/r._itemsPerBar),v=a*r._itemsPerBar;return{type:y.ObjectType.item,index:i.startIndex+Math.min(i.count-1,v+c)}}return{type:y.ObjectType.item,index:u.startIndex-1}}return e===b.rightArrow?f===l?t:u instanceof g.UniformGroup&&o instanceof g.UniformGroup?(n=r._indexToCoordinate(s.index),c=r._horizontal?n.row:n.column,{type:y.ObjectType.item,index:o.startIndex+Math.min(o.count-1,c)}):{type:y.ObjectType.item,index:o.startIndex}:t}return h.index+=u.startIndex,h}var r=this,f=r._site.groupIndexFromItemIndex(t.index),u=r._groups[f],e=r._adjustedKeyForOrientationAndBars(r._adjustedKeyForRTL(i),u instanceof g.CellSpanningGroup);if(t.type===y.ObjectType.groupHeader){if(i!==b.pageUp&&i!==b.pageDown){switch(e){case b.leftArrow:return{type:y.ObjectType.groupHeader,index:Math.max(0,t.index-1)};case b.rightArrow:return{type:y.ObjectType.groupHeader,index:Math.min(r._groups.length-1,t.index+1)}}return t}t={type:y.ObjectType.item,index:this._groups[t.index].startIndex}}switch(r._adjustedKeyForRTL(i)){case b.upArrow:case b.leftArrow:case b.downArrow:case b.rightArrow:return o();default:return n._LayoutCommon.prototype._getAdjacentForPageKeys.call(r,t,i)}},hitTest:function(n,t){var r,u=this._sizes,f,i;return n-=u.layoutOriginX,t-=u.layoutOriginY,f=this._groupFromOffset(this._horizontal?n:t),i=this._groups[f],this._horizontal?n-=i.offset:t-=i.offset,this._groupsEnabled&&(this._groupHeaderPosition===k.left?n-=u.headerContainerWidth:t-=u.headerContainerHeight),r=i.hitTest(n,t),r.index+=i.startIndex,r.insertAfterIndex+=i.startIndex,r},setupAnimations:function(){var e,r;if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var s=this._getRealizationRange(),h=this._site.tree,n=0,u="horizontal"===this.orientation,t=0,l=h.length;l>t;t++){var i=h[t],c=!1,o=this._groups[t],a=o instanceof g.CellSpanningGroup,f=o?o.offset:0;(st(i.itemsContainer,function(i,r){if(s.firstIndex<=n&&s.lastIndex>=n&&(c=!0,!this._cachedItemRecords[n])){var u=this._getItemPositionForAnimations(n,t,r),f=u.row,e=u.column,o=u.left,h=u.top;this._cachedItemRecords[n]={oldRow:f,oldColumn:e,oldLeft:o,oldTop:h,width:u.width,height:u.height,element:i,inCellSpanningGroup:a}}n++}.bind(this)),c)&&(e=t,this._cachedHeaderRecords[e]||(r=this._getHeaderPositionForAnimations(e),this._cachedHeaderRecords[e]={oldLeft:r.left,oldTop:r.top,width:r.width,height:r.height,element:i.header}),this._cachedGroupRecords[nt(i.itemsContainer.element)]||(this._cachedGroupRecords[nt(i.itemsContainer.element)]={oldLeft:u?f:0,left:u?f:0,oldTop:u?0:f,top:u?0:f,element:i.itemsContainer.element}))}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(n,t){var w,i,u,o,b,k,l,et,ot;if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM");this._updateAnimationCache(n,t);for(var rt=this._getRealizationRange(),ut=this._site.tree,f=0,v="horizontal"===this.orientation,e=0,ct=ut.length;ct>e;e++){var ft=ut[e],y=this._groups[e],lt=y instanceof g.CellSpanningGroup,s=y?y.offset:0,h=0,c=0,r=this._cachedGroupRecords[nt(ft.itemsContainer.element)];r&&(v?h=r.oldLeft-s:c=r.oldTop-s);st(ft.itemsContainer,function(n,t){var i,r,o,l,s;if(rt.firstIndex<=f&&rt.lastIndex>=f)if(i=this._cachedItemRecords[f],i){var u=this._getItemPositionForAnimations(f,e,t),v=u.row,y=u.column,w=u.left,b=u.top;(i.inCellSpanningGroup=i.inCellSpanningGroup||lt,i.oldRow!==v||i.oldColumn!==y||i.oldTop!==b||i.oldLeft!==w)&&(i.row=v,i.column=y,i.left=w,i.top=b,r=i.oldLeft-i.left-h,o=i.oldTop-i.top-c,(r=(this._site.rtl?-1:1)*r,i.xOffset=r,i.yOffset=o,0!==r||0!==o)&&(l=i.element,i.needsToResetTransform=!0,l.style[tt]="",l.style[d.scriptName]="translate("+r+"px,"+o+"px)"),s=n.parentNode,a.hasClass(s,p._itemsBlockClass)&&(this._animatingItemsBlocks[nt(s)]=s))}else this._cachedInsertedItemRecords[f]=n,n.style[tt]="",n.style.opacity=0;f++}.bind(this));w=e;i=this._cachedHeaderRecords[w];i&&(u=this._getHeaderPositionForAnimations(w),(i.height=u.height,i.width=u.width,i.oldLeft!==u.left||i.oldTop!==u.top)&&(i.left=u.left,i.top=u.top,o=i.oldLeft-i.left,b=i.oldTop-i.top,(o=(this._site.rtl?-1:1)*o,0!==o||0!==b)&&(i.needsToResetTransform=!0,k=i.element,k.style[tt]="",k.style[d.scriptName]="translate("+o+"px,"+b+"px)")));r&&(v&&r.left!==s||!v&&r.top!==s)&&(l=r.element,0===h&&0===c?r.needsToResetTransform&&(r.needsToResetTransform=!1,l.style[d.scriptName]=""):(et=(this._site.rtl?-1:1)*h,ot=c,r.needsToResetTransform=!0,l.style[tt]="",l.style[d.scriptName]="translate("+et+"px, "+ot+"px)"))}if(this._inListMode||1===this._itemsPerBar)for(var ht=Object.keys(this._animatingItemsBlocks),it=0,at=ht.length;at>it;it++)this._animatingItemsBlocks[ht[it]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function dt(){var n;if(oi(),ri)si();else{if(f._itemsPerBar>1)for(var e=f._itemsPerBar*f._sizes.containerCrossSize+f._getHeaderSizeContentAdjustment()+f._sizes.containerMargins[t?"top":i.rtl?"right":"left"]+(t?f._sizes.layoutOriginY:f._sizes.layoutOriginX),r=0,o=u.length;o>r;r++)n=u[r],n[it]>n[rt]?(ut=Math.max(ut,n[ui]+n[t?"height":"width"]),et=Math.max(et,e-n[fi]),bt=!0,y.push(n)):n[it]<n[rt]&&(ft=Math.max(ft,e-n[ui]),ot=Math.max(ot,n[fi]+n[t?"height":"width"]),y.push(n),bt=!0);i.rtl&&!t&&(ut*=-1,et*=-1,ft*=-1,ot*=-1);bt?ci(f._itemsPerBar):wt()}}function pt(t){lt=s.join(v);lt.done(function(){v=[];h&&(n.Layout._debugAnimations?r._requestAnimationFrame(function(){t()}):t())})}function oi(){if(b.length){i._writeProfilerMark("Animation:setupRemoveAnimation,StartTM");ct+=60;k+=60;var n=120;w&&(n*=10);v.push(o.executeTransition(b,[{property:"opacity",delay:ii,duration:n,timing:"linear",to:0,skipStylesReset:!0}]));i._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function si(){var n,s,t,r,h;i._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var f=[],n=0,s=u.length;s>n;n++)t=u[n],r=t.element,f.push(r);for(n=0,s=e.length;s>n;n++)t=e[n],r=t.element,f.push(r);h=120;w&&(h*=10);v.push(o.executeTransition(f,{property:"opacity",delay:ii,duration:h,timing:"linear",to:0}));pt(hi);i._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function hi(){var n,s,r,t,h;i._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM");k=0;for(var f=[],n=0,s=u.length;s>n;n++)r=u[n],t=r.element,t.style[d.scriptName]="",f.push(t);for(n=0,s=e.length;s>n;n++)r=e[n],t=r.element,t.style[d.scriptName]="",f.push(t);h=120;w&&(h*=10);v.push(o.executeTransition(f,{property:"opacity",delay:k,duration:h,timing:"linear",to:1}));i._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM");ni()}function ci(n){var b,u,c,et,k,h;i._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var tt={},r=0,l=y.length;l>r;r++){var f=y[r],e=f.xOffset,s=f.yOffset;f[it]>f[rt]?t?s-=ut:e-=ut:f[it]<f[rt]&&(t?s+=ft:e+=ft);b=f.element;at=Math.min(at,t?e:s);vt=Math.max(vt,t?e:s);u=b.parentNode;a.hasClass(u,"win-itemscontainer")||(u=u.parentNode);c=tt[nt(u)];c||(et=ht(ti(u,i.tree)),tt[nt(u)]=c=Math.ceil(et/n)-1);y[r][t?"column":"row"]===c&&(g[nt(u)]=u);k=80;w&&(k*=10);v.push(o.executeTransition(b,{property:d.cssName,delay:ct,duration:k,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+e+"px,"+s+"px)"}))}for(var ot=Object.keys(g),r=0,l=ot.length;l>r;r++)h=g[ot[r]],i.rtl&&t?(h.style.paddingLeft=-1*at+"px",h.style.marginLeft=at+"px"):(h.style[t?"paddingRight":"paddingBottom"]=vt+"px",h.style[t?"marginRight":"marginBottom"]="-"+vt+"px");for(var st=Object.keys(yt),r=0,l=st.length;l>r;r++)yt[st[r]].classList.add(p._clipClass);pt(li);i._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function gt(){for(var r,u,f=Object.keys(g),n=0,e=f.length;e>n;n++)r=g[f[n]],i.rtl&&t?(r.style.paddingLeft="",r.style.marginLeft=""):(r.style[t?"paddingRight":"paddingBottom"]="",r.style[t?"marginRight":"marginBottom"]="");g={};for(var o=Object.keys(yt),n=0,e=o.length;e>n;n++)u=yt[o[n]],u.style.overflow="",u.classList.remove(p._clipClass)}function li(){var f,s;for(i._writeProfilerMark("Animation:prepareReflowedItems,StartTM"),f=0,s=y.length;s>f;f++){var u=y[f],e=0,o=0;u[it]>u[rt]?t?o=et:e=et:u[it]<u[rt]&&(t?o=-1*ot:e=-1*ot);u.element.style[tt]="";u.element.style[d.scriptName]="translate("+e+"px,"+o+"px)"}i._writeProfilerMark("Animation:prepareReflowedItems,StopTM");n.Layout._debugAnimations?r._requestAnimationFrame(function(){wt(!0)}):wt(!0)}function wt(n){var f=200,t,h,r;if(n&&(f=150,ct=0,k=0),w&&(f*=10),u.length>0||e.length>0){i._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var s=[],t=0,h=e.length;h>t;t++)r=e[t].element,s.push(r);for(t=0,h=u.length;h>t;t++)r=u[t].element,s.push(r);v.push(o.executeTransition(s,{property:d.cssName,delay:ct,duration:f,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}));k+=80;i._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}ni()}function ni(){if(st.length>0){i._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var n=120;w&&(n*=10);v.push(o.executeTransition(st,[{property:"opacity",delay:k,duration:n,timing:"linear",to:1}]));i._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}pt(ai)}function ai(){var t,r,n;for(i._writeProfilerMark("Animation:cleanupAnimations,StartTM"),gt(),t=0,r=b.length;r>t;t++)n=b[t],n.parentNode&&(l._disposeElement(n),n.parentNode.removeChild(n));i._writeProfilerMark("Animation:cleanupAnimations,StopTM");f._animationsRunning=null;h.complete()}var h=new c,ei,f;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),h.complete(),h.promise;this._animationsRunning=h.promise;for(var w=n.Layout._debugAnimations||n.Layout._slowAnimations,i=this._site,st=this._insertedElements,b=this._removedElements,u=this._itemMoveRecords,e=this._moveRecords,ii=0,ct=0,k=0,lt=null,v=[],ri=!1,bt=!1,at=0,vt=0,g={},ut=0,ft=0,et=0,ot=0,y=[],t="horizontal"===this.orientation,it=t?"oldColumn":"oldRow",rt=t?"column":"row",ui=t?"oldTop":"oldLeft",fi=t?"top":"left",yt=this._animatingItemsBlocks,kt=0,vi=u.length;vi>kt;kt++)if(ei=u[kt],ei.inCellSpanningGroup){ri=!0;break}return f=this,n.Layout._debugAnimations?r._requestAnimationFrame(function(){dt()}):dt(),this._resetAnimationCaches(!0),h.promise.then(null,function(){var n,i,t;for(gt(),n=0,i=e.length;i>n;n++)t=e[n].element,t.style[d.scriptName]="",t.style.opacity=1;for(n=0,i=u.length;i>n;n++)t=u[n].element,t.style[d.scriptName]="",t.style.opacity=1;for(n=0,i=st.length;i>n;n++)st[n].style.opacity=1;for(n=0,i=b.length;i>n;n++)t=b[n],t.parentNode&&(l._disposeElement(t),t.parentNode.removeChild(t));this._animationsRunning=null;h=null;lt&&lt.cancel()}.bind(this)),h.promise},dragOver:function(n,t,i){var c=this.hitTest(n,t),l=this._groups?this._site.groupIndexFromItemIndex(c.index):0,b=this._site.tree[l].itemsContainer,a=ht(b),f=this._groups?this._groups[l].startIndex:0,u=this._getVisibleRange(),e,o,s,h,r,nt,v,k,y,p,w;if(c.index-=f,c.insertAfterIndex-=f,u.firstIndex=Math.max(u.firstIndex-f-1,0),u.lastIndex=Math.min(u.lastIndex-f+1,a),e=Math.max(Math.min(a-1,c.insertAfterIndex),-1),o=Math.min(e+1,a),i){for(r=e;r>=u.firstIndex;r--){if(!i._isIncluded(r+f)){e=r;break}r===u.firstIndex&&(e=-1)}for(r=o;r<u.lastIndex;r++){if(!i._isIncluded(r+f)){o=r;break}r===u.lastIndex-1&&(o=a)}}if(s=gt(b,o),h=gt(b,e),this._animatedDragItems)for(r=0,nt=this._animatedDragItems.length;nt>r;r++)v=this._animatedDragItems[r],v&&(v.style[tt]=this._site.animationsDisabled?"":vt,v.style[d.scriptName]="");this._animatedDragItems=[];k="horizontal"===this.orientation;y=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[l]instanceof g.CellSpanningGroup&&(y=1===this._groups[l]._slotsPerColumn);p=0;w=0;!k&&!y||k&&y?p=this._site.rtl?-kt:kt:w=kt;s&&(s.style[tt]=this._site.animationsDisabled?"":vt,s.style[d.scriptName]="translate("+p+"px, "+w+"px)",this._animatedDragItems.push(s));h&&(h.style[tt]=this._site.animationsDisabled?"":vt,h.style[d.scriptName]="translate("+-p+"px, -"+w+"px)",this._animatedDragItems.push(h))},dragLeave:function(){if(this._animatedDragItems)for(var n=0,t=this._animatedDragItems.length;t>n;n++)this._animatedDragItems[n].style[tt]=this._site.animationsDisabled?"":vt,this._animatedDragItems[n].style[d.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(n){n===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),n&&(this._itemsPerBar=Math.min(this._itemsPerBar,n)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=n,this._invalidateLayout())},_getItemPosition:function(n){if(this._groupsEnabled){var t=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(n)),i=this._groups[t],r=n-i.startIndex;return this._getItemPositionForAnimations(n,t,r)}return this._getItemPositionForAnimations(n,0,n)},_getRealizationRange:function(){var n=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(n.firstPixel),lastIndex:this._lastItemFromRange(n.lastPixel)}},_getVisibleRange:function(){var n=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(n.firstPixel),lastIndex:this._lastItemFromRange(n.lastPixel)}},_resetAnimationCaches:function(n){var i;if(!n){this._resetStylesForRecords(this._cachedGroupRecords);this._resetStylesForRecords(this._cachedItemRecords);this._resetStylesForRecords(this._cachedHeaderRecords);this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords);this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);this._resetStylesForRemovedRecords(this._cachedRemovedItems);this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var r=Object.keys(this._animatingItemsBlocks),t=0,u=r.length;u>t;t++)i=this._animatingItemsBlocks[r[t]],i.style.overflow="",i.classList.remove(p._clipClass)}this._cachedGroupRecords={};this._cachedItemRecords={};this._cachedHeaderRecords={};this._cachedInsertedItemRecords={};this._cachedInsertedHeaderRecords={};this._cachedRemovedItems=[];this._cachedRemovedHeaders=[];this._animatingItemsBlocks={}},_cacheRemovedElements:function(n,t,i,r,u){var h="left",c,l,s,a,o,f,e;for(this._site.rtl&&(h="right"),u?(c=this._sizes.headerContainerOuterX,l=this._sizes.headerContainerOuterY):(c=this._sizes.containerMargins[h],l=this._sizes.containerMargins.top),s=0,a=n.length;a>s;s++)o=n[s],-1===o.newIndex&&(f=o.element,e=t[o.oldIndex],e&&(e.element=f,delete t[o.oldIndex],f.style.position="absolute",f.style[tt]="",f.style.top=e.oldTop-l+"px",f.style[h]=e.oldLeft-c+"px",f.style.width=e.width+"px",f.style.height=e.height+"px",f.style[d.scriptName]="",this._site.surface.appendChild(f),r.push(e)),i[o.oldIndex]&&delete i[o.oldIndex])},_cacheInsertedElements:function(n,t,i){for(var r,o,c,f,e={},u=0,h=n.length;h>u;u++)r=n[u],o=t[r.oldIndex],(o&&delete t[r.oldIndex],o||-1===r.oldIndex||r.moved)&&(c=i[r.newIndex],c&&delete i[r.newIndex],f=r.element,e[r.newIndex]=f,f.style[tt]="",f.style[d.scriptName]="",f.style.opacity=0);for(var s=Object.keys(t),u=0,h=s.length;h>u;u++)e[s[u]]=t[s[u]];return e},_resetStylesForRecords:function(n){for(var t,r=Object.keys(n),i=0,u=r.length;u>i;i++)t=n[r[i]],t.needsToResetTransform&&(t.element.style[d.scriptName]="",t.needsToResetTransform=!1)},_resetStylesForInsertedRecords:function(n){for(var r,i=Object.keys(n),t=0,u=i.length;u>t;t++)r=n[i[t]],r.style.opacity=1},_resetStylesForRemovedRecords:function(n){for(var t,i=0,r=n.length;r>i;i++)t=n[i].element,t.parentNode&&(l._disposeElement(t),t.parentNode.removeChild(t))},_updateAnimationCache:function(n,t){function u(n,t){for(var r,u,s,e,o={},i=0,h=n.length;h>i;i++)r=n[i],u=t[r.oldIndex],u&&(o[r.newIndex]=u,u.element=r.element,delete t[r.oldIndex]);for(var c=Object.keys(t),i=0,h=c.length;h>i;i++)s=c[i],e=t[s],(!e.element||f[nt(e.element)])&&(o[s]=e);return o}this._resetStylesForRecords(this._cachedItemRecords);this._resetStylesForRecords(this._cachedHeaderRecords);this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords);this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var f={},e=this._getRealizationRange(),o=this._site.tree,i=0,r=0,s=o.length;s>i;i++)st(o[i].itemsContainer,function(n){e.firstIndex<=r&&e.lastIndex>=r&&(f[nt(n)]=!0);r++});this._cachedItemRecords=u(n,this._cachedItemRecords);this._cachedHeaderRecords=u(t,this._cachedHeaderRecords);this._cachedInsertedItemRecords=this._cacheInsertedElements(n,this._cachedInsertedItemRecords,this._cachedItemRecords);this._cachedInsertedHeaderRecords=this._cacheInsertedElements(t,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function n(n,e){for(var s,o,h=0,c=n.length;c>h;h++)s=n[h],o=s.element,s[t]+s[i]-1<r||s[t]>f||!u._site.viewport.contains(o)?o.parentNode&&(l._disposeElement(o),o.parentNode.removeChild(o)):e.push(o)}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var u=this,t="horizontal"===this.orientation?"oldLeft":"oldTop",i="horizontal"===this.orientation?"width":"height",r=this._site.scrollbarPos,f=r+this._site.viewportSize[i]-1;n(this._cachedRemovedItems,this._removedElements);n(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function n(n,r){for(var u,f,o=Object.keys(n),e=0,s=o.length;s>e;e++)u=o[e],f=n[u],u<t.firstIndex||u>t.lastIndex||i._site.viewport.contains(f.element)?f.style.opacity=1:r.push(f)}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var i=this,t=this._getVisibleRange();n(this._cachedInsertedItemRecords,this._insertedElements);n(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var y=this,h="horizontal"===this.orientation?"oldLeft":"oldTop",c="horizontal"===this.orientation?"left":"top",e="horizontal"===this.orientation?"width":"height",l=this._getRealizationRange(),o=this._site.scrollbarPos,a=o+this._site.viewportSize[e]-1,i,r,s,u,f;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var v=this._site.tree,n=0,t=0,p=v.length;p>t;t++)i=v[t],r=!1,st(i.itemsContainer,function(){var t,i;l.firstIndex<=n&&l.lastIndex>=n&&(t=this._cachedItemRecords[n],t&&(i=(t[h]+t[e]-1>=o&&t[h]<=a||t[c]+t[e]-1>=o&&t[c]<=a)&&y._site.viewport.contains(t.element),i&&(r=!0,t.needsToResetTransform&&(this._itemMoveRecords.push(t),delete this._cachedItemRecords[n]))));n++}.bind(this)),s=t,u=this._cachedHeaderRecords[s],u&&r&&u.needsToResetTransform&&(this._moveRecords.push(u),delete this._cachedHeaderRecords[s]),f=this._cachedGroupRecords[nt(i.itemsContainer.element)],f&&r&&f.needsToResetTransform&&(this._moveRecords.push(f),delete this._cachedGroupRecords[nt(i.itemsContainer.element)]);this._resetStylesForRecords(this._cachedGroupRecords);this._resetStylesForRecords(this._cachedItemRecords);this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(n,t,i){var u=this._groups[t],r=u.getItemPositionForAnimations(i),f=this._groups[t]?this._groups[t].offset:0,e=this._groupsEnabled&&this._groupHeaderPosition===k.left?this._sizes.headerContainerWidth:0,o=this._groupsEnabled&&this._groupHeaderPosition===k.top?this._sizes.headerContainerHeight:0;return r.left+=this._sizes.layoutOriginX+e+this._sizes.itemsContainerOuterX,r.top+=this._sizes.layoutOriginY+o+this._sizes.itemsContainerOuterY,r[this._horizontal?"left":"top"]+=f,r},_getHeaderPositionForAnimations:function(n){var t,i,r,u,f;return this._groupsEnabled?(i=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,r=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight,this._groupHeaderPosition!==k.left||this._horizontal?this._groupHeaderPosition===k.top&&this._horizontal&&(i=this._groups[n].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):r=this._groups[n].getItemsContainerSize()-this._sizes.headerContainerOuterHeight,u=this._horizontal?this._groups[n].offset:0,f=this._horizontal?0:this._groups[n].offset,t={top:this._sizes.layoutOriginY+f+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+u+this._sizes.headerContainerOuterX,height:r,width:i}):t={top:0,left:0,height:0,width:0},t},_rangeContainsItems:function(n,t){if(0===this._groups.length)return!1;var i=this._groups[this._groups.length-1],r=this._sizes.layoutOrigin+i.offset+this._getGroupSize(i)-1;return t>=0&&r>=n},_itemFromOffset:function(n,t){function f(n){if(!t.wholeItem){var r=i._horizontal?i._site.rtl?"right":"left":"top",u=i._horizontal?i._site.rtl?"left":"right":"bottom";return t.last?n-i._sizes.containerMargins[r]:n+i._sizes.containerMargins[u]}return n}function e(n){return t.last?n-i._getHeaderSizeGroupAdjustment()-i._sizes.itemsContainerOuterStart:n}var i=this,u,r;return 0===this._groups.length?0:(t=t||{},n-=this._sizes.layoutOrigin,n=f(n),u=this._groupFromOffset(e(n)),r=this._groups[u],n-=r.offset,n-=this._getHeaderSizeGroupAdjustment(),r.startIndex+r.itemFromOffset(n,t))},_firstItemFromRange:function(n,t){return t=t||{},t.last=0,this._itemFromOffset(n,t)},_lastItemFromRange:function(n,t){return t=t||{},t.last=1,this._itemFromOffset(n,t)},_adjustedKeyForRTL:function(n){return this._site.rtl&&(n===b.leftArrow?n=b.rightArrow:n===b.rightArrow&&(n=b.leftArrow)),n},_adjustedKeyForOrientationAndBars:function(n,t){var i=n;if(t)return n;if(!this._horizontal)switch(i){case b.leftArrow:i=b.upArrow;break;case b.rightArrow:i=b.downArrow;break;case b.upArrow:i=b.leftArrow;break;case b.downArrow:i=b.rightArrow}return 1===this._itemsPerBar&&(i===b.upArrow?i=b.leftArrow:i===b.downArrow&&(i=b.rightArrow)),i},_getAdjacentForPageKeys:function(n,t){var h,i=this._sizes.containerMargins,u="horizontal"===this.orientation?i.left+i.right:i.top+i.bottom,e=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],f=this._site.scrollbarPos,c=f+e-1-i["horizontal"===this.orientation?"right":"bottom"],o=this._firstItemFromRange(f,{wholeItem:!0}),s=this._lastItemFromRange(c,{wholeItem:!1}),r=this._getItemPosition(n.index),l=!1,p,a,w,v;if((n.index<o||n.index>s)&&(l=!0,f="horizontal"===this.orientation?r.left-u:r.top-u,c=f+e-1,o=this._firstItemFromRange(f,{wholeItem:!0}),s=this._lastItemFromRange(c,{wholeItem:!1})),t===b.pageUp){if(!l&&o!==n.index)return{type:y.ObjectType.item,index:o};p="horizontal"===this.orientation?r.left+r.width+u+i.left:r.top+r.height+u+i.bottom;a=this._firstItemFromRange(p-e,{wholeItem:!0});h=n.index===a?Math.max(0,n.index-this._itemsPerBar):a}else{if(!l&&s!==n.index)return{type:y.ObjectType.item,index:s};w="horizontal"===this.orientation?r.left-u-i.right:r.top-u-i.bottom;v=Math.max(0,this._lastItemFromRange(w+e-1,{wholeItem:!0}));h=n.index===v?n.index+this._itemsPerBar:v}return{type:y.ObjectType.item,index:h}},_isCellSpanning:function(n){var i=this._site.groupFromIndex(n),t=this._groupInfo;return t?!!("function"==typeof t?t(i):t).enableCellSpanning:!1},_getGroupInfo:function(n){var f=this._site.groupFromIndex(n),t=this._groupInfo,i=this._sizes.containerMargins,r={enableCellSpanning:!1};if(t="function"==typeof t?t(f):t){if(t.enableCellSpanning&&(+t.cellWidth!==t.cellWidth||+t.cellHeight!==t.cellHeight))throw new u("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",bt.groupInfoResultIsInvalid);r={enableCellSpanning:!!t.enableCellSpanning,cellWidth:t.cellWidth+i.left+i.right,cellHeight:t.cellHeight+i.top+i.bottom}}return r},_getItemInfo:function(n){var t;if(this._itemInfo&&"function"==typeof this._itemInfo)t=this._itemInfo(n);else{if(!this._useDefaultItemInfo)throw new u("WinJS.UI.GridLayout.ItemInfoIsInvalid",bt.itemInfoIsInvalid);t=this._defaultItemInfo(n)}return s.as(t).then(function(n){if(!n||+n.width!==n.width||+n.height!==n.height)throw new u("WinJS.UI.GridLayout.ItemInfoIsInvalid",bt.itemInfoIsInvalid);return n})},_defaultItemInfo:function(n){var t=this;return this._site.renderItem(this._site.itemFromIndex(n)).then(function(i){return t._elementsToMeasure[n]={element:i},t._measureElements()}).then(function(){var i=t._elementsToMeasure[n],r={width:i.width,height:i.height};return delete t._elementsToMeasure[n],r},function(i){return delete t._elementsToMeasure[n],s.wrapError(i)})},_getGroupSize:function(n){var t=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===k.top?t=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==k.left||(t=this._sizes.headerContainerMinHeight)),Math.max(t,n.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(n){return n<this._groups[0].offset?0:this._groupFrom(function(t){return n<t.offset})},_groupFromImpl:function(n,t,i){if(n>t)return null;var r=n+Math.floor((t-n)/2),u=this._groups[r];return i(u,r)?this._groupFromImpl(n,r-1,i):t>r&&!i(this._groups[r+1],r+1)?this._groupFromImpl(r+1,t,i):r},_groupFrom:function(n){if(this._groups.length>0){var t=this._groups.length-1,i=this._groups[t];return n(i,t)?this._groupFromImpl(0,this._groups.length-1,n):t}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null);this._containerSizeClassName&&(a.removeClass(this._site.surface,this._containerSizeClassName),ft(this._containerSizeClassName),this._containerSizeClassName=null);this._sizes=null;this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var n=this;n._measuringElements=h.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){var e,i,u,o,s,l;n._site._writeProfilerMark("_measureElements,StartTM");var r=n._createMeasuringSurface(),f=t.document.createElement("div"),h=n._site,v=n._measuringElements,c=n._elementsToMeasure,y=!1;for(f.className=p._itemsContainerClass+" "+p._laidOutClass,f.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1",u=Object.keys(c),i=0,e=u.length;e>i;i++)o=c[u[i]].element,o.style["-ms-grid-column"]=i+1,o.style["-ms-grid-row"]=i+1,f.appendChild(o);for(r.appendChild(f),h.viewport.insertBefore(r,h.viewport.firstChild),v.then(null,function(){y=!0}),i=0,e=u.length;e>i&&!y;i++)s=c[u[i]],l=s.element.querySelector("."+p._itemClass),s.width=a.getTotalWidth(l),s.height=a.getTotalHeight(l);r.parentNode&&r.parentNode.removeChild(r);v===n._measuringElements&&(n._measuringElements=null);h._writeProfilerMark("_measureElements,StopTM")},function(t){return n._measuringElements=null,s.wrapError(t)})}return this._measuringElements},_ensureEnvInfo:function(){return this._envInfo||(this._envInfo=ii(this._site),this._envInfo&&!this._envInfo.supportsCSSGrid&&a.addClass(this._site.surface,p._noCSSGrid)),!!this._envInfo},_createMeasuringSurface:function(){var n=t.document.createElement("div");return n.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto;-ms-flex-align: start;-webkit-align-items: flex-start;align-items: flex-start",n.className=p._scrollableClass+" "+(this._inListMode?p._listLayoutClass:p._gridLayoutClass),this._envInfo.supportsCSSGrid||a.addClass(n,p._noCSSGrid),this._groupsEnabled&&(this._groupHeaderPosition===k.top?a.addClass(n,p._headerPositionTopClass):a.addClass(n,p._headerPositionLeftClass)),n},_measureItem:function(n){function o(n,u){var u,h=!!u,e={},c=r.rtl?"right":"left";return r.itemCount.then(function(t){return!t||i._groupsEnabled&&!r.groupCount?s.cancel:(u=u||r.itemFromIndex(n),e.container=r.renderItem(u),i._groupsEnabled&&(e.headerContainer=r.renderHeader(i._site.groupFromIndex(r.groupIndexFromItemIndex(n)))),s.join(e))}).then(function(e){function vt(){var s=i._horizontal,h=i._groupsEnabled,u=!1,t;f.then(null,function(){u=!0});var o=ct(b),l=r.rtl?r.viewport.offsetWidth-(b.offsetLeft+b.offsetWidth):b.offsetLeft,v=b.offsetTop,n={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:et(w),surfaceOuterWidth:ot(w),layoutOriginX:l-o[c],layoutOriginY:v-o.top,itemsContainerOuterHeight:et(y),itemsContainerOuterWidth:ot(y),itemsContainerOuterX:ut(r.rtl?"Right":"Left",y),itemsContainerOuterY:ut("Top",y),itemsContainerMargins:ct(y),itemBoxOuterHeight:et(st),itemBoxOuterWidth:ot(st),containerOuterHeight:et(e.container),containerOuterWidth:ot(e.container),emptyContainerContentHeight:a.getContentHeight(d),emptyContainerContentWidth:a.getContentWidth(d),containerMargins:ct(e.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};return h&&(n.headerContainerOuterX=ut(r.rtl?"Right":"Left",e.headerContainer),n.headerContainerOuterY=ut("Top",e.headerContainer),n.headerContainerOuterWidth=ot(e.headerContainer),n.headerContainerOuterHeight=et(e.headerContainer),n.headerContainerWidth=a.getTotalWidth(e.headerContainer),n.headerContainerHeight=a.getTotalHeight(e.headerContainer),n.headerContainerMinWidth=rt(e.headerContainer,"minWidth")+n.headerContainerOuterWidth,n.headerContainerMinHeight=rt(e.headerContainer,"minHeight")+n.headerContainerOuterHeight),t={sizes:n,viewportContentWidth:a.getContentWidth(r.viewport),viewportContentHeight:a.getContentHeight(r.viewport),containerContentWidth:a.getContentWidth(e.container),containerContentHeight:a.getContentHeight(e.container),containerWidth:a.getTotalWidth(e.container),containerHeight:a.getTotalHeight(e.container)},t.viewportCrossSize=t[s?"viewportContentHeight":"viewportContentWidth"],r.readyToMeasure(),u?null:t}function nt(){w.parentNode&&w.parentNode.removeChild(w)}var w=i._createMeasuringSurface(),y=t.document.createElement("div"),d=t.document.createElement("div"),st=e.container.querySelector("."+p._itemBoxClass),ht=r.groupIndexFromItemIndex(n),v,l,ft;d.className=p._containerClass;y.className=p._itemsContainerClass+" "+p._laidOutClass;var lt=1,at=1,tt=2,it=2,b=y,g=!1;if((i._inListMode&&i._groupsEnabled&&(i._horizontal&&i._groupHeaderPosition===k.top?(lt=2,it=1,tt=1,b=e.headerContainer,g=!0):i._horizontal||i._groupHeaderPosition!==k.left||(at=2,it=1,tt=1,b=e.headerContainer,g=!0)),y.style.cssText+=";display: "+(i._inListMode?(i._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+at+";-ms-grid-row: "+lt,i._inListMode||(e.container.style.display="inline-block"),i._groupsEnabled&&(e.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+it+";-ms-grid-row: "+tt,a.addClass(e.headerContainer,p._laidOutClass+" "+p._groupLeaderClass),(i._groupHeaderPosition===k.top&&i._horizontal||i._groupHeaderPosition===k.left&&!i._horizontal)&&a.addClass(y,p._groupLeaderClass)),g&&w.appendChild(e.headerContainer),y.appendChild(e.container),y.appendChild(d),w.appendChild(y),!g&&i._groupsEnabled&&w.appendChild(e.headerContainer),r.viewport.insertBefore(w,r.viewport.firstChild),v=vt(),!v)||i._horizontal&&0===v.viewportContentHeight||!i._horizontal&&0===v.viewportContentWidth)return nt(),s.cancel;if(!(h||i._isCellSpanning(ht)||0!==v.containerContentWidth&&0!==v.containerContentHeight))return nt(),u.then(function(){return o(n,u)});l=i._sizes=v.sizes;(Object.defineProperties(l,{surfaceOuterCrossSize:{get:function(){return i._horizontal?l.surfaceOuterHeight:l.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return i._horizontal?l.layoutOriginX:l.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return i._horizontal?l.itemsContainerOuterWidth:l.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return i._horizontal?l.itemsContainerOuterHeight:l.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return i._horizontal?l.itemsContainerOuterX:l.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return i._horizontal?l.itemsContainerOuterY:l.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return i._horizontal?l.containerHeight:l.containerWidth},enumerable:!0},containerSize:{get:function(){return i._horizontal?l.containerWidth:l.containerHeight},enumerable:!0}}),i._isCellSpanning(ht))||(i._inListMode?(ft=v.viewportCrossSize-l.surfaceOuterCrossSize-i._getHeaderSizeContentAdjustment()-l.itemsContainerOuterCrossSize,i._horizontal?(l.containerHeight=ft,l.containerWidth=v.containerWidth):(l.containerHeight=v.containerHeight,l.containerWidth=ft)):(l.containerWidth=v.containerWidth,l.containerHeight=v.containerHeight),l.containerSizeLoaded=!0);i._createContainerStyleRule();i._viewportSizeChanged(v.viewportCrossSize);nt()})}var i=this,u="Layout:measureItem",r=i._site,f=i._measuringPromise,e;return f||(r._writeProfilerMark(u+",StartTM"),e=new c,i._measuringPromise=f=e.promise.then(function(){return i._ensureEnvInfo()?o(n):s.cancel}).then(function(){r._writeProfilerMark(u+":complete,info");r._writeProfilerMark(u+",StopTM")},function(n){return i._measuringPromise=null,r._writeProfilerMark(u+":canceled,info"),r._writeProfilerMark(u+",StopTM"),s.wrapError(n)}),e.complete()),f},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===k.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===k.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===k.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===k.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(n){var t=this._sizes;t.viewportContentSize=n;t.surfaceContentSize=n-t.surfaceOuterCrossSize;t.maxItemsContainerContentSize=t.surfaceContentSize-t.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment();t.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(t.maxItemsContainerContentSize/t.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(t[this._horizontal?"containerHeight":"containerWidth"]=t.maxItemsContainerContentSize),this._itemsPerBar=1);this._resetAnimationCaches()},_createContainerStyleRule:function(){var n=this._sizes,t,i,r,u;!this._containerSizeClassName&&n.containerSizeLoaded&&(0===n.emptyContainerContentHeight||0===n.emptyContainerContentWidth)&&(t=n.containerWidth-n.containerOuterWidth+"px",i=n.containerHeight-n.containerOuterHeight+"px",this._inListMode&&(this._horizontal?i="calc(100% - "+(n.containerMargins.top+n.containerMargins.bottom)+"px)":t="auto"),this._containerSizeClassName||(this._containerSizeClassName=yt("containersize"),a.addClass(this._site.surface,this._containerSizeClassName)),r="."+p._containerClass,u="width:"+t+";height:"+i+";",pt(this._containerSizeClassName,this._site,r,u))},_ensureContainerSize:function(n){var i=this._sizes,r,u,t;return i.containerSizeLoaded||this._ensuringContainerSize?this._ensuringContainerSize?this._ensuringContainerSize:s.wrap():(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo?r=this._getItemInfo():(u=i.containerMargins,r=s.wrap({width:n.groupInfo.cellWidth-u.left-u.right,height:n.groupInfo.cellHeight-u.top-u.bottom})),t=this,this._ensuringContainerSize=r.then(function(n){i.containerSizeLoaded=!0;i.containerWidth=n.width+i.itemBoxOuterWidth+i.containerOuterWidth;i.containerHeight=n.height+i.itemBoxOuterHeight+i.containerOuterHeight;t._inListMode?t._itemsPerBar=1:(t._itemsPerBar=Math.floor(i.maxItemsContainerContentSize/i.containerCrossSize),t.maximumRowsOrColumns&&(t._itemsPerBar=Math.min(t._itemsPerBar,t.maximumRowsOrColumns)),t._itemsPerBar=Math.max(1,t._itemsPerBar));t._createContainerStyleRule()}),r.done(function(){t._ensuringContainerSize=null},function(){t._ensuringContainerSize=null}),r)},_indexToCoordinate:function(n,t){t=t||this._itemsPerBar;var i=Math.floor(n/t);return this._horizontal?{column:i,row:n-i*t}:{row:i,column:n-i*t}},_rangeForGroup:function(n,t){var i=n.startIndex,r=i+n.count-1;return!t||t.firstIndex>r||t.lastIndex<i?null:{firstIndex:Math.max(0,t.firstIndex-i),lastIndex:Math.min(n.count-1,t.lastIndex-i)}},_syncDomWithGroupHeaderPosition:function(n){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var t,i=n.length;if(this._oldGroupHeaderPosition===k.top)if(a.removeClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)n[t].header.style.maxWidth="",a.removeClass(n[t].itemsContainer.element,p._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===k.left){if(a.removeClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)n[t].header.style.maxHeight="",a.removeClass(n[t].itemsContainer.element,p._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===k.top){if(a.addClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)a.addClass(n[t].itemsContainer.element,p._groupLeaderClass)}else if(a.addClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)a.addClass(n[t].itemsContainer.element,p._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(n){var f=this._groups[n],e=this._site.tree[n],i=e.header,r=e.itemsContainer.element,t=this._sizes,u=f.getItemsContainerCrossSize(),o,s,h,c;this._groupsEnabled&&(this._horizontal?this._groupHeaderPosition===k.top?(o=t.headerContainerMinWidth-t.headerContainerOuterWidth,s=f.getItemsContainerSize()-t.headerContainerOuterWidth,i.style.maxWidth=Math.max(o,s)+"px",this._envInfo.supportsCSSGrid?(i.style.msGridColumn=n+1,r.style.msGridColumn=n+1):(i.style.height=t.headerContainerHeight-t.headerContainerOuterHeight+"px",r.style.height=u-t.itemsContainerOuterHeight+"px",r.style.marginBottom=t.itemsContainerMargins.bottom+(t.maxItemsContainerContentSize-u+t.itemsContainerOuterHeight)+"px"),a.addClass(r,p._groupLeaderClass)):this._envInfo.supportsCSSGrid?(i.style.msGridColumn=2*n+1,r.style.msGridColumn=2*n+2):(i.style.width=t.headerContainerWidth-t.headerContainerOuterWidth+"px",i.style.height=u-t.headerContainerOuterHeight+"px",r.style.height=u-t.itemsContainerOuterHeight+"px"):this._groupHeaderPosition===k.left?(h=t.headerContainerMinHeight-t.headerContainerOuterHeight,c=f.getItemsContainerSize()-t.headerContainerOuterHeight,i.style.maxHeight=Math.max(h,c)+"px",this._envInfo.supportsCSSGrid?(i.style.msGridRow=n+1,r.style.msGridRow=n+1):(i.style.width=t.headerContainerWidth-t.headerContainerOuterWidth+"px",r.style.width=u-t.itemsContainerOuterWidth+"px",r.style["margin"+(this._site.rtl?"Left":"Right")]=t.itemsContainerMargins[this._site.rtl?"left":"right"]+(t.maxItemsContainerContentSize-u+t.itemsContainerOuterWidth)+"px"),a.addClass(r,p._groupLeaderClass)):(i.style.msGridRow=2*n+1,this._inListMode?i.style.height=t.headerContainerHeight-t.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?r.style.msGridRow=2*n+2:(i.style.height=t.headerContainerHeight-t.headerContainerOuterHeight+"px",i.style.width=u-t.headerContainerOuterWidth+"px",r.style.width=u-t.itemsContainerOuterWidth+"px")),a.addClass(i,p._laidOutClass+" "+p._groupLeaderClass));a.addClass(r,p._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:i.Namespace._lazy(function(){return i.Class.derive(n._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(n){if(a._deprecated(w.disableBackdropIsDeprecated),n=!!n,this._backdropDisabled!==n&&(this._backdropDisabled=n,this._disableBackdropClassName&&(ft(this._disableBackdropClassName),this._site&&a.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=yt("disablebackdrop"),this._site&&a.addClass(this._site.surface,this._disableBackdropClassName),n))pt(this._disableBackdropClassName,this._site,".win-container.win-backdrop","background-color:transparent;")}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(n){if(a._deprecated(w.backdropColorIsDeprecated),n&&this._backdropColor!==n){this._backdropColor=n;this._backdropColorClassName&&(ft(this._backdropColorClassName),this._site&&a.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null);this._backdropColorClassName=yt("backdropcolor");this._site&&a.addClass(this._site.surface,this._backdropColorClassName);var t="background-color:"+n+";";pt(this._backdropColorClassName,this._site,".win-container.win-backdrop",t)}}}})}),GridLayout:i.Namespace._lazy(function(){return i.Class.derive(n._LegacyLayout,function(n){n=n||{};this.itemInfo=n.itemInfo;this.groupInfo=n.groupInfo;this._maxRowsOrColumns=0;this._useDefaultItemInfo=!0;this._elementsToMeasure={};this._groupHeaderPosition=n.groupHeaderPosition||k.top;this.orientation=n.orientation||"horizontal";n.maxRows&&(this.maxRows=+n.maxRows);n.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+n.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(n){this._setMaxRowsOrColumns(n)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(n){a._deprecated(w.maxRowsIsDeprecated);this.maximumRowsOrColumns=n}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(n){n&&a._deprecated(w.itemInfoIsDeprecated);this._itemInfo=n;this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(n){n&&a._deprecated(w.groupInfoIsDeprecated);this._groupInfo=n;this._invalidateLayout()}}})})});g=i.Namespace.defineWithParent(null,null,{UniformGroupBase:i.Namespace._lazy(function(){return i.Class.define(null,{cleanUp:function(){},itemFromOffset:function(n,t){var i;t=t||{};i=this._layout._sizes;n-=i.itemsContainerOuterStart;t.wholeItem&&(n+=(t.last?-1:1)*(i.containerSize-1));var r=this.count-1,u=Math.floor(r/this._layout._itemsPerBar),f=it(0,u,Math.floor(n/i.containerSize)),e=(f+t.last)*this._layout._itemsPerBar-t.last;return it(0,this.count-1,e)},hitTest:function(n,t){var f=this._layout._horizontal,u=this._layout._itemsPerBar,e=this._layout._inListMode||1===u,h=f?n:t,c=f?t:n,r=this._layout._sizes,l;h-=r.itemsContainerOuterStart;c-=r.itemsContainerOuterCrossStart;var i,o=Math.floor(h/r.containerSize),a=it(0,u-1,Math.floor(c/r.containerCrossSize)),s=Math.max(-1,o*u+a);return(i=!f&&e||f&&!e?(t-r.containerHeight/2)/r.containerHeight:(n-r.containerWidth/2)/r.containerWidth,e)?(i=Math.floor(i),{index:s,insertAfterIndex:i>=0&&s>=0?i:-1}):(i=it(-1,u-1,i),l=0>i?o*u-1:o*u+Math.floor(i),{index:it(-1,this.count-1,s),insertAfterIndex:it(-1,this.count-1,l)})},getAdjacent:function(n,t){var i,r=n.index,u=Math.floor(r/this._layout._itemsPerBar),f=r%this._layout._itemsPerBar,e,o,s,h;switch(t){case b.upArrow:i=0===f?"boundary":r-1;break;case b.downArrow:e=r===this.count-1;o=this._layout._itemsPerBar>1&&f===this._layout._itemsPerBar-1;i=e||o?"boundary":r+1;break;case b.leftArrow:i=0===u&&this._layout._itemsPerBar>1?"boundary":r-this._layout._itemsPerBar;break;case b.rightArrow:s=this.count-1;h=Math.floor(s/this._layout._itemsPerBar);i=u===h?"boundary":Math.min(r+this._layout._itemsPerBar,this.count-1)}return"boundary"===i?i:{type:y.ObjectType.item,index:i}},getItemsContainerSize:function(){var n=this._layout._sizes,t=Math.ceil(this.count/this._layout._itemsPerBar);return t*n.containerSize+n.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var n=this._layout._sizes;return this._layout._itemsPerBar*n.containerCrossSize+n.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(n){var t=this._layout._sizes,u=this._layout._site.rtl?"right":"left",r=this._layout._sizes.containerMargins,i=this._layout._indexToCoordinate(n);return{row:i.row,column:i.column,top:r.top+i.row*t.containerHeight,left:r[u]+i.column*t.containerWidth,height:t.containerHeight-t.containerMargins.top-t.containerMargins.bottom,width:t.containerWidth-t.containerMargins.left-t.containerMargins.right}}})}),UniformGroup:i.Namespace._lazy(function(){return i.Class.derive(g.UniformGroupBase,function(n,t){this._layout=n;this._itemsContainer=t;a.addClass(this._itemsContainer,n._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(n){n||(a.removeClass(this._itemsContainer,p._uniformGridLayoutClass),a.removeClass(this._itemsContainer,p._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width="");this._itemsContainer=null;this._layout=null;this.groupInfo=null;this.startIndex=null;this.offset=null;this.count=null},prepareLayout:function(n,t,i,r){return this.groupInfo=r.groupInfo,this.startIndex=r.startIndex,this.count=n,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var n=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-n.itemsContainerOuterSize+"px";this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?n.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*n.containerCrossSize+"px"},layoutUnrealizedRange:function(){return s.wrap()}})}),UniformFlowGroup:i.Namespace._lazy(function(){return i.Class.derive(g.UniformGroupBase,function(n,t){this._layout=n;this._itemsContainer=t.element;a.addClass(this._itemsContainer,n._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(n){n||(a.removeClass(this._itemsContainer,p._uniformListLayoutClass),a.removeClass(this._itemsContainer,p._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info");this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:i.Namespace._lazy(function(){return i.Class.define(function(n,t){this._layout=n;this._itemsContainer=t;a.addClass(this._itemsContainer,p._cellSpanningGridLayoutClass);this.resetMap()},{cleanUp:function(n){n||(this._cleanContainers(),a.removeClass(this._itemsContainer,p._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText="");this._itemsContainer=null;this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null);this.resetMap();this._slotsPerColumn=null;this._offScreenSlotsPerColumn=null;this._items=null;this._layout=null;this._containersToHide=null;this.groupInfo=null;this.startIndex=null;this.offset=null;this.count=null},prepareLayoutWithCopyOfTree:function(n,t,i,r){var u,e=this,f;if(this._containersToHide={},t)for(u=t.firstIndex;u<=t.lastIndex;u++)this._containersToHide[nt(i._items[u])]=i._items[u];for(this.groupInfo=r.groupInfo,this.startIndex=r.startIndex,this.count=n.items.length,this._items=n.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap(),f=new Array(this.count),u=0;u<this.count;u++)f[u]=this._layout._getItemInfo(this.startIndex+u);return s.join(f).then(function(n){n.forEach(function(n,t){e.addItemToMap(t,n)})})},layoutRealizedRange:function(n,t){if(t)for(var r=Math.max(n,t.firstIndex),i=r;i<=t.lastIndex;i++)this._layoutItem(i),delete this._containersToHide[nt(this._items[i])];Object.keys(this._containersToHide).forEach(function(n){a.removeClass(this._containersToHide[n],p._laidOutClass)}.bind(this));this._containersToHide={};this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(n,t,i){var u,r=this;return r._layoutPromise=new s(function(f){function l(){u=null;f()}function a(n){return h.schedule(n,h.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}var e;if(t){var s=!1,c=t.firstIndex-1,o=Math.max(n,t.lastIndex+1);o=Math.max(c+1,o);u=a(function v(t){for(;!s;){if(t.shouldYield)return void t.setWork(v);s=!0;c>=n&&(r._layoutItem(c),c--,s=!1);o<r.count&&(r._layoutItem(o),o++,s=!1)}l()})}else i?(e=r.count-1,u=a(function y(t){for(;e>=n;e--){if(t.shouldYield)return void t.setWork(y);r._layoutItem(e)}l()})):(e=n,u=a(function p(n){for(;e<r.count;e++){if(n.shouldYield)return void n.setWork(p);r._layoutItem(e)}l()}))},function(){u&&u.cancel();u=null}),r._layoutPromise},itemFromOffset:function(n,t){var i,r,u;return t=t||{},i=this._layout._sizes,r=i.containerMargins,n-=i.itemsContainerOuterX,n-=(t.last?1:-1)*r[t.last?"left":"right"],u=this.indexFromOffset(n,t.wholeItem,t.last).item,it(0,this.count-1,u)},getAdjacent:function(n,t){var u,e,r,f,i;u=e=n.index;i=this.lastAdjacent===u?this.lastInMapIndex:this.findItem(u);do{var o=Math.floor(i/this._slotsPerColumn),s=i-o*this._slotsPerColumn,h=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(t){case b.upArrow:if(!(s>0))return{type:y.ObjectType.item,index:e};i--;break;case b.downArrow:if(!(s+1<this._slotsPerColumn))return{type:y.ObjectType.item,index:e};i++;break;case b.leftArrow:i=o>0?i-this._slotsPerColumn:-1;break;case b.rightArrow:i=h>o?i+this._slotsPerColumn:this.occupancyMap.length}f=i>=0&&i<this.occupancyMap.length;f&&(r=this.occupancyMap[i]?this.occupancyMap[i].index:void 0)}while(f&&(u===r||void 0===r));return this.lastAdjacent=r,this.lastInMapIndex=i,f?{type:y.ObjectType.item,index:r}:"boundary"},hitTest:function(n,t){var e=this._layout._sizes,i=0;if(n-=e.itemsContainerOuterX,t-=e.itemsContainerOuterY,this.occupancyMap.length>0){for(var h=this.indexFromOffset(n,!1,0),c=Math.min(this._slotsPerColumn-1,Math.floor(t/this.groupInfo.cellHeight)),r=h.index,u=r;c-->0;)r++,this.occupancyMap[r]&&(u=r);this.occupancyMap[u]||u--;i=this.occupancyMap[u].index}var f=this.getItemSize(i),l=f.column*this.groupInfo.cellWidth,a=f.row*this.groupInfo.cellHeight,o=1===this._slotsPerColumn,s=i;return(o&&n<l+f.contentWidth/2||!o&&t<a+f.contentHeight/2)&&s--,{type:y.ObjectType.item,index:it(0,this.count-1,i),insertAfterIndex:it(-1,this.count-1,s)}},getItemsContainerSize:function(){var n=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+n.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var n=this._layout._sizes;return n.maxItemsContainerContentSize+n.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(n){var u=this._layout._site.rtl?"right":"left",i=this._layout._sizes.containerMargins,t=this.getItemSize(n),r=this.groupInfo;return{row:t.row,column:t.column,top:i.top+t.row*r.cellHeight,left:i[u]+t.column*r.cellWidth,height:t.contentHeight,width:t.contentWidth}},_layoutItem:function(n){var t=this.getItemSize(n);return this._items[n].style.cssText+=";-ms-grid-row:"+(t.row+1)+";-ms-grid-column:"+(t.column+1)+";-ms-grid-row-span:"+t.rows+";-ms-grid-column-span:"+t.columns+";height:"+t.contentHeight+"px;width:"+t.contentWidth+"px",a.addClass(this._items[n],p._laidOutClass),this._items[n]},_cleanContainers:function(){for(var t=this._items,i=t.length,n=0;i>n;n++)t[n].style.cssText="",a.removeClass(t[n],p._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var n=-1;return this.occupancyMap.forEach(function(t){t.index>n&&(n=t.index)}),n+1},coordinateToIndex:function(n,t){return n*this._slotsPerColumn+t},markSlotAsFull:function(n,t){for(var u,e,i=this._layout._indexToCoordinate(n,this._slotsPerColumn),f=i.row+t.rows,r=i.row;f>r&&r<this._slotsPerColumn;r++)for(u=i.column,e=i.column+t.columns;e>u;u++)this.occupancyMap[this.coordinateToIndex(u,r)]=t;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,f-this._slotsPerColumn)},isSlotEmpty:function(n,t,i){for(var u,e,r=t,f=t+n.rows;f>r;r++)for(u=i,e=i+n.columns;e>u;u++)if(r>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(u,r)])return!1;return!0},findEmptySlot:function(n,t,i){var f=this._layout._indexToCoordinate(n,this._slotsPerColumn),o=f.row,e=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn),r,u;if(i){for(r=f.column+1;e>=r;r++)if(this.isSlotEmpty(t,0,r))return this.coordinateToIndex(r,0)}else for(r=f.column;e>=r;r++){for(u=o;u<this._slotsPerColumn;u++)if(this.isSlotEmpty(t,u,r))return this.coordinateToIndex(r,u);o=0}return(e+1)*this._slotsPerColumn},findItem:function(n){for(var i,t=n,r=this.occupancyMap.length;r>t;t++)if(i=this.occupancyMap[t],i&&i.index===n)return t;return t},getItemSize:function(n){var i=this.findItem(n),t=this.occupancyMap[i],r=this._layout._indexToCoordinate(i,this._slotsPerColumn);return n===t.index?{row:r.row,column:r.column,contentWidth:t.contentWidth,contentHeight:t.contentHeight,columns:t.columns,rows:t.rows}:null},resetMap:function(){this.occupancyMap=[];this.lastAdded=0;this._offScreenSlotsPerColumn=0},addItemToMap:function(n,t){function f(n,t){var r=i.findEmptySlot(i.lastAdded,n,t);i.lastAdded=r;i.markSlotAsFull(r,n)}var i=this,u=i.groupInfo,r=i._layout._sizes.containerMargins,e={index:n,contentWidth:t.width,contentHeight:t.height,columns:Math.max(1,Math.ceil((t.width+r.left+r.right)/u.cellWidth)),rows:Math.max(1,Math.ceil((t.height+r.top+r.bottom)/u.cellHeight))};f(e,t.newColumn)},indexFromOffset:function(n,t,i){var u=0,e=0,f=this.groupInfo,r=0,o;if(this.occupancyMap.length>0){if(e=this.getOccupancyMapItemCount()-1,u=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*f.cellWidth,u>n){for(o=this._slotsPerColumn,r=(Math.max(0,Math.floor(n/f.cellWidth))+i)*this._slotsPerColumn-i;!this.occupancyMap[r]&&o-->0;)r+=i>0?-1:1;return{index:r,item:this.occupancyMap[r].index}}r=this.occupancyMap.length-1}return{index:r,item:e+(Math.max(0,Math.floor((n-u)/f.cellWidth))+i)*this._slotsPerColumn-i}}})})});i.Namespace._moduleDefine(n,"WinJS.UI",{ListLayout:i.Namespace._lazy(function(){return i.Class.derive(n._LegacyLayout,function(n){n=n||{};this._itemInfo={};this._groupInfo={};this._groupHeaderPosition=n.groupHeaderPosition||k.top;this._inListMode=!0;this.orientation=n.orientation||"vertical"},{initialize:function(t,i){a.addClass(t.surface,p._listLayoutClass);n._LegacyLayout.prototype.initialize.call(this,t,i)},uninitialize:function(){this._site&&a.removeClass(this._site.surface,p._listLayoutClass);n._LegacyLayout.prototype.uninitialize.call(this)},layout:function(t,i,r,u){return this._groupsEnabled||this._horizontal?n._LegacyLayout.prototype.layout.call(this,t,i,r,u):this._layoutNonGroupedVerticalList(t,i,r,u)},_layoutNonGroupedVerticalList:function(n,t,i,r){var u=this,f="Layout:_layoutNonGroupedVerticalList";return u._site._writeProfilerMark(f+",StartTM"),this._layoutPromise=u._measureItem(0).then(function(){a[u._usingStructuralNodes?"addClass":"removeClass"](u._site.surface,p._structuralNodesClass);u._sizes.viewportContentSize!==u._getViewportCrossSize()&&u._viewportSizeChanged(u._getViewportCrossSize());u._cacheRemovedElements(i,u._cachedItemRecords,u._cachedInsertedItemRecords,u._cachedRemovedItems,!1);u._cacheRemovedElements(r,u._cachedHeaderRecords,u._cachedInsertedHeaderRecords,u._cachedRemovedHeaders,!0);var e=n[0].itemsContainer,t=new g.UniformFlowGroup(u,e);u._groups=[t];t.groupInfo={enableCellSpanning:!1};t.startIndex=0;t.count=ht(e);t.offset=0;t.layout();u._site._writeProfilerMark(f+":setSurfaceWidth,info");u._site.surface.style.width=u._sizes.surfaceContentSize+"px";u._layoutAnimations(i,r);u._site._writeProfilerMark(f+":complete,info");u._site._writeProfilerMark(f+",StopTM")},function(n){return u._site._writeProfilerMark(f+":canceled,info"),u._site._writeProfilerMark(f+",StopTM"),s.wrapError(n)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){var t=this;return this._measureItem(0).then(function(){return t._usingStructuralNodes=t._envInfo.nestedFlexTooLarge||t._envInfo.nestedFlexTooSmall?!1:n.ListLayout._numberOfItemsPerItemsBlock>0,t._usingStructuralNodes?n.ListLayout._numberOfItemsPerItemsBlock:null})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:i.Namespace._lazy(function(){return i.Class.derive(n._LayoutCommon,function(n){n=n||{};this._itemInfo=n.itemInfo;this._groupInfo=n.groupInfo;this._groupHeaderPosition=n.groupHeaderPosition||k.top;this._horizontal=!0;this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(n){this._setMaxRowsOrColumns(n)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(n){this._itemInfo=n;this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(n){this._groupInfo=n;this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:i.Namespace._lazy(function(){return i.Class.define(function(n){var t,i;this.defaultAnimations=!0;this.initialize=function(t,i){n.initialize(t,i)};this.hitTest=function(t,i){return n.hitTest(t,i)};n.uninitialize&&(this.uninitialize=function(){n.uninitialize()});"numberOfItemsPerItemsBlock"in n&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return n.numberOfItemsPerItemsBlock}});n._getItemPosition&&(this._getItemPosition=function(t){return n._getItemPosition(t)});n.itemsFromRange&&(this.itemsFromRange=function(t,i){return n.itemsFromRange(t,i)});n.getAdjacent&&(this.getAdjacent=function(t,i){return n.getAdjacent(t,i)});n.dragOver&&(this.dragOver=function(t,i,r){return n.dragOver(t,i,r)});n.dragLeave&&(this.dragLeave=function(){return n.dragLeave()});t={enumerable:!0,get:function(){return"vertical"}};(void 0!==n.orientation&&(t.get=function(){return n.orientation},t.set=function(t){n.orientation=t}),Object.defineProperty(this,"orientation",t),(n.setupAnimations||n.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return n.setupAnimations()},this.executeAnimations=function(){return n.executeAnimations()}),n.layout)&&(this.defaultAnimations?(i=this,this.layout=function(t,r,u,f){var e,o=wt(n.layout(t,r,[],[]));return o.realizedRangeComplete.then(function(){e=!0}),e&&i._layoutAnimations(u,f),o}):this.layout=function(t,i,r,u){return wt(n.layout(t,i,r,u))})},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(n,t,i,r){return this.defaultAnimations&&this._layoutAnimations(i,r),wt()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(n,t){switch(t){case b.pageUp:case b.upArrow:case b.leftArrow:return{type:n.type,index:n.index-1};case b.downArrow:case b.rightArrow:case b.pageDown:return{type:n.type,index:n.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})});k={left:"left",top:"top"};i.Namespace._moduleDefine(n,"WinJS.UI",{HeaderPosition:k,_getMargins:ct})});t("WinJS/Controls/ListView/_VirtualizeContentsView",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_Helpers","./_ItemsContainer"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n,t){s._setAttribute(n,"aria-flowto",t.id);s._setAttribute(t,"x-ms-aria-flowfrom",n.id)}i.Namespace._moduleDefine(n,"WinJS.UI",{_VirtualizeContentsView:i.Namespace._lazy(function(){function et(n){for(var i,t=n.job._workItems;t.length&&!n.shouldYield;)(i=t.shift())();n.setWork(et);t.length||n.job.pause()}function rt(n,t){var i=e.schedule(et,n,null,t);return i._workItems=[],i.addWork=function(n,t){t?this._workItems.unshift(n):this._workItems.push(n);this.resume()},i.clearWork=function(){this._workItems.length=0},i.dispose=function(){this.cancel();this._workItems.length=0},i}function nt(n){return n._zooming||n._pinching}function d(t,i){return t._isZombie()?u.wrap():nt(t)?(+i!==i&&(i=n._waitForSeZoTimeoutDuration),u.timeout(n._waitForSeZoIntervalDuration).then(function(){return i-=n._waitForSeZoIntervalDuration,0>=i?!0:d(t,i)})):u.wrap()}function it(n){if("number"==typeof n){var t=n;n=function(){return{position:t,direction:"right"}}}return n}function w(){}var n=i.Class.define(function(n){this._listView=n;this._forceRelayout=!1;this.items=new y._ItemsContainer(n);this.firstIndexDisplayed=-1;this.lastIndexDisplayed=-1;this.begin=0;this.end=0;this._realizePass=1;this._firstLayoutPass=!0;this._runningAnimations=null;this._renderCompletePromise=u.wrap();this._state=new tt(this);this._createLayoutSignal();this._createTreeBuildingSignal();this._layoutWork=null;this._onscreenJob=rt(e.Priority.aboveNormal,"on-screen items");this._frontOffscreenJob=rt(e.Priority.normal,"front off-screen items");this._backOffscreenJob=rt(e.Priority.belowNormal,"back off-screen items");this._scrollbarPos=0;this._direction="right";this._scrollToFunctor=it(0)},{_dispose:function(){this.cleanUp();this.items=null;this._renderCompletePromise&&this._renderCompletePromise.cancel();this._renderCompletePromise=null;this._onscreenJob.dispose();this._frontOffscreenJob.dispose();this._backOffscreenJob.dispose()},_createItem:function(n,t,i,r){this._listView._writeProfilerMark("createItem("+n+") "+this._getBoundingRectString(n)+",info");var f=this;f._listView._itemsManager._itemFromItemPromiseThrottled(t).done(function(t){t?i(n,t,f._listView._itemsManager._recordFromElement(t)):r(n)},function(t){return r(n),u.wrapError(t)})},_addItem:function(n,t,i,r){if(this._realizePass===r){var u=this._listView._itemsManager._recordFromElement(i);delete this._pendingItemPromises[u.itemPromise.handle];this.items.setItemAt(t,{itemBox:null,container:null,element:i,detached:!0,itemsManagerRecord:u})}},finalItem:function(){return this.containers?u.wrap(this.containers.length-1):u.cancel},_setSkipRealizationForChange:function(t){t?this._realizationLevel!==n._realizationLevel.realize&&(this._realizationLevel=n._realizationLevel.skip):this._realizationLevel=n._realizationLevel.realize},_realizeItems:function(n,t,i,r,o,h,v,y,p,w){function pt(n,t){kt.push(u._cancelBlocker(t.renderComplete));wt(n)}function ut(n,t){function w(n,t){!n.updatedSwipeableAttribute&&(b._listView.itemsDraggable||b._listView.itemsReorderable||b._listView._swipeable)&&n.itemsManagerRecord.renderComplete.done(function(){if(b._realizePass===o){var i=s.hasClass(t,l._nonDraggableClass),u=s.hasClass(t,l._nonSelectableClass),r=b._listView.itemsDraggable||b._listView.itemsReorderable,f=b._listView._selectionAllowed()&&b._listView._swipeBehavior===c.SwipeBehavior.select;r&&!i&&(n.itemBox.draggable=!0);b._listView._swipeable&&(r&&!f&&i||f&&!r&&u||i&&u)&&s.addClass(n.itemBox,l._nonSwipeableClass);n.updatedSwipeableAttribute=!0}})}var u,f,r,e;if(b._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!b._listView._isZombie()){for(var h=0,y=-1,p=-1,i=n;t>=i;i++)u=b.items.itemDataAt(i),u&&(f=u.element,r=u.itemBox,r||(r=b._listView._itemBoxTemplate.cloneNode(!0),u.itemBox=r,r.appendChild(f),s.addClass(f,l._itemClass),b._listView._setupAriaSelectionObserver(f),b._listView._isSelected(i)&&a._ItemEventsHandler.renderSelection(r,f,!0,!0),b._listView._currentMode().renderDragSourceOnRealizedItem(i,r)),w(u,f,r),e=b.getContainer(i),r.parentNode!==e&&(b._appendAndRestoreFocus(e,r),h++,0>y&&(y=i),p=i,u.container=e,b._listView._isSelected(i)&&s.addClass(e,l._selectedClass),s.removeClass(e,l._backdropClass),b.items.elementAvailable(i)));b._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM");h>0&&(b._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+h+" ("+y+"-"+p+"),info"),b._reportElementsLevel(v))}}function fi(n,t,i,r){function f(n,t){var r=b.items.itemDataAt(n),i;return r?(i=r.itemBox,i&&i.parentNode?t?(s.addClass(i.parentNode,l._backdropClass),i.parentNode.removeChild(i),!0):!1:!0):!0}if(!w){for(var u=!1;n>=i;)u=f(n,u),n--;for(u=!1;r>=t;)u=f(t,u),t++}}function nt(n,t,i,r,f){function c(n){var r=b.items.itemDataAt(n),t;r&&(t=r.itemsManagerRecord,t.readyComplete||b._realizePass!==o||i.addWork(function(){b._listView._isZombie()||t.pendingReady&&b._realizePass===o&&(b._listView._writeProfilerMark("pendingReady("+n+"),info"),t.pendingReady())},f))}for(var h,s=[],e=n;t>=e;e++)h=b.items.itemDataAt(e),h&&s.push(h.itemsManagerRecord.itemPromise);u.join(s).then(function(){var i;if("right"===r)for(i=n;t>=i;i++)c(i);else for(i=t;i>=n;i--)c(i)})}function wt(n){if(b._realizePass===o){if(n>=y&&p>=n){if(0==--bt){if(ut(y,p),fi(y,p,t,i),b._firstLayoutPass){nt(y,p,b._frontOffscreenJob,"right"===v?"left":"right",!0);var r=e.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!b._listView._isZombie()){b._listView._writeProfilerMark("entranceAnimation,StartTM");var n=b._listView._animateListEntrance(!b._firstEntranceAnimated);return b._firstEntranceAnimated=!0,n}});b._runningAnimations=u.join([b._runningAnimations,r]);b._runningAnimations.done(function(){b._listView._writeProfilerMark("entranceAnimation,StopTM");b._realizePass===o&&(b._runningAnimations=null,tt.complete())});b._firstLayoutPass=!1;b._listView._isCurrentZoomView&&e.requestDrain(b._onscreenJob.priority)}else nt(y,p,b._frontOffscreenJob,v),tt.complete();b._updateHeaders(b._listView._canvas,y,p+1).done(function(){it.complete()})}}else y>n?(--st,st%et==0&&ut(t,y-1),st||(b._updateHeaders(b._listView._canvas,t,y).done(function(){"right"!==v&&rt.complete()}),nt(t,y-1,"right"!==v?b._frontOffscreenJob:b._backOffscreenJob,"left"))):n>p&&(--ot,ot%et==0&&ut(p+1,i-1),ot||(b._updateHeaders(b._listView._canvas,p+1,i).then(function(){"right"===v&&rt.complete()}),nt(p+1,i-1,"right"===v?b._frontOffscreenJob:b._backOffscreenJob,"right")));ft--;0===ft&&(b._renderCompletePromise=u.join(kt).then(null,function(n){var t=Array.isArray(n)&&n.some(function(n){return n&&!(n instanceof Error&&"Canceled"===n.name)});if(t)return u.wrapError(n)}),(b._headerRenderPromises||u.wrap()).done(function(){e.schedule(function(){b._listView._isZombie()?k.cancel():k.complete()},Math.min(b._onscreenJob.priority,b._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function ei(t,i,r){if(b._realizePass===o){var i=r.element;b._addItem(n,t,i,o);pt(t,r)}}var d="_realizeItems("+t+"-"+(i-1)+") visible("+y+"-"+p+")",dt,vt,ri,ui;this._listView._writeProfilerMark(d+",StartTM");v=v||"right";var ft=i-t,et=p-y+1,bt=et,ot=i-p-1,st=y-t,kt=[],tt=new f,it=new f,rt=new f,b=this;if(ft>0){var ht=0,ct=0,oi=0;b.firstIndexDisplayed=y;b.lastIndexDisplayed=p;dt=b._listView._isCurrentZoomView;b._highPriorityRealize&&(b._firstLayoutPass||b._hasAnimationInViewportPending)?(b._highPriorityRealize=!1,b._onscreenJob.priority=e.Priority.high,b._frontOffscreenJob.priority=e.Priority.normal,b._backOffscreenJob.priority=e.Priority.belowNormal):b._highPriorityRealize?(b._highPriorityRealize=!1,b._onscreenJob.priority=e.Priority.high,b._frontOffscreenJob.priority=e.Priority.high-1,b._backOffscreenJob.priority=e.Priority.high-1):dt?(b._onscreenJob.priority=e.Priority.aboveNormal,b._frontOffscreenJob.priority=e.Priority.normal,b._backOffscreenJob.priority=e.Priority.belowNormal):(b._onscreenJob.priority=e.Priority.belowNormal,b._frontOffscreenJob.priority=e.Priority.idle,b._backOffscreenJob.priority=e.Priority.idle);var k=new f,gt=b._listView._versionManager.cancelOnNotification(k.promise),ni=function(n,t){t.startStage1&&t.stage0.then(function(){b._realizePass===o&&t.startStage1&&n.addWork(t.startStage1)})},ti=function(n,t){var r=b.items.itemDataAt(t),i;r||(i=b._listView._itemsManager._itemPromiseAtIndex(t),b._pendingItemPromises[i.handle]=i,delete b._previousRealizationPendingItemPromises[i.handle],n.addWork(function(){if(!b._listView._isZombie()&&(ht++,b._createItem(t,i,ei,wt),!b._listView._isZombie()&&b._realizePass===o&&i.handle)){var r=b._listView._itemsManager._recordFromHandle(i.handle);ni(n,r)}}))},lt=function(n,t,i){for(var r=t;i>=r;r++)ti(n,r)},at=function(n,t,i){for(var r=i;r>=t;r--)ti(n,r)},g=function(n,t,i){for(var u,f,r=t;i>=r;r++)u=b.items.itemDataAt(r),u&&(f=u.itemsManagerRecord,pt(r,f),ct++,ni(n,f))};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{};this._pendingItemPromises={};"left"===v?(at(b._onscreenJob,y,p),at(b._frontOffscreenJob,t,y-1),vt=t>y-1):(lt(b._onscreenJob,y,p),lt(b._frontOffscreenJob,p+1,i-1),vt=p+1>i-1);for(var yt=0,ii=Object.keys(this._previousRealizationPendingItemPromises),si=ii.length;si>yt;yt++)ri=ii[yt],b._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[ri]);return this._previousRealizationPendingItemPromises={},g(b._onscreenJob,y,p),"left"===v?g(b._frontOffscreenJob,t,y-1):g(b._frontOffscreenJob,p+1,i-1),ui=bt===p-y+1,b._firstLayoutPass?b._listView._canvas.style.opacity=0:ui?b._listView._showProgressBar(b._listView._element,"50%","50%"):b._listView._hideProgressBar(),b._frontOffscreenJob.pause(),b._backOffscreenJob.pause(),it.promise.done(function(){b._frontOffscreenJob.resume();vt&&rt.complete()},function(){k.cancel()}),rt.promise.done(function(){b._listView._writeProfilerMark("frontItemsRealized,info");"left"===v?(lt(b._backOffscreenJob,p+1,i-1),g(b._backOffscreenJob,p+1,i-1)):(at(b._backOffscreenJob,t,y-1),g(b._backOffscreenJob,t,y-1));b._backOffscreenJob.resume()}),k.promise.done(function(){b._listView._versionManager.clearCancelOnNotification(gt);b._listView._writeProfilerMark(d+" complete(created:"+ht+" updated:"+ct+"),info")},function(n){return b._listView._versionManager.clearCancelOnNotification(gt),b._onscreenJob.clearWork(),b._frontOffscreenJob.clearWork(),b._backOffscreenJob.clearWork(),tt.cancel(),it.cancel(),b._listView._writeProfilerMark(d+" canceled(created:"+ht+" updated:"+ct+" clean:"+oi+"),info"),u.wrapError(n)}),b._listView._writeProfilerMark(d+",StopTM"),{viewportItemsRealized:it.promise,allItemsRealized:k.promise,loadingCompleted:u.join([k.promise,tt.promise]).then(function(){for(var f,r=[],n=t;i>n;n++)f=b.items.itemDataAt(n),f&&r.push(f.itemsManagerRecord.itemReadyPromise);return u._cancelBlocker(u.join(r))})}}return b._listView._writeProfilerMark(d+",StopTM"),{viewportItemsRealized:u.wrap(),allItemsRealized:u.wrap(),loadingCompleted:u.wrap()}},_setAnimationInViewportState:function(n){var t;if(this._hasAnimationInViewportPending=!1,n&&n.length>0)for(var u=this._listView._getViewportLength(),r=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+u-1),i=0,f=n.length;f>i;i++)if(t=n[i],t.newIndex>=r.firstIndex&&t.newIndex<=r.lastIndex&&t.newIndex!==t.oldIndex){this._hasAnimationInViewportPending=!0;break}},_addHeader:function(n,t){var i=this;return this._listView._groups.renderGroup(t).then(function(n){if(n){n.element.tabIndex=0;var r=i._getHeaderContainer(t);n.element.parentNode!==r&&(r.appendChild(n.element),s.addClass(n.element,l._headerClass));i._listView._groups.setDomElement(t,n.element)}})},_updateHeaders:function(n,t,i){function s(t){var i=f._listView._groups.group(t),r;return i&&!i.header?(r=i.headerPromise,r||(r=i.headerPromise=f._addHeader(n,t),r.done(function(){i.headerPromise=null},function(){i.headerPromise=null})),r):u.wrap()}function e(){f._headerRenderPromises=null}var f=this;this._listView._groups.removeElements();var h=this._listView._groups.groupFromItem(t),r=h,c=this._listView._groups.groupFromItem(i-1),o=[];if(null!==r)for(;c>=r;r++)o.push(s(r));return this._headerRenderPromises=u.join(o,this._headerRenderPromises).then(e,e),this._headerRenderPromises||u.wrap()},_unrealizeItem:function(n){var f,i=this._listView,u;this._listView._writeProfilerMark("_unrealizeItem("+n+"),info");u=i._selection._getFocused();u.type!==c.ObjectType.groupHeader&&u.index===n&&(i._unsetFocusOnItem(),f=!0);var r=this.items.itemDataAt(n),e=r.element,t=r.itemBox;t&&t.parentNode&&(s.removeClass(t.parentNode,l._selectedClass),s.removeClass(t.parentNode,l._footprintClass),s.addClass(t.parentNode,l._backdropClass),t.parentNode.removeChild(t));r.container=null;i._currentMode().itemUnrealized&&i._currentMode().itemUnrealized(n,t);this.items.removeItem(n);r.removed||i._itemsManager.releaseItem(e);o._disposeElement(e);f&&i._setFocusOnItem(i._selection._getFocused())},_unrealizeGroup:function(n){var i,t=n.header,r=this._listView._selection._getFocused();r.type===c.ObjectType.groupHeader&&this._listView._groups.group(r.index)===n&&(this._listView._unsetFocusOnItem(),i=!0);t.parentNode&&t.parentNode.removeChild(t);o._disposeElement(t);n.header=null;n.left=-1;n.top=-1;i&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(n){var r=this,e=0,t,u,f;if(this.items.eachIndex(function(t){if(t<r.begin||t>=r.end)return(r._unrealizeItem(t),n&&++e>=n)}),t=this._listView._groups,u=t.groupFromItem(this.begin),null!==u)for(var o=t.groupFromItem(this.end-1),i=0,s=t.length();s>i;i++)f=t.group(i),(u>i||i>o)&&f.header&&this._unrealizeGroup(f)},_unrealizeExcessiveItems:function(){var n=this.items.count(),i=this.end-this.begin,t=i+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+n+") approved("+t+"),info");n>t&&this._unrealizeItems(n-t)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var n=this;return d(this._listView).then(function(){function o(){n._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}var t,s,c,l;if(n._listView._isZombie())return void o();t=[];n.items.eachIndex(function(i){(i<n.begin||i>=n.end)&&t.push(i)});n._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+t.length+"),info");var i=[],f=n._listView._groups,h=f.groupFromItem(n.begin);if(null!==h)for(var a=f.groupFromItem(n.end-1),r=0,v=f.length();v>r;r++)s=f.group(r),(h>r||r>a)&&s.header&&i.push(s);return t.length||i.length?(l=new u(function(r){function u(f){var e;if(!n._listView._isZombie()){for(var o=-1,h=-1,c=0,s=nt(n._listView);t.length&&!s&&!f.shouldYield;)e=t.shift(),n._unrealizeItem(e),c++,0>o&&(o=e),h=e;for(n._listView._writeProfilerMark("unrealizeWorker removeItems:"+c+" ("+o+"-"+h+"),info");i.length&&!s&&!f.shouldYield;)n._unrealizeGroup(i.shift());t.length||i.length?s?f.setPromise(d(n._listView).then(function(){return u})):f.setWork(u):r()}}c=e.schedule(u,e.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")}),l.then(o,function(t){return c.cancel(),n._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),n._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),u.wrapError(t)})):(o(),u.wrap())})},_getBoundingRectString:function(n){var i,t;return n>=0&&n<this.containers.length&&(t=this._listView._layout._getItemPosition(n),t&&(i="["+t.left+"; "+t.top+"; "+t.width+"; "+t.height+" ]")),i||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null);-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(n){function i(){t._listView._writeProfilerMark("aria work,StopTM")}function r(n){var r=t._listView._groups,i=r.group(n+1);return i?Math.min(i.startIndex-1,t.end-1):t.end-1}if(!this._listView._isZombie()){var t=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(f){if(!(f>0&&-1!==t.firstIndexDisplayed&&-1!==t.lastIndexDisplayed))return u.wrap();t._listView._writeProfilerMark("aria work,StartTM");var y,a,w,h,c,v,b=t._listView._ariaStartMarker,k=t._listView._ariaEndMarker,l=t.begin,o=t.items.itemAt(t.begin);return o?(s._ensureId(o),t._listView._groupsEnabled()?(a=t._listView._groups,w=h=a.groupFromItem(t.begin),c=a.group(h),v=r(h),s._ensureId(c.header),s._setAttribute(c.header,"role",t._listView._headerRole),s._setAttribute(c.header,"x-ms-aria-flowfrom",b.id),p(c.header,o),s._setAttribute(c.header,"tabindex",t._listView._tabIndex)):s._setAttribute(o,"x-ms-aria-flowfrom",b.id),new u(function(u){var b=n;y=e.schedule(function g(n){var e,y;if(t._listView._isZombie())return void i();for(;l<t.end;l++){if(!b&&nt(t._listView))return void n.setPromise(d(t._listView).then(function(n){return b=n,g}));if(n.shouldYield)return void n.setWork(g);if(o=t.items.itemAt(l),e=t.items.itemAt(l+1),(e&&s._ensureId(e),s._setAttribute(o,"role",t._listView._itemRole),s._setAttribute(o,"aria-setsize",f),s._setAttribute(o,"aria-posinset",l+1),s._setAttribute(o,"tabindex",t._listView._tabIndex),t._listView._groupsEnabled())?l!==v&&e?p(o,e):(y=a.group(h+1),y&&y.header&&e?(s._setAttribute(y.header,"tabindex",t._listView._tabIndex),s._setAttribute(y.header,"role",t._listView._headerRole),s._ensureId(y.header),p(o,y.header),p(y.header,e)):s._setAttribute(o,"aria-flowto",k.id),h++,c=y,v=r(h)):e?p(o,e):s._setAttribute(o,"aria-flowto",k.id),!e)break}t._listView._fireAccessibilityAnnotationCompleteEvent(t.begin,l,w,h-1);i();u()},e.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){y.cancel();i()})):void i()})}},_setupDeferredActions:function(){function t(){n._listView._isZombie()||(n.deferTimeout=null,n._listView._versionManager.clearCancelOnNotification(n.deferredActionCancelToken),n.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var n=this;this._clearDeferTimeout();this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return u.timeout(l._DEFERRED_ACTION)}).then(function(){return d(n._listView)}).then(function(t){return n._setupAria(t)}).then(t,function(n){return t(),u.wrapError(n)});this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout);this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(n,t,i){function l(){return o.items.itemAt(t)}function a(){for(var n=i;n>=t;n--)if(o.items.itemAt(n))return o.items.itemAt(n);return null}var o=this,r,e,u,h,c,f;this._listView._isZombie()||(this._listView._createAriaMarkers(),u=this._listView._ariaStartMarker,h=this._listView._ariaEndMarker,(-1!==t&&-1!==i&&i>=t&&(r=l(),e=a()),!n&&r&&e)?((s._ensureId(r),s._ensureId(e),this._listView._groupsEnabled())?(c=this._listView._groups,f=c.group(c.groupFromItem(t)),f.header&&(s._ensureId(f.header),t===f.startIndex?s._setAttribute(u,"aria-flowto",f.header.id):s._setAttribute(u,"aria-flowto",r.id))):s._setAttribute(u,"aria-flowto",r.id),s._setAttribute(h,"x-ms-aria-flowfrom",e.id)):(p(u,h),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)))},updateAriaForAnnouncement:function(n,t){var i=-1,r=c.ObjectType.item;s.hasClass(n,l._headerClass)?(i=this._listView._groups.index(n),r=c.ObjectType.groupHeader,s._setAttribute(n,"role",this._listView._headerRole),s._setAttribute(n,"tabindex",this._listView._tabIndex)):(i=this.items.index(n),s._setAttribute(n,"aria-setsize",t),s._setAttribute(n,"aria-posinset",i+1),s._setAttribute(n,"role",this._listView._itemRole),s._setAttribute(n,"tabindex",this._listView._tabIndex));r===c.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,i,i):this._listView._fireAccessibilityAnnotationCompleteEvent(i,i,-1,-1)},_reportElementsLevel:function(n){function t(n,t){for(var f,u=0,i=n;t>=i;i++)f=r.itemDataAt(i),f&&f.container&&u++;return u}var i,r=this.items;i=Math.floor("right"===n?100*t(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed):100*t(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1));this._listView._writeProfilerMark("elementsLevel level("+i+"),info")},_createHeaderContainer:function(n){return this._createSurfaceChild(l._headerContainerClass,n)},_createItemsContainer:function(n){var i=this._createSurfaceChild(l._itemsContainerClass,n),r=t.document.createElement("div");return r.className=l._padderClass,i.appendChild(r),i},_ensureContainerInDOM:function(n){var t=this.containers[n];return t&&!this._listView._canvas.contains(t)?(this._forceItemsBlocksInDOM(n,n+1),!0):!1},_ensureItemsBlocksInDOM:function(n,t){if(this._expandedRange){var i=this._expandedRange.first.index,r=this._expandedRange.last.index+1;i>=n&&t>i?t=Math.max(t,r):r>n&&t>=r&&(n=Math.min(n,i))}this._forceItemsBlocksInDOM(n,t)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var t=this;return d(this._listView).then(function(){function i(){t._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(t._listView._isZombie())return void i();if(t._expandedRange&&-1!==t.begin&&-1!==t.end&&(t._expandedRange.first.index<t.begin||t._expandedRange.last.index+1>t.end)){var r,f=new u(function(i){function u(r){var f,e,o;if(!t._listView._isZombie()){for(f=nt(t._listView);t._expandedRange.first.index<t.begin&&!f&&!r.shouldYield;)e=Math.min(t.begin,t._expandedRange.first.index+t._blockSize*n._blocksToRelease),t._forceItemsBlocksInDOM(e,t.end);for(;t._expandedRange.last.index+1>t.end&&!f&&!r.shouldYield;)o=Math.max(t.end,t._expandedRange.last.index-t._blockSize*n._blocksToRelease),t._forceItemsBlocksInDOM(t.begin,o);t._expandedRange.first.index<t.begin||t._expandedRange.last.index+1>t.end?f?r.setPromise(d(t._listView).then(function(){return u})):r.setWork(u):i()}}r=e.schedule(u,e.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return f.then(i,function(n){return r.cancel(),t._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),t._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),u.wrapError(n)})}return i(),u.wrap()})},_forceItemsBlocksInDOM:function(n,t){function a(n,t){var i=n.element.firstElementChild;i.style[et]=t}function p(n){for(var t=0;t<i.tree.length;t++)for(var r=i.tree[t].itemsContainer,u=0,f=r.itemsBlocks.length;f>u;u++)if(n(r,r.itemsBlocks[u]))return}function w(n){i._listView._writeProfilerMark("_itemsBlockExtent,StartTM");i._listView._itemsBlockExtent=s[i._listView._horizontal()?"getTotalWidth":"getTotalHeight"](n.element);i._listView._writeProfilerMark("_itemsBlockExtent("+i._listView._itemsBlockExtent+"),info");i._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function rt(){return-1===i._listView._itemsBlockExtent&&p(function(n,t){return t.items.length===i._blockSize&&t.element.parentNode===n.element?(w(t),!0):!1}),-1===i._listView._itemsBlockExtent&&p(function(n,t){return t.items.length===i._blockSize?(n.element.appendChild(t.element),w(t),n.element.removeChild(t.element),!0):!1}),i._listView._itemsBlockExtent}function c(n,t,i){function u(t){var i=n.itemsBlocks[t];i&&i.element.parentNode===n.element&&(n.element.removeChild(i.element),it++)}if(Array.isArray(t))t.forEach(u);else for(var r=t;i>r;r++)u(r)}function v(n,t,i){for(var r,e=n.element.firstElementChild,f=e,u=t;i>u;u++)r=n.itemsBlocks[u],r&&(r.element.parentNode!==n.element&&(n.element.insertBefore(r.element,f.nextElementSibling),tt++),f=r.element)}function ut(n){if(n<i.tree.length){i._listView._writeProfilerMark("collapseGroup("+n+"),info");var t=i.tree[n].itemsContainer;c(t,0,t.itemsBlocks.length);a(t,"")}}function ft(n){if(n<i.tree.length){i._listView._writeProfilerMark("expandGroup("+n+"),info");var t=i.tree[n].itemsContainer;v(t,0,t.itemsBlocks.length);a(t,"")}}function b(n,t){function u(n,t){for(var r=[],i=n;t>=i;i++)r.push(i);return r}var f=t[0],e=t[1],i=n[0],r=n[1];return i>e||f>r?u(i,r):f>i&&r>e?u(i,f-1).concat(u(e+1,r)):f>i?u(i,f-1):r>e?u(e+1,r):null}var k,nt,h,y;if(this._blockSize){k="_forceItemsBlocksInDOM begin("+n+") end("+t+"),";this._listView._writeProfilerMark(k+"StartTM");var i=this,tt=0,it=0,et="padding"+(this._listView._horizontal()?"Left":"Top"),r=this._listView._groups.groupFromItem(n),u=this._listView._groups.groupFromItem(t-1),d=this._listView._groups.group(r),e=i.tree[r].itemsContainer,f=Math.floor((n-d.startIndex)/this._blockSize),g=this._listView._groups.group(u),l=i.tree[u].itemsContainer,o=Math.floor((t-1-g.startIndex)/this._blockSize);for(f&&-1===i._listView._itemsBlockExtent&&p(function(n,t){return t.items.length===i._blockSize&&t.element.parentNode===n.element?(w(t),!0):!1}),nt=this._expandedRange?b([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[r,u]):null,(nt&&nt.forEach(ut),this._expandedRange&&this._expandedRange.first.groupKey===d.key)?(h=b([this._expandedRange.first.block,Number.MAX_VALUE],[f,Number.MAX_VALUE]),h&&c(e,h)):this._expandedRange&&r>=this._expandedRange.first.groupIndex&&r<=this._expandedRange.last.groupIndex&&c(e,0,f),(r!==u?(v(e,f,e.itemsBlocks.length),v(l,0,o+1)):v(e,f,o+1),this._expandedRange&&this._expandedRange.last.groupKey===g.key)?(h=b([0,this._expandedRange.last.block],[0,o]),h&&c(l,h)):this._expandedRange&&u>=this._expandedRange.first.groupIndex&&u<=this._expandedRange.last.groupIndex&&c(l,o+1,l.itemsBlocks.length),a(e,f?f*rt()+"px":""),r!==u&&a(l,""),y=r+1;u>y;y++)ft(y);this._expandedRange={first:{index:n,groupIndex:r,groupKey:d.key,block:f},last:{index:t-1,groupIndex:u,groupKey:g.key,block:o}};this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+r+"-"+u+") blocks("+f+"-"+o+") added("+tt+") removed("+it+"),info");this._listView._writeProfilerMark(k+"StopTM")}},_realizePageImpl:function(){var t=this,i="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(i+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){t._listView._isZombie()||t._listView._batchViewUpdates(l._ViewChange.realize,l._ScrollToPriority.low,t._listView.scrollPosition)}),this._listView._writeProfilerMark(i+",StopTM"),u.cancel):new u(function(e){function d(){e();ft.complete()}function rt(){t._listView._hideProgressBar();t._state.setLoadingState(t._listView._LoadingState.viewPortLoaded);t._executeAnimations&&t._setState(at,ft.promise)}function ut(n){t._updateAriaMarkers(0===n,t.firstIndexDisplayed,t.lastIndexDisplayed);t._state.setLoadingState&&t._state.setLoadingState(t._listView._LoadingState.itemsLoaded)}function p(n){t._listView._clearInsertedItems();t._listView._groups.removeElements();rt();ut(n);d()}var ft=new f,o,b,tt,a,et,k,h,ct;if(t._state.setLoadingState(t._listView._LoadingState.itemsLoading),t._firstLayoutPass&&t._listView._showProgressBar(t._listView._element,"50%","50%"),o=t.containers.length,o){var g=n._pagesToPrefetch,w=n._customPagesToPrefetchMax,nt=n._customPagesToPrefetchMin;t._listView._zooming&&(g=0,w=0,nt=0);a=t._listView._getViewportLength();r._isiOS&&!n._disableCustomPagesPrefetch?(b="left"===t._direction?w:nt,et=Math.max(0,b-t._scrollbarPos/a),tt=Math.min(w,et+("right"===t._direction?w:nt))):(b=g,tt=g);var ot=Math.max(0,t._scrollbarPos-b*a),st=t._scrollbarPos+(1+tt)*a,c=t._listView._layout.itemsFromRange(ot,st-1);if((c.firstIndex<0||c.firstIndex>=o)&&(c.lastIndex<0||c.lastIndex>=o))t.begin=-1,t.end=-1,t.firstIndexDisplayed=-1,t.lastIndexDisplayed=-1,p(o);else{var v=s._clamp(c.firstIndex,0,o-1),it=s._clamp(c.lastIndex+1,0,o),ht=t._listView._layout.itemsFromRange(t._scrollbarPos,t._scrollbarPos+a-1),l=s._clamp(ht.firstIndex,0,o-1),y=s._clamp(ht.lastIndex,0,o-1);t._realizationLevel!==n._realizationLevel.skip||t.lastRealizePass||l!==t.firstIndexDisplayed||y!==t.lastIndexDisplayed?(t._forceRelayout||v!==t.begin||it!==t.end||l!==t.firstIndexDisplayed||y!==t.lastIndexDisplayed)&&it>v&&st>ot?(t._listView._writeProfilerMark("realizePage currentInView("+l+"-"+y+") previousInView("+t.firstIndexDisplayed+"-"+t.lastIndexDisplayed+") change("+(l-t.firstIndexDisplayed)+"),info"),t._cancelRealize(),k=t._realizePass,t.begin=v,t.end=it,t.firstIndexDisplayed=l,t.lastIndexDisplayed=y,t.deletesWithoutRealize=0,t._ensureItemsBlocksInDOM(t.begin,t.end),h=t._realizeItems(t._listView._itemCanvas,t.begin,t.end,o,k,t._scrollbarPos,t._direction,l,y,t._forceRelayout),t._forceRelayout=!1,ct=h.viewportItemsRealized.then(function(){return rt(),h.allItemsRealized}).then(function(){if(t._realizePass===k)return t._updateHeaders(t._listView._canvas,t.begin,t.end).then(function(){ut(o)})}).then(function(){return h.loadingCompleted}).then(function(){t._unrealizeExcessiveItems();t.lastRealizePass=null;d()},function(n){return t._realizePass===k&&(t.lastRealizePass=null,t.begin=-1,t.end=-1),u.wrapError(n)}),t.lastRealizePass=u.join([h.viewportItemsRealized,h.allItemsRealized,h.loadingCompleted,ct]),t._unrealizeExcessiveItems()):t.lastRealizePass?t.lastRealizePass.then(d):p(o):(t.begin=v,t.end=v+Object.keys(t.items._itemData).length,t._updateHeaders(t._listView._canvas,t.begin,t.end).done(function(){t.lastRealizePass=null;p(o)}))}}else t.begin=-1,t.end=-1,t.firstIndexDisplayed=-1,t.lastIndexDisplayed=-1,p(o);t._reportElementsLevel(t._direction);t._listView._writeProfilerMark(i+",StopTM")})},realizePage:function(n,t,i,r){this._scrollToFunctor=it(n);this._forceRelayout=this._forceRelayout||t;this._scrollEndPromise=i;this._listView._writeProfilerMark(this._state.name+"_realizePage,info");this._state.realizePage(r||ut)},onScroll:function(n,t){this.realizePage(n,!1,t,ct)},reload:function(n,t){this._listView._isZombie()||(this._scrollToFunctor=it(n),this._forceRelayout=!0,this._highPriorityRealize=!!t,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(n){this._listView._isZombie()||(this._scrollToFunctor=it(n),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(n){var t=this,i=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return n>i?t._listView._itemsCount().then(function(i){return t.containers.length<i?u._cancelBlocker(t._creatingContainersWork&&t._creatingContainersWork.promise).then(function(){return t._getLayoutCompleted()}).then(function(){return n}):n}):u.wrap(n)},waitForEntityPosition:function(n){var t=this;return this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+n.type+": "+n.index+"),info"),u._cancelBlocker(this._state.waitForEntityPosition(n).then(function(){if(n.type!==c.ObjectType.groupHeader&&n.index>=t.containers.length||n.type===c.ObjectType.groupHeader&&t._listView._groups.group(n.index).startIndex>=t.containers.length)return t._creatingContainersWork&&t._creatingContainersWork.promise}).then(function(){return t._getLayoutCompleted()}))},stopWork:function(n){this._listView._writeProfilerMark(this._state.name+"_stop,info");this._state.stop(n);this._layoutWork&&this._layoutWork.cancel();n&&this._creatingContainersWork&&this._creatingContainersWork.cancel();n&&(this._state=new tt(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM");(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0);this._clearDeferTimeout();this._realizePass++;this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var n=this.lastRealizePass;n&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,n.cancel());this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(n){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1;this.lastIndexDisplayed=-1;this._runningAnimations=null;this._executeAnimations=!1;var t=this._listView;this._firstLayoutPass=!0;t._unsetFocusOnItem();t._currentMode().onDataChanged&&t._currentMode().onDataChanged();this.items.each(function(i,r){n&&r.parentNode&&r.parentNode.parentNode&&r.parentNode.parentNode.removeChild(r.parentNode);t._itemsManager.releaseItem(r);o._disposeElement(r)});this.items.removeItems();this._deferredReparenting=[];n&&t._groups.removeElements();t._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new tt(this),this.resetItems(),!this._listView._isZombie()){var n=this._listView;n._groups.resetGroups();n._resetCanvas();this.tree=null;this.keyToGroupIndex=null;this.containers=null;this._expandedRange=null}},cleanUp:function(){this.stopWork(!0);this._runningAnimations&&this._runningAnimations.cancel();var n=this._listView._itemsManager;this.items.each(function(t,i){n.releaseItem(i);o._disposeElement(i)});this._listView._unsetFocusOnItem();this.items.removeItems();this._deferredReparenting=[];this._listView._groups.resetGroups();this._listView._resetCanvas();this.tree=null;this.keyToGroupIndex=null;this.containers=null;this._expandedRange=null;this.destroyed=!0},getContainer:function(n){return this.containers[n]},_getHeaderContainer:function(n){return this.tree[n].header},_getGroups:function(n){var i,r,t,u,f,e;if(this._listView._groupDataSource){if(i=this._listView._groups.groups,r=[],n)for(t=0,u=i.length;u>t;t++)f=i[t],e=u>t+1?i[t+1].startIndex:n,r.push({key:f.key,size:e-f.startIndex});return r}return[{key:"-1",size:n}]},_createChunk:function(n,t,i){function e(n,t){var e=n.element.children,s=e.length,o=Math.min(t-n.items.length,i),c=v._stripedContainers(o,n.items.length),u,f;for(h.insertAdjacentHTMLUnsafe(n.element,"beforeend",c),u=0;o>u;u++)f=e[s+u],n.items.push(f),r.containers.push(f)}function o(n){var t={header:r._listView._groupDataSource?r._createHeaderContainer():null,itemsContainer:{element:r._createItemsContainer(),items:[]}};r.tree.push(t);r.keyToGroupIndex[n.key]=r.tree.length-1;e(t.itemsContainer,n.size)}var r=this,u,f;if((this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=n.length)&&(u=this.tree[this.tree.length-1],f=n[this.tree.length-1].size,u.itemsContainer.items.length<f))return e(u.itemsContainer,f),void this._listView._writeProfilerMark("createChunk,StopTM");this.tree.length<n.length&&o(n[this.tree.length]);this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(n,i,r,u){function s(n,i){var e,o=n.itemsBlocks.length?n.itemsBlocks[n.itemsBlocks.length-1]:null,s,k,l,g,a,y,nt,p,w;if(o&&o.items.length<r){var b=Math.min(i,r-o.items.length),tt=o.items.length,e=(n.itemsBlocks.length-1)*r+tt,it=v._stripedContainers(b,e);for(h.insertAdjacentHTMLUnsafe(o.element,"beforeend",it),a=o.element.children,s=0;b>s;s++)k=a[tt+s],o.items.push(k),f.containers.push(k);i-=b}e=n.itemsBlocks.length*r;i>u&&(i=Math.min(i,Math.max(1,Math.floor(u/r))*r));var c=Math.floor(i/r),d="",rt=e,ut=e+r,ft=["<div class='win-itemsblock'>"+v._stripedContainers(r,rt)+"<\/div>","<div class='win-itemsblock'>"+v._stripedContainers(r,ut)+"<\/div>"];for(d=v._repeat(ft,c),e+=c*r,l=i%r,l&&(d+="<div class='win-itemsblock'>"+v._stripedContainers(l,e)+"<\/div>",e+=l,c++),g=t.document.createElement("div"),h.setInnerHTMLUnsafe(g,d),a=g.children,y=0;c>y;y++)for(nt=a[y],p={element:nt,items:v._nodeListToArray(nt.children)},n.itemsBlocks.push(p),w=0;w<p.items.length;w++)f.containers.push(p.items[w])}function l(n){var t={header:f._listView._groupDataSource?f._createHeaderContainer():null,itemsContainer:{element:f._createItemsContainer(),itemsBlocks:[]}};f.tree.push(t);f.keyToGroupIndex[n.key]=f.tree.length-1;s(t.itemsContainer,n.size)}var f=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=n.length){var e=this.tree[this.tree.length-1].itemsContainer,c=n[this.tree.length-1].size,o=0;if(e.itemsBlocks.length&&(o=(e.itemsBlocks.length-1)*r+e.itemsBlocks[e.itemsBlocks.length-1].items.length),c>o)return s(e,c-o),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<n.length&&l(n[this.tree.length]);this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var t=this,f=0,i=!1;return function u(e){t._listView._versionManager.locked?e.setPromise(t._listView._versionManager.unlocked.then(function(){return u})):t._listView._itemsCount().then(function(o){var c=!i&&nt(t._listView);if(c)e.setPromise(d(t._listView).then(function(n){return i=n,u}));else{if(t._listView._isZombie())return;i=!1;var l=r._now()+n._createContainersJobTimeslice,s=t._getGroups(o),a=t.containers.length,v=t.end===t.containers.length,h=n._chunkSize;do t._blockSize?t._createChunkWithBlocks(s,o,t._blockSize,h):t._createChunk(s,o,h),f++;while(t.containers.length<o&&r._now()<l);t._listView._writeProfilerMark("createContainers yields containers("+t.containers.length+"),info");t._listView._affectedRange.add({start:a,end:t.containers.length},o);v?(t.stopWork(),t._listView._writeProfilerMark(t._state.name+"_relayout,info"),t._state.relayout()):(t._listView._writeProfilerMark(t._state.name+"_layoutNewContainers,info"),t._state.layoutNewContainers());t.containers.length<o?e.setWork(u):(t._listView._writeProfilerMark("createContainers completed steps("+f+"),info"),t._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return e.schedule(this._generateCreateContainersWorker(),e.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null;this.keyToGroupIndex=null;this.containers=null;this._expandedRange=null;var i,t=this;return this._listView._itemsCount().then(function(n){return 0===n&&t._listView._hideProgressBar(),i=n,t._listView._writeProfilerMark("createContainers("+i+"),StartTM"),t._listView._groupDataSource?t._listView._groups.initialize():void 0}).then(function(){return t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),i&&t._listView._groups.length()?t._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(u){var s;t._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+u+"),info");t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM");t._listView._resetCanvas();t.tree=[];t.keyToGroupIndex={};t.containers=[];t._blockSize=u;var f,e=t._getGroups(i),h=r._now()+n._maxTimePerCreateContainers,o=Math.min(n._startupChunkSize,n._chunkSize);do f=u?t._createChunkWithBlocks(e,i,u,o):t._createChunk(e,i,o);while(r._now()<h&&t.containers.length<i&&!f);(t._listView._writeProfilerMark("createContainers created("+t.containers.length+"),info"),t._listView._affectedRange.add({start:0,end:t.containers.length},i),t.containers.length<i)?(s=t._scheduleLazyTreeCreation(),t._creatingContainersWork.promise.done(null,function(){s.cancel()})):(t._listView._writeProfilerMark("createContainers completed synchronously,info"),t._creatingContainersWork.complete());t._listView._writeProfilerMark("createContainers("+i+"),StopTM")})},_updateItemsBlocks:function(n){function u(){var n=t.document.createElement("div");return n.className=l._itemsBlockClass,n}function e(t,r){function l(){var n,u;for(t.itemsBlocks=null,t.items=[],n=0;s>n;n++)u=i.containers[r+n],t.element.appendChild(u),t.items.push(u)}function a(){var f,o,c,h;for(t.itemsBlocks=[{element:e.length?e.shift():u(),items:[]}],f=t.itemsBlocks[0],o=0;s>o;o++)f.items.length===n&&(c=e.length?e.shift():u(),t.itemsBlocks.push({element:c,items:[]}),f=t.itemsBlocks[t.itemsBlocks.length-1]),h=i.containers[r+o],f.element.appendChild(h),f.items.push(h);t.items=null}var f,e=[],s=0,h=t.itemsBlocks,c;if(h)for(f=0;f<h.length;f++)s+=h[f].items.length,e.push(h[f].element);else s=t.items.length;for(o?a():l(),f=0;f<e.length;f++)c=e[f],c.parentNode===t.element&&t.element.removeChild(c);return s}for(var i=this,o=!!n,r=0,f=0;r<this.tree.length;r++)f+=e(this.tree[r].itemsContainer,f);i._blockSize=n},_layoutItems:function(){var n=this;return this._listView._itemsCount().then(function(){return u.as(n._listView._layout.numberOfItemsPerItemsBlock).then(function(t){n._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+t+"),info");t!==n._blockSize&&(n._updateItemsBlocks(t),n._listView._itemsBlockExtent=-1);var i,r=n._listView._affectedRange.get();return r&&(i={firstIndex:Math.max(r.start-1,0),lastIndex:Math.min(n.containers.length-1,r.end)},i.firstIndex<n.containers.length||0===n.containers.length)?n._listView._layout.layout(n.tree,i,n._modifiedElements||[],n._modifiedGroups||[]):(n._listView._affectedRange.clear(),{realizedRangeComplete:u.wrap(),layoutComplete:u.wrap()})})})},updateTree:function(n,t,i){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(n,t,i)},_updateTreeImpl:function(n,i,r,u){function y(n){for(var i,t=0,r=n.length;r>t;t++)i=n[t],i.parentNode.removeChild(i)}var e,c,f,h,o,v;if(this._executeAnimations=!0,this._modifiedElements=r,!r.handled){for(r.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM"),e=this,u||this._unrealizeItems(),f=0,h=r.length;h>f;f++)r[f]._itemBox&&r[f]._itemBox.parentNode&&s.removeClass(r[f]._itemBox.parentNode,l._selectedClass);for(this.items.each(function(n,t,i){i.container&&s.removeClass(i.container,l._selectedClass);i.container&&s.addClass(i.container,l._backdropClass)}),c=this._listView._updateContainers(this._getGroups(n),n,i,r),y(c.removedHeaders),y(c.removedItemsContainers),f=0,h=r.length;h>f;f++)if(o=r[f],-1!==o.newIndex){if(o.element=this.getContainer(o.newIndex),!o.element)throw"Container missing after updateContainers.";}else s.removeClass(o.element,l._backdropClass);v=t.document.activeElement;this._listView._canvas.contains(v)&&(this._requireFocusRestore=v);this._deferredReparenting=[];this.items.each(function(n,t,i){var r=e.getContainer(n),u=i.itemBox;u&&r&&(u.parentNode!==r&&(n>=e.firstIndexDisplayed&&n<=e.lastIndexDisplayed?e._appendAndRestoreFocus(r,u):e._deferredReparenting.push({itemBox:u,container:r})),s.removeClass(r,l._backdropClass),i.container=r,s[e._listView.selection._isIncluded(n)?"addClass":"removeClass"](r,l._selectedClass),!e._listView.selection._isIncluded(n)&&s.hasClass(u,l._selectedClass)&&a._ItemEventsHandler.renderSelection(u,i.element,!1,!0))});this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){var n,i,r,t;if(this._deferredReparenting&&(n=this._deferredReparenting.length,n>0)){for(i="_completeReparenting("+n+")",this._listView._writeProfilerMark(i+",StartTM"),t=0;n>t;t++)r=this._deferredReparenting[t],this._appendAndRestoreFocus(r.container,r.itemBox);this._deferredReparenting=[];this._listView._writeProfilerMark(i+",StopTM")}this._requireFocusRestore=null},_appendAndRestoreFocus:function(n,i){var r,u;i.parentNode!==n&&(this._requireFocusRestore&&(r=t.document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===r&&(n.contains(r)||i.contains(r))&&(this._listView._unsetFocusOnItem(),r=t.document.activeElement),s.empty(n),n.appendChild(i),this._requireFocusRestore&&r===this._listView._keyboardEventsHelper)&&(u=this._listView._selection._getFocused(),u.type===c.ObjectType.item&&this.items.itemBoxAt(u.index)===i&&(s._setActive(this._requireFocusRestore),this._requireFocusRestore=null))},_startAnimations:function(){var n;return this._listView._writeProfilerMark("startAnimations,StartTM"),n=this,this._hasAnimationInViewportPending=!1,u.as(this._listView._layout.executeAnimations()).then(function(){n._listView._writeProfilerMark("startAnimations,StopTM")})},_setState:function(n,t){if(!this._listView._isZombie()){var i=this._state.name;this._state=new n(this,t);this._listView._writeProfilerMark(this._state.name+"_enter from("+i+"),info");this._state.enter()}},getAdjacent:function(n,t){var i=this;return this.waitForEntityPosition(n).then(function(){return i._listView._layout.getAdjacent(n,t)})},hitTest:function(n,t){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var i=this._listView._layout.hitTest(n,t);return i.index=s._clamp(i.index,-1,this._listView._cachedCount-1,0),i.insertAfterIndex=s._clamp(i.insertAfterIndex,-1,this._listView._cachedCount-1,0),i},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new f;var n=this;this._creatingContainersWork.promise.done(function(){n._creatingContainersWork=null},function(){n._creatingContainersWork=null})}},_createLayoutSignal:function(){var n=this;this._layoutCompleted||(this._layoutCompleted=new f,this._layoutCompleted.promise.done(function(){n._layoutCompleted=null},function(){n._layoutCompleted=null}));this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new f,this._realizedRangeLaidOut.promise.done(function(){n._realizedRangeLaidOut=null},function(){n._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?u._cancelBlocker(this._layoutCompleted.promise):u.wrap()},_createSurfaceChild:function(n,i){var r=t.document.createElement("div");return r.className=n,this._listView._canvas.insertBefore(r,i?i.nextElementSibling:null),r},_executeScrollToFunctor:function(){var n=this;return u.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(t){n._scrollToFunctor=null;t=t||{};+t.position===t.position&&(n._scrollbarPos=t.position);n._direction=t.direction||"right"})}},{_pagesToPrefetch:2,_customPagesToPrefetchMax:6,_customPagesToPrefetchMin:2,_disableCustomPagesPrefetch:!1,_waitForSeZoIntervalDuration:100,_waitForSeZoTimeoutDuration:500,_chunkSize:500,_startupChunkSize:100,_maxTimePerCreateContainers:5,_createContainersJobTimeslice:15,_blocksToRelease:10,_realizationLevel:{skip:"skip",realize:"realize",normal:"normal"}}),tt=i.Class.define(function(n){this.view=n;this.view._createTreeBuildingSignal();this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal();this.view._createLayoutSignal()},stop:w,realizePage:w,rebuildTree:function(){this.view._setState(k)},relayout:function(){this.view._setState(k)},layoutNewContainers:w,waitForEntityPosition:function(){return this.view._setState(k),this.view._getLayoutCompleted()},updateTree:w}),k=i.Class.define(function(n){this.view=n},{name:"BuildingState",enter:function(){this.canceling=!1;this.view._createTreeBuildingSignal();this.view._createLayoutSignal();var n=this,t=new f;this.promise=t.promise.then(function(){return n.view._createContainers()}).then(function(){n.view._setState(g)},function(t){return n.canceling||(n.view._setState(tt),n.view._listView._raiseViewComplete()),u.wrapError(t)});t.complete()},stop:function(){this.canceling=!0;this.promise.cancel();this.view._setState(tt)},realizePage:w,rebuildTree:function(){this.canceling=!0;this.promise.cancel();this.enter()},relayout:w,layoutNewContainers:w,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:w}),g=i.Class.define(function(n,t){this.view=n;this.nextStateType=t||ut},{name:"LayingoutState",enter:function(){var n=this,t;this.canceling=!1;this.view._createLayoutSignal();this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");t=new f;this.promise=t.promise.then(function(){return n.view._layoutItems()}).then(function(t){return n.view._layoutWork=t.layoutComplete,t.realizedRangeComplete}).then(function(){n.view._listView._writeProfilerMark(n.name+"_enter_layoutItems,StopTM");n.view._listView._clearInsertedItems();n.view._setAnimationInViewportState(n.view._modifiedElements);n.view._modifiedElements=[];n.view._modifiedGroups=[];n.view._realizedRangeLaidOut.complete();n.view._layoutWork.then(function(){n.view._listView._writeProfilerMark(n.name+"_enter_layoutCompleted,info");n.view._listView._affectedRange.clear();n.view._layoutCompleted.complete()});n.canceling||n.view._setState(n.nextStateType)},function(t){return n.view._listView._writeProfilerMark(n.name+"_enter_layoutCanceled,info"),n.canceling||(n.view.firstIndexDisplayed=n.view.lastIndexDisplayed=-1,n.view._updateAriaMarkers(!0,n.view.firstIndexDisplayed,n.view.lastIndexDisplayed),n.view._setState(ot)),u.wrapError(t)});t.complete();this.canceling&&this.promise.cancel()},cancelLayout:function(n){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info");this.canceling=!0;this.promise&&this.promise.cancel();n&&this.view._setState(ht)},stop:function(){this.cancelLayout(!0)},realizePage:w,rebuildTree:function(){this.cancelLayout(!1);this.view._setState(k)},relayout:function(){this.cancelLayout(!1);this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i)}}),ht=i.Class.define(function(n){this.view=n},{name:"LayoutCanceledState",enter:w,stop:w,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(k)},relayout:function(){this.view._setState(g)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i)}}),ut=i.Class.define(function(n){this.view=n;this.nextState=ft;this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var n=this,t=new f;this.promise=t.promise.then(function(){return n.view._executeScrollToFunctor()}).then(function(){return n.relayoutNewContainers=!1,u._cancelBlocker(n.view._realizePageImpl())}).then(function(){n.view._state===n&&(n.view._completeUpdateTree(),n.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),n.view._setState(n.nextState))},function(t){return n.view._state!==n||n.canceling||(n.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),n.view._setState(b)),u.wrapError(t)});t.complete()},stop:function(){this.canceling=!0;this.promise.cancel();this.view._cancelRealize();this.view._setState(b)},realizePage:function(){this.canceling=!0;this.promise.cancel();this.enter()},rebuildTree:function(){this.stop();this.view._setState(k)},relayout:function(){this.stop();this.view._setState(g)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i)},setLoadingState:function(n){this.view._listView._setViewState(n)}}),b=i.Class.define(function(n){this.view=n},{name:"CanceledState",enter:w,stop:function(){this.view._cancelRealize()},realizePage:function(n){this.stop();this.view._setState(n)},rebuildTree:function(){this.stop();this.view._setState(k)},relayout:function(n){this.stop();this.view._setState(g,n)},layoutNewContainers:function(){this.relayout(b)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i)}}),ct=i.Class.derive(ut,function(n){this.view=n;this.nextState=lt;this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),lt=i.Class.derive(b,function(n){this.view=n},{name:"ScrollingPausedState",enter:function(){var n=this;this.promise=u._cancelBlocker(this.view._scrollEndPromise).then(function(){n.view._setState(ft)})},stop:function(){this.promise.cancel();this.view._cancelRealize()}}),ft=i.Class.define(function(n){this.view=n},{name:"UnrealizingState",enter:function(){var n=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return n.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),n.view._renderCompletePromise}).then(function(){n.view._setState(ot)})},stop:function(){this.view._cancelRealize();this.promise.cancel();this.view._setState(b)},realizePage:function(n){this.promise.cancel();this.view._setState(n)},rebuildTree:function(){this.view._setState(k)},relayout:function(){this.view._setState(g)},layoutNewContainers:function(){this.view._createLayoutSignal();this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i)}}),at=i.Class.define(function(n,t){this.view=n;this.realizePromise=t;this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var n=this;this.animating=!0;this.animatePromise=this.view._startAnimations();this.animateSignal=new f;this.view._executeAnimations=!1;this.animatePromise.done(function(){n.animating=!1;n.modifiedElements?(n.view._updateTreeImpl(n.count,n.delta,n.modifiedElements),n.modifiedElements=null,n.view._setState(b)):n.animateSignal.complete()},function(t){return n.animating=!1,u.wrapError(t)});this._waitForRealize()},_waitForRealize:function(){var n=this,t;this.realizing=!0;this.realizePromise.done(function(){n.realizing=!1});t=++this.realizeId;u.join([this.realizePromise,this.animateSignal.promise]).done(function(){t===n.realizeId&&(n.view._completeUpdateTree(),n.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),n.view._setState(ft))})},stop:function(n){this.realizePromise.cancel();this.view._cancelRealize();n&&(this.animatePromise.cancel(),this.view._setState(b))},realizePage:function(){if(!this.modifiedElements){var n=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return u._cancelBlocker(n.view._realizePageImpl())});this._waitForRealize()}},rebuildTree:function(){this.stop(!0);this.view._setState(k)},relayout:function(){this.stop(!0);this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null);this.view._setState(g)},layoutNewContainers:function(){this.view._createLayoutSignal();this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(n,t,i){if(this.animating){var r=this.modifiedElements;return this.count=n,this.delta=t,this.modifiedElements=i,r?u.cancel:this.animatePromise}return this.view._updateTreeImpl(n,t,i)},setLoadingState:function(n){this.view._listView._setViewState(n)}}),ot=i.Class.derive(b,function(n){this.view=n},{name:"CompletedState",enter:function(){this._stopped=!1;this.view._setupDeferredActions();this.view._realizationLevel=n._realizationLevel.normal;this.view._listView._raiseViewComplete();this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(st)},stop:function(){this._stopped=!0;b.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal();this.view._setState(st)},updateTree:function(n,t,i){return this.view._updateTreeImpl(n,t,i,!0)}}),st=i.Class.derive(b,function(n){this.view=n},{name:"LayingoutNewContainersState",enter:function(){var n=this;this.promise=u.join([this.view.deferTimeout,this.view._layoutWork]);this.promise.then(function(){n.view._relayoutInComplete=!1;n.relayout(b)})},stop:function(){this.promise.cancel();this.view._cancelRealize()},realizePage:function(n){this.stop();this.view._setState(g,n)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return n})})});t("require-style!less/controls",[],function(){});t("WinJS/Controls/ListView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_SafeHtml","../Utilities/_TabContainer","../Utilities/_UI","../Utilities/_VersionManager","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler","./ListView/_BrowseMode","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_Helpers","./ListView/_ItemsContainer","./ListView/_Layouts","./ListView/_SelectionManager","./ListView/_VirtualizeContentsView","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt){"use strict";function dt(){var n=vt;vt=[];n=n.filter(function(n){return n._isZombie()?(n._dispose(),!1):!0});vt=vt.concat(n)}function gt(n){vt.push(n);wt&&wt.cancel();wt=c.timeout(ti).then(dt)}function ni(n){return n.offsetParent?n.offsetParent.offsetWidth-n.offsetLeft-n.offsetWidth:0}var wt,bt=i._browserStyleEquivalents.transform,ti=1e3,vt=[],at=p._uniqueID,yt=ot._ListViewAnimationHelper,kt={get notCompatibleWithSemanticZoom(){return"ListView can only be used with SemanticZoom if randomAccess loading behavior is specified."},get listViewInvalidItem(){return"Item must provide index, key or description of corresponding item."},get listViewViewportAriaLabel(){return e._getWinJSString("ui/listViewViewportAriaLabel").value}},ii=i.requireSupportedForProcessing,pt={entrance:"entrance",contentTransition:"contentTransition"};t.Namespace.define("WinJS.UI",{ListViewAnimationType:pt,ListView:t.Namespace._lazy(function(){var w=t.Class.define(function(){this.clear()},{add:function(n,t){if(n._lastKnownSizeOfData=t,this._range){this._range.start=Math.min(this._range.start,n.start);var i=this._range._lastKnownSizeOfData-this._range.end,r=n._lastKnownSizeOfData-n.end,u=Math.min(i,r);this._range._lastKnownSizeOfData=n._lastKnownSizeOfData;this._range.end=this._range._lastKnownSizeOfData-u}else this._range=n},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),st=t.Class.define(function(n){this._listView=n},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(n,t,i,r){this._listView._configureForZoom(n,t,i,r)},setCurrentItem:function(n,t){this._listView._setCurrentItem(n,t)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(n,t){return this._listView._positionItem(n,t)},endZoom:function(n){this._listView._endZoom(n)},pinching:{get:function(){return this._listView._pinching},set:function(n){this._listView._pinching=n}}}),e=t.Class.define(function(t,i){if(t=t||n.document.createElement("div"),p._supportsTouchActionCrossSlide&&t.classList.add(tt._listViewSupportsCrossSlideClass),this._id=t.id||"",this._writeProfilerMark("constructor,StartTM"),i=i||{},t.winControl=this,p.addClass(t,"win-disposable"),this._affectedRange=new w,this._mutationObserver=new p._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=t,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=tt._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._viewportWidth=tt._UNINITIALIZED,this._viewportHeight=tt._UNINITIALIZED,this._manipulationState=p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new ft._UnsupportedGroupFocusCache,this._viewChange=tt._ViewChange.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new lt._VirtualizeContentsView(this),this._selection=new ct._SelectionManager(this),this._createTemplates(),this._groupHeaderRenderer=b._trivialHtmlRenderer,this._itemRenderer=b._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,i.itemDataSource)this._dataSource=i.itemDataSource;else{var r=new h.List;this._dataSource=r.dataSource}this._selectionMode=g.SelectionMode.multi;this._tap=g.TapBehavior.invokeOnly;this._groupHeaderTap=g.GroupHeaderTapBehavior.invoke;this._swipeBehavior=g.SwipeBehavior.select;this._mode=new rt._SelectionMode(this);this._setSwipeClass();this._groups=new et._NoGroups(this);this._updateItemsAriaRoles();this._updateGroupHeadersAriaRoles();this._element.setAttribute("aria-multiselectable",this._multiSelection());this._element.tabIndex=-1;this._tabManager.tabIndex=this._tabIndex;"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative");this._updateItemsManager();i.layout||this._updateLayout(new ht.GridLayout);this._attachEvents();this._runningInit=!0;v.setOptions(this,i);this._runningInit=!1;this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0);this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(n){this._updateLayout(n);this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0,!0))}},pagesToLoad:{get:function(){return 2*lt._VirtualizeContentsView._pagesToPrefetch+1},set:function(){p._deprecated(ut.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){p._deprecated(ut.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(n){function t(n){n.detail===g.DataSourceStatus.failure&&(i.itemDataSource=null,i.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var i=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",t,!1);this._groupDataSource=n;this._groupFocusCache=n&&this._supportsGroupHeaderKeyboarding?new ft._GroupFocusCache(this):new ft._UnsupportedGroupFocusCache;this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",t,!1);this._createGroupsContainer();this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1;this._groupDataSource?p.addClass(this._element,tt._groupsClass):p.removeClass(this._element,tt._groupsClass);this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){p._deprecated(ut.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){p._deprecated(ut.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(n){if("string"==typeof n&&n.match(/^(none|single|multi)$/))return i.isPhone&&n===g.SelectionMode.single?void 0:(this._selectionMode=n,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),this._setSwipeClass(),void this._configureSelectionMode());throw new r("WinJS.UI.ListView.ModeIsInvalid",ut.modeIsInvalid);}},tapBehavior:{get:function(){return this._tap},set:function(n){i.isPhone&&n===g.TapBehavior.directSelect||(this._tap=n,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(n){this._groupHeaderTap=n;this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(n){this._swipeBehavior=n;this._setSwipeClass()}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(n){this._writeProfilerMark("set_itemDataSource,info");this._dataSource=n||(new h.List).dataSource;this._groupFocusCache.clear();this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(n){this._setRenderer(n,!1);this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(n){p._deprecated(ut.resetItemIsDeprecated);this._itemRelease=n}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(n){this._setRenderer(n,!0);this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(n){p._deprecated(ut.resetGroupHeaderIsDeprecated);this._groupHeaderRelease=n}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(n){if(!(0>n)){this._writeProfilerMark("set_indexOfFirstVisible("+n+"),info");this._raiseViewLoading(!0);var t=this;this._batchViewUpdates(tt._ViewChange.realize,tt._ScrollToPriority.high,function(){var i;return t._entityInRange({type:g.ObjectType.item,index:n}).then(function(n){return n.inRange?t._getItemOffset({type:g.ObjectType.item,index:n.index}).then(function(n){return i=n,t._ensureFirstColumnRange(g.ObjectType.item)}).then(function(){return i=t._correctRangeInFirstColumn(i,g.ObjectType.item),i=t._convertFromCanvasCoordinates(i),t._view.waitForValidScrollPosition(i.begin)}).then(function(n){var i=n<t._lastScrollPosition?"left":"right",r=t._viewport[t._scrollLength]-t._getViewportLength();return n=p._clamp(n,0,r),{position:n,direction:i}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var n=this._selection._getFocused(),t={index:n.index,type:n.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1},i,r,u;return n.type===g.ObjectType.groupHeader?(i=this._groups.group(n.index),i&&(t.key=i.key,t.showFocus=!(!i.header||!p.hasClass(i.header,tt._itemFocusClass)))):(r=this._view.items.itemAt(n.index),r&&(u=this._itemsManager._recordFromElement(r),t.key=u.item&&u.item.key,t.showFocus=!!r.parentNode.querySelector("."+tt._itemFocusOutlineClass))),t},set:function(n){function u(i,r,u){var f=!!n.showFocus&&t._hasKeyboardFocus;t._unsetFocusOnItem(r);t._selection._setFocused(u,f);t._hasKeyboardFocus?(t._keyboardFocusInbound=f,t._setFocusOnItem(u)):t._tabManager.childFocus=r?i:null;u.type!==g.ObjectType.groupHeader&&(t._updateFocusCache(u.index),t._updater&&(t._updater.newSelectionPivot=u.index,t._updater.oldSelectionPivot=-1),t._selection._pivot=u.index)}var t,f,i,r;this._hasKeyboardFocus=n.hasFocus||this._hasKeyboardFocus;t=this;n.key&&(n.type!==g.ObjectType.groupHeader&&this._dataSource.itemFromKey||n.type===g.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)?(this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel(),f=n.type===g.ObjectType.groupHeader?this._groupDataSource:this._dataSource,this.oldCurrentItemKeyFetch=f.itemFromKey(n.key).then(function(i){if(t.oldCurrentItemKeyFetch=null,i){var r=n.type===g.ObjectType.groupHeader?t._groups.group(i.index).header:t._view.items.itemAt(i.index);u(r,!!r,{type:n.type||g.ObjectType.item,index:i.index})}})):void 0!==n.index&&(n.type===g.ObjectType.groupHeader?(r=t._groups.group(n.index),i=r&&r.header):i=t._view.items.itemAt(n.index),u(i,!!i,{type:n.type||g.ObjectType.item,index:n.index}))}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new st(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(n){i.isPhone||this._dragSource!==n&&(this._dragSource=n,this._setSwipeClass())}},itemsReorderable:{get:function(){return this._reorderable},set:function(n){i.isPhone||this._reorderable!==n&&(this._reorderable=n,this._setSwipeClass())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(n){this._maxDeferredItemCleanup=Math.max(0,+n||0)}},dispose:function(){this._dispose()},elementFromIndex:function(n){return this._view.items.itemAt(n)},indexOfElement:function(n){return this._view.items.index(n)},ensureVisible:function(n){var i=g.ObjectType.item,r=n,t;(+n!==n&&(i=n.type,r=n.index),this._writeProfilerMark("ensureVisible("+i+": "+r+"),info"),0>r)||(this._raiseViewLoading(!0),t=this,this._batchViewUpdates(tt._ViewChange.realize,tt._ScrollToPriority.high,function(){var n;return t._entityInRange({type:i,index:r}).then(function(r){return r.inRange?t._getItemOffset({type:i,index:r.index}).then(function(r){return n=r,t._ensureFirstColumnRange(i)}).then(function(){var c,u,l,e,a,v,y,w;n=t._correctRangeInFirstColumn(n,i);var s=t._getViewportLength(),o=t._viewportScrollPosition,h=o+s,f=t._viewportScrollPosition,b=n.end-n.begin;return n=t._convertFromCanvasCoordinates(n),c=!1,i===g.ObjectType.groupHeader&&o<=n.begin&&(u=t._groups.group(r.index).header,u&&(e=ht._getMargins(u),t._horizontalLayout?(a=t._rtl(),v=a?ni(u)-e.right:u.offsetLeft-e.left,l=v+u.offsetWidth+(a?e.left:e.right)):l=u.offsetTop+u.offsetHeight+e.top,c=h>=l)),c||(b>=h-o?f=n.begin:n.begin<o?f=n.begin:n.end>h&&(f=n.end-s)),y=f<t._lastScrollPosition?"left":"right",w=t._viewport[t._scrollLength]-s,f=p._clamp(f,0,w),{position:f,direction:y}}):{position:0,direction:"left"}})},!0))},loadMorePages:function(){p._deprecated(ut.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info");this._forceLayoutImpl(tt._ViewChange.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info");this._forceLayoutImpl(tt._ViewChange.remeasure)},_entityInRange:function(n){if(n.type===g.ObjectType.item)return this._itemsCount().then(function(t){var i=p._clamp(n.index,0,t-1);return{inRange:i>=0&&t>i,index:i}});var t=p._clamp(n.index,0,this._groups.length()-1);return c.wrap({inRange:t>=0&&t<this._groups.length(),index:t})},_forceLayoutImpl:function(n){var t=this;this._versionManager.unlocked.then(function(){t._writeProfilerMark("_forceLayoutImpl viewChange("+n+"),info");t._cancelAsyncViewWork();t._pendingLayoutReset=!0;t._resizeViewport();t._batchViewUpdates(n,tt._ScrollToPriority.low,function(){return{position:t._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){i.isPhone&&(this.tapBehavior===g.TapBehavior.toggleSelect&&this.selectionMode===g.SelectionMode.multi?p.addClass(this._canvas,tt._selectionModeClass):p.removeClass(this._canvas,tt._selectionModeClass))},_lastScrollPosition:{get:function(){return this._lastScrollPositionValue},set:function(n){if(0===n)this._lastDirection="right",this._direction="right",this._lastScrollPositionValue=0;else{var t=n<this._lastScrollPositionValue?"left":"right";this._direction=this._scrollDirection(n);this._lastDirection=t;this._lastScrollPositionValue=n}}},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=p.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(n){var t={};t[this._scrollProperty]=n;p.setScrollPosition(this._viewport,t);this._currentScrollPosition=n}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(n){var t=this._horizontal()?this._rtl()?-n:n:0,i=this._horizontal()?0:n;this._canvas.style[bt.scriptName]=0!==n?"translate( "+t+"px, "+i+"px)":"";this._canvasStartValue=n}},scrollPosition:{get:function(){return this._viewportScrollPosition},set:function(n){var t=this;this._batchViewUpdates(tt._ViewChange.realize,tt._ScrollToPriority.high,function(){return t._view.waitForValidScrollPosition(n).then(function(){var r=t._viewport[t._scrollLength]-t._getViewportLength(),i;return n=p._clamp(n,0,r),i=n<t._lastScrollPosition?"left":"right",{position:n,direction:i}})},!0)}},_setRenderer:function(n,t){var u;if(n){if("function"==typeof n)u=n;else if("object"==typeof n){if(i.validation&&!n.renderItem)throw new r("WinJS.UI.ListView.invalidTemplate",ut.invalidTemplate);u=n.renderItem}}else{if(i.validation)throw new r("WinJS.UI.ListView.invalidTemplate",ut.invalidTemplate);u=b.trivialHtmlRenderer}u&&(t?this._groupHeaderRenderer=u:this._itemRenderer=u)},_renderWithoutReuse:function(n,t){var i,r;return(t&&y._disposeElement(t),i=this._itemRenderer(n),i.then)?i.then(function(n){return n.tabIndex=0,n}):(r=i.element||i,r.tabIndex=0,i)},_isInsertedItem:function(n){return!!this._insertedItems[n.handle]},_clearInsertedItems:function(){for(var t=Object.keys(this._insertedItems),n=0,i=t.length;i>n;n++)this._insertedItems[t[n]].release();this._insertedItems={};this._modifiedElements=[];this._countDifference=0},_cancelAsyncViewWork:function(n){this._view.stopWork(n)},_updateView:function(){function i(){n._itemsBlockExtent=-1;n._firstItemRange=null;n._firstHeaderRange=null;n._itemMargins=null;n._headerMargins=null;n._canvasMargins=null;n._cachedRTL=null;n._rtl()}function t(){var t,i;return n._scrollToPriority=tt._ScrollToPriority.uninitialized,t=n._setScrollbarPosition,n._setScrollbarPosition=!1,i="number"==typeof n._scrollToFunctor?{position:n._scrollToFunctor}:n._scrollToFunctor(),c.as(i).then(function(i){return i=i||{},t&&+i.position===i.position&&(n._lastScrollPosition=i.position,n._viewportScrollPosition=i.position),i},function(i){return n._setScrollbarPosition|=t,c.wrapError(i)})}if(!this._isZombie()){var n=this,r=this._viewChange;this._viewChange=tt._ViewChange.realize;r===tt._ViewChange.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),i(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(t,!0),this._setFocusOnItem(this._selection._getFocused())):r===tt._ViewChange.remeasure?(this._view.resetItems(!0),this._resetLayout(),i(),this._view.refresh(t),this._setFocusOnItem(this._selection._getFocused())):r===tt._ViewChange.relayout?(this._pendingLayoutReset&&(this._resetLayout(),i()),this._view.refresh(t)):this._view.onScroll(t)}},_batchViewUpdates:function(n,t,i,r,u){if(this._viewChange=Math.min(this._viewChange,n),(null===this._scrollToFunctor||t>=this._scrollToPriority)&&(this._scrollToPriority=t,this._scrollToFunctor=i),this._setScrollbarPosition|=!!r,!this._batchingViewUpdates){this._raiseViewLoading();var f=this;this._batchingViewUpdatesSignal=new a;this._batchingViewUpdates=c.any([this._batchingViewUpdatesSignal.promise,l.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){if(!f._isZombie())return f._viewChange!==tt._ViewChange.rebuild||f._firstTimeDisplayed||0===Object.keys(f._view.items._itemData).length||u?void 0:f._fadeOutViewport()}).then(function(){f._batchingViewUpdates=null;f._batchingViewUpdatesSignal=null;f._updateView();f._firstTimeDisplayed=!1},function(){f._batchingViewUpdates=null;f._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var t=n.document.createElement("div");t.className=this._canvas.className;this._viewport.replaceChild(t,this._canvas);this._canvas=t;this._groupsToRemove={};this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){p.addClass(this._element,tt._listViewClass);p[this._rtl()?"addClass":"removeClass"](this._element,tt._rtlListViewClass);this._element.innerHTML='<div tabIndex="-1" role="group" class="'+tt._viewportClass+" "+tt._horizontalClass+'"><div class="'+tt._scrollableClass+'"><div class="'+tt._proxyClass+'"><\/div><\/div><div><\/div><\/div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"><\/div>';this._viewport=this._element.firstElementChild;this._canvas=this._viewport.firstElementChild;this._canvasProxy=this._canvas.firstElementChild;this._deleteWrapper=this._canvas.nextElementSibling;this._keyboardEventsHelper=this._viewport.nextElementSibling;this._tabIndex=p.getTabIndex(this._element);this._tabIndex<0&&(this._tabIndex=0);this._tabManager=new d.TabContainer(this._viewport);this._tabManager.tabIndex=this._tabIndex;this._progressBar=n.document.createElement("progress");p.addClass(this._progressBar,tt._progressClass);this._progressBar.style.position="absolute";this._progressBar.max=100},_unsetFocusOnItem:function(t){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus);this._isZombie()||(t||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,n.document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,p._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(n){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var t=this,i=function(i){t._isZombie()||(t._tabManager.childFocus!==i&&(t._tabManager.childFocus=i),t._focusRequest=null,t._hasKeyboardFocus&&!t._itemFocused&&(t._selection._keyboardFocused()&&t._drawFocusRectangle(i),t._view.updateAriaForAnnouncement(i,n.type===g.ObjectType.groupHeader?t._groups.length():t._cachedCount),t._itemFocused=!0,p._setActive(i)))};this._focusRequest=n.type!==g.ObjectType.groupHeader?this._view.items.requestItem(n.index):this._groups.requestHeader(n.index);this._focusRequest.then(i)}},_attachEvents:function(){function r(n,t,r){return{name:t?n:n.toLowerCase(),handler:function(t){i["_on"+n](t)},capture:r}}function t(n,t,r){return{capture:r,name:t?n:n.toLowerCase(),handler:function(t){var r=i._mode,u="on"+n;!i._disposed&&r[u]&&r[u](t)}}}function s(n,t){return{handler:function(t){i["_on"+n](t)},filter:t}}var i=this,h=[s("PropertyChange",["dir","style","tabindex"])],f,e,u,o;this._cachedStyleDir=this._element.style.direction;h.forEach(function(n){new p._MutationObserver(n.handler).observe(i._element,{attributes:!0,attributeFilter:n.filter})});f=[t("PointerDown"),t("click",!1),t("PointerUp"),t("LostPointerCapture"),t("MSHoldVisual",!0),t("PointerCancel",!0),t("DragStart"),t("DragOver"),t("DragEnter"),t("DragLeave"),t("Drop"),t("ContextMenu"),t("MSManipulationStateChanged",!0,!0)];f.forEach(function(n){p._addEventListener(i._viewport,n.name,n.handler,!!n.capture)});e=[r("FocusIn",!1,!1),r("FocusOut",!1,!1),t("KeyDown"),t("KeyUp"),r("MSElementResize",!1,!1)];e.forEach(function(n){p._addEventListener(i._element,n.name,n.handler,!!n.capture)});this._onMSElementResizeBound=this._onMSElementResize.bind(this);p._resizeNotifier.subscribe(this._element,this._onMSElementResizeBound);u=n.document.body.contains(this._element);p._addInsertedNotifier(this._element);this._element.addEventListener("WinJSNodeInserted",function(n){return u?void(u=!1):void i._onMSElementResizeBound(n)},!1);o=[r("MSManipulationStateChanged",!0),r("Scroll")];o.forEach(function(n){i._viewport.addEventListener(n.name,n.handler,!1)});this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this));this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this));this._viewport.addEventListener("onTabEntered",function(n){i._mode.onTabEntered(n)});this._viewport.addEventListener("onTabExiting",function(n){i._mode.onTabExiting(n)})},_updateItemsManager:function(){function t(t){t.detail===g.DataSourceStatus.failure&&(n.itemDataSource=null,n.groupDataSource=null)}var n=this,r={beginNotifications:function(){},changed:function(t,i){var r,u,e,f,o;if(!n._ifZombieDispose()){for(n._createUpdater(),r=n._updater.elements[at(i)],r&&(u=n.selection._isIncluded(r.index),(u&&(n._updater.updateDrag=!0),i!==t)?(((n._tabManager.childFocus===i||n._updater.newFocusedItem===i)&&(n._updater.newFocusedItem=t,n._tabManager.childFocus=null),r.itemBox)&&(p.addClass(t,tt._itemClass),n._setupAriaSelectionObserver(t),e=i.nextElementSibling,r.itemBox.removeChild(i),r.itemBox.insertBefore(t,e)),n._setAriaSelected(t,u),n._view.items.setItemAt(r.newIndex,{element:t,itemBox:r.itemBox,container:r.container,itemsManagerRecord:r.itemsManagerRecord}),delete n._updater.elements[at(i)],y._disposeElement(i),n._updater.elements[at(t)]={item:t,container:r.container,itemBox:r.itemBox,index:r.index,newIndex:r.newIndex,itemsManagerRecord:r.itemsManagerRecord}):r.itemBox&&r.container&&(it._ItemEventsHandler.renderSelection(r.itemBox,t,u,!0),p[u?"addClass":"removeClass"](r.container,tt._selectedClass)),n._updater.changed=!0),f=0,o=n._notificationHandlers.length;o>f;f++)n._notificationHandlers[f].changed(t,i);n._writeProfilerMark("changed,info")}},removed:function(t,i,r){function o(t){n._updater.updateDrag=!0;n._currentMode()._dragging&&n._currentMode()._draggingUnselectedItem&&n._currentMode()._dragInfo._isIncluded(t)&&(n._updater.newDragInfo=new ct._Selection(n,[]));var r=n._updater.selectionFirst[t],u=n._updater.selectionLast[t],i=r||u;i&&(delete n._updater.selectionFirst[i.oldFirstIndex],delete n._updater.selectionLast[i.oldLastIndex],n._updater.selectionChanged=!0)}var s,u,f,e,l;if(!n._ifZombieDispose()){if(n._createUpdater(),s=n._insertedItems[r],s&&delete n._insertedItems[r],t){if(f=n._updater.elements[at(t)],e=n._itemsManager.itemObject(t),e&&n._groupFocusCache.deleteItem(e.key),f){if(u=f.index,f.itemBox){var h=f.itemBox,a=tt._containerOddClass,c=tt._containerEvenClass,v=p.hasClass(h.parentElement,c)?c:a;n._updater.removed.push({index:u,itemBox:h,containerStripe:v})}n._updater.deletesCount++;l=n._view.items.itemDataAt(u);l.removed=!0;delete n._updater.elements[at(t)]}else u=e&&e.index;n._updater.oldFocus.type!==g.ObjectType.groupHeader&&n._updater.oldFocus.index===u&&(n._updater.newFocus.index=u,n._updater.focusedItemRemoved=!0);o(u)}else u=n._updater.selectionHandles[r],u===+u&&o(u);n._writeProfilerMark("removed("+u+"),info");n._updater.changed=!0}},updateAffectedRange:function(t){n._itemsCount().then(function(i){var r=n._view.containers?n._view.containers.length:0;t.start=Math.min(t.start,r);n._affectedRange.add(t,i)});n._createUpdater();n._updater.changed=!0},indexChanged:function(t,i,r){var f,e,u;n._ifZombieDispose()||((n._createUpdater(),t)&&(f=n._itemsManager.itemObject(t),f&&n._groupFocusCache.updateItemIndex(f.key,i),e=n._updater.elements[at(t)],e&&(e.newIndex=i,n._updater.changed=!0),n._updater.itemsMoved=!0),n._currentMode()._dragging&&n._currentMode()._draggingUnselectedItem&&n._currentMode()._dragInfo._isIncluded(r)&&(n._updater.newDragInfo=new ct._Selection(n,[{firstIndex:i,lastIndex:i}]),n._updater.updateDrag=!0),n._updater.oldFocus.type!==g.ObjectType.groupHeader&&n._updater.oldFocus.index===r&&(n._updater.newFocus.index=i,n._updater.changed=!0),n._updater.oldSelectionPivot===r&&(n._updater.newSelectionPivot=i,n._updater.changed=!0),u=n._updater.selectionFirst[r],u&&(u.newFirstIndex=i,n._updater.changed=!0,n._updater.updateDrag=!0),u=n._updater.selectionLast[r],u&&(u.newLastIndex=i,n._updater.changed=!0,n._updater.updateDrag=!0))},endNotifications:function(){n._update()},inserted:function(t){n._ifZombieDispose()||(n._writeProfilerMark("inserted,info"),n._createUpdater(),n._updater.changed=!0,t.retain(),n._updater.insertsCount++,n._insertedItems[t.handle]=t)},moved:function(t,i,r,u){var o,f;if(!n._ifZombieDispose()){if((n._createUpdater(),n._updater.movesCount++,t)&&(n._updater.itemsMoved=!0,o=n._updater.elements[at(t)],o&&(o.moved=!0)),f=n._updater.selectionHandles[u.handle],f===+f){n._updater.updateDrag=!0;var s=n._updater.selectionFirst[f],h=n._updater.selectionLast[f],e=s||h;e&&e.oldFirstIndex!==e.oldLastIndex&&(delete n._updater.selectionFirst[e.oldFirstIndex],delete n._updater.selectionLast[e.oldLastIndex],n._updater.selectionChanged=!0,n._updater.changed=!0)}n._writeProfilerMark("moved("+f+"),info")}},countChanged:function(t,i){n._ifZombieDispose()||(n._writeProfilerMark("countChanged("+t+"),info"),n._cachedCount=t,n._createUpdater(),n._view.lastIndexDisplayed+1===i&&(n._updater.changed=!0),n._updater.countDifference+=t-i)},reload:function(){n._ifZombieDispose()||(n._writeProfilerMark("reload,info"),n._processReload())}},i;this._versionManager&&this._versionManager._dispose();this._versionManager=new nt._VersionManager;this._updater=null;i=this._selection.getRanges();this._selection._selected.clear();this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",t,!1),this._clearInsertedItems(),this._itemsManager.release());this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null);this._cachedCount=tt._UNINITIALIZED;this._itemsManager=b._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),r,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(t){return t>=n.indexOfFirstVisible&&t<=n.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id});this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",t,!1);this._selection._selected.set(i)},_processReload:function(){this._affectedRange.addAll();this._cancelAsyncViewWork(!0);this._currentMode()._dragging&&this._currentMode()._clearDragProperties();this._groupFocusCache.clear();this._selection._reset();this._updateItemsManager();this._pendingLayoutReset=!0;this._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.low,this.scrollPosition)},_createUpdater:function(){var n,u,i;if(!this._updater){this.itemDataSource._isVirtualizedDataSource&&this._affectedRange.addAll();this._versionManager.beginUpdating();this._cancelAsyncViewWork();n={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:g.ObjectType.item,index:tt._INVALID_INDEX},newSelectionPivot:{type:g.ObjectType.item,index:tt._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:g.ObjectType.item,index:tt._INVALID_INDEX},newFocus:{type:g.ObjectType.item,index:tt._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(t,i,r){n.elements[at(i)]={item:i,container:r.container,itemBox:r.itemBox,index:t,newIndex:t,itemsManagerRecord:r.itemsManagerRecord,detached:r.detached}});for(var r=this._selection._selected._ranges,t=0,f=r.length;f>t;t++)u=r[t],i={newFirstIndex:r[t].firstIndex,oldFirstIndex:r[t].firstIndex,newLastIndex:r[t].lastIndex,oldLastIndex:r[t].lastIndex},n.selectionFirst[i.oldFirstIndex]=i,n.selectionLast[i.oldLastIndex]=i,n.selectionHandles[u.firstPromise.handle]=i.oldFirstIndex,n.selectionHandles[u.lastPromise.handle]=i.oldLastIndex;n.oldSelectionPivot=this._selection._pivot;n.newSelectionPivot=n.oldSelectionPivot;n.oldFocus=this._selection._getFocused();n.newFocus=this._selection._getFocused();this._updater=n}},_synchronize:function(){var n=this._updater,s,t,f,h,c,e,o,l,a,u,v,y,i,r;if(this._updater=null,this._groupsChanged=!1,this._countDifference=this._countDifference||0,n&&n.changed){n.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved();n.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(n.removed.map(function(n){return n.itemBox}));(n.itemsMoved||n.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations();this._currentMode().onDataChanged&&this._currentMode().onDataChanged();s=[];for(t in n.selectionFirst)n.selectionFirst.hasOwnProperty(t)&&(f=n.selectionFirst[t],n.selectionChanged=n.selectionChanged||f.newLastIndex-f.newFirstIndex!=f.oldLastIndex-f.oldFirstIndex,f.newFirstIndex<=f.newLastIndex&&s.push({firstIndex:f.newFirstIndex,lastIndex:f.newLastIndex}));for(n.selectionChanged?(h=new ct._Selection(this,s),this._selection._fireSelectionChanging(h),this._selection._selected.set(s),this._selection._fireSelectionChanged(),h.clear()):this._selection._selected.set(s),this._selection._updateCount(this._cachedCount),n.newSelectionPivot=Math.min(this._cachedCount-1,n.newSelectionPivot),this._selection._pivot=n.newSelectionPivot>=0?n.newSelectionPivot:tt._INVALID_INDEX,n.newFocus.type!==g.ObjectType.groupHeader&&(n.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,n.newFocus.index))),this._selection._setFocused(n.newFocus,this._selection._keyboardFocused()),c=this._modifiedElements||[],e={},this._modifiedElements=[],this._countDifference+=n.countDifference,t=0;t<c.length;t++)i=c[t],-1===i.newIndex?this._modifiedElements.push(i):e[i.newIndex]=i;for(t=0;t<n.removed.length;t++)o=n.removed[t],i=e[o.index],i?delete e[o.index]:i={oldIndex:o.index},i.newIndex=-1,i._removalHandled||(i._itemBox=o.itemBox,i._containerStripe=o.containerStripe),this._modifiedElements.push(i);for(l=Object.keys(this._insertedItems),t=0;t<l.length;t++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[l[t]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");a={};for(t in n.elements)n.elements.hasOwnProperty(t)&&(u=n.elements[t],a[u.newIndex]={element:u.item,container:u.container,itemBox:u.itemBox,itemsManagerRecord:u.itemsManagerRecord,detached:u.detached},i=e[u.index],i?(delete e[u.index],i.newIndex=u.newIndex):i={oldIndex:u.index,newIndex:u.newIndex},i.moved=u.moved,this._modifiedElements.push(i));for(this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM"),v=Object.keys(e),t=0;t<v.length;t++)y=v[t],i=e[y],-1!==i.oldIndex&&this._modifiedElements.push(i);return this._view.items._itemData=a,n.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?n.newDragInfo&&(this._currentMode()._dragInfo=n.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),n.focusedItemRemoved||this._focusRequest&&n.oldFocus.index!==n.newFocus.index||n.oldFocus.type!==n.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):n.newFocusedItem&&(this._hasKeyboardFocus=n.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())),r=this,this._groups.synchronizeGroups().then(function(){return n.newFocus.type===g.ObjectType.groupHeader&&(n.newFocus.index=Math.min(r._groups.length()-1,n.newFocus.index),n.newFocus.index<0&&(n.newFocus={type:g.ObjectType.item,index:0}),r._selection._setFocused(n.newFocus,r._selection._keyboardFocused())),r._versionManager.endUpdating(),n.deletesCount>0&&r._updateDeleteWrapperSize(),r._view.updateTree(r._cachedCount,r._countDifference,r._modifiedElements)}).then(function(){return r._lastScrollPosition})}return this._countDifference+=n?n.countDifference:0,r=this,this._groups.synchronizeGroups().then(function(){return n&&r._versionManager.endUpdating(),r._view.updateTree(r._cachedCount,r._countDifference,r._modifiedElements)}).then(function(){return r.scrollPosition})},_updateDeleteWrapperSize:function(n){var t=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+t]=(n?0:this.scrollPosition+this._getViewportSize()[t])+"px"},_verifyRealizationNeededForChange:function(){var u=!1,f=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),n=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference),i,r;if(n&&this._updater.elements)for(var e=Object.keys(this._updater.elements),t=0,o=e.length;o>t;t++)if(i=this._updater.elements[e[t]],r=i.index-i.newIndex,0>r||r>this._updater.deletesCount){n=!1;break}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0;n&&this._view.lastIndexDisplayed<this._view.end-f&&this._updater.deletesCount+this._view.deletesWithoutRealize<f?(u=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0;this._view._setSkipRealizationForChange(u)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var n=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(t){n._writeProfilerMark("update,StopTM");n._batchViewUpdates(tt._ViewChange.relayout,tt._ScrollToPriority.low,t).complete()})):this._batchViewUpdates(tt._ViewChange.relayout,tt._ScrollToPriority.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var n=this;this._updateJob=l.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){n._updateJob&&n._update()});this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp();this._groups=this._groupDataSource?new et._UnvirtualizedGroupsContainer(this,this._groupDataSource):new et._NoGroups(this)},_createLayoutSite:function(){var t=this;return Object.create({invalidateLayout:function(){t._pendingLayoutReset=!0;var n="horizontal"===t._layout.orientation!==t._horizontalLayout;t._affectedRange.addAll();t._batchViewUpdates(tt._ViewChange.rebuild,tt._ScrollToPriority.low,n?0:t.scrollPosition,!1,!0)},itemFromIndex:function(n){return t._itemsManager._itemPromiseAtIndex(n)},groupFromIndex:function(n){return t._groupsEnabled()?n<t._groups.length()?t._groups.group(n).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(n){return n=Math.max(0,n),t._groups.groupFromItem(n)},renderItem:function(i){return c._cancelBlocker(t._itemsManager._itemFromItemPromise(i)).then(function(i){var f,r,u;return i?(f=t._itemsManager._recordFromElement(i),f.pendingReady&&f.pendingReady(),i=i.cloneNode(!0),p.addClass(i,tt._itemClass),r=n.document.createElement("div"),p.addClass(r,tt._itemBoxClass),r.appendChild(i),u=n.document.createElement("div"),p.addClass(u,tt._containerClass),u.appendChild(r),u):c.cancel})},renderHeader:function(i){var r=b._normalizeRendererReturn(t.groupHeaderTemplate(c.wrap(i)));return r.then(function(t){p.addClass(t.element,tt._headerClass);var i=n.document.createElement("div");return p.addClass(i,tt._headerContainerClass),i.appendChild(t.element),i})},readyToMeasure:function(){t._getViewportLength();t._getCanvasMargins()},_isZombie:function(){return t._isZombie()},_writeProfilerMark:function(n){t._writeProfilerMark(n)}},{_itemsManager:{enumerable:!0,get:function(){return t._itemsManager}},rtl:{enumerable:!0,get:function(){return t._rtl()}},surface:{enumerable:!0,get:function(){return t._canvas}},viewport:{enumerable:!0,get:function(){return t._viewport}},scrollbarPos:{enumerable:!0,get:function(){return t.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return t._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return t.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return t._animationsDisabled()}},tree:{enumerable:!0,get:function(){return t._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,t.scrollPosition-2*t._getViewportLength()),lastPixel:t.scrollPosition+3*t._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:t.scrollPosition,lastPixel:t.scrollPosition+t._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return t._itemsCount()}},groupCount:{enumerable:!0,get:function(){return t._groups.length()}}})},_initializeLayout:function(){this._affectedRange.addAll();var n=this._createLayoutSite();return this._layout.initialize(n,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(n){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",p.addClass(this._viewport,tt._horizontalClass),p.removeClass(this._viewport,tt._verticalClass),n&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",p.addClass(this._viewport,tt._verticalClass),p.removeClass(this._viewport,tt._horizontalClass),n&&p.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1;this._affectedRange.addAll();this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(n){var t=!1,i,r;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),t=!0);n&&"function"==typeof n.type?(r=ii(n.type),i=new r(n)):i=n&&n.initialize?n:new ht.GridLayout(n);t&&this._resetCanvas();this._layoutImpl=i;this._layout=new ht._LayoutWrapper(i);t&&this._unsetFocusOnItem();this._setFocusOnItem({type:g.ObjectType.item,index:0});this._selection._setFocused({type:g.ObjectType.item,index:0});this._horizontalLayout=this._initializeLayout();this._resetLayoutOrientation(t);t&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setSwipeClass:function(){!i.isPhone&&(this._currentMode()instanceof rt._SelectionMode&&this._selectionAllowed()&&this._swipeBehavior===g.SwipeBehavior.select||this._dragSource||this._reorderable)?(this._swipeable=!0,p.addClass(this._element,tt._swipeableClass)):(this._swipeable=!1,p.removeClass(this._element,tt._swipeableClass));var n=this.itemsDraggable||this.itemsReorderable,t=this._selectionAllowed()&&this._swipeBehavior===g.SwipeBehavior.select,r=this._swipeable;this._view.items.each(function(u,f,e){var c,l;if(e.itemBox){var o=p.hasClass(f,tt._nonDraggableClass),s=p.hasClass(f,tt._nonSelectableClass),h=p.hasClass(e.itemBox,tt._nonSwipeableClass);(e.itemBox.draggable=n&&!o,!r&&h)?p.removeClass(e.itemBox,tt._nonSwipeableClass):r&&(c=n&&!t&&o||t&&!n&&s||o&&s,c&&!h?p.addClass(e.itemBox,tt._nonSwipeableClass):!c&&h&&p.removeClass(e.itemBox,tt._nonSwipeableClass));l=i.isPhone&&s;p[l?"addClass":"removeClass"](e.itemBox,tt._nonSelectableClass)}})},_resizeViewport:function(){this._viewportWidth=tt._UNINITIALIZED;this._viewportHeight=tt._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info");l.schedule(function(){var n,t,i;this._isZombie()||this._viewportWidth===tt._UNINITIALIZED||this._viewportHeight===tt._UNINITIALIZED||(n=this._element.offsetWidth,t=this._element.offsetHeight,(this._previousWidth!==n||this._previousHeight!==t)&&(this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+n+"x"+t+"),info"),this._previousWidth=n,this._previousHeight=t,this._resizeViewport(),i=this,this._affectedRange.addAll(),this._batchViewUpdates(tt._ViewChange.relayout,tt._ScrollToPriority.low,function(){return{position:i.scrollPosition,direction:"right"}})))},l.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(n){function o(n){r._changeFocus(r._selection._getFocused(),!0,!1,!1,n)}var r,f,e;if(this._hasKeyboardFocus=!0,r=this,n.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?o(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(n.target===this._element)o();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var u=this._view.items,t={},i=this._groups.headerFrom(n.target),s=null;(i?(t.type=g.ObjectType.groupHeader,t.index=this._groups.index(i)):(t.index=u.index(n.target),t.type=g.ObjectType.item,i=u.itemBoxAt(t.index),s=u.itemAt(t.index)),t.index!==tt._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(t.type===g.ObjectType.groupHeader&&n.target===i||t.type===g.ObjectType.item&&n.target.parentNode===i)&&this._drawFocusRectangle(i),this._tabManager.childFocus!==i&&this._tabManager.childFocus!==s&&(this._selection._setFocused(t,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,i=t.type===g.ObjectType.groupHeader?i:u.itemAt(t.index),this._tabManager.childFocus=i,r._updater)))&&(f=r._updater.elements[at(i)],e=t.index,f&&f.newIndex&&(e=f.newIndex),r._updater.oldFocus={type:t.type,index:e},r._updater.newFocus={type:t.type,index:e})}},_onFocusOut:function(n){if(!this._disposed){this._hasKeyboardFocus=!1;this._itemFocused=!1;var t=this._view.items.itemBoxFrom(n.target)||this._groups.headerFrom(n.target);t&&this._clearFocusRectangle(t)}},_onMSManipulationStateChanged:function(n){function t(){i._manipulationEndSignal=null}var i=this;this._manipulationState=n.currentState;i._writeProfilerMark("_onMSManipulationStateChanged state("+n.currentState+"),info");this._manipulationState===p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new a,this._manipulationEndSignal.promise.done(t,t));this._manipulationState===p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){var n,t,r;if(!this._isZombie())if(n=this._viewportScrollPosition,n!==this._lastScrollPosition){this._pendingScroll=i._requestAnimationFrame(this._checkScroller.bind(this));n=Math.max(0,n);t=this._scrollDirection(n);this._lastScrollPosition=n;this._raiseViewLoading(!0);r=this;this._view.onScroll(function(){return{position:r._lastScrollPosition,direction:t}},this._manipulationEndSignal?this._manipulationEndSignal.promise:c.timeout(tt._DEFERRED_SCROLL_END))}else this._pendingScroll=null},_scrollDirection:function(n){var t=n<this._lastScrollPosition?"left":"right";return t===this._lastDirection?t:this._direction},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(n){var t=this;n.forEach(function(n){var r=!1,i;("dir"===n.attributeName?r=!0:"style"===n.attributeName&&(r=t._cachedStyleDir!==n.target.style.direction),r&&(t._cachedStyleDir=n.target.style.direction,t._cachedRTL=null,p[t._rtl()?"addClass":"removeClass"](t._element,tt._rtlListViewClass),t._lastScrollPosition=0,t._viewportScrollPosition=0,t.forceLayout()),"tabIndex"===n.attributeName)&&(i=t._element.tabIndex,i>=0&&(t._view.items.each(function(n,t){t.tabIndex=i}),t._tabIndex=i,t._tabManager.tabIndex=i,t._element.tabIndex=-1))})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=ht._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(n,t){function r(i,r){void 0!==n[i]&&(n[i]=t(n[i],r))}var i;return this._horizontal()?(i=this._getCanvasMargins()[this._rtl()?"right":"left"],r("left",i)):(i=this._getCanvasMargins().top,r("top",i)),r("begin",i),r("end",i),n},_convertFromCanvasCoordinates:function(n){return this._convertCoordinatesByCanvasMargins(n,function(n,t){return n+t})},_convertToCanvasCoordinates:function(n){return this._convertCoordinatesByCanvasMargins(n,function(n,t){return n-t})},_getViewportSize:function(){return(this._viewportWidth===tt._UNINITIALIZED||this._viewportHeight===tt._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,p.getContentWidth(this._element)),this._viewportHeight=Math.max(0,p.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function i(){n._itemsCountPromise=null}var n=this,t;return this._cachedCount!==tt._UNINITIALIZED?c.wrap(this._cachedCount):(this._itemsCountPromise?t=this._itemsCountPromise:(t=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(t){return t===g.CountResult.unknown&&(t=0),n._cachedCount=t,n._selection._updateCount(n._cachedCount),t},function(){return c.cancel}),this._itemsCountPromise.then(i,i)),t)},_isSelected:function(n){return this._selection._isIncluded(n)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(n){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!n);this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_setViewState:function(t){var i,r;if(t!==this._loadingState){i=null;switch(t){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(gt(this),this._scheduledForDispose=!0);this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:i={scrolling:this._scrolling};this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded);this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+t+",info");this._loadingState=t;r=n.document.createEvent("CustomEvent");r.initCustomEvent("loadingstatechanged",!0,!1,i);this._element.dispatchEvent(r)}},_createTemplates:function(){function t(t,i){var r=n.document.createElement("div");return r.className=t,i||r.setAttribute("aria-hidden",!0),r}this._itemBoxTemplate=t(tt._itemBoxClass,!0)},_updateSelection:function(){var t=this._selection.getIndices(),i=this._selection.isEverything(),r={},n,u,f;if(!i)for(n=0,u=t.length;u>n;n++)f=t[n],r[f]=!0;this._view.items.each(function(n,t,u){if(u.itemBox&&!p.hasClass(u.itemBox,tt._swipeClass)){var f=i||!!r[n];it._ItemEventsHandler.renderSelection(u.itemBox,t,f,!0);u.container&&p[f?"addClass":"removeClass"](u.container,tt._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===n.getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(n,t,i){var r=this._progressBar,f=r.style,u;r.parentNode||(this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel(),u=this,this._progressIndicatorDelayTimer=c.timeout(tt._LISTVIEW_PROGRESS_DELAY).then(function(){u._isZombie()||(n.appendChild(r),yt.fadeInElement(r),u._progressIndicatorDelayTimer=null)}));f[this._rtl()?"right":"left"]=t;f.top=i},_hideProgressBar:function(){var n,t;this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);n=this._progressBar;n.parentNode&&!this._fadingProgressBar&&(this._fadingProgressBar=!0,t=this,yt.fadeOutElement(n).then(function(){n.parentNode&&n.parentNode.removeChild(n);t._fadingProgressBar=!1}))},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(n,t,u){if(i.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new r("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",kt.notCompatibleWithSemanticZoom);this._isZoomedOut=n;this._disableEntranceAnimation=!t;this._isCurrentZoomView=t;this._triggerZoom=u},_setCurrentItem:function(n,t){this._rtl()&&(n=this._viewportWidth-n);this._horizontal()?n+=this.scrollPosition:t+=this.scrollPosition;var i=this._view.hitTest(n,t),r={type:i.type?i.type:g.ObjectType.item,index:i.index};r.index>=0&&(this._hasKeyboardFocus?this._changeFocus(r,!0,!1,!0):this._changeFocusPassively(r))},_getCurrentItem:function(){var n=this._selection._getFocused(),t,i;return n.type===g.ObjectType.groupHeader&&(n={type:g.ObjectType.item,index:this._groups.group(n.index).startIndex}),"number"!=typeof n.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),n=this._selection._getFocused()),t=this,i=this._getItemOffsetPosition(n.index).then(function(n){var i=t._canvasStart;return n[t._startProperty]+=i,n}),c.join({item:this._dataSource.itemFromIndex(n.index),position:i})},_animateItemsForPhoneZoom:function(){function o(n,t,i){return function(r){return(t[r]-n)*i}}function r(){for(var t=0,i=n.length;i>t;t++)n[t].style[bt.scriptName]=""}for(var n=[],f=[],e=[],u=Number.MAX_VALUE,t=this,i=this._view.firstIndexDisplayed,h=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);h>i;i++)e.push(this._view.waitForEntityPosition({type:g.ObjectType.item,index:i}).then(function(){var r,e;n.push(t._view.items.containerAt(i));r=0;t.layout._getItemPosition&&(e=t.layout._getItemPosition(i),e.row&&(r=e.row));f.push(r);u=Math.min(r,u)}));return c.join(e).then(function(){return(0===n.length?c.wrap():s.executeTransition(n,{property:bt.cssName,delay:o(u,f,30),duration:100,timing:"ease-in-out",from:t._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:t._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(r,r)}).then(r,r)},_beginZoom:function(){var n,u,t,r,f;return this._zooming=!0,n=null,i.isPhone?this._isZoomedOut&&((this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView)?(u=this,t=function(){u._zoomAnimationPromise=null},this._zoomAnimationPromise=n=this._animateItemsForPhoneZoom().then(t,t)):(this._zoomAnimationPromise=new a,n=this._zoomAnimationPromise.promise)):(r=this._horizontal(),f=-this.scrollPosition,p.addClass(this._viewport,r?tt._zoomingXClass:tt._zoomingYClass),this._canvasStart=f,p.addClass(this._viewport,r?tt._zoomingYClass:tt._zoomingXClass)),n},_positionItem:function(n,t){function h(n){return u._getItemOffsetPosition(n).then(function(r){var f,e=u._horizontal(),k=u._viewport[e?"scrollWidth":"scrollHeight"],v=e?u._viewportWidth:u._viewportHeight,y=e?"headerContainerWidth":"headerContainerHeight",s=u.layout._sizes,p=0,o,w,h,c,l,b,a;return s&&s[y]&&(p=s[y]),o=i.isPhone?p:t[u._startProperty],w=v-(e?r.width:r.height),o=Math.max(0,Math.min(w,o)),f=r[u._startProperty]-o,h=Math.max(0,Math.min(k-v,f)),c=h-f,f=h,l={type:g.ObjectType.item,index:n},(u._hasKeyboardFocus?u._changeFocus(l,!0):u._changeFocusPassively(l),u._raiseViewLoading(!0),i.isPhone)?u._viewportScrollPosition=f:(b=-f,u._canvasStart=b),(u._view.realizePage(f,!0),i.isPhone&&u._isZoomedOut)&&(a=function(){u._zoomAnimationPromise&&u._zoomAnimationPromise.complete&&u._zoomAnimationPromise.complete();u._zoomAnimationPromise=null},u._animateItemsForPhoneZoom().then(a,a)),e?{x:c,y:0}:{x:0,y:c}})}var u=this,f=0,e,o,s;if(n&&(f=this._isZoomedOut?n.groupIndexHint:n.firstItemIndexHint),"number"==typeof f)return h(f);if(o=this._isZoomedOut?n.groupKey:n.firstItemKey,"string"==typeof o&&this._dataSource.itemFromKey)e=this._dataSource.itemFromKey(o,this._isZoomedOut?{groupMemberKey:n.key,groupMemberIndex:n.index}:null);else{if(s=this._isZoomedOut?n.groupDescription:n.firstItemDescription,i.validation&&void 0===s)throw new r("WinJS.UI.ListView.InvalidItem",kt.listViewInvalidItem);e=this._dataSource.itemFromDescription(s)}return e.then(function(n){return h(n.index)})},_endZoom:function(n){if(!this._isZombie()){if(!i.isPhone){var t=this._canvasStart;p.removeClass(this._viewport,tt._zoomingYClass);p.removeClass(this._viewport,tt._zoomingXClass);this._canvasStart=0;this._viewportScrollPosition=-t}this._disableEntranceAnimation=!n;this._isCurrentZoomView=n;this._zooming=!1;this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(n){var t=this;return this._getItemOffset({type:g.ObjectType.item,index:n}).then(function(n){return t._ensureFirstColumnRange(g.ObjectType.item).then(function(){return n=t._correctRangeInFirstColumn(n,g.ObjectType.item),n=t._convertFromCanvasCoordinates(n),t._horizontal()?(n.left=n.begin,n.width=n.end-n.begin,n.height=n.totalHeight):(n.top=n.begin,n.height=n.end-n.begin,n.width=n.totalWidth),n})})},_groupRemoved:function(n){this._groupFocusCache.deleteGroup(n)},_updateFocusCache:function(n){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var t=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(n).then(function(){t._updateFocusCacheItemRequest=null;var i=t._view.items.itemDataAt(n),r=t._groups.groupFromItem(n),u=t._groups.group(r).key;i.itemsManagerRecord.item&&t._groupFocusCache.updateCache(u,i.itemsManagerRecord.item.key,n)})},_changeFocus:function(n,t,i,r,u){var f,e;this._isZombie()||(n.type!==g.ObjectType.groupHeader?(f=this._view.items.itemAt(n.index),!t&&f&&p.hasClass(f,tt._nonSelectableClass)&&(t=!0),this._updateFocusCache(n.index)):(e=this._groups.group(n.index),f=e&&e.header),this._unsetFocusOnItem(!!f),this._hasKeyboardFocus=!0,this._selection._setFocused(n,u),r||this.ensureVisible(n),!t&&this._selectFocused(i)&&this._selection.set(n.index),this._setFocusOnItem(n))},_changeFocusPassively:function(n){var t,i;n.type!==g.ObjectType.groupHeader?(t=this._view.items.itemAt(n.index),this._updateFocusCache(n.index)):(i=this._groups.group(n.index),t=i&&i.header);this._unsetFocusOnItem(!!t);this._selection._setFocused(n);this._setFocusOnItem(n)},_drawFocusRectangle:function(t){var i,r;if(p.hasClass(t,tt._headerClass))p.addClass(t,tt._itemFocusClass);else{if(i=this._view.items.itemBoxFrom(t),i.querySelector("."+tt._itemFocusOutlineClass))return;p.addClass(i,tt._itemFocusClass);r=n.document.createElement("div");r.className=tt._itemFocusOutlineClass;i.appendChild(r)}},_clearFocusRectangle:function(n){var t,i,r;n&&!this._isZombie()&&(t=this._view.items.itemBoxFrom(n),t?(p.removeClass(t,tt._itemFocusClass),i=t.querySelector("."+tt._itemFocusOutlineClass),i&&i.parentNode.removeChild(i)):(r=this._groups.headerFrom(n),r&&p.removeClass(r,tt._itemFocusClass)))},_defaultInvoke:function(n){(this._isZoomedOut||i.isPhone&&this._triggerZoom&&n.type===g.ObjectType.groupHeader)&&(this._changeFocusPassively(n),this._triggerZoom())},_selectionAllowed:function(n){var t=void 0!==n?this.elementFromIndex(n):null,i=!(t&&p.hasClass(t,tt._nonSelectableClass));return i&&this._selectionMode!==g.SelectionMode.none},_multiSelection:function(){return this._selectionMode===g.SelectionMode.multi},_selectOnTap:function(){return this._tap===g.TapBehavior.toggleSelect||this._tap===g.TapBehavior.directSelect},_selectFocused:function(n){return this._tap===g.TapBehavior.directSelect&&this._selectionMode===g.SelectionMode.multi&&!n},_dispose:function(){var n,t;this._disposed||(this._disposed=!0,n=function(n){n&&(n.textContent="")},p._resizeNotifier.unsubscribe(this._element,this._onMSElementResizeBound),this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),n(this._viewport),n(this._canvas),n(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null,t=vt.indexOf(this),t>=0&&vt.splice(t,1))},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&n.document.body.contains(this.element))},_ifZombieDispose:function(){var n=this._isZombie();return n&&!this._disposed&&gt(this),n},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!s.isAnimationEnabled()},_fadeOutViewport:function(){var n=this;return new c(function(t){var f,u,r;if(n._animationsDisabled())return void t();n._fadingViewportOut||(n._waitingEntranceAnimationPromise&&(n._waitingEntranceAnimationPromise.cancel(),n._waitingEntranceAnimationPromise=null),f=n._fireAnimationEvent(pt.contentTransition),n._firedAnimationEvent=!0,u=i._browserStyleEquivalents["overflow-style"],r=u?n._viewport:n._canvas,f.prevented?(n._disableEntranceAnimation=!0,r.style.opacity=1,t()):(n._fadingViewportOut=!0,u&&(r.style[u.scriptName]="none"),yt.fadeOutElement(r).then(function(){n._isZombie()||(n._fadingViewportOut=!1,r.style.opacity=1,t())})))})},_animateListEntrance:function(n){function e(){r._canvas.style.opacity=1;t&&(u.style[t.scriptName]="")}var f={prevented:!1,animationPromise:c.wrap()},r=this,t=i._browserStyleEquivalents["overflow-style"],u=t?this._viewport:this._canvas;return this._disableEntranceAnimation||this._animationsDisabled()?(e(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),c.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:f=this._fireAnimationEvent(pt.entrance),f.prevented||i.isPhone?(e(),c.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,t&&(u.style[t.scriptName]="none"),this._waitingEntranceAnimationPromise=f.animationPromise.then(function(){if(!r._isZombie())return(r._canvas.style.opacity=1,yt.animateEntrance(u,n).then(function(){r._isZombie()||(t&&(u.style[t.scriptName]=""),r._waitingEntranceAnimationPromise=null)}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(t){var i=n.document.createEvent("CustomEvent"),r=c.wrap(),u;return i.initCustomEvent("contentanimating",!0,!0,{type:t}),t===pt.entrance&&(i.detail.setPromise=function(n){r=n}),u=!this._element.dispatchEvent(i),{prevented:u,animationPromise:r}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",kt.listViewViewportAriaLabel);this._ariaStartMarker||(this._ariaStartMarker=n.document.createElement("div"),this._ariaStartMarker.id=at(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild));this._ariaEndMarker||(this._ariaEndMarker=n.document.createElement("div"),this._ariaEndMarker.id=at(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var n,t,i=this,r=this._element.getAttribute("role");this._currentMode().staticMode()?(n="list",t="listitem"):(n="listbox",t="option");(r!==n||this._itemRole!==t)&&(this._element.setAttribute("role",n),this._itemRole=t,this._view.items.each(function(n,t){t.setAttribute("role",i._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var i=this.groupHeaderTapBehavior===g.GroupHeaderTapBehavior.none?"separator":"link",n,r,t;if(this._headerRole!==i)for(this._headerRole=i,n=0,r=this._groups.length();r>n;n++)t=this._groups.group(n).header,t&&t.setAttribute("role",this._headerRole)},_setAriaSelected:function(n,t){var i="true"===n.getAttribute("aria-selected");t!==i&&n.setAttribute("aria-selected",t)},_setupAriaSelectionObserver:function(n){n._mutationObserver||(this._mutationObserver.observe(n,{attributes:!0,attributeFilter:["aria-selected"]}),n._mutationObserver=!0)},_itemPropertyChange:function(n){function s(n){n.forEach(function(n){n.item.setAttribute("aria-selected",!n.selected)})}var e,l,o;if(!this._isZombie()){for(var t=this,v=t._selectionMode===g.SelectionMode.single,i=[],h=[],r=0,y=n.length;y>r;r++){var u=n[r].target,f=t._view.items.itemBoxFrom(u),c="true"===u.getAttribute("aria-selected");f&&c!==p._isSelectionRendered(f)&&(e=t._view.items.index(f),l={index:e,item:u,selected:c},(t._selectionAllowed(e)?i:h).push(l))}i.length>0&&(o=new a,t.selection._synchronize(o).then(function(){var n=t.selection._cloneSelection();return i.forEach(function(t){t.selected?n[v?"set":"add"](t.index):n.remove(t.index)}),t.selection._set(n)}).then(function(n){t._isZombie()||n||s(i);o.complete()}));s(h)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(n,t){var i=this;return this._view.waitForEntityPosition(n).then(function(){var r=n.type===g.ObjectType.groupHeader?i._view._getHeaderContainer(n.index):i._view.getContainer(n.index),e,o,u,f;return r?(i._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info"),i._view._expandedRange?(e=i._view._expandedRange.first.index,o=i._view._expandedRange.last.index):t=!1,n.type===g.ObjectType.item?(t=!!t,t&=i._view._ensureContainerInDOM(n.index)):t=!1,u=i._getItemMargins(n.type),f={left:i._rtl()?ni(r)-u.right:r.offsetLeft-u.left,top:r.offsetTop-u.top,totalWidth:p.getTotalWidth(r),totalHeight:p.getTotalHeight(r),contentWidth:p.getContentWidth(r),contentHeight:p.getContentHeight(r)},t&&i._view._forceItemsBlocksInDOM(e,o+1),i._zooming&&0!==i._canvasStart?f:i._convertToCanvasCoordinates(f)):c.cancel})},_getItemOffset:function(n,t){var i=this;return this._getItemPosition(n,t).then(function(t){var r=i._getItemMargins(n.type),u;return i._horizontal()?(u=i._rtl(),t.begin=t.left-r[u?"left":"right"],t.end=t.left+t.totalWidth+r[u?"right":"left"]):(t.begin=t.top-r.bottom,t.end=t.top+t.totalHeight+r.top),t})},_getItemMargins:function(t){t=t||g.ObjectType.item;var i=this,r=function(t){var u,r=i._canvas.querySelector("."+t),f;return r||(r=n.document.createElement("div"),p.addClass(r,t),i._viewport.appendChild(r),u=!0),f=ht._getMargins(r),u&&i._viewport.removeChild(r),f};return t!==g.ObjectType.groupHeader?this._itemMargins?this._itemMargins:this._itemMargins=r(tt._containerClass):this._headerMargins?this._headerMargins:this._headerMargins=r(tt._headerContainerClass)},_fireAccessibilityAnnotationCompleteEvent:function(t,i,r,u){var e={firstIndex:t,lastIndex:i,firstHeaderIndex:+r||-1,lastHeaderIndex:+u||-1},f=n.document.createEvent("CustomEvent");f.initCustomEvent("accessibilityannotationcomplete",!0,!1,e);this._element.dispatchEvent(f)},_ensureFirstColumnRange:function(n){var t=n===g.ObjectType.item?"_firstItemRange":"_firstHeaderRange",i;return this[t]?c.wrap():(i=this,this._getItemOffset({type:n,index:0},!0).then(function(n){i[t]=n}))},_correctRangeInFirstColumn:function(n,t){var i=t===g.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return i.begin===n.begin&&(n.begin=this._horizontal()?-this._getCanvasMargins()[this._rtl()?"right":"left"]:-this._getCanvasMargins().top),n},_updateContainers:function(t,i,r,u){function ct(){var t=n.document.createElement("div");return t.className=tt._containerClass,t}function lt(t,i,r){var ut,a,p,ft,d,rt,v,st,nt,o,ht,l,c;i+r>g&&(r=g-i);var v,tt=t.itemsContainer,f=tt.itemsBlocks,s=e._view._blockSize,u=f.length?f[f.length-1]:null,h=f.length?(f.length-1)*s+u.items.length:0,y=r-h;if(y>0){if(a=y,u&&u.items.length<s){for(p=Math.min(a,s-u.items.length),ut=u.items.length,ft=ot._stripedContainers(p,h),k.insertAdjacentHTMLUnsafe(u.element,"beforeend",ft),v=u.element.children,o=0;p>o;o++)u.items.push(v[ut+o]);a-=p}h=f.length*s;var b=Math.floor(a/s),it="",ct=h,lt=h+s,at=["<div class='win-itemsblock'>"+ot._stripedContainers(s,ct)+"<\/div>","<div class='win-itemsblock'>"+ot._stripedContainers(s,lt)+"<\/div>"];for(it=ot._repeat(at,b),h+=b*s,d=a%s,d&&(it+="<div class='win-itemsblock'>"+ot._stripedContainers(d,h)+"<\/div>",h+=d,b++),rt=n.document.createElement("div"),k.setInnerHTMLUnsafe(rt,it),v=rt.children,o=0;b>o;o++)l=v[o],st={element:l,items:ot._nodeListToArray(l.children)},f.push(st)}else if(0>y)for(c=y;0>c;c++)nt=u.items.pop(),!e._view._requireFocusRestore&&nt.contains(n.document.activeElement)&&(e._view._requireFocusRestore=n.document.activeElement,e._unsetFocusOnItem()),u.element.removeChild(nt),w.push(nt),u.items.length||(tt.element===u.element.parentNode&&tt.element.removeChild(u.element),f.pop(),u=f[f.length-1]);for(o=0,ht=f.length;ht>o;o++)for(l=f[o],c=0;c<l.items.length;c++)et.push(l.items[c])}function dt(n,t,i){for(var o=u.filter(function(n){return-1===n.oldIndex&&n.newIndex>=t&&n.newIndex<t+i}).sort(function(n,t){return n.newIndex-t.newIndex}),r=n.itemsContainer,f=0,h=o.length;h>f;f++){var c=o[f],e=c.newIndex-t,s=ct(),l=e<r.items.length?r.items[e]:null;r.items.splice(e,0,s);r.element.insertBefore(s,l)}}function at(n,t,i){var u,f,o,s,e,r,h;if(t+i>g&&(i=g-t),u=n.itemsContainer,f=i-u.items.length,f>0)for(o=u.element.children,s=o.length,k.insertAdjacentHTMLUnsafe(u.element,"beforeend",ot._repeat("<div class='win-container win-backdrop'><\/div>",f)),r=0;f>r;r++)e=o[s+r],u.items.push(e);for(r=f;0>r;r++)e=u.items.pop(),u.element.removeChild(e),w.push(e);for(r=0,h=u.items.length;h>r;r++)et.push(u.items[r])}function gt(n,t){var r=e._view._createHeaderContainer(it),i={header:r,itemsContainer:{element:e._view._createItemsContainer(r)}};return i.itemsContainer[e._view._blockSize?"itemsBlocks":"items"]=[],e._view._blockSize?lt(i,t,n.size):at(i,t,n.size),i}function ni(n,t,r,f){for(var p,w,b,o,a,d,l,y,c,h,g=r+f-1,s=0,v=u.length;v>s;s++)o=u[s],o.newIndex>=r&&o.newIndex<=g&&-1!==o.oldIndex&&(c!==+c||o.newIndex<c)&&(c=o.newIndex,h=o.newIndex-o.oldIndex);if(c===+c){for(p=0,s=0,v=u.length;v>s;s++)o=u[s],o.newIndex>=r&&o.newIndex<c&&-1===o.oldIndex&&p++;for(w=0,b=c-h,s=0,v=u.length;v>s;s++)o=u[s],o.oldIndex>=t&&o.oldIndex<b&&-1===o.newIndex&&w++;if(h+=w,h-=p,h-=r-t,a=n.itemsContainer,h>0)for(d=a.element.children,k.insertAdjacentHTMLUnsafe(a.element,"afterBegin",ot._repeat("<div class='win-container win-backdrop'><\/div>",h)),l=0;h>l;l++)y=d[l],a.items.splice(l,0,y);for(l=h;0>l;l++)y=a.items.shift(),a.element.removeChild(y);h&&e._affectedRange.add({start:r,end:r+f},i)}}function ti(n){for(var t=0,i=0,u=e._view.tree.length;u>i;i++){var f=e._view.tree[i],r=f.itemsContainer.items.length,o=t+r-1;if(n>=t&&o>=n)return{group:i,item:n-t};t+=r}}var e=this,g=this._view.containers.length+(r>0?r:0),y=[],ft={},et=[],w=[],vt=[],s=0,b,it,rt,d,a,ut,ht,v,f,c,nt,o;if(!e._view._blockSize)for(f=0,c=this._view.tree.length;c>f;f++)vt.push(s),s+=this._view.tree[f].itemsContainer.items.length;if(!e._view._blockSize)for(var yt=u.filter(function(n){return-1===n.newIndex&&!n._removalHandled}).sort(function(n,t){return t.oldIndex-n.oldIndex}),f=0,c=yt.length;c>f;f++){b=yt[f];b._removalHandled=!0;nt=b._itemBox;b._itemBox=null;var d=ti(b.oldIndex),pt=this._view.tree[d.group],o=pt.itemsContainer.items[d.item];o.parentNode.removeChild(o);p.hasClass(nt,tt._selectedClass)&&p.addClass(o,tt._selectedClass);pt.itemsContainer.items.splice(d.item,1);b.element=o}for(this._view._modifiedGroups=[],it=this._canvasProxy,s=0,f=0,c=t.length;c>f&&(!this._groupsEnabled()||g>s);f++){var h=t[f],st=this._view.keyToGroupIndex[h.key],l=this._view.tree[st];l?(e._view._blockSize?lt(l,s,h.size):(ni(l,vt[st],s,h.size),dt(l,s,h.size),at(l,s,h.size)),y.push(l),ft[h.key]=y.length-1,delete this._view.keyToGroupIndex[h.key],it=l.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:st,newIndex:y.length-1,element:l.header})):(rt=gt(h,s),y.push(rt),ft[h.key]=y.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:y.length-1,element:rt.header}),it=rt.itemsContainer.element);s+=h.size}for(var wt=[],bt=[],kt=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],f=0,c=kt.length;c>f;f++){if(d=this._view.keyToGroupIndex[kt[f]],a=this._view.tree[d],bt.push(a.header),wt.push(a.itemsContainer.element),this._view._blockSize)for(ut=0;ut<a.itemsContainer.itemsBlocks.length;ut++)for(ht=a.itemsContainer.itemsBlocks[ut],v=0;v<ht.items.length;v++)w.push(ht.items[v]);else for(v=0;v<a.itemsContainer.items.length;v++)w.push(a.itemsContainer.items[v]);this._view._modifiedGroups.push({oldIndex:d,newIndex:-1,element:a.header})}for(f=0,c=u.length;c>f;f++)-1!==u[f].newIndex||u[f]._removalHandled||(u[f]._removalHandled=!0,nt=u[f]._itemBox,u[f]._itemBox=null,w.length?(o=w.pop(),p.empty(o)):o=ct(),p.hasClass(nt,tt._selectedClass)&&p.addClass(o,tt._selectedClass),u._containerStripe===tt._containerEvenClass?(p.addClass(o,tt._containerEvenClass),p.removeClass(o,tt._containerOddClass)):(p.addClass(o,tt._containerOddClass),p.removeClass(o,tt._containerEvenClass)),o.appendChild(nt),u[f].element=o);return this._view.tree=y,this._view.keyToGroupIndex=ft,this._view.containers=et,{removedHeaders:bt,removedItemsContainers:wt}},_writeProfilerMark:function(n){var t="WinJS.UI.ListView:"+this._id+":"+n;o(t);f.log&&f.log(t,null,"listviewprofiler")}},{triggerDispose:function(){dt()}});return t.Class.mix(e,u.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","accessibilityannotationcomplete")),t.Class.mix(e,v.DOMEventMixin),e})})});t("WinJS/Controls/FlipView/_Constants",[],function(){"use strict";var n={};return n.datasourceCountChangedEvent="datasourcecountchanged",n.pageVisibilityChangedEvent="pagevisibilitychanged",n.pageSelectedEvent="pageselected",n.pageCompletedEvent="pagecompleted",n});t("WinJS/Controls/FlipView/_PageManager",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_TabContainer","./_Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{_FlipPageManager:i.Namespace._lazy(function(){function w(n){var t=n.winControl;return t&&t._isFlipView?!0:!1}function k(n){n.forEach(function(n){var i=n.target,r,u;i.winControl&&i.tabIndex>=0&&(i.winControl._pageManager._updateTabIndex(i.tabIndex),i.tabIndex=-1);r=i.winControl;r&&r._isFlipView&&(u=!1,"dir"===n.attributeName?u=!0:"style"===n.attributeName&&(u=r._cachedStyleDir!==i.style.direction),u&&(r._cachedStyleDir=i.style.direction,r._pageManager._rtl="rtl"===t.getComputedStyle(r._pageManager._flipperDiv,null).direction,r._pageManager.resized()))})}var n=v._uniqueID,e=r._browserStyleEquivalents,d=50,g=250,nt={get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"}},b=i.Class.define(function(n,i,u,f,e,o,s){this._visibleElements=[];this._flipperDiv=n;this._panningDiv=i;this._panningDivContainer=u;this._buttonVisibilityHandler=s;this._currentPage=null;this._rtl="rtl"===t.getComputedStyle(this._flipperDiv,null).direction;this._itemsManager=f;this._itemSpacing=e;this._tabIndex=v.getTabIndex(n);this._tabIndex<0&&(this._tabIndex=0);i.tabIndex=-1;n.tabIndex=-1;this._tabManager=new y.TabContainer(this._panningDivContainer);this._tabManager.tabIndex=this._tabIndex;this._lastSelectedPage=null;this._lastSelectedElement=null;this._bufferSize=b.flipPageBufferCount;this._cachedSize=-1;this._environmentSupportsTouch=o;var h=this;this._panningDiv.addEventListener("keydown",function(n){h._blockTabs&&n.keyCode===v.Key.tab&&(n.stopImmediatePropagation(),n.preventDefault())},!0);v._addEventListener(this._flipperDiv,"focusin",function(n){n.target===h._flipperDiv&&h._currentPage.element&&v._setActive(h._currentPage.element)},!1);new v._MutationObserver(k).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]});this._cachedStyleDir=this._flipperDiv.style.direction;this._handleManipulationStateChangedBound=this._handleManipulationStateChanged.bind(this);this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(r._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0)},{initialize:function(i,r){var u=null,e,f;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._isHorizontal=r,!this._currentPage){for(this._bufferAriaStartMarker=t.document.createElement("div"),this._bufferAriaStartMarker.id=n(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),u=this._currentPage,this._panningDiv.appendChild(u.pageRoot),e=2*this._bufferSize,f=0;e>f;f++)u=this._createFlipPage(u,this),this._panningDiv.appendChild(u.pageRoot);this._bufferAriaEndMarker=t.document.createElement("div");this._bufferAriaEndMarker.id=n(this._bufferAriaEndMarker);this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev;this._itemsManager&&this.setNewItemsManager(this._itemsManager,i)},dispose:function(){var t=this._currentPage,n=t;do a._disposeElement(n.element),n=n.next;while(n!==t)},setOrientation:function(n){var i,t;if(this._notificationsEndedSignal)return t=this,void this._notificationsEndedSignal.promise.done(function(){t._notificationsEndedSignal=null;t.setOrientation(n)});n!==this._isHorizontal&&(this._isOrientationChanging=!0,this._isHorizontal?v.setScrollPosition(this._panningDivContainer,{scrollLeft:this._getItemStart(this._currentPage),scrollTop:0}):v.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:this._getItemStart(this._currentPage)}),this._isHorizontal=n,i=this._panningDivContainer.style,i.overflowX="hidden",i.overflowY="hidden",t=this,r._requestAnimationFrame(function(){t._isOrientationChanging=!1;t._forEachPage(function(n){var t=n.pageRoot.style;t.left="0px";t.top="0px"});i.overflowX=t._isHorizontal&&t._environmentSupportsTouch?"scroll":"hidden";i.overflowY=t._isHorizontal||!t._environmentSupportsTouch?"hidden":"scroll";t._ensureCentered()}))},resetState:function(n){var i,t,f;if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==n){if(i=this.jumpToIndex(n,!0),!i&&r.validation)throw new u("WinJS.UI.FlipView.BadCurrentPage",nt.badCurrentPage);return i}return a.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0),t=this,f=h.wrap(!0),this._itemsManager&&(f=t._itemsManager._firstItem().then(function(n){return t._currentPage.setElement(n),t._fetchPreviousItems(!0).then(function(){return t._fetchNextItems()}).then(function(){t._setButtonStates()})})),f.then(function(){t._tabManager.childFocus=t._currentPage.element;t._ensureCentered();t._itemSettledOn()})},setNewItemsManager:function(n,t){this._itemsManager=n;var i=this;return this.resetState(t).then(function(){0!==t&&(i._tabManager.childFocus=i._currentPage.element,i._ensureCentered(),i._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var n=0,t=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return t&&(n=this._getElementIndex(t)),n},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._hasFocus&&(this._hadFocus=!0),this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var t=this._getViewportStart(),n=this._lastScrollPos>t?this._getTailOfBuffer():this._getHeadOfBuffer();if(t!==this._lastScrollPos){for(;this._currentPage.element&&this._getItemStart(this._currentPage)>t&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(n.prev),n=n.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=t&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(n.next),n=n.next;this._setButtonStates();this._checkElementVisibility(!1);this._blockTabs=!0;this._lastScrollPos=t;this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element);this._setListEnds();!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(n,t){var r=this;if(this._forEachPage(function(i){if(i.element===t)return(i===r._currentPage||i===r._currentPage.next?r._changeFlipPage(i,t,n):i.setElement(n,!0),!0)}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var u=this._navigationAnimationRecord.elementContainers,i=0,f=u.length;f>i;i++)u[i].element===t&&(r._changeFlipPage(u[i],t,n),u[i].element=n);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth;this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var n=this;this._forEachPage(function(t){t.pageRoot.style.width=n._panningDivContainerOffsetWidth+"px";t.pageRoot.style.height=n._panningDivContainerOffsetHeight+"px"});this._ensureCentered();this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(n,t){var u,f,r,i;return!t&&(!this._itemsManager||!this._currentPage.element||0>n||(u=this._getElementIndex(this._currentPage.element),f=Math.abs(n-u),0===f))?h.wrap(!1):(r=h.wrap(!0),i=this,r=r.then(function(){var r=i._itemsManager._itemPromiseAtIndex(n);return h.join({element:i._itemsManager._itemFromItemPromise(r),item:r}).then(function(n){var r=n.element;return i._resetBuffer(r,t),r?(i._currentPage.setElement(r),i._fetchNextItems().then(function(){return i._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),r=r.then(function(n){return i._setButtonStates(),n}))},startAnimatedNavigation:function(t,i,r){var s,e,h,o,u,f;return(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element)&&(s=this._currentPage,e=t?this._currentPage.next:this._currentPage.prev,e.element)?(this._hasFocus&&v._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=t,this._navigationAnimationRecord.cancelAnimationCallback=i,this._navigationAnimationRecord.completionCallback=r,this._navigationAnimationRecord.oldCurrentPage=s,this._navigationAnimationRecord.newCurrentPage=e,h=s.element,o=e.element,this._navigationAnimationRecord.newCurrentElement=o,s.setElement(null,!0),s.elementUniqueID=n(h),e.setElement(null,!0),e.elementUniqueID=n(o),u=this._createDiscardablePage(h),f=this._createDiscardablePage(o),u.pageRoot.itemIndex=this._getElementIndex(h),f.pageRoot.itemIndex=u.pageRoot.itemIndex+(t?1:-1),u.pageRoot.style.position="absolute",f.pageRoot.style.position="absolute",u.pageRoot.style.zIndex=1,f.pageRoot.style.zIndex=2,this._setItemStart(u,0),this._setItemStart(f,0),this._blockTabs=!0,this._visibleElements.push(o),this._announceElementVisible(o),this._navigationAnimationRecord.elementContainers=[u,f],{outgoing:u,incoming:f}):null},endAnimatedNavigation:function(n,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var r=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,t);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,i);r||this._setViewportStart(this._getItemStart(n?this._currentPage.next:this._currentPage.prev));this._navigationAnimationRecord=null;this._itemSettledOn()}},startAnimatedJump:function(t,i,r){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._hasFocus&&(this._hadFocus=!0),this._currentPage.element){var f=this._currentPage.element,e=this._getElementIndex(f),u=this;return u.jumpToIndex(t).then(function(o){var c,s,h;return o?(u._navigationAnimationRecord={},u._navigationAnimationRecord.cancelAnimationCallback=i,u._navigationAnimationRecord.completionCallback=r,u._navigationAnimationRecord.oldCurrentPage=null,u._forEachPage(function(n){if(n.element===f)return(u._navigationAnimationRecord.oldCurrentPage=n,!0)}),u._navigationAnimationRecord.newCurrentPage=u._currentPage,u._navigationAnimationRecord.newCurrentPage===u._navigationAnimationRecord.oldCurrentPage)?null:(c=u._currentPage.element,u._navigationAnimationRecord.newCurrentElement=c,u._currentPage.setElement(null,!0),u._currentPage.elementUniqueID=n(c),u._navigationAnimationRecord.oldCurrentPage&&u._navigationAnimationRecord.oldCurrentPage.setElement(null,!0),s=u._createDiscardablePage(f),h=u._createDiscardablePage(c),s.pageRoot.itemIndex=e,h.pageRoot.itemIndex=t,s.pageRoot.style.position="absolute",h.pageRoot.style.position="absolute",s.pageRoot.style.zIndex=1,h.pageRoot.style.zIndex=2,u._setItemStart(s,0),u._setItemStart(h,u._itemSize(u._currentPage)),u._visibleElements.push(c),u._announceElementVisible(c),u._navigationAnimationRecord.elementContainers=[s,h],u._blockTabs=!0,{oldPage:s,newPage:h}):null})}return h.wrap(null)},simulateMouseWheelScroll:function(n){var u,i,r;this._environmentSupportsTouch||this._waitingForMouseScroll||(u="number"==typeof n.deltaY?(n.deltaX||n.deltaY)>0:n.wheelDelta<0,i=u?this._currentPage.next:this._currentPage.prev,i.element&&(r={contentX:0,contentY:0,viewportX:0,viewportY:0},r[this._isHorizontal?"contentX":"contentY"]=this._getItemStart(i),v._zoomTo(this._panningDivContainer,r),this._waitingForMouseScroll=!0,t.setTimeout(function(){this._waitingForMouseScroll=!1}.bind(this),v._zoomToDuration+100)))},endAnimatedJump:function(n,t){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info");this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(n.element,!0):n.element.parentNode&&n.element.parentNode.removeChild(n.element);this._navigationAnimationRecord.newCurrentPage.setElement(t.element,!0);this._navigationAnimationRecord=null;this._ensureCentered();this._itemSettledOn()},inserted:function(t,i,r,u){var a;this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var f=this._prevMarker,c=!1,l=!1;if(u&&(this._createAnimationRecord(n(t),null),this._getAnimationRecord(t).inserted=!0),i){do{if(f===this._currentPage&&(c=!0),f.elementUniqueID===n(i)){l=!0;var h,e=f,o=t,s=n(t);if(c)for(;e.next!==this._prevMarker;)h=e.next.element,s=e.next.elementUniqueID,e.next.setElement(o,!0),!o&&s&&(e.next.elementUniqueID=s),o=h,e=e.next;else for(f.elementUniqueID===f.next.elementUniqueID&&f.elementUniqueID&&(e=f.next);e.next!==this._prevMarker;)h=e.element,s=e.elementUniqueID,e.setElement(o,!0),!o&&s&&(e.elementUniqueID=s),o=h,e=e.prev;o&&(a=!1,this._forEachPage(function(t){if(n(o)===t.elementUniqueID)return(a=!0,!0)}),a||this._releaseElementIfNotAnimated(o));break}f=f.next}while(f!==this._prevMarker)}else if(r){for(;f.next!==this._prevMarker&&f.elementUniqueID!==n(r);)f===this._currentPage&&(c=!0),f=f.next;f.elementUniqueID===n(r)&&f!==this._prevMarker?(f.prev.setElement(t),l=!0):this._releaseElementIfNotAnimated(t)}else this._currentPage.setElement(t);this._getAnimationRecord(t).successfullyMoved=l;this._setButtonStates()},changed:function(t,i){var f,u,o,r,e;if(this._writeProfilerMark("WinJS.UI.FlipView:changed,info"),f=this,this._forEachPage(function(r){if(r.elementUniqueID===n(i)){var u=f._animationRecords[r.elementUniqueID];return u.changed=!0,u.oldElement=i,u.newElement=t,r.element=t,r.elementUniqueID=n(t),f._animationRecords[n(t)]=u,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(u=0,o=this._navigationAnimationRecord.elementContainers.length;o>u;u++)r=this._navigationAnimationRecord.elementContainers[u],r&&r.elementUniqueID===n(i)&&(r.element=t,r.elementUniqueID=n(t));e=this._navigationAnimationRecord.newCurrentElement;e&&n(e)===n(i)&&(this._navigationAnimationRecord.newCurrentElement=t)}},moved:function(t,i,r){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var u=this._getAnimationRecord(t);u||(u=this._createAnimationRecord(n(t)));u.moved=!0;this.removed(t,!1,!1);i||r?this.inserted(t,i,r,!1):u.successfullyMoved=!1},removed:function(t,i,r){var c,l,f,e;this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var o=this,u=this._prevMarker,s=h.wrap();if(i)return c=!1,this._forEachPage(function(i){(i.elementUniqueID===n(t)||c)&&(i.setElement(null,!0),c=!0)}),void this._setButtonStates();if(r&&(l=this._getAnimationRecord(t),l&&(l.removed=!0)),this._currentPage.elementUniqueID===n(t))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(u.elementUniqueID===n(t))u.next.element?s=this._itemsManager._previousItem(u.next.element).then(function(n){return n===t&&(n=o._itemsManager._previousItem(n)),n}).then(function(n){u.setElement(n,!0)}):u.setElement(null,!0);else if(u.prev.elementUniqueID===n(t))u.prev.prev&&u.prev.prev.element?s=this._itemsManager._nextItem(u.prev.prev.element).then(function(n){return n===t&&(n=o._itemsManager._nextItem(n)),n}).then(function(n){u.prev.setElement(n,!0)}):u.prev.setElement(null,!0);else{for(f=this._currentPage.prev,e=!1;f!==u&&!e;)f.elementUniqueID===n(t)&&(this._shiftRight(f),e=!0),f=f.prev;for(f=this._currentPage.next;f!==u&&!e;)f.elementUniqueID===n(t)&&(this._shiftLeft(f),e=!0),f=f.next}return s.then(function(){o._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info");this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(n){this._itemSpacing=n;this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM");this._logBuffer();this._notificationsStarted=this._notificationsStarted||0;this._notificationsStarted++;this._notificationsEndedSignal=new c;this._temporaryKeys=[];this._animationRecords={};var n=this;this._forEachPage(function(t){n._createAnimationRecord(t.elementUniqueID,t)});this._animationRecords.currentPage=this._currentPage.element;this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var n=this;this._endNotificationsWork&&this._endNotificationsWork.cancel();this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function c(t){var i=null;return n._forEachPage(function(n){if(n.element===t)return(i=n,!0)}),i}function o(t,i){n._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var u=n._createDiscardablePage(i);n._setItemStart(u,t.originalLocation);r.push(n._deleteFlipPage(u))}function s(t,i){var u,f,e,o;n._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");f=t.originalLocation;t.successfullyMoved?(u=c(i),f=t.newLocation):(u=n._createDiscardablePage(i),e=n._getElementIndex(i),o=n._currentPage.element?n._getElementIndex(n._currentPage.element):0,f+=o>e?-100*n._bufferSize:100*n._bufferSize);u&&(n._setItemStart(u,t.originalLocation),r.push(n._moveFlipPage(u,function(){n._setItemStart(u,f)})))}function e(){return 0===r.length&&r.push(h.wrap()),h.join(r)}var r=[];n._forEachPage(function(t){var i=n._getAnimationRecord(t.element);i&&(i.changed&&(i.oldElement.removedFromChange=!0,r.push(n._changeFlipPage(t,i.oldElement,i.newElement))),i.newLocation=t.location,n._setItemStart(t,i.originalLocation),i.inserted&&(t.elementRoot.style.opacity=0))});var u=n._animationRecords.currentPage,t=n._getAnimationRecord(u),f=n._animationRecords.nextPage,i=n._getAnimationRecord(f);t&&t.changed&&(u=t.newElement);i&&i.changed&&(f=i.newElement);(u!==n._currentPage.element||f!==n._currentPage.next.element)&&(t&&t.removed&&o(t,u),i&&i.removed&&o(i,f));n._blockTabs=!0;e().then(function(){r=[];t&&t.moved&&s(t,u);i&&i.moved&&s(i,f);var o=n._getAnimationRecord(n._currentPage.element),h=n._getAnimationRecord(n._currentPage.next.element);n._forEachPage(function(u){var f=n._getAnimationRecord(u.element);f&&(f.inserted?f!==o&&f!==h&&(u.elementRoot.style.opacity=1):f.originalLocation!==f.newLocation&&(f!==t&&f!==i||f===t&&!t.moved||f===i&&!i.moved)&&r.push(n._moveFlipPage(u,function(){n._setItemStart(u,f.newLocation)})))});e().then(function(){r=[];o&&o.inserted&&r.push(n._insertFlipPage(n._currentPage));h&&h.inserted&&r.push(n._insertFlipPage(n._currentPage.next));e().then(function(){n._checkElementVisibility(!1);n._itemSettledOn();n._setListEnds();n._notificationsStarted--;0===n._notificationsStarted&&n._notificationsEndedSignal.complete();n._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM");n._logBuffer();n._endNotificationsWork=null})})})})},disableTouchFeatures:function(){var n,t;this._environmentSupportsTouch=!1;n=this._panningDivContainer.style;this._panningDivContainer.removeEventListener(r._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0);n.overflowX="hidden";n.overflowY="hidden";t=["scroll-snap-type","scroll-snap-points-x","scroll-snap-points-y","scroll-limit-x-min","scroll-limit-x-max","scroll-limit-y-min","scroll-limit-y-max"];t.forEach(function(t){var i=e[t];i&&(n[i.scriptName]="")})},_hasFocus:{get:function(){return this._flipperDiv.contains(t.document.activeElement)}},_timeoutPageSelection:function(){var n=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel();this._lastTimeoutRequest=h.timeout(g).then(function(){n._itemSettledOn()})},_updateTabIndex:function(n){this._forEachPage(function(t){t.element&&(t.element.tabIndex=n)});this._tabIndex=n;this._tabManager.tabIndex=n},_releaseElementIfNotAnimated:function(n){var t=this._getAnimationRecord(n);t&&(t.changed||t.inserted||t.moved||t.removed)||this._itemsManager.releaseItem(n)},_getAnimationRecord:function(t){return t?this._animationRecords[n(t)]:null},_createAnimationRecord:function(n,t){if(n){var i=this._animationRecords[n]={removed:!1,changed:!1,inserted:!1};return t&&(i.originalLocation=t.location),i}},_writeProfilerMark:function(n){o(n);this._flipperDiv.winControl.constructor._enabledDebug&&f.log&&f.log(n,null,"flipviewdebug")},_getElementIndex:function(n){var t=0;try{t=this._itemsManager.itemObject(n).index}catch(i){}return t},_resetBuffer:function(n,t){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var r=this._currentPage,i=r;do i.element&&i.element===n||t?i.setElement(null,!0):i.setElement(null),i=i.next;while(i!==r)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(n){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var t=this._createFlipPage(n,this);return this._panningDiv.appendChild(t.pageRoot),t},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var n=h.wrap(this._currentPage),t=this,i=0;i<this._bufferSize;i++)n=n.then(function(n){return n.next===t._prevMarker&&t._insertNewFlipPage(n),n.element?t._itemsManager._nextItem(n.element).then(function(t){return n.next.setElement(t),n.next}):(n.next.setElement(null),n.next)});return n},_fetchOneNext:function(n){var t,i;return(this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info"),t=n.prev.element,this._prevMarker===n&&(this._prevMarker=this._prevMarker.next),!t)?void n.setElement(null):(i=this,this._itemsManager._nextItem(t).then(function(t){n.setElement(t);i._movePageAhead(n.prev,n)}))},_fetchPreviousItems:function(n){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var i=this,t=h.wrap(this._currentPage),r=0;r<this._bufferSize;r++)t=t.then(function(n){return n.element?i._itemsManager._previousItem(n.element).then(function(t){return n.prev.setElement(t),n.prev}):(n.prev.setElement(null),n.prev)});return t.then(function(t){n&&(i._prevMarker=t)})},_fetchOnePrevious:function(n){var t,i;return(this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info"),t=n.next.element,this._prevMarker===n.next&&(this._prevMarker=this._prevMarker.prev),!t)?(n.setElement(null),h.wrap()):(i=this,this._itemsManager._previousItem(t).then(function(t){n.setElement(t);i._movePageBehind(n.next,n)}))},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton();this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(n){var t,i;for(this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._setItemStart(this._currentPage,d*this._viewportSize()),t=this._currentPage;t!==this._prevMarker;)this._movePageBehind(t,t.prev),t=t.prev;for(t=this._currentPage;t.next!==this._prevMarker;)this._movePageAhead(t,t.next),t=t.next;i=!1;this._lastScrollPos&&!n&&(this._setListEnds(),i=!0);this._lastScrollPos=this._getItemStart(this._currentPage);this._setViewportStart(this._lastScrollPos);this._checkElementVisibility(!0);this._setupSnapPoints();i||this._setListEnds()},_ensureBufferConsistency:function(){var t=this,i=this._currentPage.element,f;if(!i)return h.wrap();var n=!1,r={},u={};return this._forEachPage(function(t){if(t&&t.elementUniqueID){if(r[t.elementUniqueID])return n=!0,!0;if(r[t.elementUniqueID]=!0,t.location>0){if(u[t.location])return n=!0,!0;u[t.location]=!0}}}),f=Object.keys(this._animationRecords),f.forEach(function(i){var r=t._animationRecords[i];r&&(r.changed||r.inserted||r.moved||r.removed)&&(n=!0)}),n?(this._resetBuffer(null,!0),this._currentPage.setElement(i),this._fetchNextItems().then(function(){return t._fetchPreviousItems(!0)}).then(function(){t._ensureCentered()})):h.wrap()},_shiftLeft:function(n){var t,i,r;for(this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info"),t=n,i=null;t!==this._prevMarker&&t.next!==this._prevMarker;)i=t.next.element,!i&&t.next.elementUniqueID&&(t.elementUniqueID=t.next.elementUniqueID),t.next.setElement(null,!0),t.setElement(i,!0),t=t.next;if(t!==this._prevMarker&&t.prev.element)return r=this,this._itemsManager._nextItem(t.prev.element).then(function(n){t.setElement(n);r._createAnimationRecord(t.elementUniqueID,t)})},_logBuffer:function(){if(this._flipperDiv.winControl.constructor._enabledDebug){f.log&&f.log(this._currentPage.next.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"\t"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug");f.log&&f.log(this._currentPage.next.next.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"\t"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug");f.log&&f.log("> "+this._currentPage.elementUniqueID+"\t@:"+this._currentPage.location+(this._currentPage.element?"\t"+this._currentPage.element.textContent:""),null,"flipviewdebug");f.log&&f.log(this._currentPage.next.elementUniqueID+"\t@:"+this._currentPage.next.location+(this._currentPage.next.element?"\t"+this._currentPage.next.element.textContent:""),null,"flipviewdebug");f.log&&f.log(this._currentPage.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"\t"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var t=Object.keys(this._itemsManager._elementMap),n=[];this._forEachPage(function(t){t&&t.elementUniqueID&&n.push(t.elementUniqueID)});f.log&&f.log("itemsmanager  = ["+t.join(" ")+"] flipview ["+n.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(n){var t,i,r;for(this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info"),t=n,i=null;t!==this._prevMarker;)i=t.prev.element,!i&&t.prev.elementUniqueID&&(t.elementUniqueID=t.prev.elementUniqueID),t.prev.setElement(null,!0),t.setElement(i,!0),t=t.prev;if(t.next.element)return r=this,this._itemsManager._previousItem(t.next.element).then(function(n){t.setElement(n);r._createAnimationRecord(t.elementUniqueID,t)})},_checkElementVisibility:function(n){var t,u,i,r;if(n){for(i=this._currentPage.element,t=0,u=this._visibleElements.length;u>t;t++)this._visibleElements[t]!==i&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[];i&&(this._visibleElements.push(i),this._announceElementVisible(i))}else{for(t=0,u=this._visibleElements.length;u>t;t++)(!this._visibleElements[t].parentNode||this._visibleElements[t].removedFromChange)&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[];r=this;this._forEachPage(function(n){var t=n.element;t&&(r._itemInView(n)?(r._visibleElements.push(t),r._announceElementVisible(t)):r._announceElementInvisible(t))})}},_announceElementVisible:function(n){if(n&&!n.visible){n.visible=!0;var i=t.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info");i.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0});n.dispatchEvent(i)}},_announceElementInvisible:function(n){var i,r;n&&n.visible&&(n.visible=!1,i=!1,n.parentNode||(i=!0,this._panningDivContainer.appendChild(n)),r=t.document.createEvent("CustomEvent"),this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),r.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),n.dispatchEvent(r),i&&this._panningDivContainer.removeChild(n))},_createDiscardablePage:function(t){var r=this._createPageContainer(),i={pageRoot:r.root,elementRoot:r.elementContainer,discardable:!0,element:t,elementUniqueID:n(t),discard:function(){i.pageRoot.parentNode&&i.pageRoot.parentNode.removeChild(i.pageRoot);i.element.parentNode&&i.element.parentNode.removeChild(i.element)}};return i.pageRoot.style.top="0px",i.elementRoot.appendChild(t),this._panningDiv.appendChild(i.pageRoot),i},_createPageContainer:function(){var u=this._panningDivContainerOffsetWidth,f=this._panningDivContainerOffsetHeight,i=t.document.createElement("div"),n=i.style,r=t.document.createElement("div");return r.className="win-item",n.position="absolute",n.overflow="hidden",n.width=u+"px",n.height=f+"px",i.appendChild(r),{root:i,elementContainer:r}},_createFlipPage:function(t,i){var r={},u;return r.element=null,r.elementUniqueID=null,t?(r.prev=t,r.next=t.next,r.next.prev=r,t.next=r):(r.next=r,r.prev=r),u=this._createPageContainer(),r.elementRoot=u.elementContainer,r.elementRoot.style.msOverflowStyle="auto",r.pageRoot=u.root,r.setElement=function(t,u){if(void 0===t&&(t=null),t===r.element)return void(t||(r.elementUniqueID=null));if(r.element&&(u||(i._itemsManager.releaseItem(r.element),a._disposeElement(r.element))),r.element=t,r.elementUniqueID=t?n(t):null,v.empty(r.elementRoot),r.element){if(r===i._currentPage&&(i._tabManager.childFocus=t),!w(r.element)){r.element.tabIndex=i._tabIndex;r.element.setAttribute("role","option");r.element.setAttribute("aria-selected",!1);r.element.id||(r.element.id=n(r.element));var f=function(n,t,i){n.setAttribute(i,t.id)},e=!r.next.element||r===i._prevMarker.prev;e&&(f(r.element,i._bufferAriaEndMarker,"aria-flowto"),f(i._bufferAriaEndMarker,r.element,"x-ms-aria-flowfrom"));r!==i._prevMarker&&r.prev.element&&(f(r.prev.element,r.element,"aria-flowto"),f(r.element,r.prev.element,"x-ms-aria-flowfrom"));r.next!==i._prevMarker&&r.next.element&&(f(r.element,r.next.element,"aria-flowto"),f(r.next.element,r.element,"x-ms-aria-flowfrom"));r.prev.element||f(r.element,i._bufferAriaStartMarker,"x-ms-aria-flowfrom")}r.elementRoot.appendChild(r.element)}},r},_itemInView:function(n){return this._itemEnd(n)>this._getViewportStart()&&this._getItemStart(n)<this._viewportEnd()},_getViewportStart:function(){if(this._panningDivContainer.parentNode)return this._isHorizontal?v.getScrollPosition(this._panningDivContainer).scrollLeft:v.getScrollPosition(this._panningDivContainer).scrollTop},_setViewportStart:function(n){this._panningDivContainer.parentNode&&(this._isHorizontal?v.setScrollPosition(this._panningDivContainer,{scrollLeft:n}):v.setScrollPosition(this._panningDivContainer,{scrollTop:n}))},_viewportEnd:function(){var n=this._panningDivContainer;return this._isHorizontal?this._rtl?this._getViewportStart()+this._panningDivContainerOffsetWidth:v.getScrollPosition(n).scrollLeft+this._panningDivContainerOffsetWidth:n.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_getItemStart:function(n){return n.location},_setItemStart:function(n,t){this._isHorizontal?n.pageRoot.style.left=(this._rtl?-t:t)+"px":n.pageRoot.style.top=t+"px";n.location=t},_itemEnd:function(n){return(this._isHorizontal?n.location+this._panningDivContainerOffsetWidth:n.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(n,t){var i=this._itemSize(n)+this._itemSpacing;this._setItemStart(t,this._getItemStart(n)+i)},_movePageBehind:function(n,t){var i=this._itemSize(n)+this._itemSpacing;this._setItemStart(t,this._getItemStart(n)-i)},_setupSnapPoints:function(){var n;if(this._environmentSupportsTouch){n=this._panningDivContainer.style;n[e["scroll-snap-type"].scriptName]="mandatory";var t=this._viewportSize(),u=t+this._itemSpacing,i="scroll-snap-points",r=0,f=this._getItemStart(this._currentPage);r=f%(t+this._itemSpacing);n[e[this._isHorizontal?i+"-x":i+"-y"].scriptName]="snapInterval("+r+"px, "+u+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var i=this._panningDivContainer.style,r=0,u=0,n=this._getTailOfBuffer(),t=this._getHeadOfBuffer(),f=e["scroll-limit-"+(this._isHorizontal?"x-min":"y-min")].scriptName,o=e["scroll-limit-"+(this._isHorizontal?"x-max":"y-max")].scriptName;!t.element&&(t=t.prev,t!==this._prevMarker.prev););for(;!n.element&&(n=n.next,n!==this._prevMarker););u=this._getItemStart(t);r=this._getItemStart(n);i[f]=r+"px";i[o]=u+"px"}},_viewportOnItemStart:function(){return this._getItemStart(this._currentPage)===this._getViewportStart()},_restoreAnimatedElement:function(t,i){var r=!0;return t.elementUniqueID!==n(i.element)||t.element?this._forEachPage(function(n){n.elementUniqueID!==i.elementUniqueID||n.element||(n.setElement(i.element,!0),r=!1)}):(t.setElement(i.element,!0),r=!1),r},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var n=this;r._setImmediate(function(){n._viewportOnItemStart()&&(n._blockTabs=!1,n._currentPage.element&&n._lastSelectedElement!==n._currentPage.element&&(n._lastSelectedPage&&n._lastSelectedPage.element&&!w(n._lastSelectedPage.element)&&n._lastSelectedPage.element.setAttribute("aria-selected",!1),n._lastSelectedPage=n._currentPage,n._lastSelectedElement=n._currentPage.element,w(n._currentPage.element)||n._currentPage.element.setAttribute("aria-selected",!0),l.schedule(function(){var i,r,u;n._currentPage.element&&((n._hasFocus||n._hadFocus)&&(n._hadFocus=!1,v._setActive(n._currentPage.element),n._tabManager.childFocus=n._currentPage.element),i=t.document.createEvent("CustomEvent"),i.initCustomEvent(p.pageSelectedEvent,!0,!1,{source:n._flipperDiv}),n._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),n._currentPage.element.dispatchEvent(i),r=n._currentPage.element,r&&(u=n._itemsManager._recordFromElement(r,!0),u&&u.renderComplete.then(function(){r===n._currentPage.element&&(n._currentPage.element.setAttribute("aria-setsize",n._cachedSize),n._currentPage.element.setAttribute("aria-posinset",n.currentIndex()+1),n._bufferAriaStartMarker.setAttribute("aria-flowto",n._currentPage.element.id),i=t.document.createEvent("CustomEvent"),i.initCustomEvent(p.pageCompletedEvent,!0,!1,{source:n._flipperDiv}),n._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),n._currentPage.element.dispatchEvent(i))})))},l.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent")))})},_forEachPage:function(n){var t=this._prevMarker;do{if(n(t))break;t=t.next}while(t!==this._prevMarker)},_changeFlipPage:function(n,t,i){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info");n.element=null;n.setElement?n.setElement(i,!0):(t.parentNode.removeChild(t),n.elementRoot.appendChild(i));var r=t.style;return r.position="absolute",r.left="0px",r.top="0px",r.opacity=1,n.pageRoot.appendChild(t),t.style.left=Math.max(0,(n.pageRoot.offsetWidth-t.offsetWidth)/2)+"px",t.style.top=Math.max(0,(n.pageRoot.offsetHeight-t.offsetHeight)/2)+"px",s.fadeOut(t).then(function(){t.parentNode&&t.parentNode.removeChild(t)})},_deleteFlipPage:function(n){o("WinJS.UI.FlipView:_deleteFlipPage,info");n.elementRoot.style.opacity=0;var t=s.createDeleteFromListAnimation([n.elementRoot]),i=this;return t.execute().then(function(){n.discardable&&(n.discard(),i._itemsManager.releaseItem(n.element))})},_insertFlipPage:function(n){o("WinJS.UI.FlipView:_insertFlipPage,info");n.elementRoot.style.opacity=1;var t=s.createAddToListAnimation([n.elementRoot]);return t.execute().then(function(){n.discardable&&n.discard()})},_moveFlipPage:function(n,t){var r,i;return o("WinJS.UI.FlipView:_moveFlipPage,info"),r=s.createRepositionAnimation(n.pageRoot),t(),i=this,r.execute().then(function(){if(n.discardable){n.discard();var t=i._getAnimationRecord(n.element);t&&!t.successfullyMoved&&i._itemsManager.releaseItem(n.element)}})},_handleManipulationStateChanged:function(n){this._manipulationState=n.currentState;0===n.currentState&&n.target===this._panningDivContainer&&(this._itemSettledOn(),this._ensureCentered())}},{supportedForProcessing:!1});return b.flipPageBufferCount=2,b})})});t("WinJS/Controls/FlipView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_UI","./FlipView/_Constants","./FlipView/_PageManager","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";t.Namespace.define("WinJS.UI",{FlipView:t.Namespace._lazy(function(){function ot(t){var i=t[0].target.winControl;i&&i instanceof p&&t.some(function(n){return"dir"===n.attributeName?!0:"style"===n.attributeName?i._cachedStyleDir!==n.target.style.direction:!1})&&(i._cachedStyleDir=i._flipviewDiv.style.direction,i._rtl="rtl"===n.getComputedStyle(i._flipviewDiv,null).direction,i._setupOrientation())}function nt(n){var t=n.target&&n.target.winControl;t&&t instanceof p&&(e("WinJS.UI.FlipView:resize,StartTM"),t._resize())}var g="win-navbutton",st="win-flipview",tt="win-navleft",it="win-navright",ht="win-navtop",ct="win-navbottom",lt="Previous",at="Next",vt=3e3,yt=500,rt="&#57570;",ut="&#57571;",pt="&#57572;",wt="&#57573;",ft=40,et={get badAxis(){return"Invalid argument: orientation must be a string, either 'horizontal' or 'vertical'"},get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"},get noitemsManagerForCount(){return"Invalid operation: can't get count if no dataSource has been set"},get badItemSpacingAmount(){return"Invalid argument: itemSpacing must be a number greater than or equal to zero"},get navigationDuringStateChange(){return"Error: After changing itemDataSource or itemTemplate, any navigation in the FlipView control should be delayed until the pageselected event is fired."},get panningContainerAriaLabel(){return f._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},p=t.Class.define(function(t,i){var c;e("WinJS.UI.FlipView:constructor,StartTM");this._disposed=!1;t=t||n.document.createElement("div");var o=!0,f=null,s=w._trivialHtmlRenderer,r=0,u=0;if(i){if(i.orientation&&"string"==typeof i.orientation)switch(i.orientation.toLowerCase()){case"horizontal":o=!0;break;case"vertical":o=!1}i.currentPage&&(r=i.currentPage>>0,r=0>r?0:r);i.itemDataSource&&(f=i.itemDataSource);i.itemTemplate&&(s=this._getItemRenderer(i.itemTemplate));i.itemSpacing&&(u=i.itemSpacing>>0,u=0>u?0:u)}f||(c=new h.List,f=c.dataSource);y.empty(t);this._flipviewDiv=t;t.winControl=this;a._setOptions(this,i,!0);this._initializeFlipView(t,o,f,s,r,u);y.addClass(t,"win-disposable");this._avoidTrappingTime=0;this._windowWheelHandlerBound=this._windowWheelHandler.bind(this);y._globalListener.addEventListener(t,"wheel",this._windowWheelHandlerBound);y._globalListener.addEventListener(t,"mousewheel",this._windowWheelHandlerBound);e("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){e("WinJS.UI.FlipView:dispose,StopTM");this._disposed||(y._globalListener.removeEventListener(this._flipviewDiv,"wheel",this._windowWheelHandlerBound),y._globalListener.removeEventListener(this._flipviewDiv,"mousewheel",this._windowWheelHandlerBound),y._resizeNotifier.unsubscribe(this._flipviewDiv,nt),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){e("WinJS.UI.FlipView:next,info");var n=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,n)},previous:function(){e("WinJS.UI.FlipView:prev,info");var n=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,n)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(n){var t,i;if(e("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal)return t=this,void this._pageManager._notificationsEndedSignal.promise.done(function(){t._pageManager._notificationsEndedSignal=null;t.currentPage=n});if(!this._animating||this._cancelAnimation())if(n>>=0,n=0>n?0:n,this._refreshTimer)this._indexAfterRefresh=n;else{if(this._pageManager._cachedSize>0?n=Math.min(this._pageManager._cachedSize-1,n):0===this._pageManager._cachedSize&&(n=0),t=this,this._jumpingToIndex===n)return;i=function(){t._jumpingToIndex=null};this._jumpingToIndex=n;var u=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),f=this._jumpAnimation?null:this._cancelDefaultAnimation,r=function(){t._completeJump()};this._pageManager.startAnimatedJump(n,f,r).then(function(n){if(n){t._animationsStarted();var f=n.oldPage.pageRoot,o=n.newPage.pageRoot;t._contentDiv.appendChild(f);t._contentDiv.appendChild(o);t._completeJumpPending=!0;u(f,o).then(function(){t._completeJumpPending&&(r(),e("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(i,i)}else i()},i)}}},orientation:{get:function(){return this._axisAsString()},set:function(n){e("WinJS.UI.FlipView:set_orientation,info");var t="horizontal"===n;t!==this._isHorizontal&&(this._isHorizontal=t,this._setupOrientation(),this._pageManager.setOrientation(this._isHorizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(n){e("WinJS.UI.FlipView:set_itemDataSource,info");this._dataSourceAfterRefresh=n||(new h.List).dataSource;this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(n){e("WinJS.UI.FlipView:set_itemTemplate,info");this._itemRendererAfterRefresh=this._getItemRenderer(n);this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(n){e("WinJS.UI.FlipView:set_itemSpacing,info");n>>=0;n=0>n?0:n;this._pageManager.setItemSpacing(n)}},count:function(){e("WinJS.UI.FlipView:count,info");var n=this;return new c(function(t,i){n._itemsManager?n._pageManager._cachedSize===b.CountResult.unknown||n._pageManager._cachedSize>=0?t(n._pageManager._cachedSize):n._dataSource.getCount().then(function(i){n._pageManager._cachedSize=i;t(i)}):i(p.noitemsManagerForCount)})},setCustomAnimations:function(n){e("WinJS.UI.FlipView:setCustomAnimations,info");void 0!==n.next&&(this._nextAnimation=n.next);void 0!==n.previous&&(this._prevAnimation=n.previous);void 0!==n.jump&&(this._jumpAnimation=n.jump)},forceLayout:function(){e("WinJS.UI.FlipView:forceLayout,info");this._pageManager.resized()},_initializeFlipView:function(t,r,u,f,e,o){function v(n){n.setAttribute("aria-hidden",!0);n.style.visibility="hidden";n.style.opacity=0;n.tabIndex=-1;n.style.zIndex=1e3}function p(n){if(n.pointerType!==c){if(s._touchInteraction=!1,n.screenX===s._lastMouseX&&n.screenY===s._lastMouseY)return;s._lastMouseX=n.screenX;s._lastMouseY=n.screenY;s._mouseInViewport=!0;s._fadeInButton("prev");s._fadeInButton("next");s._fadeOutButtons()}}function k(n){n.pointerType===c?(s._mouseInViewport=!1,s._touchInteraction=!0,s._fadeOutButtons(!0)):(s._touchInteraction=!1,s._isInteractive(n.target)||0!=(4&n.buttons)&&(n.stopPropagation(),n.preventDefault()))}function g(n){n.pointerType!==c&&(s._touchInteraction=!1)}var s=this,tt=!1,rt,c,a;this._flipviewDiv=t;y.addClass(this._flipviewDiv,st);this._contentDiv=n.document.createElement("div");this._panningDivContainer=n.document.createElement("div");this._panningDivContainer.className="win-surface";this._panningDiv=n.document.createElement("div");this._prevButton=n.document.createElement("button");this._nextButton=n.document.createElement("button");this._isHorizontal=r;this._dataSource=u;this._itemRenderer=f;this._itemsManager=null;this._pageManager=null;for(var it=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],h=!0,ut=i._browserStyleEquivalents,l=0,ft=it.length;ft>l;l++)h=h&&!!ut[it[l]];h=h&&!!i._browserEventEquivalents.manipulationStateChanged;this._environmentSupportsTouch=h;h&&y._detectSnapPointsSupport().then(function(n){n||(s._environmentSupportsTouch=!1,tt&&(s._fadeInButton("prev"),s._fadeInButton("next"),y._removeEventListener(s._contentDiv,"pointerdown",k,!1),y._removeEventListener(s._contentDiv,"pointermove",p,!1),y._removeEventListener(s._contentDiv,"pointerup",g,!1),s._panningDivContainer.style[s._isHorizontal?"overflowX":"overflowY"]="hidden",s._pageManager.disableTouchFeatures()))});rt=this._flipviewDiv.getAttribute("aria-label");rt||this._flipviewDiv.setAttribute("aria-label","");this._flipviewDiv.setAttribute("role","listbox");this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden");this._contentDiv.style.position="relative";this._contentDiv.style.zIndex=0;this._contentDiv.style.width="100%";this._contentDiv.style.height="100%";this._panningDiv.style.position="relative";this._panningDivContainer.style.position="relative";this._panningDivContainer.style.width="100%";this._panningDivContainer.style.height="100%";this._panningDivContainer.setAttribute("role","group");this._panningDivContainer.setAttribute("aria-label",et.panningContainerAriaLabel);this._contentDiv.appendChild(this._panningDivContainer);this._flipviewDiv.appendChild(this._contentDiv);this._panningDiv.style.width="100%";this._panningDiv.style.height="100%";this._setupOrientation();v(this._prevButton);v(this._nextButton);this._prevButton.setAttribute("aria-label",lt);this._nextButton.setAttribute("aria-label",at);this._prevButton.setAttribute("type","button");this._nextButton.setAttribute("type","button");this._panningDivContainer.appendChild(this._panningDiv);this._contentDiv.appendChild(this._prevButton);this._contentDiv.appendChild(this._nextButton);this._itemsManagerCallback={inserted:function(n,t,i){s._itemsManager._itemFromPromise(n).then(function(n){var r=s._itemsManager._elementFromHandle(t),u=s._itemsManager._elementFromHandle(i);s._pageManager.inserted(n,r,u,!0)})},countChanged:function(n,t){s._pageManager._cachedSize=n;t!==b.CountResult.unknown&&s._fireDatasourceCountChangedEvent()},changed:function(n,t){s._pageManager.changed(n,t)},moved:function(n,t,i,r){var u=function(n){s._pageManager.moved(n,t,i)};n?u(n):s._itemsManager._itemFromPromise(r).then(u)},removed:function(n,t){n&&s._pageManager.removed(n,t,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){s._cancelAnimation();s._pageManager.notificationsStarted()},endNotifications:function(){s._pageManager.notificationsEnded()},itemAvailable:function(n,t){s._pageManager.itemRetrieved(n,t)},reload:function(){s._pageManager.reload()}};this._dataSource&&(this._itemsManager=w._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}));this._pageManager=new d._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,o,this._environmentSupportsTouch,{hidePreviousButton:function(){s._hasPrevContent=!1;s._fadeOutButton("prev");s._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){s._hasPrevContent=!0;s._fadeInButton("prev");s._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){s._hasNextContent=!1;s._fadeOutButton("next");s._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){s._hasNextContent=!0;s._fadeInButton("next");s._nextButton.setAttribute("aria-hidden",!1)}});this._pageManager.initialize(e,this._isHorizontal);this._dataSource.getCount().then(function(n){s._pageManager._cachedSize=n});this._prevButton.addEventListener("click",function(){s.previous()},!1);this._nextButton.addEventListener("click",function(){s.next()},!1);new y._MutationObserver(ot).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]});this._cachedStyleDir=this._flipviewDiv.style.direction;this._flipviewDiv.addEventListener("mselementresize",nt);y._resizeNotifier.subscribe(this._flipviewDiv,nt);this._contentDiv.addEventListener("mouseleave",function(){s._mouseInViewport=!1},!1);c=y._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._environmentSupportsTouch&&(y._addEventListener(this._contentDiv,"pointerdown",k,!1),y._addEventListener(this._contentDiv,"pointermove",p,!1),y._addEventListener(this._contentDiv,"pointerup",g,!1));this._panningDivContainer.addEventListener("scroll",function(){s._scrollPosChanged()},!1);this._panningDiv.addEventListener("blur",function(){s._touchInteraction||s._fadeOutButtons()},!0);a=n.document.body.contains(this._flipviewDiv);y._addInsertedNotifier(this._flipviewDiv);this._flipviewDiv.addEventListener("WinJSNodeInserted",function(){return a?void(a=!1):void s._pageManager.resized()},!1);this._flipviewDiv.addEventListener("keydown",function(n){var r=!0,t,i;if(!s._isInteractive(n.target)){if(t=y.Key,i=!1,s._isHorizontal)switch(n.keyCode){case t.leftArrow:s._rtl?s.next():s.previous();i=!0;break;case t.pageUp:s.previous();i=!0;break;case t.rightArrow:s._rtl?s.previous():s.next();i=!0;break;case t.pageDown:s.next();i=!0;break;case t.upArrow:case t.downArrow:i=!0;r=!1}else switch(n.keyCode){case t.upArrow:case t.pageUp:s.previous();i=!0;break;case t.downArrow:case t.pageDown:s.next();i=!0;break;case t.space:i=!0}switch(n.keyCode){case t.home:s.currentPage=0;i=!0;break;case t.end:s._pageManager._cachedSize>0&&(s.currentPage=s._pageManager._cachedSize-1);i=!0}if(i)return n.preventDefault(),r&&n.stopPropagation(),!0}},!1);tt=!0},_windowWheelHandler:function(n){n=n.detail.originalEvent;var r=n.target&&(this._flipviewDiv.contains(n.target)||this._flipviewDiv===n.target),t=this,u=i._now(),f=this._avoidTrappingTime>u;(!r||f)&&(this._avoidTrappingTime=u+yt);r&&f?(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",i._yieldForDomModification(function(){t._pageManager._ensureCentered();t._isHorizontal?(t._panningDivContainer.style.overflowX=t._environmentSupportsTouch?"scroll":"hidden",t._panningDivContainer.style.overflowY="hidden"):(t._panningDivContainer.style.overflowY=t._environmentSupportsTouch?"scroll":"hidden",t._panningDivContainer.style.overflowX="hidden")})):r&&this._pageManager.simulateMouseWheelScroll(n)},_isInteractive:function(n){if(n.parentNode)for(var i=n.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),t=0,r=i.length;r>t;t++)if(i[t]===n)return!0;return!1},_refreshHandler:function(){var n=this._dataSourceAfterRefresh||this._dataSource,t=this._itemRendererAfterRefresh||this._itemRenderer,i=this._indexAfterRefresh||0;this._setDatasource(n,t,i);this._dataSourceAfterRefresh=null;this._itemRendererAfterRefresh=null;this._indexAfterRefresh=0;this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var n=this;this._refreshTimer=!0;l.schedule(function(){n._refreshTimer&&!n._disposed&&n._refreshHandler()},l.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(t){var r=null,u,i;return"function"==typeof t?(u=new c(function(){}),i=t(u),r=i.element?"object"==typeof i.element&&"function"==typeof i.element.then?function(i){var r=n.document.createElement("div");return r.className="win-template",v.markDisposable(r),{element:r,renderComplete:t(i).element.then(function(n){r.appendChild(n)})}}:t:function(i){var r=n.document.createElement("div");return r.className="win-template",v.markDisposable(r),{element:r,renderComplete:i.then(function(){return c.as(t(i)).then(function(n){r.appendChild(n)})})}}):"object"==typeof t&&(r=t.renderItem),r},_navigate:function(n,t){var e,o;if(i.validation&&this._refreshTimer)throw new r("WinJS.UI.FlipView.NavigationDuringStateChange",et.navigationDuringStateChange);if(this._animating||(this._animatingForward=n),this._goForward=n,this._animating&&!this._cancelAnimation())return!1;var u=this,s=n?this._nextAnimation:this._prevAnimation,c=s?s:this._defaultAnimation.bind(this),h=function(n){u._completeNavigation(n)},f=this._pageManager.startAnimatedNavigation(n,t,h);return f?(this._animationsStarted(),e=f.outgoing.pageRoot,o=f.incoming.pageRoot,this._contentDiv.appendChild(e),this._contentDiv.appendChild(o),this._completeNavigationPending=!0,c(e,o).then(function(){u._completeNavigationPending&&h(u._goForward)}).done(),!0):!1},_cancelDefaultAnimation:function(n,t){n.style.opacity=0;t.style.animationName="";t.style.opacity=1},_cancelAnimation:function(){var n;if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback&&(n=this._pageManager._navigationAnimationRecord.cancelAnimationCallback,n&&(n=n.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers)){var t=this._pageManager._navigationAnimationRecord.elementContainers[0],i=this._pageManager._navigationAnimationRecord.elementContainers[1],r=t.pageRoot,u=i.pageRoot;return n&&n(r,u),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}return!1},_completeNavigation:function(n){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var r=this._pageManager._navigationAnimationRecord.elementContainers[0],u=this._pageManager._navigationAnimationRecord.elementContainers[1],t=r.pageRoot,i=u.pageRoot;t.parentNode&&t.parentNode.removeChild(t);i.parentNode&&i.parentNode.removeChild(i);this._pageManager.endAnimatedNavigation(n,r,u);this._fadeOutButtons();this._scrollPosChanged();this._pageManager._ensureCentered(!0);this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var i=this._pageManager._navigationAnimationRecord.elementContainers[0],r=this._pageManager._navigationAnimationRecord.elementContainers[1],n=i.pageRoot,t=r.pageRoot;n.parentNode&&n.parentNode.removeChild(n);t.parentNode&&t.parentNode.removeChild(t);this._pageManager.endAnimatedJump(i,r);this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(n){return this._pageManager.jumpToIndex(n)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(n,t,i){var r,u,f;this._animating&&this._cancelAnimation();r=0;void 0!==i&&(r=i);this._dataSource=n;this._itemRenderer=t;u=this._itemsManager;this._itemsManager=w._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv});this._dataSource=this._itemsManager.dataSource;f=this;this._dataSource.getCount().then(function(n){f._pageManager._cachedSize=n});this._pageManager.setNewItemsManager(this._itemsManager,r);u&&u.release()},_fireDatasourceCountChangedEvent:function(){var t=this;l.schedule(function(){var i=n.document.createEvent("Event");i.initEvent(p.datasourceCountChangedEvent,!0,!0);e("WinJS.UI.FlipView:dataSourceCountChangedEvent,info");t._flipviewDiv.dispatchEvent(i)},l.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._isHorizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._isHorizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden";this._panningDivContainer.style.overflowY="hidden";var t="rtl"===n.getComputedStyle(this._flipviewDiv,null).direction;this._rtl=t;t?(this._prevButton.className=g+" "+it,this._nextButton.className=g+" "+tt):(this._prevButton.className=g+" "+tt,this._nextButton.className=g+" "+it);this._prevButton.innerHTML=t?ut:rt;this._nextButton.innerHTML=t?rt:ut}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=g+" "+ht,this._nextButton.className=g+" "+ct,this._prevButton.innerHTML=pt,this._nextButton.innerHTML=wt;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(n,t){(this._mouseInViewport||t||!this._environmentSupportsTouch)&&("next"===n&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===n&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(n){var t=this;return"next"===n?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=o.fadeOut(this._nextButton).then(function(){t._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=o.fadeOut(this._prevButton).then(function(){t._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(n){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var t=this;this._buttonFadePromise=(n?c.wrap():c.timeout(s._animationTimeAdjustment(vt))).then(function(){t._fadeOutButton("prev");t._fadeOutButton("next");t._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(n,t){var r={},i,u,f;return t.style.left="0px",t.style.top="0px",t.style.opacity=0,i=n.itemIndex>t.itemIndex?-ft:ft,r.left=(this._isHorizontal?this._rtl?-i:i:0)+"px",r.top=(this._isHorizontal?0:i)+"px",u=o.fadeOut(n),f=o.enterContent(t,[r],{mechanism:"transition"}),c.join([u,f])},_fadeInFromCurrentValue:function(n){return s.executeTransition(n,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}},k);return t.Class.mix(p,u.createEventProperties(p.datasourceCountChangedEvent,p.pageVisibilityChangedEvent,p.pageSelectedEvent,p.pageCompletedEvent)),t.Class.mix(p,a.DOMEventMixin),p})})});t("WinJS/Controls/ItemContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";var g=f._createEventProperty,d={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};i.Namespace._moduleDefine(n,"WinJS.UI",{ItemContainer:i.Namespace._lazy(function(){var o={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},f=i.Class.define(function(i,r){function s(n,t,i){return{name:t?n:n.toLowerCase(),handler:function(t){e["_on"+n](t)},capture:i}}var e,h;if(i=i||t.document.createElement("DIV"),this._id=i.id||v._uniqueID(i),this._writeProfilerMark("constructor,StartTM"),r=r||{},i.winControl)throw new u("WinJS.UI.ItemContainer.DuplicateConstruction",o.duplicateConstruction);i.winControl=this;this._element=i;v.addClass(i,"win-disposable");this._selectionMode=w.SelectionMode.single;this._draggable=!1;this._pressedEntity={type:w.ObjectType.item,index:b._INVALID_INDEX};this.tapBehavior=w.TapBehavior.invokeOnly;this.swipeOrientation=w.Orientation.vertical;this.swipeBehavior=w.SwipeBehavior.select;v.addClass(this.element,f._ClassName.itemContainer+" "+b._containerClass);this._setupInternalTree();this._selection=new n._SingleItemSelectionManager(i,this._itemBox);this._setTabIndex();l.setOptions(this,r);this._mutationObserver=new v._MutationObserver(this._itemPropertyChange.bind(this));this._mutationObserver.observe(i,{attributes:!0,attributeFilter:["aria-selected"]});this._setAriaRole();e=this;this.selectionDisabled||c.schedule(function(){e._setDirectionClass()},c.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize");this._itemEventsHandler=new k._ItemEventsHandler(Object.create({containerFromElement:function(){return e.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return b._INVALID_INDEX},itemBoxAtIndex:function(){return e._itemBox},itemAtIndex:function(){return e.element},headerAtIndex:function(){return null},containerAtIndex:function(){return e.element},isZombie:function(){return this._disposed},getItemPosition:function(){return e._getItemPosition()},rtl:function(){return e._rtl()},fireInvokeEvent:function(){e._fireInvokeEvent()},verifySelectionAllowed:function(){return e._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(n,t){return e._selection.set({firstIndex:n,lastIndex:t})}},{pressedEntity:{get:function(){return e._pressedEntity},set:function(n){e._pressedEntity=n}},pressedElement:{enumerable:!0,set:function(n){e._pressedElement=n}},eventHandlerRoot:{enumerable:!0,get:function(){return e.element}},swipeBehavior:{enumerable:!0,get:function(){return e._swipeBehavior}},selectionMode:{enumerable:!0,get:function(){return e._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return b._containerClass}},canvasProxy:{enumerable:!0,get:function(){return e._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return e._tapBehavior}},draggable:{enumerable:!0,get:function(){return e._draggable}},selection:{enumerable:!0,get:function(){return e._selection}},horizontal:{enumerable:!0,get:function(){return e._swipeOrientation===w.Orientation.vertical}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));h=[s("MSManipulationStateChanged",!0,!0),s("PointerDown"),s("Click"),s("PointerUp"),s("PointerCancel"),s("LostPointerCapture"),s("ContextMenu"),s("MSHoldVisual",!0),s("FocusIn"),s("FocusOut"),s("DragStart"),s("DragEnd"),s("KeyDown")];h.forEach(function(n){v._addEventListener(e.element,n.name,n.handler,!!n.capture)});this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(n){r.isPhone||this._draggable!==n&&(this._draggable=n,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(n){this._selection.selected!==n&&(this._selection.selected=n)}},swipeOrientation:{get:function(){return this._swipeOrientation},set:function(n){n===w.Orientation.vertical?(v.removeClass(this.element,f._ClassName.horizontal),v.addClass(this.element,f._ClassName.vertical)):(n=w.Orientation.horizontal,v.removeClass(this.element,f._ClassName.vertical),v.addClass(this.element,f._ClassName.horizontal));this._swipeOrientation=n}},tapBehavior:{get:function(){return this._tapBehavior},set:function(n){r.isPhone&&n===w.TapBehavior.directSelect||(this._tapBehavior=n,this._setAriaRole())}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(n){this._swipeBehavior=n;this._setSwipeClass()}},selectionDisabled:{get:function(){return this._selectionMode===w.SelectionMode.none},set:function(n){n?this._selectionMode=w.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=w.SelectionMode.single);this._setSwipeClass();this._setAriaRole()}},oninvoked:g(d.invoked),onselectionchanging:g(d.selectionchanging),onselectionchanged:g(d.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),a.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(n){this._itemEventsHandler.onMSManipulationStateChanged(n)},_onPointerDown:function(n){this._itemEventsHandler.onPointerDown(n)},_onClick:function(n){this._itemEventsHandler.onClick(n)},_onPointerUp:function(n){v.hasClass(this._itemBox,b._itemFocusClass)&&this._onFocusOut(n);this._itemEventsHandler.onPointerUp(n)},_onPointerCancel:function(n){this._itemEventsHandler.onPointerCancel(n)},_onLostPointerCapture:function(n){this._itemEventsHandler.onLostPointerCapture(n)},_onContextMenu:function(n){this._itemEventsHandler.onContextMenu(n)},_onMSHoldVisual:function(n){this._itemEventsHandler.onMSHoldVisual(n)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+b._itemFocusOutlineClass)&&p._keyboardSeenLast){v.addClass(this._itemBox,b._itemFocusClass);var n=t.document.createElement("div");n.className=b._itemFocusOutlineClass;this._itemBox.appendChild(n)}},_onFocusOut:function(){v.removeClass(this._itemBox,b._itemFocusClass);var n=this._itemBox.querySelector("."+b._itemFocusOutlineClass);n&&n.parentNode.removeChild(n)},_onDragStart:function(n){var t,i;this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement)?n.preventDefault():(this._dragging=!0,t=this,(n.dataTransfer.setData("text",""),n.dataTransfer.setDragImage)&&(i=this.element.getBoundingClientRect(),n.dataTransfer.setDragImage(this.element,n.clientX-i.left,n.clientY-i.top)),r._yieldForDomModification(function(){t._dragging&&v.addClass(t._itemBox,b._dragSourceClass)}))},_onDragEnd:function(){this._dragging=!1;v.removeClass(this._itemBox,b._dragSourceClass);this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(n){var f;if(!this._itemEventsHandler._isInteractive(n.target)){var t=v.Key,i=n.keyCode,u=this._swipeBehavior===w.SwipeBehavior.select,r=!1;n.ctrlKey||i!==t.enter?n.ctrlKey&&i===t.enter||u&&n.shiftKey&&i===t.F10||u&&i===t.menu||i===t.space?this.selectionDisabled||(this.selected=!this.selected,r=v._setActive(this.element)):i===t.escape&&this.selected&&(this.selected=!1,r=!0):(f=this._verifySelectionAllowed(),f.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),r=!0);r&&(n.stopPropagation(),n.preventDefault())}},_setTabIndex:function(){var n=this.element.getAttribute("tabindex");n||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){v[this._rtl()?"addClass":"removeClass"](this.element,b._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction;this._setDirectionClass()},_getItemPosition:function(){var n=this.element;return n?h.wrap({left:this._rtl()?n.offsetParent.offsetWidth-n.offsetLeft-n.offsetWidth:n.offsetLeft,top:n.offsetTop,totalWidth:v.getTotalWidth(n),totalHeight:v.getTotalHeight(n),contentWidth:v.getContentWidth(n),contentHeight:v.getContentHeight(n)}):h.cancel},_itemPropertyChange:function(n){if(!this._disposed){var i=n[0].target,t="true"===i.getAttribute("aria-selected");t!==v._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?v._setAttribute(i,"aria-selected",!t):(this.selected=t,t!==this.selected&&v._setAttribute(i,"aria-selected",!t)))}},_setSwipeClass:function(){r.isPhone||(this._swipeBehavior===w.SwipeBehavior.select&&this._selectionMode!==w.SelectionMode.none||this._draggable?v.addClass(this._element,b._swipeableClass):v.removeClass(this._element,b._swipeableClass))},_updateDraggableAttribute:function(){this._setSwipeClass();this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode===w.SelectionMode.none||this._tapBehavior!==w.TapBehavior.toggleSelect&&this._swipeBehavior!==w.SwipeBehavior.select)return{canSelect:!1,canTapSelect:!1};var n=this._selection.fireSelectionChanging();return{canSelect:n,canTapSelect:n&&this._tapBehavior===w.TapBehavior.toggleSelect}},_setupInternalTree:function(){var i=t.document.createElement("div"),n,r;for(i.className=b._itemClass,this._captureProxy=t.document.createElement("div"),this._itemBox=t.document.createElement("div"),this._itemBox.className=b._itemBoxClass,n=this.element.firstChild;n;)r=n.nextSibling,i.appendChild(n),n=r;this.element.appendChild(this._itemBox);this._itemBox.appendChild(i);this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==w.TapBehavior.none){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(d.invoked,!0,!1,{});this.element.dispatchEvent(n)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var n;n=this.tapBehavior===w.TapBehavior.none&&this.selectionDisabled?"listitem":"option";v._setAttribute(this.element,"role",n)}},_writeProfilerMark:function(n){var t="WinJS.UI.ItemContainer:"+this._id+":"+n;s(t);e.log&&e.log(t,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return i.Class.mix(f,l.DOMEventMixin),f}),_SingleItemSelectionManager:i.Namespace._lazy(function(){return i.Class.define(function(n,t){this._selected=!1;this._element=n;this._itemBox=t},{selected:{get:function(){return this._selected},set:function(n){n=!!n;this._selected!==n&&this.fireSelectionChanging()&&(this._selected=n,k._ItemEventsHandler.renderSelection(this._itemBox,this._element,n,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(d.selectionchanging,!0,!0,{}),this._element.dispatchEvent(n)},fireSelectionChanged:function(){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(d.selectionchanged,!0,!1,{});this._element.dispatchEvent(n)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:w.ObjectType.item,index:b._INVALID_INDEX}}})})})});t("WinJS/Controls/Repeater",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{Repeater:i.Namespace._lazy(function(){function ut(n){var i=t.document.createElement("div");return i.textContent=JSON.stringify(n),i}var v="itemsloaded",y="itemchanging",p="itemchanged",w="iteminserting",b="iteminserted",k="itemmoving",d="itemmoved",g="itemremoving",nt="itemremoved",tt="itemsreloading",it="itemsreloaded",n=u._createEventProperty,f={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get asynchronousRender(){return"Top level items must render synchronously"},get repeaterReentrancy(){return"Cannot modify Repeater data until Repeater has commited previous modification."}},rt=i.Class.define(function(n,i){if(n&&n.winControl)throw new r("WinJS.UI.Repeater.DuplicateConstruction",f.duplicateConstruction);this._element=n||t.document.createElement("div");this._id=this._element.id||a._uniqueID(this._element);this._writeProfilerMark("constructor,StartTM");i=i||{};a.addClass(this._element,"win-repeater win-disposable");this._render=null;this._modifying=!1;this._disposed=!1;this._element.winControl=this;this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var u=this._extractInlineTemplate();this._initializing=!0;this.template=i.template||u;this.data=i.data;this._initializing=!1;c._setOptions(this,i,!0);this._repeatedDOM=[];this._renderAllItems();this.dispatchEvent(v,{});this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(n){this._writeProfilerMark("data.set,StartTM");this._data&&this._removeDataListeners();this._data=n||new o.List;this._addDataListeners();this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(v,{}));this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(n){this._writeProfilerMark("template.set,StartTM");this._template=n||ut;this._render=a._syncRenderer(this._template,this.element.tagName);this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(v,{}));this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(n){return this._repeatedDOM[n]},dispose:function(){if(!this._disposed){this._disposed=!0;this._removeDataListeners();this._data=null;this._template=null;for(var n=0,t=this._repeatedDOM.length;t>n;n++)l._disposeElement(this._repeatedDOM[n])}},onitemsloaded:n(v),onitemchanging:n(y),onitemchanged:n(p),oniteminserting:n(w),oniteminserted:n(b),onitemmoving:n(k),onitemmoved:n(d),onitemremoving:n(g),onitemremoved:n(nt),onitemsreloading:n(tt),onitemsreloaded:n(it),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var n=t.document.createElement(this._element.tagName);this._element.firstElementChild;)n.appendChild(this._element.firstElementChild);return new s.Template(n,{extractChild:!0})}},_renderAllItems:function(){for(var n,u=t.document.createDocumentFragment(),i=0,e=this._data.length;e>i;i++){if(n=this._render(this._data.getAt(i)),!n)throw new r("WinJS.UI.Repeater.AsynchronousRender",f.asynchronousRender);u.appendChild(n);this._repeatedDOM.push(n)}this._element.appendChild(u)},_reloadRepeater:function(n){this._unloadRepeatedDOM(n);this._repeatedDOM=[];this._renderAllItems()},_unloadRepeatedDOM:function(n){for(var i,t=0,r=this._repeatedDOM.length;r>t;t++)i=this._repeatedDOM[t],n&&l._disposeElement(i),i.parentElement===this._element&&this._element.removeChild(i)},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(n){this._data.addEventListener(n,this._dataListeners[n],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new r("WinJS.UI.Repeater.RepeaterModificationReentrancy",f.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(n){this._data.removeEventListener(n,this._dataListeners[n],!1)}.bind(this))},_dataItemChangedHandler:function(n){var u;this._beginModification();var e,o=this._element,i=n.detail.index,t=this._render(n.detail.newValue);if(!t)throw new r("WinJS.UI.Repeater.AsynchronousRender",f.asynchronousRender);this._repeatedDOM[i]&&(n.detail.oldElement=this._repeatedDOM[i]);n.detail.newElement=t;n.detail.setPromise=function(n){e=n};this._writeProfilerMark(y+",info");this.dispatchEvent(y,n.detail);u=null;i<this._repeatedDOM.length?(u=this._repeatedDOM[i],o.replaceChild(t,u),this._repeatedDOM[i]=t):(o.appendChild(t),this._repeatedDOM.push(t));this._endModification();this._writeProfilerMark(p+",info");this.dispatchEvent(p,n.detail);u&&h.as(e).done(function(){l._disposeElement(u)}.bind(this))},_dataItemInsertedHandler:function(n){var i,t,u,e;if(this._beginModification(),i=n.detail.index,t=this._render(n.detail.value),!t)throw new r("WinJS.UI.Repeater.AsynchronousRender",f.asynchronousRender);u=this._element;(n.detail.affectedElement=t,this._writeProfilerMark(w+",info"),this.dispatchEvent(w,n.detail),i<this._repeatedDOM.length)?(e=this._repeatedDOM[i],u.insertBefore(t,e)):u.appendChild(t);this._repeatedDOM.splice(i,0,t);this._endModification();this._writeProfilerMark(b+",info");this.dispatchEvent(b,n.detail)},_dataItemMovedHandler:function(n){var t,i;this._beginModification();t=this._repeatedDOM[n.detail.oldIndex];(n.detail.affectedElement=t,this._writeProfilerMark(k+",info"),this.dispatchEvent(k,n.detail),this._repeatedDOM.splice(n.detail.oldIndex,1)[0],t.parentNode.removeChild(t),n.detail.newIndex<this._data.length-1)?(i=this._repeatedDOM[n.detail.newIndex],this._element.insertBefore(t,i),this._repeatedDOM.splice(n.detail.newIndex,0,t)):(this._repeatedDOM.push(t),this._element.appendChild(t));this._endModification();this._writeProfilerMark(d+",info");this.dispatchEvent(d,n.detail)},_dataItemRemovedHandler:function(n){this._beginModification();var r,t=this._repeatedDOM[n.detail.index],i={affectedElement:t,index:n.detail.index,item:n.detail.item};i.setPromise=function(n){r=n};this._writeProfilerMark(g+",info");this.dispatchEvent(g,i);t.parentNode.removeChild(t);this._repeatedDOM.splice(n.detail.index,1);this._endModification();this._writeProfilerMark(nt+",info");this.dispatchEvent(nt,i);h.as(r).done(function(){l._disposeElement(t)}.bind(this))},_dataReloadHandler:function(){var i,n,t,r;this._beginModification();n=this._repeatedDOM.slice(0);t={affectedElements:n};t.setPromise=function(n){i=n};this._writeProfilerMark(tt+",info");this.dispatchEvent(tt,t);this._reloadRepeater(!1);r=this._repeatedDOM.slice(0);this._endModification();this._writeProfilerMark(it+",info");this.dispatchEvent(it,{affectedElements:r});h.as(i).done(function(){for(var t=0,i=n.length;i>t;t++)l._disposeElement(n[t])}.bind(this))},_writeProfilerMark:function(n){e("WinJS.UI.Repeater:"+this._id+":"+n)}},{isDeclarativeControlContainer:!0});return i.Class.mix(rt,c.DOMEventMixin),rt})})});t("WinJS/Controls/DatePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h){"use strict";i.Namespace.define("WinJS.UI",{DatePicker:i.Namespace._lazy(function(){function b(n,i,r){var f=t.Windows.Globalization.DateTimeFormatting,u;return n=n?n:r,u=new f.DateTimeFormatter(n),i?new f.DateTimeFormatter(n,u.languages,u.geographicRegion,i,u.clock):u}function s(n,t,i){var f=w[n],u,r;return f||(f=w[n]={}),u=f[t],u||(u=f[t]={}),r=u[i],r||(r=u[i]={},r.formatter=b(n,t,i),r.years={}),r}function k(n,t,i,r,u,f){var o=s(n,t,i),e=o.years[f.year+"-"+f.era];return e||(e=o.formatter.format(f.getDateTime()),o.years[f.year+"-"+f.era]=e),e}function d(n,t,i,r){var u=s(n,t,i);return u.formatter.format(r.getDateTime())}function g(n,t,i,r){var u=s(n,t,i);return u.formatter.format(r.getDateTime())}function l(n){var r=t.Windows.Globalization,i=new r.Calendar;return n?new r.Calendar(i.languages,n,i.getClock()):i}function a(n,t){var i=0;if(n.era===t.era)i=t.year-n.year;else for(;n.era!==t.era||n.year!==t.year;)i++,n.addYears(1);return i}var v="day",y="{month.full}",p="year.full",c={get ariaLabel(){return f._getWinJSString("ui/datePicker").value},get selectDay(){return f._getWinJSString("ui/selectDay").value},get selectMonth(){return f._getWinJSString("ui/selectMonth").value},get selectYear(){return f._getWinJSString("ui/selectYear").value}},w={},r=i.Class.define(function(t,i){this._currentDate=new Date;this._minYear=this._currentDate.getFullYear()-100;this._maxYear=this._currentDate.getFullYear()+100;this._datePatterns={date:null,month:null,year:null};t=t||n.document.createElement("div");o.addClass(t,"win-disposable");t.winControl=this;var r=t.getAttribute("aria-label");r||t.setAttribute("aria-label",c.ariaLabel);this._init(t);e.setOptions(this,i)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group");this._dateElement.setAttribute("aria-label",c.selectDay);this._monthElement.setAttribute("aria-label",c.selectMonth);this._yearElement.setAttribute("aria-label",c.selectYear)},_addControlsInOrder:function(){var t=this._domElement,n=this,i=0;n._information.order.forEach(function(r){switch(r){case"month":t.appendChild(n._monthElement);o.addClass(n._monthElement,"win-order"+i++);break;case"date":t.appendChild(n._dateElement);o.addClass(n._dateElement,"win-order"+i++);break;case"year":t.appendChild(n._yearElement);o.addClass(n._yearElement,"win-order"+i++)}})},_createControlElements:function(){this._monthElement=n.document.createElement("select");this._monthElement.className="win-datepicker-month";this._dateElement=n.document.createElement("select");this._dateElement.className="win-datepicker-date";this._yearElement=n.document.createElement("select");this._yearElement.className="win-datepicker-year"},_createControls:function(){var t=this._information,n=t.getIndex(this.current);t.forceLanguage&&(this._domElement.setAttribute("lang",t.forceLanguage),this._domElement.setAttribute("dir",t.isRTL?"rtl":"ltr"));this._yearControl=new h._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:n.year});this._monthControl=new h._Select(this._monthElement,{dataSource:this._information.months(n.year),disabled:this.disabled,index:n.month});this._dateControl=new h._Select(this._dateElement,{dataSource:this._information.dates(n.year,n.month),disabled:this.disabled,index:n.date});this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(n){this._calendar=n;this._setElement(this._domElement)}},current:{get:function(){var n=this._currentDate,t=n.getFullYear();return new Date(Math.max(Math.min(this.maxYear,t),this.minYear),n.getMonth(),n.getDate(),12,0,0,0)},set:function(n){var t,i;"string"==typeof n?(t=new Date(Date.parse(n)),t.setHours(12,0,0,0)):t=n;i=this._currentDate;i!==t&&(this._currentDate=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(n){this._disabled!==n&&(this._disabled=n,this._yearControl&&(this._monthControl.setDisabled(n),this._dateControl.setDisabled(n),this._yearControl.setDisabled(n)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(n){this._datePatterns.date!==n&&(this._datePatterns.date=n,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(n){this._domElement=this._domElement||n;this._domElement&&(o.empty(this._domElement),o.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(n){this._minYear!==n&&(this._minYear=n,n>this._maxYear&&(this._maxYear=n),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var n={year:this._information.years.getLength()-1};return n.month=this._information.months(n.year).getLength()-1,n.date=this._information.dates(n.year,n.month).getLength()-1,this._information.getDate(n).getFullYear()},set:function(n){this._maxYear!==n&&(this._maxYear=n,n<this._minYear&&(this._minYear=n),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(n){this._datePatterns.month!==n&&(this._datePatterns.month=n,this._init())}},_updateInformation:function(){var n=new Date(this._minYear,0,1,12,0,0),t=new Date(this._maxYear,11,31,12,0,0);n.setFullYear(this._minYear);t.setFullYear(this._maxYear);this._information=r.getInformation(n,t,this._calendar,this._datePatterns)},_init:function(n){this._setElement(n)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var n=this._information.getIndex(this.current);this._yearControl.index=n.year;this._monthControl.dataSource=this._information.months(n.year);this._monthControl.index=n.month;this._dateControl.dataSource=this._information.dates(n.year,n.month);this._dateControl.index=n.date}},_wireupEvents:function(){function t(){n._currentDate=n._information.getDate({year:n._yearControl.index,month:n._monthControl.index,date:n._dateControl.index},n._currentDate);var t=n._information.getIndex(n._currentDate);n._monthControl.dataSource=n._information.months(t.year);n._monthControl.index=t.month;n._dateControl.dataSource=n._information.dates(t.year,t.month);n._dateControl.index=t.date}var n=this;this._dateElement.addEventListener("change",t,!1);this._monthElement.addEventListener("change",t,!1);this._yearElement.addEventListener("change",t,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(n){this._datePatterns.year!==n&&(this._datePatterns.year=n,this._init())}}},{_getInformationWinRT:function(n,t,i,r){function c(n){return new Date(Math.min(new Date(Math.max(nt,n)),tt))}var nt,tt,it,w;r=r||{date:v,month:y,year:p};var u=l(i),e=l(i),f=l(i);u.setToMin();nt=u.getDateTime();u.setToMax();tt=u.getDateTime();u.hour=12;n=c(n);t=c(t);u.setDateTime(t);it={year:u.year,era:u.era};u.setDateTime(n);w=0;w=a(u,it)+1;var rt=s("day month.full year",i).formatter,o=rt.patterns[0],ut=8207===o.charCodeAt(0),b=["date","month","year"],h={month:o.indexOf("{month"),date:o.indexOf("{day"),year:o.indexOf("{year")};b.sort(function(n,t){return h[n]<h[t]?-1:h[n]>h[t]?1:0});var ft=function(){return{getLength:function(){return w},getValue:function(t){return u.setDateTime(n),u.addYears(t),k(r.year,i,p,r,b,u)}}}(),et=function(t){return e.setDateTime(n),e.addYears(t),{getLength:function(){return e.numberOfMonthsInThisYear},getValue:function(n){return e.month=e.firstMonthInThisYear,e.addMonths(n),d(r.month,i,y,e)}}},ot=function(t,u){return f.setDateTime(n),f.addYears(t),f.month=f.firstMonthInThisYear,f.addMonths(u),f.day=f.firstDayInThisMonth,{getLength:function(){return f.numberOfDaysInThisMonth},getValue:function(n){return f.day=f.firstDayInThisMonth,f.addDays(n),g(r.date,i,v,f)}}};return{isRTL:ut,forceLanguage:rt.resolvedLanguage,order:b,getDate:function(t,i){var f,r,e,o;return i&&(u.setDateTime(i),f={year:u.year,month:u.month,day:u.day}),r=u,r.setDateTime(n),r.addYears(t.year),r.firstMonthInThisYear>r.lastMonthInThisYear?(e=t.month+r.firstMonthInThisYear>r.numberOfMonthsInThisYear?t.month+r.firstMonthInThisYear-r.numberOfMonthsInThisYear:t.month+r.firstMonthInThisYear,f&&f.year!==r.year&&(e=Math.max(Math.min(f.month,r.numberOfMonthsInThisYear),1))):e=f&&f.year!==r.year?Math.max(Math.min(f.month,r.firstMonthInThisYear+r.numberOfMonthsInThisYear-1),r.firstMonthInThisYear):Math.max(Math.min(t.month+r.firstMonthInThisYear,r.firstMonthInThisYear+r.numberOfMonthsInThisYear-1),r.firstMonthInThisYear),r.month=e,o=Math.max(Math.min(t.date+r.firstDayInThisMonth,r.firstDayInThisMonth+r.numberOfDaysInThisMonth-1),r.firstDayInThisMonth),!f||f.year===r.year&&f.month===r.month||(o=Math.max(Math.min(f.day,r.firstDayInThisMonth+r.numberOfDaysInThisMonth-1),r.firstDayInThisMonth)),r.day=r.firstDayInThisMonth,r.addDays(o-r.firstDayInThisMonth),r.getDateTime()},getIndex:function(t){var f=c(t),e,r,i,o,s;return u.setDateTime(f),e={year:u.year,era:u.era},r=0,u.setDateTime(n),u.month=1,r=a(u,e),u.setDateTime(f),i=u.month-u.firstMonthInThisYear,0>i&&(i=u.month-u.firstMonthInThisYear+u.numberOfMonthsInThisYear),o=u.day-u.firstDayInThisMonth,s={year:r,month:i,date:o},s},years:ft,months:et,dates:ot}},_getInformationJS:function(n,t){var i=n.getFullYear(),o=t.getFullYear(),r={getLength:function(){return Math.max(0,o-i+1)},getValue:function(n){return i+n}},u=["January","February","March","April","May","June","July","August","September","October","November","December"],f=function(){return{getLength:function(){return u.length},getValue:function(n){return u[n]},getMonthNumber:function(n){return Math.min(n,u.length-1)}}},e=function(n,t){var u=new Date,f=r.getValue(n),e=t+1,i;return u.setFullYear(f,e,0),i=u.getDate(),{getLength:function(){return i},getValue:function(n){return""+(n+1)},getDateNumber:function(n){return Math.min(n+1,i)}}};return{order:["month","date","year"],getDate:function(n){return new Date(r.getValue(n.year),f(n.year).getMonthNumber(n.month),e(n.year,n.month).getDateNumber(n.date),12,0)},getIndex:function(n){var t=0,o=n.getFullYear(),u,s;return t=i>o?0:o>this.maxYear?r.getLength()-1:n.getFullYear()-i,u=Math.min(n.getMonth(),f(t).getLength()),s=Math.min(n.getDate()-1,e(t,u).getLength()),{year:t,month:u,date:s}},years:r,months:f,dates:e}}});return r.getInformation=t.Windows.Globalization.Calendar&&t.Windows.Globalization.DateTimeFormatting?r._getInformationWinRT:r._getInformationJS,i.Class.mix(r,u.createEventProperties("change")),i.Class.mix(r,e.DOMEventMixin),r})})});t("WinJS/Controls/TimePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h){"use strict";i.Namespace.define("WinJS.UI",{TimePicker:i.Namespace._lazy(function(){var c="{minute.integer(2)}",l="{hour.integer(1)}",a="{period.abbreviated(2)}",s={get ariaLabel(){return f._getWinJSString("ui/timePicker").value},get selectHour(){return f._getWinJSString("ui/selectHour").value},get selectMinute(){return f._getWinJSString("ui/selectMinute").value},get selectAMPM(){return f._getWinJSString("ui/selectAMPM").value}},v=function(n,t){return n.getHours()===t.getHours()&&n.getMinutes()===t.getMinutes()},r=i.Class.define(function(t,i){this._currentTime=r._sentinelDate();t=t||n.document.createElement("div");o.addClass(t,"win-disposable");t.winControl=this;var u=t.getAttribute("aria-label");u||t.setAttribute("aria-label",s.ariaLabel);this._timePatterns={minute:null,hour:null,period:null};this._init(t);e.setOptions(this,i)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group");this._hourElement.setAttribute("aria-label",s.selectHour);this._minuteElement.setAttribute("aria-label",s.selectMinute);this._ampmElement&&this._ampmElement.setAttribute("aria-label",s.selectAMPM)},_addControlsInOrder:function(n){var t=this;n.order.forEach(function(n,i){switch(n){case"hour":t._domElement.appendChild(t._hourElement);o.addClass(t._hourElement,"win-order"+i);break;case"minute":t._domElement.appendChild(t._minuteElement);o.addClass(t._minuteElement,"win-order"+i);break;case"period":t._ampmElement&&(t._domElement.appendChild(t._ampmElement),o.addClass(t._ampmElement,"win-order"+i))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(n){this._clock!==n&&(this._clock=n,this._init())}},current:{get:function(){var t=this._currentTime,n;return t?(n=r._sentinelDate(),n.setHours(t.getHours()),n.setMinutes(this._getMinutesIndex(t)*this.minuteIncrement),n.setSeconds(0),n.setMilliseconds(0),n):t},set:function(n){var t,i;"string"==typeof n?(t=r._sentinelDate(),t.setTime(Date.parse(t.toDateString()+" "+n))):(t=r._sentinelDate(),t.setHours(n.getHours()),t.setMinutes(n.getMinutes()));i=this._currentTime;v(i,t)||(this._currentTime=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(n){this._disabled!==n&&(this._disabled=n,this._hourControl&&(this._hourControl.setDisabled(n),this._minuteControl.setDisabled(n)),this._ampmControl&&this._ampmControl.setDisabled(n))}},element:{get:function(){return this._domElement}},_init:function(n){this._setElement(n);this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(n){this._timePatterns.hour!==n&&(this._timePatterns.hour=n,this._init())}},_getHoursAmpm:function(n){var t=n.getHours();return this._ampmElement?0===t?{hours:12,ampm:0}:12>t?{hours:t,ampm:0}:{hours:t-12,ampm:1}:{hours:t}},_getHoursIndex:function(n){return this._ampmElement&&12===n?0:n},_getMinutesIndex:function(n){return parseInt(n.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(n){this._minuteIncrement!==n&&(this._minuteIncrement=n,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(n){this._timePatterns.minute!==n&&(this._timePatterns.minute=n,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(n){this._timePatterns.period!==n&&(this._timePatterns.period=n,this._init())}},_setElement:function(t){var i,u;(this._domElement=this._domElement||t,this._domElement)&&(i=r.getInformation(this.clock,this.minuteIncrement,this._timePatterns),this._information=i,i.forceLanguage&&(this._domElement.setAttribute("lang",i.forceLanguage),this._domElement.setAttribute("dir",i.isRTL?"rtl":"ltr")),o.empty(this._domElement),o.addClass(this._domElement,"win-timepicker"),this._hourElement=n.document.createElement("select"),o.addClass(this._hourElement,"win-timepicker-hour"),this._minuteElement=n.document.createElement("select"),o.addClass(this._minuteElement,"win-timepicker-minute"),this._ampmElement=null,"12HourClock"===i.clock&&(this._ampmElement=n.document.createElement("select"),o.addClass(this._ampmElement,"win-timepicker-period")),this._addControlsInOrder(i),u=this._getHoursAmpm(this.current),this._hourControl=new h._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(u.hours)}),this._minuteControl=new h._Select(this._minuteElement,{dataSource:i.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new h._Select(this._ampmElement,{dataSource:i.periods,disabled:this.disabled,index:u.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes())},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var n=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=n.ampm);this._hourControl.index=this._getHoursIndex(n.hours);this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var n=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=n.ampm);this._hourControl&&(this._hourControl.index=this._getHoursIndex(n.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var n=this,i=function(){var t=n._hourControl.index;return n._ampmElement&&1===n._ampmControl.index&&12!==t&&(t+=12),t},t=function(){var t=i();n._currentTime.setHours(t);n._currentTime.setMinutes(n._minuteControl.index*n.minuteIncrement)};this._hourElement.addEventListener("change",t,!1);this._minuteElement.addEventListener("change",t,!1);this._ampmElement&&this._ampmElement.addEventListener("change",t,!1)}},{_sentinelDate:function(){var n=new Date;return new Date(2011,6,15,n.getHours(),n.getMinutes())},_getInformationWinRT:function(n,i,u){var o=function(i,r){var f=t.Windows.Globalization.DateTimeFormatting,u;return i=i?i:r,u=new f.DateTimeFormatter(i),n&&(u=f.DateTimeFormatter(i,u.languages,u.geographicRegion,u.calendar,n)),u},y=t.Windows.Globalization,e=new y.Calendar,p,s,k;n&&(e=new y.Calendar(e.languages,e.getCalendarSystem(),n));e.setDateTime(r._sentinelDate());p=e.getClock();s=24;s=e.numberOfHoursInThisPeriod;var d=function(){var n=o(u.period,a);return{getLength:function(){return 2},getValue:function(t){var i=r._sentinelDate();return 0===t?(i.setHours(1),n.format(i)):1===t?(i.setHours(13),n.format(i)):null}}}(),g=function(){var t=o(u.minute,c),n=r._sentinelDate();return{getLength:function(){return 60/i},getValue:function(r){var u=r*i;return n.setMinutes(u),t.format(n)}}}(),nt=function(){var t=o(u.hour,l),n=r._sentinelDate();return{getLength:function(){return s},getValue:function(i){return n.setHours(i),t.format(n)}}}(),w=o("hour minute"),h=w.patterns[0],v=["hour","minute"],f={period:h.indexOf("{period"),hour:h.indexOf("{hour"),minute:h.indexOf("{minute")};f.period>-1&&v.push("period");var tt=t.Windows.Globalization.DateTimeFormatting.DateTimeFormatter,it=new tt("month.full",t.Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),rt=it.patterns[0],b=8207===rt.charCodeAt(0);return b&&(k=f.hour,f.hour=f.minute,f.minute=k),v.sort(function(n,t){return f[n]<f[t]?-1:f[n]>f[t]?1:0}),{minutes:g,hours:nt,clock:p,periods:d,order:v,forceLanguage:w.resolvedLanguage,isRTL:b}},_getInformationJS:function(n,t){var u=[12,1,2,3,4,5,6,7,8,9,10,11],i={},r;return i.getLength=function(){return 60/t},i.getValue=function(n){var i=n*t;return 10>i?"0"+i.toString():i.toString()},r=["hour","minute","period"],"24HourClock"===n&&(u=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],r=["hour","minute"]),{minutes:i,hours:u,clock:n||"12HourClock",periods:["AM","PM"],order:r}}});return r.getInformation=t.Windows.Globalization.DateTimeFormatting&&t.Windows.Globalization.Calendar&&t.Windows.Globalization.ApplicationLanguages?r._getInformationWinRT:r._getInformationJS,i.Class.mix(r,u.createEventProperties("change")),i.Class.mix(r,e.DOMEventMixin),r})})});t("WinJS/Controls/BackButton",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(n,t,i,r,u,f,e){"use strict";var s=e.Key,h="win-navigation-backbutton",c="win-back",l=3,o=function(){function f(){n.addEventListener("keyup",i,!1);e._addEventListener(n,"pointerup",r,!1)}function o(){n.removeEventListener("keyup",i,!1);e._removeEventListener(n,"pointerup",r,!1)}function i(n){(n.keyCode!==s.leftArrow||!n.altKey||n.shiftKey||n.ctrlKey)&&n.keyCode!==s.browserBack||u.back()}function r(n){n.button===l&&u.back()}var t=0;return{addRef:function(){0===t&&f();t++},release:function(){t>0&&(t--,0===t&&o())},getCount:function(){return t}}}();t.Namespace.define("WinJS.UI",{BackButton:t.Namespace._lazy(function(){var s={get ariaLabel(){return r._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},l=t.Class.define(function(t,r){if(t&&t.winControl)throw new i("WinJS.UI.BackButton.DuplicateConstruction",s.duplicateConstruction);this._element=t||n.document.createElement("button");r=r||{};this._initializeButton();this._disposed=!1;this._element.winControl=this;f.setOptions(this,r);this._buttonClickHandler=this._handleBackButtonClick.bind(this);this._element.addEventListener("click",this._buttonClickHandler,!1);this._navigatedHandler=this._handleNavigatedEvent.bind(this);u.addEventListener("navigated",this._navigatedHandler,!1);o.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,u.removeEventListener("navigated",this._navigatedHandler,!1),o.release())},refresh:function(){this._element.disabled=u.canGoBack?!1:!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new i("WinJS.UI.BackButton.BadButtonElement",s.badButtonElement);e.addClass(this._element,h);e.addClass(this._element,"win-disposable");this._element.innerHTML='<span class="'+c+'"><\/span>';this.refresh();this._element.setAttribute("aria-label",s.ariaLabel);this._element.setAttribute("title",s.ariaLabel);this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){u.back()}});return l._getReferenceCount=function(){return o.getCount()},t.Class.mix(l,f.DOMEventMixin),l})})});t("WinJS/Controls/Tooltip",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Animations/_TransitionAnimation","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{Tooltip:r.Namespace._lazy(function(){function yt(n,t){return"pointerdown"===n?t===l:n in ot}function pt(n,t){return"pointerdown"===n?t!==l:n in ht}var y=0,p=c.Key,w="top",b=o._animationTimeAdjustment(400),k=o._animationTimeAdjustment(1200),d=o._animationTimeAdjustment(400),g=o._animationTimeAdjustment(5e3),nt=o._animationTimeAdjustment(0),tt=o._animationTimeAdjustment(600),it=o._animationTimeAdjustment(400),rt=o._animationTimeAdjustment(600),ut=o._animationTimeAdjustment(200),ft=o._animationTimeAdjustment(3e5),wt=12,bt=20,kt=45,dt=20,gt=12,et=1,ni=c._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",l=c._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",ot={keyup:"",pointerover:"",pointerdown:""},st={pointermove:""},ht={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},ti={pointerover:"",pointerout:""},ii="win-tooltip",ri="win-tooltip-phantom",n=d,ct=2*n,lt=2.5*n,v=g,at=!1,vt=!1,a=f._createEventProperty;return r.Class.define(function(r,u){var e,f,h;if(r=r||t.document.createElement("div"),e=c.data(r).tooltip,e)return e;!vt&&i.Windows.UI.ViewManagement.UISettings&&(f=new i.Windows.UI.ViewManagement.UISettings,n=o._animationTimeAdjustment(f.mouseHoverTime),ct=2*n,lt=2.5*n,v=o._animationTimeAdjustment(1e3*f.messageDuration),h=f.handPreference,at=h===i.Windows.UI.ViewManagement.HandPreference.leftHanded);vt=!0;this._disposed=!1;this._placement=w;this._infotip=!1;this._innerHTML=null;this._contentElement=null;this._extraClass=null;this._lastContentType="html";this._anchorElement=r;this._domElement=null;this._phantomDiv=null;this._triggerByOpen=!1;this._eventListenerRemoveStack=[];this._lastKeyOrBlurEvent=null;this._currentKeyOrBlurEvent=null;r.winControl=this;c.addClass(r,"win-disposable");r.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title"));s.setOptions(this,u);this._events();c.data(r).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(n){if(this._innerHTML=n,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=n;this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(n){if(this._contentElement=n,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="";this._domElement.appendChild(this._contentElement);this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(n){"top"!==n&&"bottom"!==n&&"left"!==n&&"right"!==n&&(n=w);this._placement=n;this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(n){this._infotip=!!n}},extraClass:{get:function(){return this._extraClass},set:function(n){this._extraClass=n}},onbeforeopen:a("beforeopen"),onopened:a("opened"),onbeforeclose:a("beforeclose"),onclosed:a("closed"),dispose:function(){var n,i,t;if(!this._disposed){for(this._disposed=!0,h.disposeSubTree(this.element),n=0,i=this._eventListenerRemoveStack.length;i>n;n++)this._eventListenerRemoveStack[n]();this._onDismiss();t=c.data(this._anchorElement);t&&delete t.tooltip}},addEventListener:function(n,t,i){if(this._anchorElement){this._anchorElement.addEventListener(n,t,i);var r=this;this._eventListenerRemoveStack.push(function(){r._anchorElement.removeEventListener(n,t,i)})}},removeEventListener:function(n,t,i){this._anchorElement&&this._anchorElement.removeEventListener(n,t,i)},open:function(n){switch(this._triggerByOpen=!0,"touch"!==n&&"mouseover"!==n&&"mousedown"!==n&&"keyboard"!==n&&(n="default"),n){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(h.disposeSubTree(this._domElement),t.document.body.removeChild(this._domElement),this._domElement=null,t.document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){var n,i,r,u;this._cleanUpDOM();this._domElement=t.document.createElement("div");n=c._uniqueID(this._domElement);this._domElement.setAttribute("id",n);i=t.document.defaultView.getComputedStyle(this._anchorElement,null);r=this._domElement.style;r.direction=i.direction;r.writingMode=i["writing-mode"];this._domElement.setAttribute("tabindex",-1);this._domElement.setAttribute("role","tooltip");this._anchorElement.setAttribute("aria-describedby",n);"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML;t.document.body.appendChild(this._domElement);c.addClass(this._domElement,ii);this._extraClass&&c.addClass(this._domElement,this._extraClass);this._phantomDiv=t.document.createElement("div");this._phantomDiv.setAttribute("tabindex",-1);t.document.body.appendChild(this._phantomDiv);c.addClass(this._phantomDiv,ri);u=t.document.defaultView.getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=u},_raiseEvent:function(n,i){if(this._anchorElement){var r=t.document.createEvent("CustomEvent");r.initCustomEvent(n,!1,!1,i);this._anchorElement.dispatchEvent(r)}},_captureLastKeyBlurOrPointerOverEvent:function(n){switch(this._lastKeyOrBlurEvent=this._currentKeyOrBlurEvent,n.type){case"keyup":this._currentKeyOrBlurEvent=n.keyCode===p.shift?null:"keyboard";break;case"focusout":this._currentKeyOrBlurEvent=null}},_registerEventToListener:function(n,t){var i=this,r=function(n){i._captureLastKeyBlurOrPointerOverEvent(n);i._handleEvent(n)};c._addEventListener(n,t,r,!1);this._eventListenerRemoveStack.push(function(){c._removeEventListener(n,t,r,!1)})},_events:function(){for(var n in ot)this._registerEventToListener(this._anchorElement,n);for(n in st)this._registerEventToListener(this._anchorElement,n);for(n in ht)this._registerEventToListener(this._anchorElement,n);this._registerEventToListener(this._anchorElement,"contextmenu");this._registerEventToListener(this._anchorElement,"MSHoldVisual")},_handleEvent:function(n){var t=n._normalizedType||n.type,i,r,f;if(!this._triggerByOpen){if(t in ti&&c.eventWithinElement(this._anchorElement,n))return;if(yt(t,n.pointerType))if(n.pointerType===l)this._isShown||(this._showTrigger="touch"),this._onInvoke("touch","never",n);else{if(this._skipMouseOver&&n.pointerType===ni&&"pointerover"===t)return void(this._skipMouseOver=!1);i="key"===t.substring(0,3)?"keyboard":"mouse";this._isShown||(this._showTrigger=i);this._onInvoke(i,"auto",n)}else if(t in st)this._contactPoint={x:n.clientX,y:n.clientY};else if(pt(t,n.pointerType)){if(n.pointerType===l?("pointerup"===t&&(this._skipMouseOver=!0,f=this,u._yieldForEvents(function(){f._skipMouseOver=!1})),r="touch"):r="key"===t.substring(0,3)?"keyboard":"mouse","focusout"!==t&&r!==this._showTrigger)return;this._onDismiss()}else("contextmenu"===t||"MSHoldVisual"===t)&&n.preventDefault()}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var n=this,t=this._infotip?Math.min(3*v,ft):v;this._hideDelayTimer=this._setTimeout(function(){n._onDismiss()},t)}},_onHideAnimationEnd:function(){t.document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1);this._cleanUpDOM();this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby");y=(new Date).getTime();this._triggerByOpen=!1;this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(n){var t,i;return(this._useAnimation=!0,"nodelay"===n)?(t=0,this._useAnimation=!1):(i=(new Date).getTime(),ut>=i-y?(t="touch"===n?this._infotip?it:nt:this._infotip?rt:tt,this._useAnimation=!1):t="touch"===n?this._infotip?k:b:this._infotip?lt:ct),t},_getAnchorPositionFromElementWindowCoord:function(){var n=this._anchorElement.getBoundingClientRect();return{x:n.left,y:n.top,width:n.width,height:n.height}},_getAnchorPositionFromPointerWindowCoord:function(n){return{x:n.x,y:n.y,width:1,height:1}},_canPositionOnSide:function(n,t,i,r){var u=0,f=0;switch(n){case"top":u=r.width+this._offset;f=i.y;break;case"bottom":u=r.width+this._offset;f=t.height-i.y-i.height;break;case"left":u=i.x;f=r.height+this._offset;break;case"right":u=t.width-i.x-i.width;f=r.height+this._offset}return u>=r.width+this._offset&&f>=r.height+this._offset},_positionOnSide:function(n,t,i,r){var u=0,f=0;switch(n){case"top":case"bottom":u=i.x+i.width/2-r.width/2;u=Math.min(Math.max(u,0),t.width-r.width-et);f="top"===n?i.y-r.height-this._offset:i.y+i.height+this._offset;break;case"left":case"right":f=i.y+i.height/2-r.height/2;f=Math.min(Math.max(f,0),t.height-r.height-et);u="left"===n?i.x-r.width-this._offset:i.x+i.width+this._offset}this._domElement.style.left=u+"px";this._domElement.style.top=f+"px";this._phantomDiv.style.left=u+"px";this._phantomDiv.style.top=f+"px";this._phantomDiv.style.width=r.width+"px";this._phantomDiv.style.height=r.height+"px"},_position:function(n){var i={width:0,height:0},o={x:0,y:0,width:0,height:0},f={width:0,height:0},r;i.width=t.document.documentElement.clientWidth;i.height=t.document.documentElement.clientHeight;"tb-rl"===t.document.defaultView.getComputedStyle(t.document.body,null)["writing-mode"]&&(i.width=t.document.documentElement.clientHeight,i.height=t.document.documentElement.clientWidth);o=!this._contactPoint||"touch"!==n&&"mouse"!==n?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint);f.width=this._domElement.offsetWidth;f.height=this._domElement.offsetHeight;r={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};at&&(r.top[2]="right",r.top[3]="left",r.bottom[2]="right",r.bottom[3]="left");for(var e=r[this._placement],s=e.length,u=0;s>u;u++)if(u===s-1||this._canPositionOnSide(e[u],i,o,f)){this._positionOnSide(e[u],i,o,f);break}return e[u]},_showTooltip:function(n){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),t.document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var i=this;this._removeTooltip=function(n){for(var r=i._anchorElement;r;){if(n.target===r){t.document.body.removeEventListener("DOMNodeRemoved",i._removeTooltip,!1);i._cleanUpDOM();break}r=r.parentNode}};t.document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1);this._createTooltipDOM();this._position(n);this._useAnimation?e.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(n,t,i){var r,u;(this._shouldDismiss=!1,this._isShown||i&&"keyup"===i.type&&("keyboard"===this._lastKeyOrBlurEvent||!this._lastKeyOrBlurEvent&&i.keyCode!==p.tab))||(this._hideDelay=t,this._contactPoint=null,i?(this._contactPoint={x:i.clientX,y:i.clientY},this._offset="touch"===n?kt:"keyboard"===n?wt:bt):this._offset="touch"===n?dt:gt,this._clearTimeout(this._delayTimer),this._clearTimeout(this._hideDelayTimer),r=this._decideOnDelay(n),r>0?(u=this,this._delayTimer=this._setTimeout(function(){u._showTooltip(n)},r)):this._showTooltip(n))},_onDismiss:function(){this._shouldDismiss=!0;this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?e.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))},_setTimeout:function(n,i){return t.setTimeout(n,i)},_clearTimeout:function(n){t.clearTimeout(n)}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return b}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return k}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return d}},_DEFAULT_MESSAGE_DURATION:{get:function(){return g}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return nt}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return tt}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return it}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return rt}},_RESHOW_THRESHOLD:{get:function(){return ut}},_HIDE_DELAY_MAX:{get:function(){return ft}}})})})});t("WinJS/Controls/Rating",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_SafeHtml","./Tooltip","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h){"use strict";t.Namespace.define("WinJS.UI",{Rating:t.Namespace._lazy(function(){var v=r._createEventProperty,o={get averageRating(){return u._getWinJSString("ui/averageRating").value},get clearYourRating(){return u._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return u._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return"Invalid argument: tooltipStrings must be null or an array of strings."},get unrated(){return u._getWinJSString("ui/unrated").value},get userRating(){return u._getWinJSString("ui/userRating").value}},w=5,tt=!1,c="cancel",a="change",l="previewchange",it=0,b=e._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",rt=e._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",k=e._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",d="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",ut="win-rating",ft="win-star win-empty",et="win-star win-average win-empty",y="win-star win-average win-full",g="win-star win-user win-empty",ot="win-star win-user win-full",p="win-star win-tentative win-empty",nt="win-star win-tentative win-full",st="win-disabled",ht="win-average",ct="win-user";return t.Class.define(function(t,i){this._disposed=!1;t=t||n.document.createElement("div");i=i||{};this._element=t;e.addClass(this._element,"win-disposable");this._userRating=0;this._averageRating=0;this._disabled=tt;this._enableClear=!0;this._tooltipStrings=[];this._controlUpdateNeeded=!1;this._setControlSize(i.maxRating);i.tooltipStrings||this._updateTooltips(null);f.setOptions(this,i);this._controlUpdateNeeded=!0;this._forceLayout();e._addInsertedNotifier(this._element);t.winControl=this;this._events()},{maxRating:{get:function(){return this._maxRating},set:function(n){this._setControlSize(n);this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(n){this._userRating=Math.max(0,Math.min(Number(n)>>0,this._maxRating));this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(n){this._averageRating=Number(n)<1?0:Math.min(Number(n)||0,this._maxRating);this._averageRatingElement&&this._ensureAverageMSStarRating();this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(n){this._disabled=!!n;this._disabled&&this._clearTooltips();this._updateTabIndex();this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(n){this._enableClear=!!n;this._setAriaValueMin();this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(n){if("object"!=typeof n)throw new i("WinJS.UI.Rating.TooltipStringsIsInvalid",o.tooltipStringsIsInvalid);this._updateTooltips(n);this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:v(c),onchange:v(a),onpreviewchange:v(l),dispose:function(){if(!this._disposed){this._disposed=!0;for(var n=0;n<this._toolTips.length;n++)this._toolTips[n].dispose();this._toolTips=null}},addEventListener:function(n,t,i){this._element.addEventListener(n,t,i)},removeEventListener:function(n,t,i){return this._element.removeEventListener(n,t,i)},_forceLayout:function(){if(this._controlUpdateNeeded){var n=!1;this._updateControl=function(){n=!0};this.userRating=this._userRating;this.averageRating=this._averageRating;this._lastEventWasChange=!1;this._lastEventWasCancel=!1;this._tentativeRating=-1;this._captured=!1;this._pointerDownFocus=!1;this._elements=[];this._toolTips=[];this._clearElement=null;this._averageRatingElement=null;this._elementWidth=null;this._elementPadding=null;this._elementBorder=null;this._floatingValue=0;this._createControl();this._setAccessibilityProperties();delete this._updateControl;n&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=d)},_createControl:function(){var i,t,n;for(e.addClass(this._element,ut),i="",this._averageRatingHidden=!0,n=0;n<=this._maxRating;n++)i=n===this._maxRating?i+"<div class='"+y+"' style='"+d+"'><\/div>":i+"<div class='"+g+"'><\/div>";for(s.setInnerHTMLUnsafe(this._element,i),t=this._element.firstElementChild,n=0;t;)this._elements[n]=t,n<this._maxRating&&(e.data(t).msStarRating=n+1),t=t.nextElementSibling,n++;this._averageRatingElement=this._elements[this._maxRating];this._ensureAverageMSStarRating();this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider");this._element.setAttribute("aria-valuemax",this._maxRating);this._setAriaValueMin();this._updateAccessibilityRestState()},_getText:function(t){var r=this._tooltipStrings[t],i;return r?(i=n.document.createElement("div"),i.innerHTML=r,i.textContent):t===this._maxRating?o.clearYourRating:t+1},_updateAccessibilityRestState:function(){var n=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect();n.setAttribute("aria-readOnly",this._disabled);0!==this._userRating?(n.setAttribute("aria-valuenow",this._userRating),n.setAttribute("aria-label",o.userRating),n.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(n.setAttribute("aria-valuenow",this._averageRating),n.setAttribute("aria-label",o.averageRating),n.setAttribute("aria-valuetext",this._averageRating)):(n.setAttribute("aria-valuenow",o.unrated),n.setAttribute("aria-label",o.userRating),n.setAttribute("aria-valuetext",o.unrated));this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var n=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect();n.setAttribute("aria-readOnly",this._disabled);this._tentativeRating>0?(n.setAttribute("aria-label",o.tentativeRating),n.setAttribute("aria-valuenow",this._tentativeRating),n.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(n.setAttribute("aria-valuenow",o.unrated),n.setAttribute("aria-label",o.tentativeRating),n.setAttribute("aria-valuetext",this._getText(this._maxRating))):(n.setAttribute("aria-valuenow",o.unrated),n.setAttribute("aria-label",o.tentativeRating),n.setAttribute("aria-valuetext",o.unrated));this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var n=0;n<this._maxRating;n++)this._toolTips[n]=new h.Tooltip(this._elements[n])},_decrementRating:function(){this._closeTooltip();var n=!0;0===this._tentativeRating||-1===this._tentativeRating&&0===this._userRating?n=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(this._tentativeRating=0!==this._userRating&&this._userRating>0?this._userRating-1:0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,n=!1));this._showTentativeRating(n,"keyboard")},_events:function(){function n(n){return{name:n,lowerCaseName:n.toLowerCase(),handler:function(t){var i=u["_on"+n];i&&i.apply(u,[t])}}}for(var u=this,i=[n("KeyDown"),n("FocusOut"),n("FocusIn"),n("PointerCancel"),n("PointerDown"),n("PointerMove"),n("PointerOver"),n("PointerUp"),n("PointerOut")],r=[n("WinJSNodeInserted")],t=0;t<i.length;++t)e._addEventListener(this._element,i[t].lowerCaseName,i[t].handler,!1);for(t=0;t<r.length;++t)this._element.addEventListener(r[t].name,r[t].handler,!1);this._ariaValueNowMutationObserver=new e._MutationObserver(this._ariaValueNowChanged.bind(this));this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onWinJSNodeInserted:function(){this._recalculateStarProperties();this._updateControl()},_recalculateStarProperties:function(){var i=0,t;1===this._averageRating&&(i=1);t=n.getComputedStyle(this._elements[i]);this._elementWidth=t.width;"rtl"===n.getComputedStyle(this._element).direction?(this._elementPadding=t.paddingRight,this._elementBorder=t.borderRight):(this._elementPadding=t.paddingLeft,this._elementBorder=t.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var n=!0;(this._tentativeRating===this._maxRating||-1===this._tentativeRating&&this._userRating===this._maxRating)&&(n=!1);-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:this._tentativeRating=0!==this._userRating?this._userRating<this._maxRating?this._userRating+1:this._maxRating:1;this._showTentativeRating(n,"keyboard")},_ariaValueNowChanged:function(){var n,t;this._disabled||(n=this._element.getAttributeNode("aria-valuenow"),null!==n&&(t=Number(n.nodeValue),this.userRating!==t&&(this.userRating=t,this._tentativeRating=this._userRating,this._raiseEvent(a,this._userRating))))},_onPointerCancel:function(){this._showCurrentRating();this._lastEventWasChange||this._raiseEvent(c,null);this._captured=!1},_onPointerDown:function(n){(n.pointerType!==k||n.button===it)&&(this._captured||(this._pointerDownAt={x:n.clientX,y:n.clientY},this._pointerDownFocus=!0,this._disabled||(e._setPointerCapture(this._element,n.pointerId),this._captured=!0,n.pointerType===b?(this._tentativeRating=e.data(n.target).msStarRating||0,this._setStarClasses(nt,this._tentativeRating,p),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(l,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(t,i){var u,v=this._pointerDownAt||{x:t.clientX,y:t.clientY},h=e._elementsFromPoint(t.clientX,v.y),f,y,o,c,l,s,a,r;if(h)for(f=0,y=h.length;y>f;f++){if(o=h[f],"tooltip"===o.getAttribute("role"))return;if(e.hasClass(o,"win-star")){u=o;break}}u&&u.parentElement===this._element?c=e.data(u).msStarRating||0:(l=0,s=this.maxRating,"rtl"===n.getComputedStyle(this._element).direction&&(l=s,s=0),c=t.clientX<v.x?l:s);a=!1;r=Math.min(Math.ceil(c),this._maxRating);0!==r||this._enableClear||(r=1);r!==this._tentativeRating&&(this._closeTooltip(),a=!0);this._tentativeRating=r;this._showTentativeRating(a,i);t.preventDefault()},_onPointerMove:function(n){this._captured&&(n.pointerType===b?this._onCapturedPointerMove(n,"touch"):this._onCapturedPointerMove(n,"mousedown"))},_onPointerOver:function(n){this._disabled||n.pointerType!==rt&&n.pointerType!==k||this._onCapturedPointerMove(n,"mouseover")},_onPointerUp:function(n){this._captured&&(e._releasePointerCapture(this._element,n.pointerId),this._captured=!1,this._onUserRatingChanged());this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(c,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var n=0;n<this._maxRating;n++)this._elements[n].className=p;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(l,this._userRating):this._raiseEvent(l,0);this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(t){var i=e.Key,r=t.keyCode,h=n.getComputedStyle(this._element).direction,o=!0,u,s,f;switch(r){case i.enter:this._onUserRatingChanged();break;case i.tab:this._onUserRatingChanged();o=!1;break;case i.escape:this._showCurrentRating();this._lastEventWasChange||this._raiseEvent(c,null);break;case i.leftArrow:"rtl"===h?this._incrementRating():this._decrementRating();break;case i.upArrow:this._incrementRating();break;case i.rightArrow:"rtl"===h?this._decrementRating():this._incrementRating();break;case i.downArrow:this._decrementRating();break;default:u=0;(r>=i.num0&&r<=i.num9?u=i.num0:r>=i.numPad0&&r<=i.numPad9&&(u=i.numPad0),u>0)?(s=!1,f=Math.min(r-u,this._maxRating),0!==f||this._enableClear||(f=1),f!==this._tentativeRating&&(this._closeTooltip(),s=!0),this._tentativeRating=f,this._showTentativeRating(s,"keyboard")):o=!1}o&&(t.stopPropagation(),t.preventDefault())},_onPointerOut:function(n){this._captured||e.eventWithinElement(this._element,n)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(c,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(a,this._userRating)))},_raiseEvent:function(t,i){if(!this._disabled&&(this._lastEventWasChange=t===a,this._lastEventWasCancel=t===c,n.document.createEvent)){var r=n.document.createEvent("CustomEvent");r.initCustomEvent(t,!1,!1,{tentativeRating:i});this._element.dispatchEvent(r)}},_resetNextElement:function(t){if(null!==this._averageRatingElement.nextSibling){e._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var i=this._averageRatingElement.nextSibling.style,r=n.getComputedStyle(this._element).direction;t&&(r="rtl"===r?"ltr":"rtl");"rtl"===r?(i.paddingRight=this._elementPadding,i.borderRight=this._elementBorder,i.direction="rtl"):(i.paddingLeft=this._elementPadding,i.borderLeft=this._elementBorder,i.direction="ltr");i.backgroundPosition="left";i.backgroundSize="100% 100%";i.width=this._resizeStringValue(this._elementWidth,1,i.width)}},_resetAverageStar:function(n){this._resetNextElement(n);this._hideAverageRating()},_resizeStringValue:function(n,t,i){var r=parseFloat(n),u;return isNaN(r)?null!==i?i:n:(u=n.substring(r.toString(10).length),r*=t,r+u)},_setControlSize:function(n){var t=(Number(n)||w)>>0;this._maxRating=t>0?t:w},_updateTooltips:function(n){var t,i=0;if(null!==n)for(i=n.length<=this._maxRating+1?n.length:this._maxRating+1,t=0;i>t;t++)this._tooltipStrings[t]=n[t];else{for(t=0;t<this._maxRating;t++)this._tooltipStrings[t]=t+1;this._tooltipStrings[this._maxRating]=o.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(n,t,i){for(var r=0;r<this._maxRating;r++)this._elements[r].className=t>r?n:i},_updateAverageStar:function(){var t=this._averageRatingElement.style,i=this._averageRatingElement.nextSibling.style;"rtl"===n.getComputedStyle(this._element).direction?(t.backgroundPosition="right",t.paddingRight=this._elementPadding,t.borderRight=this._elementBorder,i.paddingRight="0px",i.borderRight="0px",i.direction="ltr"):(t.backgroundPosition="left",i.backgroundPosition="right",t.paddingLeft=this._elementPadding,t.borderLeft=this._elementBorder,i.paddingLeft="0px",i.borderLeft="0px",i.direction="rtl");e._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue});t.width=this._resizeStringValue(this._elementWidth,this._floatingValue,t.width);t.backgroundSize=100/this._floatingValue+"% 100%";t.display=n.getComputedStyle(this._averageRatingElement.nextSibling).display;this._averageRatingHidden=!1;e._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue});i.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,i.width);i.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip();this._tentativeRating=-1;this._disabled||this._updateControl();this._updateAccessibilityRestState()},_showTentativeRating:function(n,t){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(nt,this._tentativeRating,p),this._hideAverageStar());this._updateAccessibilityHoverState();n&&(this._openTooltip(t),this._raiseEvent(l,this._tentativeRating))},_openTooltip:function(t){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(t);else if(0===this._tentativeRating){this._clearElement=n.document.createElement("div");var i=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===n.getComputedStyle(this._element).direction&&(i*=-1);this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+i+"px; top:0px;";this._elements[0].appendChild(this._clearElement);this._toolTips[this._maxRating]=new h.Tooltip(this._clearElement);this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating];this._toolTips[this._maxRating].open(t)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var n=0;n<this._maxRating;n++)this._toolTips[n].innerHTML=null},_appendClass:function(n){for(var t=0;t<=this._maxRating;t++)e.addClass(this._elements[t],n)},_setClasses:function(n,t,i){for(var r=0;r<this._maxRating;r++)this._elements[r].className=t>r?n:i},_ensureAverageMSStarRating:function(){e.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){var t,i;if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating)for(this._setClasses(y,this._averageRating-1,et),this._averageRatingElement.className=y,t=0;t<this._maxRating;t++)t<this._averageRating&&t+1>=this._averageRating&&(this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[t]),this._floatingValue=this._averageRating-t,i=n.getComputedStyle(this._elements[t]),this._elementWidth=i.width,"rtl"===n.getComputedStyle(this._element).direction?(this._elementPadding=i.paddingRight,this._elementBorder=i.borderRight):(this._elementPadding=i.paddingLeft,this._elementBorder=i.borderLeft),this._updateAverageStar());0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(ot,this._userRating,g),this._resetAverageStar(!1));0===this._userRating&&0===this._averageRating&&(this._setClasses(ft,this._maxRating),this._resetAverageStar(!1));this.disabled&&this._appendClass(st);this._appendClass(0!==this._averageRating&&0===this._userRating?ht:ct);this._updateAccessibilityRestState()}}})})})});t("WinJS/Controls/ToggleSwitch",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/controls"],function(n,t,i,r,u,f,e){"use strict";t.Namespace.define("WinJS.UI",{ToggleSwitch:t.Namespace._lazy(function(){var w="win-toggleswitch",b="win-toggleswitch-header",k="win-toggleswitch-clickregion",d="win-toggleswitch-track",i="win-toggleswitch-fill",g="win-toggleswitch-fill-lower",nt="win-toggleswitch-fill-upper",tt="win-toggleswitch-thumb",it="win-toggleswitch-values",o="win-toggleswitch-value",rt="win-toggleswitch-value-on",ut="win-toggleswitch-value-off",ft="win-toggleswitch-description",s="win-toggleswitch-on",h="win-toggleswitch-off",c="win-toggleswitch-disabled",l="win-toggleswitch-enabled",a="win-toggleswitch-dragging",v="win-toggleswitch-pressed",y={get on(){return u._getWinJSString("ui/on").value},get off(){return u._getWinJSString("ui/off").value}},p=t.Class.define(function(t,r){t=t||n.document.createElement("div");this._domElement=t;e.addClass(this._domElement,w);this._domElement.innerHTML=['<div class="'+b+'"><\/div>','<div class="'+it+'">','   <div class="'+o+" "+rt+'"><\/div>','   <div class="'+o+" "+ut+'"><\/div>',"<\/div>",'<div class="'+k+'">','   <div class="'+d+'">','       <div class="'+i+" "+g+'"><\/div>','       <div class="'+tt+'"><\/div>','       <div class="'+i+" "+nt+'"><\/div>',"   <\/div>","<\/div>",'<div class="'+ft+'"><\/div>'].join("\n");this._headerElement=this._domElement.firstElementChild;this._labelsElement=this._headerElement.nextElementSibling;this._labelOnElement=this._labelsElement.firstElementChild;this._labelOffElement=this._labelOnElement.nextElementSibling;this._clickElement=this._labelsElement.nextElementSibling;this._trackElement=this._clickElement.firstElementChild;this._fillLowerElement=this._trackElement.firstElementChild;this._thumbElement=this._fillLowerElement.nextElementSibling;this._fillUpperElement=this._thumbElement.nextElementSibling;this._descriptionElement=this._clickElement.nextElementSibling;this._headerElement.setAttribute("aria-hidden",!0);this._labelsElement.setAttribute("aria-hidden",!0);this._headerElement.setAttribute("id",e._uniqueID(this._headerElement));this._domElement.setAttribute("aria-labelledby",this._headerElement.id);this._domElement.setAttribute("role","checkbox");this._domElement.winControl=this;e.addClass(this._domElement,"win-disposable");this._domElement.addEventListener("keydown",this._keyDownHandler.bind(this));e._addEventListener(this._clickElement,"pointerdown",this._pointerDownHandler.bind(this));e._globalListener.addEventListener(this._domElement,"pointermove",this._pointerMoveHandler.bind(this));e._globalListener.addEventListener(this._domElement,"pointerup",this._pointerUpHandler.bind(this));this._mutationObserver=new e._MutationObserver(this._ariaChangedHandler.bind(this));this._mutationObserver.observe(this._domElement,{attributes:!0,attributeFilter:["aria-checked"]});this._dragX=0;this._dragging=!1;this.checked=!1;this.disabled=!1;this.labelOn=y.on;this.labelOff=y.off;f.setOptions(this,r)},{element:{get:function(){return this._domElement}},checked:{get:function(){return this._checked},set:function(n){n=!!n;n!==this.checked&&(this._checked=n,this._domElement.setAttribute("aria-checked",n),n?(e.addClass(this._domElement,s),e.removeClass(this._domElement,h)):(e.addClass(this._domElement,h),e.removeClass(this._domElement,s)),this.dispatchEvent("change"))}},disabled:{get:function(){return this._disabled},set:function(n){n=!!n;n!==this._disabled&&(n?(e.addClass(this._domElement,c),e.removeClass(this._domElement,l)):(e.removeClass(this._domElement,c),e.addClass(this._domElement,l)),this._disabled=n,this._domElement.setAttribute("aria-disabled",n),this._domElement.setAttribute("tabIndex",n?-1:0))}},labelOn:{get:function(){return this._labelOnElement.innerHTML},set:function(n){this._labelOnElement.innerHTML=n}},labelOff:{get:function(){return this._labelOffElement.innerHTML},set:function(n){this._labelOffElement.innerHTML=n}},title:{get:function(){return this._headerElement.innerHTML},set:function(n){this._headerElement.innerHTML=n}},onchange:r._createEventProperty("change"),dispose:function(){this._disposed||(this._disposed=!0)},_ariaChangedHandler:function(){var n=this._domElement.getAttribute("aria-checked");n="true"===n?!0:!1;this.checked=n},_keyDownHandler:function(n){this.disabled||(n.keyCode===e.Key.space&&(this.checked=!this.checked),(n.keyCode===e.Key.rightArrow||n.keyCode===e.Key.upArrow)&&(this.checked=!0),(n.keyCode===e.Key.leftArrow||n.keyCode===e.Key.downArrow)&&(this.checked=!1))},_pointerDownHandler:function(n){this.disabled||(n.preventDefault(),this._mousedown=!0,this._dragXStart=n.pageX-this._trackElement.offsetLeft-this._thumbElement.offsetWidth/2,this._dragX=this._dragXStart,this._dragging=!1,e.addClass(this._domElement,v))},_pointerUpHandler:function(t){var r,i;!this.disabled&&this._mousedown&&(t=t.detail.originalEvent,t.preventDefault(),r="rtl"===n.getComputedStyle(this._domElement).direction,this._dragging?(i=this._trackElement.offsetWidth-this._thumbElement.offsetWidth,this.checked=r?this._dragX<i/2:this._dragX>=i/2,this._dragging=!1,e.removeClass(this._domElement,a)):this.checked=!this.checked,this._mousedown=!1,this._thumbElement.style.left="",this._fillLowerElement.style.width="",this._fillUpperElement.style.width="",e.removeClass(this._domElement,v))},_pointerMoveHandler:function(n){if(!this.disabled&&this._mousedown){n=n.detail.originalEvent;n.preventDefault();var r=n.pageX-this._trackElement.offsetLeft-this._thumbElement.offsetWidth/2,t=this._trackElement.offsetWidth-this._thumbElement.offsetWidth,i=this._fillLowerElement.offsetLeft+this._trackElement.clientLeft;this._dragX=Math.min(t,r);this._dragX=Math.max(0,this._dragX);!this._dragging&&Math.abs(this._dragX-this._dragXStart)>3&&(this._dragging=!0,e.addClass(this._domElement,a));this._thumbElement.style.left=this._dragX+"px";this._fillLowerElement.style.width=this._dragX-i+"px";this._fillUpperElement.style.width=t-this._dragX-i+"px"}}});return t.Class.mix(p,f.DOMEventMixin),p})})});t("WinJS/Controls/SemanticZoom",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";t.Namespace.define("WinJS.UI",{SemanticZoom:t.Namespace._lazy(function(){function ft(n){return n}function d(n,t,i){return n+" "+s._animationTimeAdjustment(t)+"s "+i+" "+s._libraryDelay+"ms"}function et(){return d(w.cssName,li,"ease-in-out")+", "+d("opacity",vt,"ease-in-out")}function ot(){return d(w.cssName,ai,"ease-in-out")+", "+d("opacity",ci,"ease-in-out")}function gt(){return d(w.cssName,yi,pt)}function ni(){return d(w.cssName,pi,pt)}function k(n,t){return v.convertToPixels(n,t)}function g(n,t){s.isAnimationEnabled()&&(n.style[w.scriptName]="scale("+t+")")}function nt(n){var t=n.target&&n.target.winControl;t&&!t._resizing&&t._onResize()}function ti(n){var t=n[0].target&&n[0].target.winControl;t&&t instanceof it&&t._onPropertyChanged()}var b=i._browserStyleEquivalents,ii={get invalidZoomFactor(){return"Invalid zoomFactor"}},ri="win-semanticzoom-button",ui="win-semanticzoom-button-location",fi=3e3,st=8,ei="win-semanticzoom",oi="win-semanticzoom-zoomedinview",si="win-semanticzoom-zoomedoutview",hi="zoomchanged",tt=1.05,ht=.65,ct=.8,lt=.2,at=4096,vt=.333,ci=.333,li=.333,ai=.333,yt=1e3*vt,vi=50,yi=.333,pi=.333,pt="cubic-bezier(0.1,0.9,0.2,1)",w=b.transform,rt=b.transition.scriptName,wt=2,wi=.2,bi=.45,ki=1e3,bt=50,f={none:0,zoomedIn:1,zoomedOut:2},ut=v._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",kt=v._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",di=v._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",dt={x:0,y:0},it=t.Class.define(function(t,u){var o,f,s,e;if(this._disposed=!1,o=this,f=i.isPhone,this._element=t,this._element.winControl=this,v.addClass(this._element,"win-disposable"),v.addClass(this._element,ei),this._element.setAttribute("role","ms-semanticzoomcontainer"),s=this._element.getAttribute("aria-label"),s||this._element.setAttribute("aria-label",""),u=u||{},this._zoomedOut=!!u.zoomedOut||!!u.initiallyZoomedOut||!1,this._enableButton=!f,f||void 0===u.enableButton||(this._enableButton=!!u.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=v._clamp(u.zoomFactor,lt,ct,ht),this.zoomedInItem=u.zoomedInItem,this.zoomedOutItem=u.zoomedOutItem,i.validation&&u._zoomFactor&&u._zoomFactor!==this._zoomFactor)throw new r("WinJS.UI.SemanticZoom.InvalidZoomFactor",ii.invalidZoomFactor);this._locked=!!u.locked;this._zoomInProgress=!1;this._isBouncingIn=!1;this._isBouncing=!1;this._zooming=!1;this._aligning=!1;this._gesturing=!1;this._gestureEnding=!1;this._buttonShown=!1;this._shouldFakeTouchCancel="TouchEvent"in n;this._initialize();this._configure();e=n.document.body.contains(this._element);v._addInsertedNotifier(this._element);this._element.addEventListener("WinJSNodeInserted",function(n){return e?void(e=!1):void nt(n)},!1);this._element.addEventListener("mselementresize",nt);v._resizeNotifier.subscribe(this._element,nt);new v._MutationObserver(ti).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]});f||(this._element.addEventListener("wheel",this._onWheel.bind(this),!0),this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),v._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),v._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),v._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),v._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),v._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords());this._onResizeImpl();l._setOptions(this,u,!0);o._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(n){var t=!!n;this._enableButton===t||i.isPhone||(this._enableButton=t,t?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(n){this._zoom(!!n,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&i.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(n){var i=this._zoomFactor,t=v._clamp(n,lt,ct,ht);i!==t&&(this._zoomFactor=t,this._onResize())}},locked:{get:function(){return this._locked},set:function(n){this._locked=!!n;n?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(n){this._zoomedInItem=n||ft}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(n){this._zoomedOutItem=n||ft}},dispose:function(){this._disposed||(this._disposed=!0,v._resizeNotifier.unsubscribe(this._element,nt),a._disposeElement(this._elementIn),a._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var t=y.children(this._element);this._elementIn=t[0];this._elementOut=t[1];this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px";h.processAll(this._elementIn);h.processAll(this._elementOut);this._viewIn=this._elementIn.winControl.zoomableView;this._viewOut=this._elementOut.winControl.zoomableView;this._element.removeChild(this._elementOut);this._element.removeChild(this._elementIn);this._element.innerHTML="";this._cropViewport=n.document.createElement("div");this._element.appendChild(this._cropViewport);this._viewportIn=n.document.createElement("div");this._opticalViewportIn=n.document.createElement("div");this._viewportOut=n.document.createElement("div");this._opticalViewportOut=n.document.createElement("div");this._opticalViewportIn.appendChild(this._viewportIn);this._opticalViewportOut.appendChild(this._viewportOut);this._cropViewport.appendChild(this._opticalViewportIn);this._cropViewport.appendChild(this._opticalViewportOut);this._canvasIn=n.document.createElement("div");this._canvasOut=n.document.createElement("div");this._viewportIn.appendChild(this._canvasIn);this._viewportOut.appendChild(this._canvasOut);this._canvasIn.appendChild(this._elementIn);this._canvasOut.appendChild(this._elementOut);this._enableButton&&this._createSemanticZoomButton();this._hiddenElement=n.document.createElement("div");this._hiddenElement.tabIndex=-1;this._hiddenElement.visibility="hidden";this._hiddenElement.setAttribute("aria-hidden","true");this._element.appendChild(this._hiddenElement);v.addClass(this._elementIn,oi);v.addClass(this._elementOut,si);this._setLayout(this._element,"relative","hidden");this._setLayout(this._cropViewport,"absolute","hidden");this._setLayout(this._opticalViewportIn,"absolute","auto");this._setLayout(this._opticalViewportOut,"absolute","auto");this._setLayout(this._viewportIn,"absolute","hidden");this._setLayout(this._viewportOut,"absolute","hidden");this._setLayout(this._canvasIn,"absolute","hidden");this._setLayout(this._canvasOut,"absolute","hidden");this._setupOpticalViewport(this._opticalViewportIn);this._setupOpticalViewport(this._opticalViewportOut);this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar";this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar";this._elementIn.style.position="absolute";this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=n.document.createElement("button");this._sezoButton.className=ri+" "+ui;this._sezoButton.tabIndex=-1;this._sezoButton.style.visibility="hidden";this._sezoButton.setAttribute("aria-hidden",!0);this._element.appendChild(this._sezoButton);this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1);this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0);v._addEventListener(this._element,"pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var n=this._viewIn.getPanAxis(),t=this._viewOut.getPanAxis(),r=i.isPhone,e,o;if(this._pansHorizontallyIn="horizontal"===n||"both"===n,this._pansVerticallyIn="vertical"===n||"both"===n,this._pansHorizontallyOut="horizontal"===t||"both"===t,this._pansVerticallyOut="vertical"===t||"both"===t,!this._zoomInProgress){e=1/this._zoomFactor-1;o=tt-1;this._setLayout(this._elementIn,"absolute","visible");this._setLayout(this._elementOut,"absolute","visible");this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),e);this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),o);this._pinching=!1;this._pinchGesture=0;this._canvasLeftIn=0;this._canvasTopIn=0;this._canvasLeftOut=0;this._canvasTopOut=0;r||(this._zoomedOut?g(this._canvasIn,this._zoomFactor):g(this._canvasOut,1/this._zoomFactor));var u=this._opticalViewportIn.style,f=this._opticalViewportOut.style,h=this._canvasIn.style,c=this._canvasOut.style;h.opacity=this._zoomedOut&&!r?0:1;c.opacity=this._zoomedOut?1:0;r&&(h.zIndex=1,c.zIndex=2);s.isAnimationEnabled()&&!r&&(u[b["transition-property"].scriptName]=w.cssName,u[b["transition-duration"].scriptName]="0s",u[b["transition-timing-function"].scriptName]="linear",f[b["transition-property"].scriptName]=w.cssName,f[b["transition-duration"].scriptName]="0s",f[b["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var t=this._element.getAttribute("aria-checked"),n="true"===t;this._zoomedOut!==n&&(this.zoomedOut=n)},_onResizeImpl:function(){this._resizing=this._resizing||0;this._resizing++;try{var r=function(n,t,i,r,u){var f=n.style;f.left=t+"px";f.top=i+"px";f.width=r+"px";f.height=u+"px"},u=n.getComputedStyle(this._element,null),f=parseFloat(u.width),e=parseFloat(u.height),o=k(this._element,u.paddingLeft),p=k(this._element,u.paddingRight),s=k(this._element,u.paddingTop),w=k(this._element,u.paddingBottom),t=f-o-p,i=e-s-w,b=1/this._zoomFactor;if(this._viewportWidth===t&&this._viewportHeight===i)return;this._sezoClientHeight=e;this._sezoClientWidth=f;this._viewportWidth=t;this._viewportHeight=i;this._configure();var h=2*b-1,c=Math.min(at,(this._pansHorizontallyIn?h:1)*t),l=Math.min(at,(this._pansVerticallyIn?h:1)*i);this._canvasLeftIn=.5*(c-t);this._canvasTopIn=.5*(l-i);r(this._cropViewport,o,s,t,i);r(this._viewportIn,0,0,t,i);r(this._opticalViewportIn,0,0,t,i);r(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,c,l);r(this._elementIn,this._canvasLeftIn,this._canvasTopIn,t,i);var a=2*tt-1,v=(this._pansHorizontallyOut?a:1)*t,y=(this._pansVerticallyOut?a:1)*i;this._canvasLeftOut=.5*(v-t);this._canvasTopOut=.5*(y-i);r(this._viewportOut,0,0,t,i);r(this._opticalViewportOut,0,0,t,i);r(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,v,y);r(this._elementOut,this._canvasLeftOut,this._canvasTopOut,t,i)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(n){return this._zooming||!this._lastMouseX&&!this._lastMouseY||n.screenX===this._lastMouseX&&n.screenY===this._lastMouseY?(this._lastMouseX=n.screenX,void(this._lastMouseY=n.screenY)):void(Math.abs(n.screenX-this._lastMouseX)<=st&&Math.abs(n.screenY-this._lastMouseY)<=st||(this._lastMouseX=n.screenX,this._lastMouseY=n.screenY,this._displayButton()))},_displayButton:function(){if(p.isHoverable){n.clearTimeout(this._dismissButtonTimer);this._showSemanticZoomButton();var t=this;this._dismissButtonTimer=n.setTimeout(function(){t._hideSemanticZoomButton()},s._animationTimeAdjustment(fi))}},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(o.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(n){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(n)this._sezoButton.style.visibility="hidden";else{var t=this;o.fadeOut(this._sezoButton).then(function(){t._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(n){n.target!==this.element&&this._hideSemanticZoomButton(!0)},_onWheel:function(n){n.ctrlKey&&(this._zoom(n.deltaY>0,this._getPointerLocation(n)),n.stopPropagation(),n.preventDefault())},_onMouseWheel:function(n){n.ctrlKey&&(this._zoom(n.wheelDelta<0,this._getPointerLocation(n)),n.stopPropagation(),n.preventDefault())},_onPenHover:function(n){n.pointerType===kt&&0===n.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton();this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(n){var i=!1,t;if(n.ctrlKey){t=v.Key;switch(n.keyCode){case t.add:case t.equal:case 61:this._zoom(!1);i=!0;break;case t.subtract:case t.dash:case 173:this._zoom(!0);i=!0}}i&&(n.stopPropagation(),n.preventDefault())},_createPointerRecord:function(n,t){var r=this._getPointerLocation(n),i={};return i.startX=i.currentX=r.x,i.startY=i.currentY=r.y,i.fireCancelOnPinch=t,this._pointerRecords[n.pointerId]=i,this._pointerCount=Object.keys(this._pointerRecords).length,i},_deletePointerRecord:function(n){var t=this._pointerRecords[n];return delete this._pointerRecords[n],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),t},_fakeCancelOnPointer:function(t){var i=n.document.createEvent("UIEvent");i.initUIEvent("touchcancel",!0,!0,n,0);i.touches=t.touches;i.targetTouches=t.targetTouches;i.changedTouches=[t._currentTouch];i._fakedBySemanticZoom=!0;t.target.dispatchEvent(i)},_handlePointerDown:function(n){this._createPointerRecord(n,!1);for(var i=Object.keys(this._pointerRecords),t=0,r=i.length;r>t;t++)try{v._setPointerCapture(this._hiddenElement,i[t]||0)}catch(u){return void this._resetPointerRecords()}n.stopImmediatePropagation();n.preventDefault()},_handleFirstPointerDown:function(n){this._resetPointerRecords();this._createPointerRecord(n,this._shouldFakeTouchCancel);this._startedZoomedOut=this._zoomedOut},_onClick:function(n){n.target!==this._element&&this._isBouncing&&n.stopImmediatePropagation()},_onPointerDown:function(n){n.pointerType===ut&&(0===this._pointerCount?this._handleFirstPointerDown(n):this._handlePointerDown(n))},_onPointerMove:function(n){function c(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))}function o(n,t){return{x:.5*(n.currentX+t.currentX)|0,y:.5*(n.currentY+t.currentY)|0}}var i,s;if(n.pointerType===di||n.pointerType===kt)return void this._onMouseMove(n);if(n.pointerType===ut&&(i=this._pointerRecords[n.pointerId],s=this._getPointerLocation(n),i)){if(i.currentX=s.x,i.currentY=s.y,2===this._pointerCount){this._pinching=!0;var h=Object.keys(this._pointerRecords),r=this._pointerRecords[h[0]],u=this._pointerRecords[h[1]];this._currentMidPoint=o(r,u);var l=c(r.currentX,r.currentY,u.currentX,u.currentY),t=this,a=function(n){var i=n?f.zoomedOut:f.zoomedIn,h=n?t._pinchedDirection===f.zoomedIn&&!t._zoomingOut:t._pinchedDirection===f.zoomedOut&&t._zoomingOut,c=n?!t._zoomedOut:t._zoomedOut,e,s;t._pinchedDirection===f.none?c?(t._isBouncingIn=!1,t._zoom(n,o(r,u),!0),t._pinchedDirection=i):t._isBouncingIn||t._playBounce(!0,o(r,u)):h&&(e=t._lastPinchDistance/t._lastPinchStartDistance,s=t._lastLastPinchDistance/t._lastPinchDistance,(n&&e>wi||!n&&s>bi)&&(t._zoom(n,o(r,u),!0),t._pinchedDirection=i))};this._updatePinchDistanceRecords(l);this._pinchDistanceCount>=wt&&(this._zooming||this._isBouncing||(e("WinJS.UI.SemanticZoom:EndPinchDetection,info"),a(this._lastPinchDirection===f.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(i.fireCancelOnPinch&&(this._fakeCancelOnPointer(n,i),i.fireCancelOnPinch=!1),n.stopImmediatePropagation(),n.preventDefault());2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}},_onPointerOut:function(n){n.pointerType===ut&&n.target===this._element&&this._completePointerUp(n,!1)},_onPointerUp:function(n){this._releasePointerCapture(n);this._completePointerUp(n,!0);this._completeZoomingIfTimeout()},_onPointerCancel:function(n){n._fakedBySemanticZoom||(this._releasePointerCapture(n),this._completePointerUp(n,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(n){var t=this._pointerRecords[n.pointerId];t&&(t.dirty=!1)},_onLostPointerCapture:function(n){var t=this._pointerRecords[n.pointerId],i;t&&(t.dirty=!0,i=this,c.timeout(bt).then(function(){t.dirty&&i._completePointerUp(n,!1)}))},_onMSContentZoom:function(n){var t=n.target,i,r;(t===this._opticalViewportIn||t===this._opticalViewportOut)&&(i=t.msContentZoomFactor<.995,r=t.msContentZoomFactor>1.005,!i||this._zoomedOut||this._zoomingOut?r&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0)},_updatePinchDistanceRecords:function(n){function i(i){t._lastPinchDirection===i?t._pinchDistanceCount++:(t._pinchGesture++,t._pinchDistanceCount=0,t._lastPinchStartDistance=n);t._lastPinchDirection=i;t._lastPinchDistance=n;t._lastLastPinchDistance=t._lastPinchDistance}var t=this;-1===this._lastPinchDistance?(e("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=n):this._lastPinchDistance!==n&&i(this._lastPinchDistance>n?f.zoomedOut:f.zoomedIn)},_zoomFromCurrent:function(n){this._zoom(n,null,!1,!0)},_zoom:function(n,t,r,u,f){var o;if(e("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+n+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!r)return;n!==this._zoomingOut&&this._startAnimations(n)}else if(n!==this._zoomedOut){this._zooming=!0;this._aligning=!0;this._gesturing=!!r;t&&(n?this._viewIn:this._viewOut).setCurrentItem(t.x,t.y);this._zoomInProgress=!0;(n?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible";n&&i.isPhone&&(this._canvasOut.style.opacity=1);var h=this._viewIn.beginZoom(),l=this._viewOut.beginZoom(),s=null;((h||l)&&i.isPhone&&(s=c.join([h,l])),u&&!f)?(o=this,(n?this._viewIn:this._viewOut).getCurrentItem().then(function(t){var i=t.position;o._prepareForZoom(n,{x:o._rtl()?o._sezoClientWidth-i.left-.5*i.width:i.left+.5*i.width,y:i.top+.5*i.height},c.wrap(t),s)})):this._prepareForZoom(n,t||{},null,s,f)}},_prepareForZoom:function(t,i,r,u,f){function c(n,t){o._canvasIn.style[b["transform-origin"].scriptName]=o._canvasLeftIn+s-n.x+"px "+(o._canvasTopIn+h-n.y)+"px";o._canvasOut.style[b["transform-origin"].scriptName]=o._canvasLeftOut+s-t.x+"px "+(o._canvasTopOut+h-t.y)+"px"}e("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var o=this,s=i.x,h=i.y;"number"==typeof s&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(s=.5*this._sezoClientWidth);"number"==typeof h&&this._pansVerticallyIn&&this._pansVerticallyOut||(h=.5*this._sezoClientHeight);c(dt,dt);f?this._aligning=!1:this._alignViewsPromise=this._alignViews(t,s,h,r).then(function(){o._aligning=!1;o._gestureEnding=!1;o._alignViewsPromise=null;o._zooming||o._gesturing||o._completeZoom()});this._zoomingOut=t;n.getComputedStyle(this._canvasIn).opacity;n.getComputedStyle(this._canvasOut).opacity;e("WinJS.UI.SemanticZoom:prepareForZoom,StopTM");this._startAnimations(t,u)},_alignViews:function(n,t,i,r){var o=1-this._zoomFactor,l=this._rtl(),s=o*(l?this._viewportWidth-t:t),h=o*i,u=this,f,e;if(n){if(f=r||this._viewIn.getCurrentItem(),f)return f.then(function(n){var t=n.position,i={left:t.left*u._zoomFactor+s,top:t.top*u._zoomFactor+h,width:t.width*u._zoomFactor,height:t.height*u._zoomFactor};return u._viewOut.positionItem(u._zoomedOutItem(n.item),i)})}else if(e=r||this._viewOut.getCurrentItem(),e)return e.then(function(n){var t=n.position,i={left:(t.left-s)/u._zoomFactor,top:(t.top-h)/u._zoomFactor,width:t.width/u._zoomFactor,height:t.height/u._zoomFactor};return u._viewIn.positionItem(u._zoomedInItem(n.item),i)});return new c(function(n){n({x:0,y:0})})},_startAnimations:function(n,t){var r,u,f;this._zoomingOut=n;r=i.isPhone;(s.isAnimationEnabled()&&!r&&(e("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[rt]=n?et():ot(),this._canvasOut.style[rt]=n?ot():et()),r||(g(this._canvasIn,n?this._zoomFactor:1),g(this._canvasOut,n?1:1/this._zoomFactor)),this._canvasIn.style.opacity=n&&!r?0:1,(!r||n)&&(this._canvasOut.style.opacity=n?1:0),s.isAnimationEnabled())?t?(u=this,f=function(){u._canvasIn.style[w.scriptName]="";u._canvasOut.style[w.scriptName]="";u._onZoomAnimationComplete()},t.then(f,f)):this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),s._animationTimeAdjustment(yt)):(this._zooming=!1,this._canvasIn.style[w.scriptName]="",this._canvasOut.style[w.scriptName]="",this._completeZoom())},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){e("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM");this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(n){if(!this._disposed)return n.target!==this._canvasOut&&n.target!==this._canvasIn||!this._isBouncing?void(n.target===this._canvasIn&&n.propertyName===w.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(t){t&&n.clearTimeout(t)},_completePointerUp:function(n,t){if(!this._disposed){var i=n.pointerId,r=this._pointerRecords[i];if(r&&(this._deletePointerRecord(i),this._isBouncingIn&&this._playBounce(!1),t&&this._pinchedDirection!==f.none&&n.stopImmediatePropagation(),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==f.none&&this._pinchDistanceCount<wt)return this._zoom(this._lastPinchDirection===f.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==f.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom());this._pinchGesture=0;this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(t,i){var r=this;r._TTFFTimer=n.setTimeout(function(){this._disposed||(r._TTFFTimer=n.setTimeout(t,i))},vi)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var t=this;(this._zoomInProgress||this._isBouncing)&&(t._completeZoomTimer=n.setTimeout(function(){t._completeZoom()},s._animationTimeAdjustment(ki)))}},_completeZoom:function(){var t,r;if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);this._zoomInProgress&&(e("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!i.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1,t=!1,(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),t=!0),this._setVisibility(),t)&&(r=n.document.createEvent("CustomEvent"),r.initCustomEvent(hi,!0,!0,this._zoomedOut),this._element.dispatchEvent(r),this._isActive&&v._setActive(this._zoomedOut?this._elementOut:this._elementIn)),e("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info"))}},_isActive:function(){var t=n.document.activeElement;return this._element===t||this._element.contains(t)},_setLayout:function(n,t,i){var r=n.style;r.position=t;r.overflow=i},_setupOpticalViewport:function(n){n.style["-ms-overflow-style"]="none";i.isPhone||(n.style["-ms-content-zooming"]="zoom",n.style["-ms-content-zoom-limit-min"]="99%",n.style["-ms-content-zoom-limit-max"]="101%",n.style["-ms-content-zoom-snap-points"]="snapList(100%)",n.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function n(n,t){n.style.visibility=t?"visible":"hidden";n.style.zIndex=t?"1":"0"}n(this._opticalViewportIn,!this._zoomedOut||i.isPhone);n(this._opticalViewportOut,this._zoomedOut);this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut);this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=f.none;this._pointerCount=0;this._pointerRecords={};this._resetPinchDistanceRecords()},_releasePointerCapture:function(n){var t=n.pointerId;try{v._releasePointerCapture(this._hiddenElement,t)}catch(i){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var n=this;this._recordResetPromise=c.timeout(bt).then(function(){0===n._pointerCount&&(n._resetPointerRecords(),n._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=f.none;this._lastPinchDistance=-1;this._lastLastPinchDistance=-1;this._pinchDistanceCount=0;this._currentMidPoint=null},_getPointerLocation:function(t){var i={left:0,top:0};try{i=this._element.getBoundingClientRect()}catch(o){}var r=n.getComputedStyle(this._element,null),f=k(this._element,r.paddingLeft),u=k(this._element,r.paddingTop),e=k(this._element,r.borderLeftWidth);return{x:+t.clientX===t.clientX?t.clientX-i.left-f-e:0,y:+t.clientY===t.clientY?t.clientY-i.top-u-u:0}},_playBounce:function(n,t){var r;if(s.isAnimationEnabled()&&this._isBouncingIn!==n){this._clearTimeout(this._completeZoomTimer);this._clearTimeout(this._TTFFTimer);this._isBouncing=!0;this._isBouncingIn=n;n?this._bounceCenter=t:this._aligned=!0;var i=this._zoomedOut?this._canvasOut:this._canvasIn,u=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,f=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;i.style[b["transform-origin"].scriptName]=u+this._bounceCenter.x+"px "+(f+this._bounceCenter.y)+"px";i.style[rt]=n?gt():ni();this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();r=n?this._zoomedOut?2-tt:tt:1;g(i,r);this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),s._animationTimeAdjustment(yt))}},_rtl:function(){return"rtl"===n.getComputedStyle(this._element,null).direction},_pinching:{set:function(n){this._viewIn.pinching=n;this._viewOut.pinching=n}}});return t.Class.mix(it,u.createEventProperties("zoomchanged")),t.Class.mix(it,l.DOMEventMixin),it})})});t("WinJS/Controls/Pivot/_Constants",[],function(){"use strict";return{_ClassName:{pivot:"win-pivot",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch",pivotDisableContentSwipeNavigation:"win-pivot-disablecontentswipenavigation"}}});t("WinJS/Controls/Pivot/_Item",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{PivotItem:i.Namespace._lazy(function(){var f={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},n=i.Class.define(function(i,r){var o,s;if(i=i||t.document.createElement("DIV"),r=r||{},i.winControl)throw new u("WinJS.UI.PivotItem.DuplicateConstruction",f.duplicateConstruction);for(i.winControl=this,this._element=i,l.addClass(this.element,n._ClassName.pivotItem),l.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=n._ClassName.pivotItemContent,i.appendChild(this._contentElement),o=this.element.firstChild;o!==this._contentElement;)s=o.nextSibling,this._contentElement.appendChild(o),o=s;this._processors=[e.processAll];h.setOptions(this,r)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(n){this._header=n;this._parentPivot&&this._parentPivot._headersState.handleHeaderChanged(this)}},_parentPivot:{get:function(){for(var n=this._element;n&&!l.hasClass(n,a._ClassName.pivot);)n=n.parentNode;return n&&n.winControl}},_process:function(){var n=this;return this._processors&&this._processors.push(function(){return s.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(t,i){return t.then(function(){return i(n.contentElement)})},this._processed||o.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,c.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:r.markSupportedForProcessing(function(n,t){t!==e.processAll&&(n._processors=n._processors||[],n._processors.push(t),n._processed&&n._process())})});return n})})});t("WinJS/Controls/Pivot",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_TabContainer","../Utilities/_KeyboardBehavior","./Pivot/_Constants","./Pivot/_Item","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";t.Namespace.define("WinJS.UI",{Pivot:t.Namespace._lazy(function(){function lt(t){return n.document.createTextNode("object"==typeof t.header?JSON.stringify(t.header):""+t.header)}function ft(){}var at=b._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",st=b._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",ot=b.Key,ht=u._createEventProperty,et={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},rt=b._MSManipulationEvent,it=!1,ct=null,tt={nop:{exit:ft,render:ft,activateHeader:ft,handleNavigation:ft,handleResize:ft,handleHeaderChanged:ft},common:{headersContainerLeadingMargin:9,getCumulativeHeaderWidth:function(n,t){var r,u,i;if(0===t)return 0;for(r=n._headersContainerElement.children.length,i=0;t>i;i++)u=tt.common.renderHeader(n,i,!1),n._headersContainerElement.appendChild(u);var f=0,o=n._rtl?n._headersContainerElement.lastElementChild:n._headersContainerElement.children[r],e=n._rtl?n._headersContainerElement.children[r]:n._headersContainerElement.lastElementChild;for(f=e.offsetLeft+e.offsetWidth-o.offsetLeft,i=0;t>i;i++)n._headersContainerElement.removeChild(n._headersContainerElement.lastElementChild);return f},refreshHeadersState:function(n,t){t&&(this._cachedWidth=0);var i=this._cachedWidth||this.getCumulativeHeaderWidth(n,n.items.length);this._cachedWidth=i;i>n._viewportWidth&&!(n._headersState instanceof tt.overflowState)?(n._headersState.exit(),n._headersState=new tt.overflowState(n)):i<=n._viewportWidth&&!(n._headersState instanceof tt.staticState)&&(n._headersState.exit(),n._headersState=new tt.staticState(n))},renderHeader:function(t,i,r){function e(){t._disposed||t._headersContainerElement.contains(u)&&i!==t.selectedIndex&&"true"===u.getAttribute("aria-selected")&&(t.selectedIndex=i)}var o=b._syncRenderer(lt),f=t._items.getAt(i),u=n.document.createElement("BUTTON");return b.addClass(u,k._ClassName.pivotHeader),u._item=f,u._pivotItemIndex=i,o(f,u),r&&(u.setAttribute("aria-selected",i===t.selectedIndex),u.setAttribute("role","tab"),new b._MutationObserver(e).observe(u,{attributes:!0,attributeFilter:["aria-selected"]})),u},updateHeader:function(n,t){var u=n.items.indexOf(t),i=n._headersContainerElement.children[u],r;i.innerHTML="";r=b._syncRenderer(lt);r(t,i)},setActiveHeader:function(t,i){var r=!1;i&&(i.classList.remove(k._ClassName.pivotHeaderSelected),i.setAttribute("aria-selected",!1),r=n.document.activeElement===i);t.classList.add(k._ClassName.pivotHeaderSelected);t.setAttribute("aria-selected",!0);r&&t.focus()}},staticState:t.Class.define(function(n){var e;if(this.pivot=n,this._firstRender=!0,this._transitionAnimation=a.wrap(),n._headersContainerElement.children.length&&h.isAnimationEnabled()){var u=n._headersContainerElement.querySelector("."+k._ClassName.pivotHeaderSelected),t=0,r=0;n._rtl?(t=u.offsetLeft,t+=u.offsetWidth,r=n._viewportWidth-tt.common.getCumulativeHeaderWidth(n,n.selectedIndex)-tt.common.headersContainerLeadingMargin,r+=parseFloat(n._headersContainerElement.style.marginLeft)):(t=u.offsetLeft,t+=parseFloat(n._headersContainerElement.style.marginLeft),r=tt.common.getCumulativeHeaderWidth(n,n.selectedIndex)+tt.common.headersContainerLeadingMargin);e=t-r;this.render();for(var o=i._browserStyleEquivalents.transform.cssName,s="translateX("+e+"px)",f=0,c=n._headersContainerElement.children.length;c>f;f++)n._headersContainerElement.children[f].style[o]=s;this._transitionAnimation=h.executeTransition(n._headersContainerElement.querySelectorAll("."+k._ClassName.pivotHeader),{property:o,delay:0,duration:k._headerSlideAnimationDuration,timing:"ease-out",to:""})}},{exit:function(){this._transitionAnimation.cancel()},render:function(){var n=this.pivot,t,i;if(!n._pendingRefresh&&n._items){if(w._disposeElement(n._headersContainerElement),b.empty(n._headersContainerElement),n._rtl?(n._headersContainerElement.style.marginLeft="0px",n._headersContainerElement.style.marginRight=tt.common.headersContainerLeadingMargin+"px"):(n._headersContainerElement.style.marginLeft=tt.common.headersContainerLeadingMargin+"px",n._headersContainerElement.style.marginRight="0px"),n._viewportElement.style.overflow=1===n.items.length?"hidden":"",n.items.length){for(t=0;t<n.items.length;t++)i=tt.common.renderHeader(n,t,!0),n._headersContainerElement.appendChild(i),t===n.selectedIndex&&i.classList.add(k._ClassName.pivotHeaderSelected);n._tabContainer.childFocus=n._headersContainerElement.children[n.selectedIndex]}this._firstRender=!1}},activateHeader:function(n){var t=this.pivot._headersContainerElement.children[this.pivot.selectedIndex];tt.common.setActiveHeader(n,t);this.pivot._animateToPrevious=n._pivotItemIndex<this.pivot.selectedIndex;this.pivot.selectedIndex=n._pivotItemIndex},handleNavigation:function(n,t,i){this._firstRender&&this.render();tt.common.setActiveHeader(this.pivot._headersContainerElement.children[t],this.pivot._headersContainerElement.children[i]);this.pivot._tabContainer.childFocus=this.pivot._headersContainerElement.children[t]},handleResize:function(){tt.common.refreshHeadersState(this.pivot)},handleHeaderChanged:function(n){tt.common.updateHeader(this.pivot,n);tt.common.refreshHeadersState(this.pivot,!0)}}),overflowState:t.Class.define(function(n){var u,f,s,r,c;if(this.pivot=n,this._blocked=!1,this._firstRender=!0,this._transitionAnimation=a.wrap(),n._slideHeadersAnimation=a.wrap(),n._headersContainerElement.children.length&&h.isAnimationEnabled()){u=this;f=function(){u._blocked=!1;u.render()};this._blocked=!0;var e=n._headersContainerElement.querySelector("."+k._ClassName.pivotHeaderSelected),o=0,t=0;for(n._rtl?(o=n._viewportWidth-tt.common.headersContainerLeadingMargin,t=e.offsetLeft,t+=e.offsetWidth,t+=parseFloat(n._headersContainerElement.style.marginLeft)):(o=tt.common.headersContainerLeadingMargin,t=e.offsetLeft,t+=parseFloat(n._headersContainerElement.style.marginLeft)),s=o-t,r=0;r<n.selectedIndex;r++)n._headersContainerElement.appendChild(n._headersContainerElement.children[r].cloneNode(!0));c=i._browserStyleEquivalents.transform.cssName;this._transitionAnimation=h.executeTransition(n._headersContainerElement.querySelectorAll("."+k._ClassName.pivotHeader),{property:c,delay:0,duration:k._headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+s+"px)"}).then(f,f)}},{exit:function(){this._transitionAnimation.cancel();this.pivot._slideHeadersAnimation.cancel()},render:function(t){var r=this.pivot,p,d,s,u,c,f,l,a,e,g,y;if(!this._blocked&&!r._pendingRefresh&&r._items){if(p=r._headersContainerElement.contains(n.document.activeElement),w._disposeElement(r._headersContainerElement),b.empty(r._headersContainerElement),d=.8*r._viewportWidth+"px",1===r._items.length)f=tt.common.renderHeader(r,0,!0),f.classList.add(k._ClassName.pivotHeaderSelected),r._headersContainerElement.appendChild(f),r._viewportElement.style.overflow="hidden",r._headersContainerElement.style.marginLeft="0px",r._headersContainerElement.style.marginRight="0px";else if(r._items.length>1){for(s=r._items.length+(t?2:1),u=r.selectedIndex-1,r._viewportElement.style.overflow&&(r._viewportElement.style.overflow=""),c=0;s>c;c++)-1===u?u=r._items.length-1:u===r._items.length&&(u=0),f=tt.common.renderHeader(r,u,!0),f.style.maxWidth=d,r._headersContainerElement.appendChild(f),u===r.selectedIndex&&f.classList.add(k._ClassName.pivotHeaderSelected),u++;r._firstLoad||this._firstRender||(t?(l="",a="0"):(l="0",a=""),e=r._headersContainerElement.children[s-1],e.style.opacity=l,g=.167,e.style[i._browserStyleEquivalents.transition.scriptName]="opacity "+h._animationTimeAdjustment(g)+"s",n.getComputedStyle(e).opacity,e.style.opacity=a);r._headersContainerElement.children[0].setAttribute("aria-hidden","true");r._headersContainerElement.style.marginLeft="0px";r._headersContainerElement.style.marginRight="0px";var nt=r._rtl?"marginRight":"marginLeft",it=r._rtl?"paddingLeft":"paddingRight",o=r._headersContainerElement.children[0],v=o.offsetWidth+parseFloat(n.getComputedStyle(o)[nt])-parseFloat(n.getComputedStyle(o)[it]);if(o!==r._headersContainerElement.children[0])return;r._headersContainerElement.style[nt]=-1*v+"px";r._prevButton=n.document.createElement("button");b.addClass(r._prevButton,k._ClassName.pivotNavButton);b.addClass(r._prevButton,k._ClassName.pivotNavButtonPrev);r._prevButton.addEventListener("click",function(){r.locked||(r._rtl?r._goNext():r._goPrevious())});r._headersContainerElement.appendChild(r._prevButton);r._prevButton.style.left=r._rtl?"0px":v+"px";r._nextButton=n.document.createElement("button");b.addClass(r._nextButton,k._ClassName.pivotNavButton);b.addClass(r._nextButton,k._ClassName.pivotNavButtonNext);r._nextButton.addEventListener("click",function(){r.locked||(r._rtl?r._goPrevious():r._goNext())});r._headersContainerElement.appendChild(r._nextButton);r._nextButton.style.right=r._rtl?v+"px":"0px"}y=r._headersContainerElement.children.length>1?1:0;r._tabContainer.childFocus=r._headersContainerElement.children[y];p&&r._headersContainerElement.children[y].focus();this._firstRender=!1}},activateHeader:function(n){n.previousSibling&&(this.pivot.selectedIndex=n._pivotItemIndex)},handleNavigation:function(n,t,r){function s(n){return e?n.offsetParent.offsetWidth-n.offsetLeft-n.offsetWidth:n.offsetLeft}function c(){u._disposed||(u._headersState.render(n),u._slideHeadersAnimation=a.wrap())}var u=this.pivot,f,e,o,l;if(this._blocked||0>t||u._firstLoad||(n?f=u._headersContainerElement.children[0]:(r>t&&(t+=u._items.length),f=u._headersContainerElement.children[1+t-r]),!f))return void this.render(n);b.removeClass(u._headersContainerElement.children[1],k._ClassName.pivotHeaderSelected);b.addClass(f,k._ClassName.pivotHeaderSelected);e=u._rtl;o=s(u._headersContainerElement.children[1])-s(f);e&&(o*=-1);l=h.isAnimationEnabled()?h.executeTransition(u._headersContainerElement.querySelectorAll("."+k._ClassName.pivotHeader),{property:i._browserStyleEquivalents.transform.cssName,delay:0,duration:k._headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+o+"px)"}):a.wrap();u._slideHeadersAnimation=l.then(c,c)},handleResize:function(){tt.common.refreshHeadersState(this.pivot)},handleHeaderChanged:function(){this.render();tt.common.refreshHeadersState(this.pivot,!0)}})},k=t.Class.define(function(t,u){if(ct||(ct=b._detectSnapPointsSupport().then(function(n){it=n})),t=t||n.document.createElement("DIV"),u=u||{},t.winControl)throw new r("WinJS.UI.Pivot.DuplicateConstruction",ut.duplicateConstruction);this._handleItemChangedBound=this._handleItemChanged.bind(this);this._handleItemInsertedBound=this._handleItemInserted.bind(this);this._handleItemMovedBound=this._handleItemMoved.bind(this);this._handleItemRemovedBound=this._handleItemRemoved.bind(this);this._handleItemReloadBound=this._handleItemReload.bind(this);this._id=t.id||b._uniqueID(t);this._writeProfilerMark("constructor,StartTM");t.winControl=this;this._element=t;this._element.setAttribute("role","tablist");this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",ut.pivotAriaLabel);b.addClass(this.element,k._ClassName.pivot);b.addClass(this.element,"win-disposable");b._addEventListener(this.element,"pointerenter",this._updatePointerType.bind(this));b._addEventListener(this.element,"pointerout",this._updatePointerType.bind(this));this._pointerType=at;this._titleElement=n.document.createElement("DIV");this._titleElement.style.display="none";b.addClass(this._titleElement,k._ClassName.pivotTitle);this._element.appendChild(this._titleElement);this._headersContainerElement=n.document.createElement("DIV");b.addClass(this._headersContainerElement,k._ClassName.pivotHeaders);this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this));this._element.appendChild(this._headersContainerElement);this._element.addEventListener("click",this._elementClickedHandler.bind(this));b._addEventListener(this._element,"pointerdown",this._elementPointerDownHandler.bind(this));b._addEventListener(this._element,"pointerup",this._elementPointerUpHandler.bind(this));b._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this));b._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this));this._winKeyboard=new g._WinKeyboard(this._headersContainerElement);this._tabContainer=new d.TabContainer(this._headersContainerElement);this._viewportElement=n.document.createElement("DIV");this._viewportElement.className=k._ClassName.pivotViewport;this._element.appendChild(this._viewportElement);this._viewportElement.setAttribute("role","group");this._viewportElement.setAttribute("aria-label",ut.pivotViewportAriaLabel);this._resizeHandlerBound=this._resizeHandler.bind(this);this.element.addEventListener("mselementresize",this._resizeHandlerBound);b._resizeNotifier.subscribe(this.element,this._resizeHandlerBound);this._viewportWidth=null;this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this));this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this));b._addEventListener(this._viewportElement,"pointerdown",this._pointerDownHandler.bind(this));this._surfaceElement=n.document.createElement("DIV");this._surfaceElement.className=k._ClassName.pivotSurface;this._viewportElement.appendChild(this._surfaceElement);this._offsetFromCenter=0;this._currentIndexOnScreen=0;this._loadId=0;this._navMode=k._NavigationModes.none;this._currentManipulationState=rt.MS_MANIPULATION_STATE_STOPPED;this._headersState=tt.nop;this._parse();u=i._shallowCopy(u);u.items&&(this.items=u.items,delete u.items);p.setOptions(this,u);this._refresh();this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},locked:{get:function(){return b.hasClass(this.element,k._ClassName.pivotLocked)},set:function(n){b[n?"addClass":"removeClass"](this.element,k._ClassName.pivotLocked);n&&this._hideNavButtons()}},items:{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(n){var t=!this._pendingItems;this._pendingItems=n;this._refresh();t&&(this._pendingIndexOnScreen=0)}},title:{get:function(){return this._titleElement.textContent},set:function(n){n?(this._titleElement.style.display="block",this._titleElement.textContent=n):(this._titleElement.style.display="none",this._titleElement.textContent="")}},selectedIndex:{get:function(){return 0===this.items.length?-1:+this._pendingIndexOnScreen===this._pendingIndexOnScreen?this._pendingIndexOnScreen:this._currentIndexOnScreen},set:function(n){n>=0&&n<this.items.length&&(this._pendingRefresh?this._pendingIndexOnScreen=n:(this._navMode=this._navMode||k._NavigationModes.api,this._loadItem(n)))}},selectedItem:{get:function(){return this.items.getAt(this.selectedIndex)},set:function(n){var t=this.items.indexOf(n);-1!==t&&(this.selectedIndex=t)}},dispose:function(){if(!this._disposed){this._disposed=!0;this._updateEvents(this._items);b._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound);this._headersState.exit();w._disposeElement(this._headersContainerElement);for(var n=0,t=this.items.length;t>n;n++)this.items.getAt(n).dispose()}},forceLayout:function(){this._disposed||this._resizeHandler()},onselectionchanged:ht(et.selectionChanged),onitemanimationstart:ht(et.itemAnimationStart),onitemanimationend:ht(et.itemAnimationEnd),_currentScrollTargetLocation:{get:function(){return this._viewportWidth===k._invalidViewportWidth?0:(50+this._offsetFromCenter)*Math.ceil(this._viewportWidth)}},_pointerType:{get:function(){return this._pointerTypeValue},set:function(n){this._pointerTypeValue!==n&&(this._pointerTypeValue=n,n===st?(b.removeClass(this.element,k._ClassName.pivotInputTypeMouse),b.addClass(this.element,k._ClassName.pivotInputTypeTouch),this._hideNavButtons()):(b.removeClass(this.element,k._ClassName.pivotInputTypeTouch),b.addClass(this.element,k._ClassName.pivotInputTypeMouse)))}},_rtl:{get:function(){return this._cachedRTL}},_viewportWidth:{get:function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(n.getComputedStyle(this._viewportElement).width),it&&(this._viewportElement.style[i._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||k._invalidViewportWidth},set:function(n){this._viewportElWidth=n}},_applyProperties:function(){var i,r,t;if(!this._disposed){if(this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;)i=this.element.firstElementChild,i.parentNode.removeChild(i);b.empty(this._surfaceElement)}this._attachItems();r=this._pendingIndexOnScreen;this._pendingIndexOnScreen=null;this._currentIndexOnScreen=0;this._firstLoad=!0;this._cachedRTL="rtl"===n.getComputedStyle(this._element,null).direction;t=this;ct.done(function(){tt.common.refreshHeadersState(t,!0);it||b.addClass(t.element,k._ClassName.pivotNoSnap);t._pendingRefresh=!1;t.selectedIndex=Math.min(r,t.items.length-1);t._firstLoad=!1;t._recenterUI()})}},_attachItems:function(){var t,i,n;for(this._measured=!1,t=0,i=this.items.length;i>t;t++){if(n=this._items.getAt(t),n.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Pivot.DuplicateItem",ut.duplicateItem);n.element.style.visibility="hidden";n.element.style.opacity=0;this._surfaceElement.appendChild(n.element)}},_parse:function(){for(var i,u,t=[],n=this.element.firstElementChild;n!==this._titleElement;){if(l.processAll(n),i=n.winControl,!i)throw new r("WinJS.UI.Pivot.InvalidContent",ut.invalidContent);t.push(i);u=n.nextElementSibling;n=u}this.items=new c.List(t)},_refresh:function(){this._pendingRefresh||(this._pendingRefresh=!0,v.schedule(this._applyProperties.bind(this),v.Priority.high))},_resizeHandler:function(){if(!this._disposed&&!this._pendingRefresh){var n=this._viewportWidth;this._viewportWidth=null;n!==this._viewportWidth?(f.log&&f.log("_resizeHandler from:"+n+" to: "+this._viewportWidth),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterUI(),this._headersState.handleResize()):f.log&&f.log("_resizeHandler worthless resize")}},_activateHeader:function(n){if(!this.locked){var t=this._items.indexOf(n._item);t!==this.selectedIndex?this._headersState.activateHeader(n):b._setActiveFirstFocusableElement(this.selectedItem.element)}},_goNext:function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},_goPrevious:function(){this._animateToPrevious=!0;this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1;this._animateToPrevious=!1},_loadItem:function(t){var u=this._animateToPrevious,e,o,r,s,i,h;this._cachedRTL="rtl"===n.getComputedStyle(this._element,null).direction;this._loadId++;e=this._loadId;this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel();this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel();this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel();this._currentItem&&this._hidePivotItem(this._currentItem.element,u);o=this._currentIndexOnScreen;(this._currentIndexOnScreen=t,this._headersState.handleNavigation(u,t,o),0>t)||(r=this._items.getAt(t),this._currentItem=r,u?this._offsetFromCenter--:t!==o&&this._offsetFromCenter++,s=!1,it&&b._supportsZoomTo&&this._currentManipulationState!==rt.MS_MANIPULATION_STATE_INERTIA&&(this._firstLoad?(f.log&&f.log("_firstLoad index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),b.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation})):(f.log&&f.log("zoomTo index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),this._viewportElement.msZoomTo({contentX:this._currentScrollTargetLocation,contentY:0,viewportX:0,viewportY:0}),s=0!==this._offsetFromCenter&&this.items.length>1)),i=this,h={index:t,direction:u?"backwards":"forward",item:r},this._writeProfilerMark("selectionChanged,info"),this._fireEvent(k._EventName.selectionChanged,!0,!1,h),r._process().then(function(){if(!i._disposed&&e===i._loadId){it?(r.element.style[i._getDirectionAccessor()]=i._currentScrollTargetLocation+"px",i._showPivotItem(r.element,u)):i._hidePivotItemAnimation?i._showPivotItemAnimation=i._hidePivotItemAnimation.then(function(){if(!i._disposed&&e===i._loadId)return i._showPivotItem(r.element,u)}):i._showPivotItem(r.element,u);var n;s?(i._stoppedAndRecenteredSignal||(i._stoppedAndRecenteredSignal=new y),n=i._stoppedAndRecenteredSignal.promise):n=a.wrap();a.join([i._slideHeadersAnimation,i._showPivotItemAnimation,i._hidePivotItemAnimation]).then(function(){n.then(function(){a.timeout(50).then(function(){i._disposed||e!==i._loadId||(i._navMode=k._NavigationModes.none,i._writeProfilerMark("itemAnimationStop,info"),i._fireEvent(k._EventName.itemAnimationEnd,!0))})})})}}))},_MSManipulationStateChangedHandler:function(n){var i,t,r;(this._currentManipulationState=n.currentState,it&&n.target===this._viewportElement)&&((this._currentManipulationState===rt.MS_MANIPULATION_STATE_STOPPED?f.log&&f.log("MSManipulation: Stopped","winjs pivot","log"):this._currentManipulationState===rt.MS_MANIPULATION_STATE_INERTIA?f.log&&f.log("MSManipulation: Inertia","winjs pivot","log"):f.log&&f.log("MSManipulation: Active","winjs pivot","log"),this._stoppedAndRecenteredSignal||(this._stoppedAndRecenteredSignal=new y),this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel(),this._currentManipulationState===rt.MS_MANIPULATION_STATE_STOPPED)?(this._navMode===k._NavigationModes.scroll&&this._scrollHandler(),this._navMode=k._NavigationModes.none,i=this,this._manipulationRecenterPromise=a._cancelBlocker(a.join([v.schedulePromiseNormal(null,"WinJS.UI.Pivot._MSManipulationStateChangedHandler_animationPlaceholder"),this._hidePivotItemAnimation,this._showPivotItemAnimation,this._slideHeadersAnimation])).then(function(){i._disposed||(i._currentManipulationState===rt.MS_MANIPULATION_STATE_STOPPED?(f.log&&f.log("Still in Stopped state: calling _recenterUI","winjs pivot","log"),i._recenterUI()):(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null))})):this._currentManipulationState===rt.MS_MANIPULATION_STATE_INERTIA&&(t=n.inertiaDestinationX,+t===t&&(f.log&&f.log("MSManipulation: inertiaDestinationX: "+t),r=t-this._currentScrollTargetLocation,r>0?(f.log&&f.log("MSManipulation: Inertia diff > 1","winjs pivot","log"),this._navMode=k._NavigationModes.inertia,this._goNext()):0>r&&(f.log&&f.log("MSManipulation: Stopped diff < -1","winjs pivot","log"),this._navMode=k._NavigationModes.inertia,this._goPrevious()))))},_scrollHandler:function(){if(it&&!this._disposed){if(this._recentering&&this._stoppedAndRecenteredSignal)return this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null,void(this._recentering=!1);if((this._navMode===k._NavigationModes.none||this._navMode===k._NavigationModes.scroll)&&(this._navMode=k._NavigationModes.scroll,this._currentManipulationState===rt.MS_MANIPULATION_STATE_STOPPED)){f.log&&f.log("_scrollHandler ScrollPosition: "+b.getScrollPosition(this._viewportElement).scrollLeft,"winjs pivot","log");var t=b.getScrollPosition(this._viewportElement).scrollLeft-this._currentScrollTargetLocation;this._cachedRTL="rtl"===n.getComputedStyle(this._element,null).direction;t>0?(f.log&&f.log("_scrollHandler diff > 1: "+t,"winjs pivot","log"),this._goNext()):0>t&&(f.log&&f.log("_scrollHandler diff < -1: "+t,"winjs pivot","log"),this._goPrevious())}}},_recenterUI:function(){it&&(this._offsetFromCenter=0,b.getScrollPosition(this._viewportElement).scrollLeft!==this._currentScrollTargetLocation?(this._recentering=!0,this._stoppedAndRecenteredSignal=this._stoppedAndRecenteredSignal||new y):this._stoppedAndRecenteredSignal&&(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._currentScrollTargetLocation+"px"),f.log&&f.log("_recenterUI index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation),b.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation}))},_hidePivotItem:function(n,t){function i(){r._disposed||(r._hidePivotItemAnimation=null,n.style.visibility="hidden",n.style.opacity=0)}var r=this,u=this._rtl&&!t||t&&!this._rtl;this._hidePivotItemAnimation=h.isAnimationEnabled()?s[u?"slideRightOut":"slideLeftOut"](n):v.schedulePromiseNormal(null,"WinJS.UI.Pivot._hidePivotItem_animationPlaceholder");this._hidePivotItemAnimation.then(i,i)},_showPivotItem:function(n,t){function i(n){var t=n.getBoundingClientRect();return t.top<c.bottom&&t.bottom>c.top}function o(){e._disposed||(e._showPivotItemAnimation=null)}var l,e;if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(k._EventName.itemAnimationStart,!0),!h.isAnimationEnabled())return n.style.visibility="",n.style.opacity="",void(this._showPivotItemAnimation=null);var r=n.querySelectorAll(".win-pivot-slide1"),u=n.querySelectorAll(".win-pivot-slide2"),f=n.querySelectorAll(".win-pivot-slide3"),c=this._viewportElement.getBoundingClientRect();return r=Array.prototype.filter.call(r,i),u=Array.prototype.filter.call(u,i),f=Array.prototype.filter.call(f,i),l=this._rtl&&!t||t&&!this._rtl,n.style.visibility="",this._showPivotItemAnimation=s[l?"slideRightIn":"slideLeftIn"](n,r,u,f),e=this,this._showPivotItemAnimation.then(o,o),this._showPivotItemAnimation},_elementClickedHandler:function(n){var r,u,f,t,i,e;if(this.locked||this._navigationHandled)return void(this._navigationHandled=!1);if(u=n.target,b.hasClass(u,k._ClassName.pivotHeader))r=u;else{if(f=!1,t=b._elementsFromPoint(n.clientX,n.clientY),t&&t[0]===this._viewportElement)for(i=0,e=t.length;e>i;i++)t[i]===u&&(f=!0),b.hasClass(t[i],k._ClassName.pivotHeader)&&(r=t[i]);f||(r=null)}r&&this._activateHeader(r)},_headersKeyDown:function(n){this.locked||(n.keyCode===ot.leftArrow||n.keyCode===ot.pageUp?this._rtl?this._goNext():this._goPrevious():(n.keyCode===ot.rightArrow||n.keyCode===ot.pageDown)&&(this._rtl?this._goPrevious():this._goNext()))},_elementPointerDownHandler:function(n){it||(n.preventDefault(),this._elementPointerDownPoint={x:n.clientX,y:n.clientY,type:n.pointerType||"mouse",time:Date.now(),inHeaders:this._headersContainerElement.contains(n.target)})},_elementPointerUpHandler:function(n){var u,r,i;if(!this._elementPointerDownPoint||this.locked)return void(this._elementPointerDownPoint=null);var f=Math.abs(n.clientY-this._elementPointerDownPoint.y),t=n.clientX-this._elementPointerDownPoint.x,e=Math.abs(t*.4),o=e>f&&Math.abs(t)>32&&(!b._supportsTouchDetection||this._elementPointerDownPoint.type===n.pointerType&&n.pointerType===st)&&(!this.element.classList.contains(nt._ClassName.pivotDisableContentSwipeNavigation)||this._elementPointerDownPoint.inHeaders&&this._headersContainerElement.contains(n.target));if((this._navigationHandled=!1,o)&&(u=Date.now()-this._elementPointerDownPoint.time,t*=Math.max(1,Math.pow(350/u,2)),t=this._rtl?-t:t,r=this._viewportWidth/4,-r>t?(this._goNext(),this._navigationHandled=!0):t>r&&(this._goPrevious(),this._navigationHandled=!0)),!this._navigationHandled){for(i=n.target;null!==i&&!b.hasClass(i,k._ClassName.pivotHeader);)i=i.parentElement;null!==i&&(this._activateHeader(i),this._navigationHandled=!0)}this._elementPointerDownPoint=null},_hideNavButtons:function(n){n&&this._headersContainerElement.contains(n.relatedTarget)||b.removeClass(this._headersContainerElement,k._ClassName.pivotShowNavButtons)},_pointerDownHandler:function(){f.log&&f.log("_pointerDown","winjs pivot","log");this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel();this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel();this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel()},_showNavButtons:function(n){this.locked||n&&n.pointerType===st||b.addClass(this._headersContainerElement,k._ClassName.pivotShowNavButtons)},_handleItemChanged:function(n){if(!this._pendingItems){var u=n.detail.index,t=n.detail.newValue,i=n.detail.oldValue;if(t.element!==i.element){if(t.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Pivot.DuplicateItem",ut.duplicateItem);t.element.style.visibility="hidden";t.element.style.opacity=0;this._surfaceElement.insertBefore(t.element,i.element);this._surfaceElement.removeChild(i.element);u===this._currentIndexOnScreen&&(this.selectedIndex=this._currentIndexOnScreen)}this._headersState.render();tt.common.refreshHeadersState(this,!0)}},_handleItemInserted:function(n){if(!this._pendingItems){var i=n.detail.index,t=n.detail.value;if(t.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Pivot.DuplicateItem",ut.duplicateItem);t.element.style.visibility="hidden";t.element.style.opacity=0;i<this.items.length-1?this._surfaceElement.insertBefore(t.element,this.items.getAt(i+1).element):this._surfaceElement.appendChild(t.element);i<=this._currentIndexOnScreen&&this._currentIndexOnScreen++;1===this._items.length&&(this.selectedIndex=0);this._headersState.render();tt.common.refreshHeadersState(this,!0)}},_handleItemMoved:function(n){if(!this._pendingItems){var i=n.detail.oldIndex,t=n.detail.newIndex,r=n.detail.value;t<this.items.length-1?this._surfaceElement.insertBefore(r.element,this.items.getAt(t+1).element):this._surfaceElement.appendChild(r.element);i<this._currentIndexOnScreen&&t>=this._currentIndexOnScreen?this._currentIndexOnScreen--:t>this._currentIndexOnScreen&&i<=this._currentIndexOnScreen?this._currentIndexOnScreen++:i===this._currentIndexOnScreen&&(this.selectedIndex=t);this._headersState.render();tt.common.refreshHeadersState(this,!0)}},_handleItemReload:function(){this.items=this.items},_handleItemRemoved:function(n){if(!this._pendingItems){var i=n.detail.value,t=n.detail.index;this._surfaceElement.removeChild(i.element);t<this._currentIndexOnScreen?this._currentIndexOnScreen--:t===this._currentIndexOnScreen&&(this.selectedIndex=Math.min(this.items.length-1,this._currentIndexOnScreen));this._headersState.render();tt.common.refreshHeadersState(this,!0)}},_fireEvent:function(t,i,r,u){var f=n.document.createEvent("CustomEvent");return f.initCustomEvent(t,!!i,!!r,u),this.element.dispatchEvent(f)},_getDirectionAccessor:function(){return this._rtl?"right":"left"},_updateEvents:function(n,t){n&&(n.removeEventListener("itemchanged",this._handleItemChangedBound),n.removeEventListener("iteminserted",this._handleItemInsertedBound),n.removeEventListener("itemmoved",this._handleItemMovedBound),n.removeEventListener("itemremoved",this._handleItemRemovedBound),n.removeEventListener("reload",this._handleItemReloadBound));t&&(t.addEventListener("itemchanged",this._handleItemChangedBound),t.addEventListener("iteminserted",this._handleItemInsertedBound),t.addEventListener("itemmoved",this._handleItemMovedBound),t.addEventListener("itemremoved",this._handleItemRemovedBound),t.addEventListener("reload",this._handleItemReloadBound))},_updatePointerType:function(n){this._pointerType=n.pointerType||at},_writeProfilerMark:function(n){var t="WinJS.UI.Pivot:"+this._id+":"+n;o(t);f.log&&f.log(t,null,"pivotprofiler")}},{_invalidViewportWidth:-1,_headerSlideAnimationDuration:250,_ClassName:nt._ClassName,_EventName:{selectionChanged:et.selectionChanged,itemAnimationStart:et.itemAnimationStart,itemAnimationEnd:et.itemAnimationEnd},_NavigationModes:{api:"api",inertia:"inertia",none:"",scroll:"scroll"}}),ut;return t.Class.mix(k,p.DOMEventMixin),ut={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateItem(){return e._getWinJSString("ui/duplicateItem").value},get invalidContent(){return"Invalid content: Pivot content must be made up of PivotItems."},get pivotAriaLabel(){return e._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return e._getWinJSString("ui/pivotViewportAriaLabel").value}},k})})});t("WinJS/Controls/Hub/_Section",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{HubSection:i.Namespace._lazy(function(){var f={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},n=i.Class.define(function(i,r){var o,h;if(i=i||t.document.createElement("DIV"),r=r||{},i.winControl)throw new u("WinJS.UI.HubSection.DuplicateConstruction",f.duplicateConstruction);for(i.winControl=this,this._element=i,c.addClass(this.element,n._ClassName.hubSection),c.addClass(this.element,"win-disposable"),this._headerElement=t.document.createElement("DIV"),this._headerElement.className=n._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+n._ClassName.hubSectionInteractive+" "+n._ClassName.hubSectionHeaderTabStop+'"><div class="'+n._ClassName.hubSectionHeaderWrapper+'" tabindex="-1"><h2 class="'+n._ClassName.hubSectionHeaderContent+" "+n._Constants.ellipsisTypeClassName+" "+n._Constants.xLargeTypeClassName+'"><\/h2><span class="'+n._ClassName.hubSectionHeaderChevron+" "+n._Constants.ellipsisTypeClassName+" "+n._Constants.xLargeTypeClassName+'"><\/span><\/div><\/button>',this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,i.appendChild(this._headerElement),this._winKeyboard=new l._WinKeyboard(this._headerElement),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=n._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",i.appendChild(this._contentElement),o=this.element.firstChild;o!==this._headerElement;)h=o.nextSibling,this._contentElement.appendChild(o),o=h;this._processors=[e.processAll];s.setOptions(this,r)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(t){this._isHeaderStatic=t;this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),c.removeClass(this._headerTabStopElement,n._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),c.addClass(this._headerTabStopElement,n._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(n){this._header=n;this._renderHeader()}},_setHeaderTemplate:function(n){this._template=c._syncRenderer(n);this._renderHeader()},_renderHeader:function(){this._template&&(h._disposeElement(this._headerContentElement),c.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var n=this;return this._processed=(this._processors||[]).reduce(function(t,i){return t.then(function(){return i(n.contentElement)})},this._processed||o.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,h._disposeElement(this._headerContentElement),h.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},_Constants:{ellipsisTypeClassName:"win-type-ellipsis",xLargeTypeClassName:"win-type-x-large"},isDeclarativeControlContainer:r.markSupportedForProcessing(function(n,t){t!==e.processAll&&(n._processors=n._processors||[],n._processors.push(t),n._processed&&n._process())})});return n})})});t("WinJS/Controls/Hub",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_UI","./Hub/_Section","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";t.Namespace.define("WinJS.UI",{Hub:t.Namespace._lazy(function(){function rt(t){return n.document.createTextNode("object"==typeof t.header?JSON.stringify(t.header):""+t.header)}var g=w.Key,it=u._createEventProperty,tt={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},ft=500,et={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},ot={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},st={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},b=t.Class.define(function(t,i){if(t=t||n.document.createElement("DIV"),i=i||{},t.winControl)throw new r("WinJS.UI.Hub.DuplicateConstruction",nt.duplicateConstruction);this._id=t.id||w._uniqueID(t);this._writeProfilerMark("constructor,StartTM");this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this);n.addEventListener("keydown",this._windowKeyDownHandlerBound);t.winControl=this;this._element=t;w.addClass(this.element,b._ClassName.hub);w.addClass(this.element,"win-disposable");this._viewportElement=n.document.createElement("DIV");this._viewportElement.className=b._ClassName.hubViewport;this._element.appendChild(this._viewportElement);this._viewportElement.setAttribute("role","group");this._viewportElement.setAttribute("aria-label",nt.hubViewportAriaLabel);this._surfaceElement=n.document.createElement("DIV");this._surfaceElement.className=b._ClassName.hubSurface;this._viewportElement.appendChild(this._surfaceElement);this._visible=!1;this._viewportElement.style.opacity=0;i.orientation||(this._orientation=k.Orientation.horizontal,w.addClass(this.element,b._ClassName.hubHorizontal));this._fireEntrance=!0;this._animateEntrance=!0;this._loadId=0;this.runningAnimations=new a.wrap;this._currentIndexForSezo=0;this._parse();p.setOptions(this,i);w._addEventListener(this.element,"focusin",this._focusin.bind(this),!1);this.element.addEventListener("keydown",this._keyDownHandler.bind(this));this.element.addEventListener("click",this._clickHandler.bind(this));this._resizeHandlerBound=this._resizeHandler.bind(this);this.element.addEventListener("mselementresize",this._resizeHandlerBound);w._resizeNotifier.subscribe(this.element,this._resizeHandlerBound);this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this));this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this));this._handleSectionChangedBind=this._handleSectionChanged.bind(this);this._handleSectionInsertedBind=this._handleSectionInserted.bind(this);this._handleSectionMovedBind=this._handleSectionMoved.bind(this);this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this);this._handleSectionReloadBind=this._handleSectionReload.bind(this);this._refresh();this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(n){if(n!==this._orientation){if(this._measured=!1,this._names){var t={};t[this._names.scrollPos]=0;w.setScrollPosition(this._viewportElement,t)}n===k.Orientation.vertical?(w.removeClass(this.element,b._ClassName.hubHorizontal),w.addClass(this.element,b._ClassName.hubVertical)):(n=k.Orientation.horizontal,w.removeClass(this.element,b._ClassName.hubVertical),w.addClass(this.element,b._ClassName.hubHorizontal));this._orientation=n;y.schedule(this._updateSnapList.bind(this),y.Priority.idle)}}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(n){var t=!this._pendingSections;this._pendingSections=n;this._refresh();t&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=rt),this._headerTemplate)},set:function(n){this._pendingHeaderTemplate=n||rt;this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(n){var t,i;(n=Math.max(0,n),this._pendingRefresh)?(this._pendingScrollLocation=n,this._pendingSectionOnScreen=null):(this._measure(),t=Math.max(0,Math.min(this._scrollLength-this._viewportSize,n)),this._scrollPosition=t,i={},i[this._names.scrollPos]=t,w.setScrollPosition(this._viewportElement,i))}},sectionOnScreen:{get:function(){var t,n;if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;for(this._measure(),t=0;t<this._sectionSizes.length;t++)if(n=this._sectionSizes[t],n.offset+n.size-n.borderEnd-n.paddingEnd>this._scrollPosition+this._startSpacer+n.borderStart+n.paddingStart)return t;return-1},set:function(n){n=Math.max(0,n);this._pendingRefresh?(this._pendingSectionOnScreen=n,this._pendingScrollLocation=null):(this._measure(),n>=0&&n<this._sectionSizes.length&&this._scrollToSection(n))}},indexOfFirstVisible:{get:function(){var n,t;for(this._measure(),n=0;n<this._sectionSizes.length;n++)if(t=this._sectionSizes[n],t.offset+t.size-t.borderEnd-t.paddingEnd>this._scrollPosition)return n;return-1}},indexOfLastVisible:{get:function(){var n,t;for(this._measure(),n=this._sectionSizes.length-1;n>=0;n--)if(t=this._sectionSizes[n],t.offset+t.paddingStart+t.borderStart<this._scrollPosition+this._viewportSize)return n;return-1}},onheaderinvoked:it(tt.headerInvoked),onloadingstatechanged:it(tt.loadingStateChanged),oncontentanimating:it(tt.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(b.LoadingState.loading),this._pendingRefresh=!0,y.schedule(this._refreshImpl.bind(this),y.Priority.high))},_refreshImpl:function(){var n,t;this._disposed||(n=a.wrap(),this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,h.isAnimationEnabled()))&&(t=this._fireEvent(b._EventName.contentAnimating,{type:b.AnimationType.contentTransition}),t&&(this._viewportElement.style["-ms-overflow-style"]="none",n=s.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=t),n.done(this._applyProperties.bind(this)))},_applyProperties:function(){var n,t;if(!this._disposed){if(this._pendingRefresh=!1,n=!1,this._pendingSections){for(n=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;)t=this.element.firstElementChild,t.parentNode.removeChild(t);w.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null);this._assignHeaderTemplate();n&&this._attachSections();+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:this.scrollPosition=+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:0;this._pendingSectionOnScreen=null;this._pendingScrollLocation=null;this._setState(b.LoadingState.loading);this._loadSections()}},_handleSectionChanged:function(n){if(!this._pendingSections){var t=n.detail.newValue,i=n.detail.oldValue;if(t._setHeaderTemplate(this.headerTemplate),t.element!==i.element){if(t.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Hub.DuplicateSection",nt.duplicateSection);this._surfaceElement.insertBefore(t.element,i.element);this._surfaceElement.removeChild(i.element);this._measured=!1;this._setState(b.LoadingState.loading);this._loadSections()}}},_handleSectionInserted:function(n){var i,t,f,o,e,u,h;if(!this._pendingSections){if(i=n.detail.index,t=n.detail.value,t._animation&&t._animation.cancel(),o=this._fireEvent(b._EventName.contentAnimating,{type:b.AnimationType.insert,index:i,section:t}),o){for(e=[],u=i+1;u<this.sections.length;u++)e.push(this.sections.getAt(u).element);f=new s._createUpdateListAnimation([t.element],[],e)}if(t.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Hub.DuplicateSection",nt.duplicateSection);(t._setHeaderTemplate(this.headerTemplate),i<this.sections.length-1?this._surfaceElement.insertBefore(t.element,this.sections.getAt(i+1).element):this._surfaceElement.appendChild(t.element),this._measured=!1,f)&&(h=f.execute(),this.runningAnimations=a.join([this.runningAnimations,h]));this._setState(b.LoadingState.loading);this._loadSections()}},_handleSectionMoved:function(n){if(!this._pendingSections){var t=n.detail.newIndex,i=n.detail.value;t<this.sections.length-1?this._surfaceElement.insertBefore(i.element,this.sections.getAt(t+1).element):this._surfaceElement.appendChild(i.element);this._measured=!1;this._setState(b.LoadingState.loading);this._loadSections()}},_handleSectionRemoved:function(n){var u,r,e,o,h;if(!this._pendingSections){var t=n.detail.value,f=n.detail.index,i=a.wrap(),c=this._fireEvent(b._EventName.contentAnimating,{type:b.AnimationType.remove,index:f,section:t});if(c){for(u=[],r=f;r<this.sections.length;r++)u.push(this.sections.getAt(r).element);e=new s._createUpdateListAnimation([],[t.element],u);this._measure();o=t.element.offsetTop;h=t.element.offsetLeft;t.element.style.position="absolute";t.element.style.top=o;t.element.style.left=h;t.element.style.opacity=0;this._measured=!1;i=e.execute().then(function(){t.element.style.position="";t.element.style.top="";t.element.style.left="";t.element.style.opacity=1}.bind(this))}i.done(function(){this._disposed||(this._surfaceElement.removeChild(t.element),this._measured=!1)}.bind(this));t._animation=i;this.runningAnimations=a.join([this.runningAnimations,i]);this._setState(b.LoadingState.loading);this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(n,t){n&&(n.removeEventListener("itemchanged",this._handleSectionChangedBind),n.removeEventListener("iteminserted",this._handleSectionInsertedBind),n.removeEventListener("itemmoved",this._handleSectionMovedBind),n.removeEventListener("itemremoved",this._handleSectionRemovedBind),n.removeEventListener("reload",this._handleSectionReloadBind));t&&(t.addEventListener("itemchanged",this._handleSectionChangedBind),t.addEventListener("iteminserted",this._handleSectionInsertedBind),t.addEventListener("itemmoved",this._handleSectionMovedBind),t.addEventListener("itemremoved",this._handleSectionRemovedBind),t.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){var t,n;for(this._measured=!1,t=0;t<this.sections.length;t++){if(n=this._sections.getAt(t),n._animation&&n._animation.cancel(),n.element.parentNode===this._surfaceElement)throw new r("WinJS.UI.Hub.DuplicateSection",nt.duplicateSection);this._surfaceElement.appendChild(n.element)}},_assignHeaderTemplate:function(){var n,t;for(this._measured=!1,n=0;n<this.sections.length;n++)t=this._sections.getAt(n),t._setHeaderTemplate(this.headerTemplate)},_loadSection:function(n){var t=this._sections.getAt(n);return t._process().then(function(){var n=t.contentElement.style;""!==n.visibility&&(n.visibility="")})},_loadSections:function(){function l(n){n.then(function(){y.schedule(g,y.Priority.idle)})}function g(){if(u===t._loadId&&!t._disposed)if(f.length){var n=f.shift(),i=t._loadSection(n);l(i)}else e.complete()}var e,c;this._loadId++;var u=this._loadId,t=this,p=a.wrap(),f=[],k=a.wrap();if(this._showProgressPromise||(this._showProgressPromise=a.timeout(ft).then(function(){this._disposed||(this._progressBar||(this._progressBar=n.document.createElement("progress"),w.addClass(this._progressBar,b._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){e=new v;k=e.promise;for(var d=[],i=Math.max(0,this.indexOfFirstVisible),r=Math.max(0,this.indexOfLastVisible),o=i;r>=o;o++)d.push(this._loadSection(o));for(i--,r++;i>=0||r<this.sections.length;)r<this.sections.length&&(f.push(r),r++),i>=0&&(f.push(i),i--);c=a.join(d);c.done(function(){u!==this._loadId||t._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),y.schedule(function(){if(u===this._loadId&&!t._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&h.isAnimationEnabled()){var i={type:b.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(b._EventName.contentAnimating,i))&&(this._viewportElement.style["-ms-overflow-style"]="none",p=s.enterContent(this._viewportElement,[{left:this._fireEntrance?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"}).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this)))}this._element===n.document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},y.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this));l(c)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);a.join([this.runningAnimations,p,k]).done(function(){u!==this._loadId||t._disposed||(this.runningAnimations=a.wrap(),this._setState(b.LoadingState.complete),y.schedule(this._updateSnapList.bind(this),y.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(t){if(t!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+t+",info");this._loadingState=t;var i=n.document.createEvent("CustomEvent");i.initCustomEvent(b._EventName.loadingStateChanged,!0,!1,{loadingState:t});this._element.dispatchEvent(i)}},_parse:function(){for(var i,u,t=[],n=this.element.firstElementChild;n!==this._viewportElement;){if(l.processAll(n),i=n.winControl,!i)throw new r("WinJS.UI.Hub.InvalidContent",nt.invalidContent);t.push(i);u=n.nextElementSibling;n=u}this.sections=new c.List(t)},_fireEvent:function(t,i){var r=n.document.createEvent("CustomEvent");return r.initCustomEvent(t,!0,!0,i),this.element.dispatchEvent(r)},_findHeaderTabStop:function(n){if(n.parentNode&&w._matchesSelector(n,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!w.hasClass(n,"win-hub-section-header-tabstop");)n=n.parentElement;return n}return null},_isHeaderInteractive:function(n){return n.parentNode?w._matchesSelector(n,".win-interactive, .win-interactive *"):!1},_clickHandler:function(n){var i=this._findHeaderTabStop(n.target),t,r;i&&!this._isHeaderInteractive(n.target)&&(t=i.parentElement.parentElement.winControl,t.isHeaderStatic||(r=this.sections.indexOf(t),this._fireEvent(b._EventName.headerInvoked,{index:r,section:t})))},_resizeHandler:function(){this._measured=!1;y.schedule(this._updateSnapList.bind(this),y.Priority.idle)},_contentResizeHandler:function(){this._measured=!1;y.schedule(this._updateSnapList.bind(this),y.Priority.idle)},_scrollHandler:function(){this._measured=!1;this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=i._requestAnimationFrame(function(){this._pendingScrollHandler=null;this._pendingSections||this.loadingState!==b.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){var i,t,u,r;if(!this._measured||0===this._scrollLength){for(this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===n.getComputedStyle(this._element,null).direction,this._names=this.orientation===k.Orientation.vertical?et:this._rtl?ot:st,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=w.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize],i=n.getComputedStyle(this._surfaceElement),this._startSpacer=parseFloat(i[this._names.marginStart])+parseFloat(i[this._names.borderStart])+parseFloat(i[this._names.paddingStart]),this._endSpacer=parseFloat(i[this._names.marginEnd])+parseFloat(i[this._names.borderEnd])+parseFloat(i[this._names.paddingEnd]),this._sectionSizes=[],t=0;t<this.sections.length;t++)u=this.sections.getAt(t),r=n.getComputedStyle(u.element),this._sectionSizes[t]={offset:u.element[this._names.offsetPos],size:u.element[this._names.offsetSize],marginStart:parseFloat(r[this._names.marginStart]),marginEnd:parseFloat(r[this._names.marginEnd]),borderStart:parseFloat(r[this._names.borderStart]),borderEnd:parseFloat(r[this._names.borderEnd]),paddingStart:parseFloat(r[this._names.paddingStart]),paddingEnd:parseFloat(r[this._names.paddingEnd])},this._rtl&&this.orientation===k.Orientation.horizontal&&(this._sectionSizes[t].offset=this._viewportSize-(this._sectionSizes[t].offset+this._sectionSizes[t].size));this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){var n,t,u,i,r;for(this._writeProfilerMark("updateSnapList,StartTM"),this._measure(),n="snapList(",t=0;t<this._sectionSizes.length;t++)t>0&&(n+=","),u=this._sectionSizes[t],n+=u.offset-u.marginStart-this._startSpacer+"px";n+=")";i="";r="";this.orientation===k.Orientation.vertical?i=n:r=n;this._lastSnapPointY!==i&&(this._lastSnapPointY=i,this._viewportElement.style["-ms-scroll-snap-points-y"]=i);this._lastSnapPointX!==r&&(this._lastSnapPointX=r,this._viewportElement.style["-ms-scroll-snap-points-x"]=r);this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(n,t){this._measure();var i=this._sectionSizes[n],r=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer);this._scrollTo(r,t)},_ensureVisible:function(n,t){this._measure();var i=this._ensureVisibleMath(n,this._scrollPosition);this._scrollTo(i,t)},_ensureVisibleMath:function(n,t){this._measure();var i=this._sectionSizes[n],r=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer),u=Math.max(0,i.offset+i.size+i.marginEnd+this._endSpacer-this._viewportSize+1);return t>r?t=r:u>t&&(t=Math.min(r,u)),t},_scrollTo:function(n,t){if(this._scrollPosition=n,t)this.orientation===k.Orientation.vertical?w._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):w._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var i={};i[this._names.scrollPos]=this._scrollPosition;w.setScrollPosition(this._viewportElement,i)}},_windowKeyDownHandler:function(n){if(n.keyCode===g.tab){this._tabSeenLast=!0;var t=this;i._yieldForEvents(function(){t._tabSeenLast=!1})}},_focusin:function(n){var r,t,i,u;for(this._tabSeenLast&&(r=this._findHeaderTabStop(n.target),r&&!this._isHeaderInteractive(n.target)&&(i=this.sections.indexOf(r.parentElement.parentElement.winControl),i>-1&&this._ensureVisible(i,!0))),t=n.target;t&&!w.hasClass(t,d.HubSection._ClassName.hubSection);)t=t.parentElement;t&&(i=this.sections.indexOf(t.winControl),i>-1&&(this._currentIndexForSezo=i));n.target===this.element&&(+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(u=this._sectionToFocus,this._sectionToFocus=null):u=this.sectionOnScreen,this._moveFocusIn(u))},_moveFocusIn:function(n){var t,i,r;if(n>=0){for(t=n;t<this.sections.length;t++){if(i=this.sections.getAt(t),r=w._trySetActive(i._headerTabStopElement,this._viewportElement),r)return;if(w._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return}for(t=n-1;t>=0;t--){if(i=this.sections.getAt(t),w._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return;if(r=w._trySetActive(i._headerTabStopElement,this._viewportElement),r)return}}},_keyDownHandler:function(n){var o=this._rtl?g.rightArrow:g.leftArrow,s=this._rtl?g.leftArrow:g.rightArrow,r,i,u,f,t,e;if(n.keyCode===g.upArrow||n.keyCode===g.downArrow||n.keyCode===g.leftArrow||n.keyCode===g.rightArrow||n.keyCode===g.pageUp||n.keyCode===g.pageDown){if(r=this._findHeaderTabStop(n.target),r&&!this._isHeaderInteractive(n.target)){if(u=this.sections.indexOf(r.parentElement.parentElement.winControl),f=!1,n.keyCode===g.pageDown||this.orientation===k.Orientation.horizontal&&n.keyCode===s||this.orientation===k.Orientation.vertical&&n.keyCode===g.downArrow){for(t=u+1;t<this.sections.length;t++)if(this._tryFocus(t)){i=t;break}}else if(n.keyCode===g.pageUp||this.orientation===k.Orientation.horizontal&&n.keyCode===o||this.orientation===k.Orientation.vertical&&n.keyCode===g.upArrow)for(t=u-1;t>=0;t--)if(this._tryFocus(t)){i=t;break}(n.keyCode===g.upArrow||n.keyCode===g.downArrow||n.keyCode===g.leftArrow||n.keyCode===g.rightArrow)&&(f=!0);+i===i&&(f?this._ensureVisible(i,!0):this._scrollToSection(i,!0));n.preventDefault()}}else(n.keyCode===g.home||n.keyCode===g.end)&&(this._measure(),e=Math.max(0,this._scrollLength-this._viewportSize),this._scrollTo(n.keyCode===g.home?0:e,!0),n.preventDefault())},_tryFocus:function(t){var i=this.sections.getAt(t);return w._setActive(i._headerTabStopElement,this._viewportElement),n.document.activeElement===i._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new ut(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===k.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(n,t){var r,i,u;for(r=this.orientation===k.Orientation.horizontal?n:t,this._measure(),r+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1,i=1;i<this._sectionSizes.length;i++)if(u=this._sectionSizes[i],u.offset-u.marginStart>r){this._currentIndexForSezo=i-1;break}},_getCurrentItem:function(){var i,t,n,r;if(this._sectionSizes.length>0)return this._measure(),t=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),n=this._sectionSizes[t],i=this.orientation===k.Orientation.horizontal?{left:Math.max(0,n.offset-n.marginStart-this._scrollPosition),top:0,width:n.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,n.offset-n.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:n.size},r=this.sections.getAt(t),a.wrap({item:{data:r,index:t,groupIndexHint:t},position:i})},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(n,t){var u,f,i,r;n.index>=0&&n.index<this._sectionSizes.length&&(this._measure(),f=this._sectionSizes[n.index],u=this.orientation===k.Orientation.horizontal?t.left:t.top,this._sectionToFocus=n.index,i=f.offset-u,i=this._ensureVisibleMath(n.index,i),this._scrollPosition=i,r={},r[this._names.scrollPos]=this._scrollPosition,w.setScrollPosition(this._viewportElement,r))},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(n){var t="WinJS.UI.Hub:"+this._id+":"+n;o(t);f.log&&f.log(t,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0;n.removeEventListener("keydown",this._windowKeyDownHandlerBound);w._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound);this._updateEvents(this._sections);for(var t=0;t<this.sections.length;t++)this.sections.getAt(t).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:tt.contentAnimating,headerInvoked:tt.headerInvoked,loadingStateChanged:tt.loadingStateChanged}}),ut,nt;return t.Class.mix(b,p.DOMEventMixin),ut=t.Class.define(function(n){this._hub=n},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(n,t,i,r){this._hub._configureForZoom(n,t,i,r)},setCurrentItem:function(n,t){this._hub._setCurrentItem(n,t)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(n,t){return this._hub._positionItem(n,t)},endZoom:function(n){this._hub._endZoom(n)}}),nt={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateSection(){return"Hub duplicate sections: Each HubSection must be unique"},get invalidContent(){return"Invalid content: Hub content must be made up of HubSections."},get hubViewportAriaLabel(){return e._getWinJSString("ui/hubViewportAriaLabel").value}},b})})});t("WinJS/Controls/AppBar/_Constants",["exports","../../Core/_Base"],function(n,t){"use strict";t.Namespace._moduleDefine(n,null,{appBarClass:"win-appbar",firstDivClass:"win-firstdiv",finalDivClass:"win-finaldiv",invokeButtonClass:"win-appbar-invokebutton",ellipsisClass:"win-appbar-ellipsis",primaryCommandsClass:"win-primarygroup",secondaryCommandsClass:"win-secondarygroup",reducedClass:"win-reduced",commandLayoutClass:"win-commandlayout",drawerLayoutClass:"win-drawerlayout",topClass:"win-top",bottomClass:"win-bottom",showingClass:"win-appbar-showing",shownClass:"win-appbar-shown",hidingClass:"win-appbar-hiding",hiddenClass:"win-appbar-hidden",minimalClass:"win-appbar-minimal",drawerContainerClass:"win-appbar-drawer",toolbarContainerClass:"win-appbar-toolbarcontainer",appBarPlacementTop:"top",appBarPlacementBottom:"bottom",appBarLayoutCustom:"custom",appBarLayoutCommands:"commands",appBarLayoutDrawer:"drawer",appBarInvokeButtonWidth:60,typeSeparator:"separator",typeContent:"content",typeButton:"button",typeToggle:"toggle",typeFlyout:"flyout",menuCommandClass:"win-command",appBarCommandClass:"win-command",appBarCommandGlobalClass:"win-global",appBarCommandSelectionClass:"win-selection",sectionSelection:"selection",sectionGlobal:"global",sectionPrimary:"primary",sectionSecondary:"secondary",hideFocusClass:"win-hidefocus",overlayClass:"win-overlay",flyoutClass:"win-flyout",flyoutLightClass:"win-ui-light",menuClass:"win-menu",menuToggleClass:"win-menu-toggle",settingsFlyoutClass:"win-settingsflyout",scrollsClass:"win-scrolls",separatorWidth:60,buttonWidth:100,narrowClass:"win-narrow",wideClass:"win-wide",_clickEatingAppBarClass:"win-appbarclickeater",_clickEatingFlyoutClass:"win-flyoutmenuclickeater",_visualViewportClass:"win-visualviewport-space",commandVisibilityChanged:"commandvisibilitychanged"})});t("WinJS/Controls/Flyout/_Overlay",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Application","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{_Overlay:r.Namespace._lazy(function(){function k(n,i,r){var e=t.document.querySelectorAll("."+w.overlayClass),s,u,h,f,o;if(e)for(s=e.length,u=0;s>u;u++)if(h=e[u],f=h.winControl,!f._disposed&&f&&(o=f[i](n),r&&o))return o}function ut(n){var i,r,u;if(!n)return[];for("string"!=typeof n&&n&&n.length||(n=[n]),r=[],i=0;i<n.length;i++)n[i]&&("string"==typeof n[i]?(u=t.document.getElementById(n[i]),u&&r.push(u)):r.push(n[i].element?n[i].element:n[i]));return r}var b=r.Class.define(function(){this._currentState=b.states.off;this._windowBlur=this._windowBlur.bind(this);this._inputPaneShowing=this._inputPaneShowing.bind(this);this._inputPaneHiding=this._inputPaneHiding.bind(this);this._documentScroll=this._documentScroll.bind(this);this._edgyStarting=this._edgyStarting.bind(this);this._edgyCompleted=this._edgyCompleted.bind(this);this._backClicked=this._backClicked.bind(this);this._windowResized=this._windowResized.bind(this)},{initialize:function(){this._toggleListeners(b.states.on)},reset:function(){this._toggleListeners(b.states.off);this._toggleListeners(b.states.on)},_windowBlur:function(){if(t.document.hasFocus()){if(n._clickEatingFlyoutDiv&&"block"===n._clickEatingFlyoutDiv.style.display||n._clickEatingAppBarDiv&&"block"===n._clickEatingAppBarDiv.style.display){var i=t.document.activeElement;i&&"IFRAME"===i.tagName&&!i.msLightDismissBlur&&(i.addEventListener("blur",this._windowBlur,!1),i.msLightDismissBlur=!0)}}else n._lightDismissOverlays(!1)},_inputPaneShowing:function(n){s(b.profilerString+"_showingKeyboard,StartTM");k(n,"_showingKeyboard");s(b.profilerString+"_showingKeyboard,StopTM")},_inputPaneHiding:function(n){s(b.profilerString+"_hidingKeyboard,StartTM");k(n,"_hidingKeyboard");s(b.profilerString+"_hidingKeyboard,StopTM")},_documentScroll:function(n){s(b.profilerString+"_checkScrollPosition,StartTM");k(n,"_checkScrollPosition");s(b.profilerString+"_checkScrollPosition,StopTM")},_edgyStarting:function(){n._lightDismissAllFlyouts()},_edgyCompleted:function(){n._containsRightMouseClick||n._lightDismissAllFlyouts()},_backClicked:function(n){s(b.profilerString+"_backClick,StartTM");var t=k(n,"_backClick",!0);return s(b.profilerString+"_backClick,StopTM"),t},_windowResized:function(n){s(b.profilerString+"_baseResize,StartTM");k(n,"_baseResize");s(b.profilerString+"_baseResize,StopTM")},_toggleListeners:function(n){var r,u,f;this._currentState!==n&&((n===b.states.on?r="addEventListener":n===b.states.off&&(r="removeEventListener"),t[r]("blur",this._windowBlur,!1),i.Windows.UI.Input.EdgeGesture)&&(u=i.Windows.UI.Input.EdgeGesture.getForCurrentView(),u[r]("starting",this._edgyStarting),u[r]("completed",this._edgyCompleted)),i.Windows.UI.ViewManagement.InputPane&&(f=i.Windows.UI.ViewManagement.InputPane.getForCurrentView(),f[r]("showing",this._inputPaneShowing,!1),f[r]("hiding",this._inputPaneHiding,!1),t.document[r]("scroll",this._documentScroll,!1)),c[r]("backclick",this._backClicked,!1),t.addEventListener("resize",this._windowResized,!1),this._currentState=n)}},{profilerString:{get:function(){return"WinJS.UI._Overlay Global Listener:"}},states:{get:function(){return{off:0,on:1}}}}),d=e._createEventProperty,nt="beforeshow",tt="aftershow",it="beforehide",rt="afterhide",g={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get mustContainCommands(){return"Invalid HTML: AppBars/Menus must contain only AppBarCommands/MenuCommands"},get closeOverlay(){return o._getWinJSString("ui/closeOverlay").value}},n=r.Class.define(function(n,t){this._baseOverlayConstructor(n,t)},{_baseOverlayConstructor:function(i,r){var e,u;if(n._addMixin(),this._disposed=!1,i||(i=t.document.createElement("div")),e=i.winControl,e)throw new f("WinJS.UI._Overlay.DuplicateConstruction",g.duplicateConstruction);this._element||(this._element=i);this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1);this._sticky=!1;this._doNext="";this._element.style.visibility="hidden";this._element.style.opacity=0;i.winControl=this;p.addClass(this._element,w.overlayClass);p.addClass(this._element,"win-disposable");u=this._element.getAttribute("unselectable");(null===u||void 0===u)&&this._element.setAttribute("unselectable","on");this._currentAnimateIn=this._baseAnimateIn;this._currentAnimateOut=this._baseAnimateOut;this._animationPromise=a.as();this._queuedToShow=[];this._queuedToHide=[];this._queuedCommandAnimation=!1;r&&y.setOptions(this,r);n._globalEventListeners.initialize()},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(n){n=!!n;var t=!!this._element.disabled;t!==n&&(this._element.disabled=n,!this.hidden&&this._element.disabled&&this._hideOrDismiss())}},onbeforeshow:d(nt),onaftershow:d(tt),onbeforehide:d(it),onafterhide:d(rt),dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},show:function(){this._show()},_show:function(){this._baseShow()},hide:function(){this._hide()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext}},addEventListener:function(n,t,i){return this._element.addEventListener(n,t,i)},removeEventListener:function(n,t,i){return this._element.removeEventListener(n,t,i)},_baseShow:function(){if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)return this._doNext="show",!1;if(this._cachedDocumentSize=this._cachedDocumentSize||n._sizeOfDocument(),"visible"!==this._element.style.visibility){this._element.winAnimating="showing";this._element.style.display="";this._element.style.visibility="hidden";this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]);this._sendEvent(n.beforeShow);this._findPosition();var t=this;return this._animationPromise=this._currentAnimateIn().then(function(){t._baseEndShow()},function(){t._baseEndShow()}),!0}return!1},_findPosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="",this._endShow(),"show"===this._doNext&&(this._doNext=""),this._sendEvent(n.afterShow),this._writeProfilerMark("show,StopTM"),v.schedule(this._checkDoNext,v.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_endShow:function(){},_baseHide:function(){if(this._animating||this._needToHandleShowingKeyboard)return this._doNext="hide",!1;if(this._needToHandleHidingKeyboard&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(n.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var t=this;this._animationPromise=this._currentAnimateOut().then(function(){t._baseEndHide()},function(){t._baseEndHide()})}return!0}return!1},_baseEndHide:function(){this._disposed||(this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._sendEvent(n.afterHide),this._writeProfilerMark("hide,StopTM"),v.schedule(this._checkDoNext,v.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",t.getComputedStyle(this._element,null).opacity,h.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,t.getComputedStyle(this._element,null).opacity,h.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(n,i){if(!this._disposed){var r=t.document.createEvent("CustomEvent");r.initEvent(n,!0,!0,i||{});this._element.dispatchEvent(r)}},_showCommands:function(n,t){var i=this._resolveCommands(n);this._showAndHideCommands(i.commands,[],t)},_hideCommands:function(n,t){var i=this._resolveCommands(n);this._showAndHideCommands([],i.commands,t)},_showOnlyCommands:function(n,t){var i=this._resolveCommands(n);this._showAndHideCommands(i.commands,i.others,t)},_showAndHideCommands:function(n,t,i){i||this.hidden&&!this._animating?(this._showAndHideFast(n,t),this._removeFromQueue(n,this._queuedToShow),this._removeFromQueue(t,this._queuedToHide)):(this._updateAnimateQueue(n,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(t,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(n,t){for(var i,r=0;r<n.length;r++)for(i=0;i<t.length;i++)if(t[i]===n[r]){t.splice(i,1);break}},_updateAnimateQueue:function(n,t,i){var u,r;if(!this._disposed){for(u=0;u<n.length;u++){for(r=0;r<t.length&&t[r]!==n[u];r++);for(r===t.length&&(t[r]=n[u]),r=0;r<i.length;r++)if(i[r]===n[u]){i.splice(r,1);break}}this._queuedCommandAnimation||(this._animating||v.schedule(this._checkDoNext,v.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(n,t){for(var i,r=0;r<n.length;r++)i=n[r],i&&i.style&&(i.style.visibility="",i.style.display="");for(r=0;r<t.length;r++)i=t[r],i&&i.style&&(i.style.visibility="hidden",i.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){var f,u;if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),v.schedule(this._checkDoNext,v.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{for(var i=this._queuedToShow,r=this._queuedToHide,e=this._findSiblings(i.concat(r)),n=0;n<i.length;n++)i[n]&&i[n].style&&t.document.body.contains(i[n])?"hidden"!==i[n].style.visibility&&"0"!==i[n].style.opacity&&(e.push(i[n]),i.splice(n,1),n--):(i.splice(n,1),n--);for(n=0;n<r.length;n++)r[n]&&r[n].style&&t.document.body.contains(r[n])&&"hidden"!==r[n].style.visibility&&"0"!==r[n].style.opacity||(r.splice(n,1),n--);f=this._baseBeginAnimateCommands(i,r,e);u=this;f?f.done(function(){u._baseEndAnimateCommands(r)},function(){u._baseEndAnimateCommands(r)}):v.schedule(function(){u._baseEndAnimateCommands([])},v.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[];this._queuedToHide=[]},_baseBeginAnimateCommands:function(n,i,r){var e,o,u,v,s,c,f,l;for(this._beginAnimateCommands(n,i,this._getVisibleCommands(r)),e=null,o=null,i.length>0&&(o=h.createDeleteFromListAnimation(i,0===n.length?r:void 0)),n.length>0&&(e=h.createAddToListAnimation(n,r)),u=0,v=i.length;v>u;u++)s=i[u].getBoundingClientRect(),c=t.getComputedStyle(i[u]),i[u].style.top=s.top-parseFloat(c.marginTop)+"px",i[u].style.left=s.left-parseFloat(c.marginLeft)+"px",i[u].style.opacity=0,i[u].style.position="fixed";for(this._element.winAnimating="rearranging",f=null,o&&(f=o.execute()),u=0;u<n.length;u++)n[u].style.visibility="",n[u].style.display="",n[u].style.opacity=1;return e&&(l=e.execute(),f=f?a.join([f,l]):l),f},_beginAnimateCommands:function(){},_getVisibleCommands:function(n){var r,t=n,u=[],i,f;for(t||(t=this.element.querySelectorAll(".win-command")),i=0,f=t.length;f>i;i++)r=t[i].winControl||t[i],r.hidden||u.push(r);return u},_baseEndAnimateCommands:function(n){if(!this._disposed){for(var t=0;t<n.length;t++)n[t].style.position="",n[t].getBoundingClientRect(),n[t].style.visibility="hidden",n[t].style.display="none",n[t].style.opacity=1;this._element.winAnimating="";this._endAnimateCommands();this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(n){var t,i,r,u,f;for(n=ut(n),t={},t.commands=[],t.others=[],u=this.element.querySelectorAll(".win-command"),i=0;i<u.length;i++){for(f=!1,r=0;r<n.length;r++)if(n[r]===u[i]){t.commands.push(u[i]);n.splice(r,1);f=!0;break}f||t.others.push(u[i])}return t},_findSiblings:function(n){for(var i,f=[],r=this.element.querySelectorAll(".win-command"),u,t=0;t<r.length;t++){for(u=!1,i=0;i<n.length;i++)if(n[i]===r[t]){n.splice(i,1);u=!0;break}u||f.push(r[t])}return f},_baseResize:function(t){if(this._cachedDocumentSize)if(this.hidden)this._cachedDocumentSize=null;else{var i=n._sizeOfDocument();(this._cachedDocumentSize.width!==i.width||this._cachedDocumentSize.height!==i.height)&&(this._cachedDocumentSize=i,this._sticky||this._hideOrDismiss())}this._resize(t)},_isLightDismissible:function(){return!this._sticky&&!this.hidden},_lightDismiss:function(t){this._isLightDismissible()&&n._lightDismissOverlays(t)},_backClick:function(){if(this._element.contains(t.document.activeElement)&&this._isLightDismissible())return(this._lightDismiss(!1),!0)},_hideOrDismiss:function(){var n=this._element;n&&p.hasClass(n,w.settingsFlyoutClass)?this._dismiss():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(n,t){for(var r=n.children,u=new Array(r.length),i=0;i<r.length;i++){if(!p.hasClass(r[i],"win-command")&&r[i].getAttribute("data-win-control")!==t)throw new f("WinJS.UI._Overlay.MustContainCommands",g.mustContainCommands);l.processAll(r[i]);u[i]=r[i].winControl}return u},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||n._trySetActive(this._element)},_focusOnLastFocusableElement:function(){var r,u,i;return this._element.firstElementChild?(r=this._element.firstElementChild.tabIndex,u=this._element.lastElementChild.tabIndex,this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1,i=p._focusLastFocusableElement(this._element),i&&n._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=r,this._element.lastElementChild.tabIndex=u,i):!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||n._trySetActive(this._element)},_focusOnFirstFocusableElement:function(){var r,u,i;return this._element.firstElementChild?(r=this._element.firstElementChild.tabIndex,u=this._element.lastElementChild.tabIndex,this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1,i=p._focusFirstFocusableElement(this._element),i&&n._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=r,this._element.lastElementChild.tabIndex=u,i):!1},_handleOverlayEventsForFlyoutOrSettingsFlyout:function(){var t=this;p._addEventListener(this._element,"focusout",function(i){n._hideIfLostFocus(t,i)},!1);p._addEventListener(this._element,"pointerdown",n._checkRightClickDown,!0);p._addEventListener(this._element,"pointerup",n._checkRightClickUp,!0)},_writeProfilerMark:function(n){s("WinJS.UI._Overlay:"+this._id+":"+n)}},{_clickEatingAppBarDiv:!1,_clickEatingFlyoutDiv:!1,_lightDismissFlyouts:function(){var u,i;n._hideClickEatingDivFlyout();for(var f=t.document.body.querySelectorAll("."+w.flyoutClass),e=f.length,r=0;e>r;r++)u=f[r],"hidden"!==u.style.visibility&&(i=u.winControl,i&&!i._sticky&&i._hideOrDismiss())},_lightDismissSettingsFlyouts:function(){for(var r,n,u=t.document.body.querySelectorAll("."+w.settingsFlyoutClass),f=u.length,i=0;f>i;i++)r=u[i],"hidden"!==r.style.visibility&&(n=r.winControl,n&&!n._sticky&&n._hideOrDismiss())},_lightDismissAllFlyouts:function(){n._lightDismissFlyouts();n._lightDismissSettingsFlyouts()},_lightDismissOverlays:function(t){n._lightDismissAppBars(t);n._lightDismissAllFlyouts()},_lightDismissAppBars:function(i){for(var r,f=t.document.querySelectorAll("."+w.appBarClass),o=f.length,e=[],u=0;o>u;u++)r=f[u].winControl,!r||r.sticky||r.hidden||e.push(r);n._hideAppBars(e,i);n._hideClickEatingDivAppBar()},_createClickEatingDivTemplate:function(i,r){var u=t.document.createElement("section");return u._winHideClickEater=r,p.addClass(u,i),p._addEventListener(u,"pointerup",function(t){n._checkSameClickEatingPointerUp(t,!0)},!0),p._addEventListener(u,"pointerdown",function(t){n._checkClickEatingPointerDown(t,!0)},!0),u.addEventListener("click",function(n){u._winHideClickEater(n)},!0),u.setAttribute("role","menuitem"),u.setAttribute("aria-label",g.closeOverlay),u.setAttribute("unselectable","on"),t.document.body.appendChild(u),u},_createClickEatingDivAppBar:function(){n._clickEatingAppBarDiv||(n._clickEatingAppBarDiv=n._createClickEatingDivTemplate(w._clickEatingAppBarClass,n._handleAppBarClickEatingClick))},_createClickEatingDivFlyout:function(){n._clickEatingFlyoutDiv||(n._clickEatingFlyoutDiv=n._createClickEatingDivTemplate(w._clickEatingFlyoutClass,n._handleFlyoutClickEatingClick))},_checkClickEatingPointerDown:function(n,t){var i=n.currentTarget;if(i)try{i._winPointerId=n.pointerId;i._winRightMouse=2===n.button}catch(r){}t&&!i._winRightMouse&&(n.stopPropagation(),n.preventDefault())},_checkSameClickEatingPointerUp:function(n,t){var r=!1,u=!1,i=n.currentTarget;try{i&&i._winPointerId===n.pointerId&&(r=!0,u=i._winRightMouse,u&&t&&(r=!1))}catch(f){}return t&&!u&&(n.stopPropagation(),n.preventDefault(),i._winHideClickEater(n)),r},_handleAppBarClickEatingClick:function(t){t.stopPropagation();t.preventDefault();n._lightDismissOverlays(!1)},_handleFlyoutClickEatingClick:function(t){t.stopPropagation();t.preventDefault();n._lightDismissFlyouts()},_checkRightClickDown:function(t){n._checkClickEatingPointerDown(t,!1)},_checkRightClickUp:function(t){n._checkSameClickEatingPointerUp(t,!1)&&(n._containsRightMouseClick=!0,u._yieldForEvents(function(){n._containsRightMouseClick=!1}))},_showClickEatingDivAppBar:function(){v.schedule(function(){n._clickEatingAppBarDiv&&(n._clickEatingAppBarDiv.style.display="block")},v.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivAppBar")},_hideClickEatingDivAppBar:function(){v.schedule(function(){n._clickEatingAppBarDiv&&(n._clickEatingAppBarDiv.style.display="none")},v.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivAppBar")},_showClickEatingDivFlyout:function(){v.schedule(function(){n._clickEatingFlyoutDiv&&(n._clickEatingFlyoutDiv.style.display="block")},v.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivFlyout")},_hideClickEatingDivFlyout:function(){v.schedule(function(){n._clickEatingFlyoutDiv&&(n._clickEatingFlyoutDiv.style.display="none")},v.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivFlyout")},_isFlyoutVisible:function(){return n._clickEatingFlyoutDiv?"block"===n._clickEatingFlyoutDiv.style.display:!1},_hideIfLostFocus:function(i){var r,f,u;if(!i.hidden&&"showing"!==i.element.winAnimating&&!i._sticky&&(r=t.document.activeElement,!i._element||!i._element.contains(r))){if(p.hasClass(i._element,w.settingsFlyoutClass)&&(f=i,u=n._getParentControlUsingClassName(r,"win-flyout"),u&&u._previousFocus&&f.element.contains(u._previousFocus)))return void p._addEventListener(u.element,"focusout",function e(t){n._hideIfLostFocus(f,t);p._removeEventListener(u.element,"focusout",e,!1)},!1);r&&(p.hasClass(r,w._clickEatingFlyoutClass)||p.hasClass(r,w._clickEatingAppBarClass))||i._hideOrDismiss()}},_trySetActive:function(n){return n&&t.document.body&&t.document.body.contains(n)&&p._setActive(n)?n===t.document.activeElement:!1},_trySelect:function(n){try{n&&n.select&&n.select()}catch(t){}},_addHideFocusClass:function(t){t&&(p.addClass(t,w.hideFocusClass),p._addEventListener(t,"focusout",n._removeHideFocusClass,!1))},_removeHideFocusClass:function(i){var r=i.target;r&&r!==t.document.activeElement&&(p.removeClass(r,w.hideFocusClass),p._removeEventListener(i.target,"focusout",n._removeHideFocusClass,!1))},_sizeOfDocument:function(){return{width:t.document.documentElement.offsetWidth,height:t.document.documentElement.offsetHeight}},_getParentControlUsingClassName:function(n,i){for(;n&&n!==t.document.body;){if(p.hasClass(n,i))return n.winControl;n=n.parentNode}return null},_globalEventListeners:new b,_hideIfAllAppBarsLostFocus:function(){n._isAppBarOrChild(t.document.activeElement)||(n._lightDismissAppBars(!1),n._ElementWithFocusPreviousToAppBar=null)},_hideAppBars:function(n,t){var i=n.map(function(n){return n._keyboardInvoked=t,n.hide(),n._animationPromise});return a.join(i)},_showAppBars:function(n,t){var i=n.map(function(n){return n._keyboardInvoked=t,n._doNotFocus=!1,n._show(),n._animationPromise});return a.join(i)},_isAppBarOrChild:function(i){if(!i)return null;if(p.hasClass(i,w._clickEatingAppBarClass)||p.hasClass(i,w._clickEatingFlyoutClass)||p.hasClass(i,w.firstDivClass)||p.hasClass(i,w.finalDivClass)||p.hasClass(i,w.invokeButtonClass))return i;for(;i&&i!==t.document;){if(p.hasClass(i,w.appBarClass))return i;if(p.hasClass(i,"win-flyout")&&i!==i.winControl._previousFocus){var r=i.winControl,u=n._isAppBarOrChild(r._previousFocus);return u&&p._addEventListener(r.element,"focusout",function f(){n._hideIfAllAppBarsLostFocus();p._removeEventListener(r.element,"focusout",f,!1)},!1),u}i=i.parentNode}return null},_keyboardInfo:{get _visible(){try{return i.Windows.UI.ViewManagement.InputPane&&i.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(n){return!1}},get _extraOccluded(){var t;if(i.Windows.UI.ViewManagement.InputPane)try{t=i.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height}catch(r){}return t&&!n._keyboardInfo._isResized?t:0},get _isResized(){var n=t.document.documentElement.clientHeight/t.innerHeight,i=t.document.documentElement.clientWidth/t.innerWidth;return.99>i/n},get _visibleDocBottom(){return n._keyboardInfo._visibleDocTop+n._keyboardInfo._visibleDocHeight},get _visibleDocHeight(){return n._keyboardInfo._visualViewportHeight-n._keyboardInfo._extraOccluded},get _animationShowLength(){var u;if(i.Windows.UI.Core.AnimationMetrics){for(var n=i.Windows.UI.Core.AnimationMetrics,e=new n.AnimationDescription(n.AnimationEffect.showPanel,n.AnimationEffectTarget.primary),f=e.animations,t=0,r=0;r<f.size;r++)u=f[r],t=Math.max(t,u.delay+u.duration);return t}return 0}},_ElementWithFocusPreviousToAppBar:null,_clickEatingAppBarClass:w._clickEatingAppBarClass,_clickEatingFlyoutClass:w._clickEatingFlyoutClass,_scrollTimeout:150,beforeShow:nt,beforeHide:it,afterShow:tt,afterHide:rt,commonstrings:{get cannotChangeCommandsWhenVisible(){return"Invalid argument: You must call hide() before changing {0} commands"},get cannotChangeHiddenProperty(){return"Unable to set hidden property while parent {0} is visible."}},_addMixin:function(){var u,e,f;if(void 0===n._keyboardInfo._visibleDocTop){var o={_visibleDocTop:function(){return 0},_visibleDocBottomOffset:function(){return n._keyboardInfo._isResized?0:n._keyboardInfo._extraOccluded},_visualViewportHeight:function(){var t=n._keyboardInfo._visualViewportSpace;return t.bottom-t.top},_visualViewportWidth:function(){var t=n._keyboardInfo._visualViewportSpace;return t.right-t.left},_visualViewportSpace:function(){var n=t.document.body.querySelector("."+w._visualViewportClass);return n||(n=t.document.createElement("DIV"),n.className=w._visualViewportClass,t.document.body.appendChild(n)),n.getBoundingClientRect()}},s={_visibleDocTop:function(){return t.window.pageYOffset-t.document.documentElement.scrollTop},_visibleDocBottomOffset:function(){return t.document.documentElement.clientHeight-n._keyboardInfo._visibleDocBottom},_visualViewportHeight:function(){return t.window.innerHeight},_visualViewportWidth:function(){return t.window.innerWidth}},r=t.document.createElement("DIV");r.className=w._visualViewportClass;t.document.body.appendChild(r);e="-ms-device-fixed"===t.getComputedStyle(r).position;!e&&i.Windows.UI.ViewManagement.InputPane?(u=s,t.document.body.removeChild(r)):u=o;for(f in u)Object.defineProperty(n._keyboardInfo,f,{get:u[f]})}}});return r.Class.mix(n,y.DOMEventMixin),n})})});t("WinJS/Controls/Flyout",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout/_Overlay","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{Flyout:i.Namespace._lazy(function(){function v(n,i){return parseFloat(n,t.getComputedStyle(n,null)[i])}var c=h.Key,n={get ariaLabel(){return f._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return"Invalid argument: Showing flyout requires a DOM element as its parameter."},get badPlacement(){return"Invalid argument: Flyout placement should be 'top' (default), 'bottom', 'left', 'right', 'auto', 'autohorizontal', or 'autovertical'."},get badAlignment(){return"Invalid argument: Flyout alignment should be 'center' (default), 'left', or 'right'."}};return i.Class.derive(a._Overlay,function(n,i){var r,u,f;return i=i||{},this._element=n||t.document.createElement("div"),this._id=this._element.id||h._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,i),r=this._element.getElementsByTagName("*"),u=this._addFirstDiv(),u.tabIndex=h._getLowestTabIndexInList(r),f=this._addFinalDiv(),f.tabIndex=h._getHighestTabIndexInList(r),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(t,i){var r,u;this._placement="auto";this._alignment="center";this._baseOverlayConstructor(t,i);a._Overlay._createClickEatingDivFlyout();this._element.style.visibilty="hidden";this._element.style.display="none";h.addClass(this._element,l.flyoutClass);h.addClass(this._element,l.flyoutLightClass);r=this._element.getAttribute("role");(null===r||""===r||void 0===r)&&(h.hasClass(this._element,l.menuClass)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));u=this._element.getAttribute("aria-label");(null===u||""===u||void 0===u)&&this._element.setAttribute("aria-label",n.ariaLabel);this._currentAnimateIn=this._flyoutAnimateIn;this._currentAnimateOut=this._flyoutAnimateOut;this._handleOverlayEventsForFlyoutOrSettingsFlyout()},anchor:{get:function(){return this._anchor},set:function(n){this._anchor=n}},placement:{get:function(){return this._placement},set:function(t){if("top"!==t&&"bottom"!==t&&"left"!==t&&"right"!==t&&"auto"!==t&&"autohorizontal"!==t&&"autovertical"!==t)throw new u("WinJS.UI.Flyout.BadPlacement",n.badPlacement);this._placement=t}},alignment:{get:function(){return this._alignment},set:function(t){if("right"!==t&&"left"!==t&&"center"!==t)throw new u("WinJS.UI.Flyout.BadAlignment",n.badAlignment);this._alignment=t}},_dispose:function(){s.disposeSubTree(this.element);this._hide();this.anchor=null},show:function(n,t,i){this._writeProfilerMark("show,StartTM");this._show(n,t,i)},_show:function(n,t,i){this._baseFlyoutShow(n,t,i)},hide:function(){this._writeProfilerMark("hide,StartTM");this._keyboardInvoked=!1;this._hide()},_hide:function(){var n,i,e,u,f;this._baseHide()&&(n=t.document.activeElement,this._previousFocus&&n&&(this._element.contains(n)||h.hasClass(n,a._Overlay._clickEatingFlyoutClass))&&void 0!==this._previousFocus.focus&&(i=a._Overlay._isAppBarOrChild(this._previousFocus),i&&(!i.winControl||i.winControl.hidden||i.winAnimating)||(e=this._previousFocus.getAttribute("role"),u=a._Overlay._keyboardInfo._visible&&!this._keyboardWasUp,(u&&this._previousFocus.setAttribute("role",""),this._keyboardInvoked?this._previousFocus.focus():a._Overlay._trySetActive(this._previousFocus),n=t.document.activeElement,u)&&(f=this._previousFocus,f&&r._yieldForDomModification(function(){f.setAttribute("role",e)}))),!this._keyboardInvoked&&this._previousFocus===n&&i&&n&&a._Overlay._addHideFocusClass(n)),this._previousFocus=null,this._isThereVisibleFlyout()||a._Overlay._hideClickEatingDivFlyout())},_baseFlyoutShow:function(i,r,f){var s,e,o;if(!this.disabled){if(i||(i=this._anchor),r||(r=this._placement),f||(f=this._alignment),"string"==typeof i?i=t.document.getElementById(i):i&&i.element&&(i=i.element),i)this._currentAnchor=i,this._currentPlacement=r,this._currentAlignment=f;else{if(!this._retryLast)throw new u("WinJS.UI.Flyout.NoAnchor",n.noAnchor);this._retryLast=null}if(this._sticky||a._Overlay._showClickEatingDivFlyout(),this._element.winAnimating)return this._doNext="show",void(this._retryLast=!0);this._baseShow()&&(h.hasClass(this.element,"win-menu")||(s=this._element.getElementsByTagName("*"),e=this.element.querySelectorAll(".win-first"),this.element.children.length&&!h.hasClass(this.element.children[0],l.firstDivClass)&&(e&&e.length>0&&e.item(0).parentNode.removeChild(e.item(0)),e=this._addFirstDiv()),e.tabIndex=h._getLowestTabIndexInList(s),o=this.element.querySelectorAll(".win-final"),h.hasClass(this.element.children[this.element.children.length-1],l.finalDivClass)||(o&&o.length>0&&o.item(0).parentNode.removeChild(o.item(0)),o=this._addFinalDiv()),o.tabIndex=h._getHighestTabIndexInList(s)),this._hideAllOtherFlyouts(this),this._previousFocus=t.document.activeElement)}},_endShow:function(){this._keyboardWasUp=a._Overlay._keyboardInfo._visible;h.hasClass(this.element,l.menuClass)?a._Overlay._trySetActive(this._element):(this._focusOnFirstFocusableElementOrThis(),a._Overlay._addHideFocusClass(t.document.activeElement))},_lightDismiss:function(){this._isLightDismissible()&&a._Overlay._lightDismissFlyouts()},_findPosition:function(){this._nextHeight=null;this._keyboardMovedUs=!1;this._hasScrolls=!1;this._keyboardSquishedUs=0;this._checkToggle&&this._checkToggle();this._updateAdjustments(this._currentAlignment);this._getTopLeft();this._scrollTop=this._nextTop-a._Overlay._keyboardInfo._visibleDocTop;this._nextTop<0?(this._element.style.bottom="0px",this._element.style.top="auto"):(this._element.style.top=this._nextTop+"px",this._element.style.bottom="auto");this._nextLeft<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._nextLeft+"px",this._element.style.right="auto");null!==this._nextHeight&&(h.addClass(this._element,l.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._nextHeight+"px",this._nextBottom=this._nextTop+this._nextHeight,this._hasScrolls=!0);a._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_getTopLeft:function(){var r=this._currentAnchor.getBoundingClientRect(),i={},t={};switch(t.top=r.top,t.bottom=r.bottom,t.left=r.left,t.right=r.right,t.height=t.bottom-t.top,t.width=t.right-t.left,i.marginTop=v(this._element,"marginTop"),i.marginBottom=v(this._element,"marginBottom"),i.marginLeft=v(this._element,"marginLeft"),i.marginRight=v(this._element,"marginRight"),i.width=h.getTotalWidth(this._element),i.height=h.getTotalHeight(this._element),i.innerWidth=h.getContentWidth(this._element),i.innerHeight=h.getContentHeight(this._element),this._nextMarginPadding=i.height-i.innerHeight,this._currentPlacement){case"top":this._fitTop(t,i)||(this._nextTop=a._Overlay._keyboardInfo._visibleDocTop,this._nextHeight=t.top-a._Overlay._keyboardInfo._visibleDocTop-this._nextMarginPadding);this._centerHorizontally(t,i,this._currentAlignment);break;case"bottom":this._fitBottom(t,i)||(this._nextTop=-1,this._nextHeight=a._Overlay._keyboardInfo._visibleDocHeight-(t.bottom-a._Overlay._keyboardInfo._visibleDocTop)-this._nextMarginPadding);this._centerHorizontally(t,i,this._currentAlignment);break;case"left":this._fitLeft(t,i)||(this._nextLeft=0);this._centerVertically(t,i);break;case"right":this._fitRight(t,i)||(this._nextLeft=-1);this._centerVertically(t,i);break;case"autovertical":this._fitTop(t,i)||this._fitBottom(t,i)||this._configureVerticalWithScroll(t);this._centerHorizontally(t,i,this._currentAlignment);break;case"autohorizontal":this._fitLeft(t,i)||this._fitRight(t,i)||(this._nextLeft=-1);this._centerVertically(t,i);break;case"auto":this._sometimesFitsAbove(t,i)?(this._fitTop(t,i)||this._fitBottom(t,i),this._centerHorizontally(t,i,this._currentAlignment)):this._fitLeft(t,i)||this._fitRight(t,i)?this._centerVertically(t,i):(this._configureVerticalWithScroll(t),this._centerHorizontally(t,i,this._currentAlignment));break;default:throw new u("WinJS.UI.Flyout.BadPlacement",n.badPlacement);}this._nextBottom=this._nextTop+i.height},_configureVerticalWithScroll:function(n){this._topHasMoreRoom(n)?(this._nextTop=a._Overlay._keyboardInfo._visibleDocTop,this._nextHeight=n.top-a._Overlay._keyboardInfo._visibleDocTop-this._nextMarginPadding):(this._nextTop=-1,this._nextHeight=a._Overlay._keyboardInfo._visibleDocHeight-(n.bottom-a._Overlay._keyboardInfo._visibleDocTop)-this._nextMarginPadding)},_sometimesFitsAbove:function(n,t){return(a._Overlay._keyboardInfo._visibleDocHeight-n.height)/2>=t.height},_topHasMoreRoom:function(n){return n.top>a._Overlay._keyboardInfo._visibleDocHeight-n.bottom},_fitTop:function(n,t){return this._nextTop=n.top-t.height,this._nextAnimOffset={top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},this._nextTop>=a._Overlay._keyboardInfo._visibleDocTop&&this._nextTop+t.height<=a._Overlay._keyboardInfo._visibleDocBottom},_fitBottom:function(n,t){return this._nextTop=n.bottom,this._nextAnimOffset={top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},this._nextTop>=a._Overlay._keyboardInfo._visibleDocTop&&this._nextTop+t.height<=a._Overlay._keyboardInfo._visibleDocBottom},_fitLeft:function(n,t){return this._nextLeft=n.left-t.width,this._nextAnimOffset={top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},this._nextLeft>=0&&this._nextLeft+t.width<=a._Overlay._keyboardInfo._visualViewportWidth},_fitRight:function(n,t){return this._nextLeft=n.right,this._nextAnimOffset={top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"},this._nextLeft>=0&&this._nextLeft+t.width<=a._Overlay._keyboardInfo._visualViewportWidth},_centerVertically:function(n,t){this._nextTop=n.top+n.height/2-t.height/2;this._nextTop<a._Overlay._keyboardInfo._visibleDocTop?this._nextTop=a._Overlay._keyboardInfo._visibleDocTop:this._nextTop+t.height>=a._Overlay._keyboardInfo._visibleDocBottom&&(this._nextTop=-1)},_centerHorizontally:function(i,r,f){if("center"===f)this._nextLeft=i.left+i.width/2-r.width/2;else if("left"===f)this._nextLeft=i.left;else{if("right"!==f)throw new u("WinJS.UI.Flyout.BadAlignment",n.badAlignment);this._nextLeft=i.right-r.width}this._nextLeft<0?this._nextLeft=0:this._nextLeft+r.width>=t.document.documentElement.clientWidth&&(this._nextLeft=-1)},_updateAdjustments:function(n){this._element.style.top="0px";this._element.style.bottom="auto";this._element.style.left="0px";this._element.style.right="auto";h.removeClass(this._element,l.scrollsClass);null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null);"center"===n?(h.removeClass(this._element,"win-leftalign"),h.removeClass(this._element,"win-rightalign")):"left"===n?(h.addClass(this._element,"win-leftalign"),h.removeClass(this._element,"win-rightalign")):"right"===n&&(h.addClass(this._element,"win-rightalign"),h.removeClass(this._element,"win-leftalign"))},_showingKeyboard:function(n){if(!this.hidden&&(n.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var i=this;t.setTimeout(function(){i._adjustForKeyboard();i._baseAnimateIn()},a._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._needToHandleHidingKeyboard){var n=this;r._setImmediate(function(){n._findPosition()});this._needToHandleHidingKeyboard=!1}},_checkKeyboardFit:function(){var t=h.getTotalHeight(this._element),n=a._Overlay._keyboardInfo._visibleDocHeight-this._nextMarginPadding;t>n?(this._keyboardMovedUs=!0,this._scrollTop=0,this._keyboardSquishedUs=n):-1===this._nextTop?this._keyboardMovedUs=!0:this._nextTop<a._Overlay._keyboardInfo._visibleDocTop?(this._scrollTop=0,this._keyboardMovedUs=!0):this._nextBottom>a._Overlay._keyboardInfo._visibleDocBottom&&(this._scrollTop=-1,this._keyboardMovedUs=!0)},_adjustForKeyboard:function(){this._keyboardSquishedUs&&(this._hasScrolls||(h.addClass(this._element,l.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._keyboardSquishedUs+"px");this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(a._Overlay._keyboardInfo._isResized)this._needToHandleHidingKeyboard=!0;else{var n=this;r._setImmediate(function(){n._findPosition()})}},_checkScrollPosition:function(n){(!this.hidden||n)&&(this._scrollTop<0?(this._element.style.bottom=a._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=a._Overlay._keyboardInfo._visibleDocTop+"px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",o.showPopup(this._element,this._nextAnimOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,o.hidePopup(this._element,this._nextAnimOffset))},_hideAllOtherFlyouts:function(n){for(var i,u=t.document.querySelectorAll("."+l.flyoutClass),r=0;r<u.length;r++)i=u[r].winControl,i&&!i.hidden&&i!==n&&i.hide()},_isThereVisibleFlyout:function(){for(var r,i=t.document.querySelectorAll("."+l.flyoutClass),n=0;n<i.length;n++)if(r=i[n].winControl,r&&!r.hidden)return!0;return!1},_handleKeyDown:function(n){n.keyCode===c.escape&&n.keyCode!==c.IME?(n.preventDefault(),n.stopPropagation(),this.winControl._keyboardInvoked=!0,this.winControl._hide()):n.keyCode!==c.space&&n.keyCode!==c.enter||this!==t.document.activeElement?!n.shiftKey||n.keyCode!==c.tab||this!==t.document.activeElement||n.altKey||n.ctrlKey||n.metaKey||(n.preventDefault(),n.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(n.preventDefault(),n.stopPropagation(),this.winControl.hide())},_addFirstDiv:function(){var n=t.document.createElement("div"),i;return n.className=l.firstDivClass,n.style.display="inline",n.setAttribute("role","menuitem"),n.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(n,this._element.children[0]):this._element.appendChild(n),i=this,h._addEventListener(n,"focusin",function(){i._focusOnLastFocusableElementOrThis()},!1),n},_addFinalDiv:function(){var n=t.document.createElement("div"),i;return n.className=l.finalDivClass,n.style.display="inline",n.setAttribute("role","menuitem"),n.setAttribute("aria-hidden","true"),this._element.appendChild(n),i=this,h._addEventListener(n,"focusin",function(){i._focusOnFirstFocusableElementOrThis()},!1),n},_writeProfilerMark:function(n){e("WinJS.UI.Flyout:"+this._id+":"+n)}})})})});t("WinJS/Controls/Toolbar/_Constants",["require","exports"],function(n,t){t.controlCssClass="win-toolbar";t.actionAreaCssClass="win-toolbar-actionarea";t.overflowButtonCssClass="win-toolbar-overflowbutton";t.ellipsisCssClass="win-toolbar-ellipsis";t.overflowAreaCssClass="win-toolbar-overflowarea";t.overflowContentFlyoutCssClass="win-toolbar-contentflyout";t.detachedModeCssClass="win-toolbar-detached";t.attachedModeCssClass="win-toolbar-attached";t.emptyToolbarCssClass="win-toolbar-empty";t.menuCssClass="win-menu";t.menuToggleClass="win-menu-toggle";t.overflowModeAttached="attached";t.overflowModeDetached="detached";t.contentMenuCommandDefaultLabel="Custom content";t.typeSeparator="separator";t.typeContent="content";t.typeButton="button";t.typeToggle="toggle";t.typeFlyout="flyout"});t("WinJS/Controls/AppBar/_Icon",["exports","../../Core/_Base","../../Core/_Resources"],function(n,t,i){"use strict";var r=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview"].reduce(function(n,t){return n[t]={get:function(){return i._getWinJSString("ui/appBarIcons/"+t).value}},n},{});t.Namespace._moduleDefine(n,"WinJS.UI.AppBarIcon",r)});t("WinJS/Controls/AppBar/_Command",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../Flyout/_Overlay","../Tooltip","./_Constants","./_Icon"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{AppBarCommand:r.Namespace._lazy(function(){function v(n){var r=this.winControl,i;r&&(r._type===l.typeToggle?r.selected=!r.selected:r._type===l.typeFlyout&&r._flyout&&(i=r._flyout,"string"==typeof i&&(i=t.document.getElementById(i)),i.show||(i=i.winControl),i&&i.show&&i.show(this,"autovertical")),r.onclick&&r.onclick(n))}var n={get ariaLabel(){return f._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badDivElement(){return"Invalid argument: For a content command, the element must be null or a div element"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"},get badPriority(){return"Invalid argument: the priority of an {0} must be a non-negative integer"}};return r.Class.define(function(t,i){var o,r,f;if(t&&t.winControl)throw new u("WinJS.UI.AppBarCommand.DuplicateConstruction",n.duplicateConstruction);(this._disposed=!1,i||(i={}),i.type||(this._type=l.typeButton),i.section=i.section||l.sectionPrimary,this._element=t,i.type===l.typeContent?this._createContent():i.type===l.typeSeparator?this._createSeparator():this._createButton(),s.addClass(this._element,"win-disposable"),this._element.winControl=this,s.addClass(this._element,l.appBarCommandClass),i.onclick&&(this.onclick=i.onclick),i.onclick=v,e.setOptions(this,i),this._type!==l.typeToggle||i.selected||(this.selected=!1),this._type!==l.typeSeparator)&&(o=this,s._addEventListener(this._element,"pointerdown",function(){h._Overlay._addHideFocusClass(o._element)},!1),r=this._element.getAttribute("role"),(null===r||""===r||void 0===r)&&(r=this._type===l.typeToggle?"menuitemcheckbox":this._type===l.typeContent?"group":"menuitem",this._element.setAttribute("role",r),this._type===l.typeFlyout&&this._element.setAttribute("aria-haspopup",!0)),f=this._element.getAttribute("aria-label"),(null===f||""===f||void 0===f)&&this._element.setAttribute("aria-label",n.ariaLabel))},{id:{get:function(){return this._element.id},set:function(n){n&&!this._element.id&&(this._element.id=n)}},type:{get:function(){return this._type},set:function(n){this._type||(this._type=n!==l.typeContent&&n!==l.typeFlyout&&n!==l.typeToggle&&n!==l.typeSeparator?l.typeButton:n)}},label:{get:function(){return this._label},set:function(n){this._label=n;this._labelSpan&&(this._labelSpan.textContent=this.label);!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label);this._element.setAttribute("aria-label",this.label);this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(n){this._icon=a[n]||n;this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none"))}},onclick:{get:function(){return this._onclick},set:function(t){if(t&&"function"!=typeof t)throw new u("WinJS.UI.AppBarCommand.BadClick",f._formatString(n.badClick,"AppBarCommand"));this._onclick=t}},priority:{get:function(){return this._priority},set:function(t){if(!(void 0===t||"number"==typeof t&&t>=0))throw new u("WinJS.UI.AppBarCommand.BadPriority",f._formatString(n.badPriority,"AppBarCommand"));this._priority=t}},flyout:{get:function(){var n=this._flyout;return"string"==typeof n&&(n=t.document.getElementById(n)),n&&!n.element&&n.winControl&&(n=n.winControl),n},set:function(n){var t=n;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=s._uniqueID(t),t=t.id)));"string"==typeof t&&this._element.setAttribute("aria-owns",t);this._flyout=n}},section:{get:function(){return this._section},set:function(n){(!this._section||i.Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(n)}},tooltip:{get:function(){return this._tooltip},set:function(n){this._tooltip=n;this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip);this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(n){this._element.setAttribute("aria-checked",n)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(n){this._element.disabled=n}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(n){if(n!==this.hidden){var t=this._element.style,i=t.visibility,r=t.display;if(n?(t.visibility="hidden",t.display="none"):(t.visibility="",t.display="inline-block"),!this._sendEvent(l.commandVisibilityChanged))throw t.visibility=i,t.display=r,new u("WinJS.UI.AppBarCommand.CannotChangeHiddenProperty",f._formatString(h._Overlay.commonstrings.cannotChangeHiddenProperty,""));}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(n){this._firstElementFocus=n===this.element?null:n;this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(n){this._lastElementFocus=n===this.element?null:n;this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===l.typeContent&&o.disposeSubTree(this.element))},addEventListener:function(n,t,i){return this._element.addEventListener(n,t,i)},removeEventListener:function(n,t,i){return this._element.removeEventListener(n,t,i)},extraClass:{get:function(){return this._extraClass},set:function(n){this._extraClass&&s.removeClass(this._element,this._extraClass);this._extraClass=n;s.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new u("WinJS.UI.AppBarCommand.BadDivElement",n.badDivElement);}else this._element=t.document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new u("WinJS.UI.AppBarCommand.BadHrElement",n.badHrElement);}else this._element=t.document.createElement("hr")},_createButton:function(){var i,r;if(this._element){if("BUTTON"!==this._element.tagName)throw new u("WinJS.UI.AppBarCommand.BadButtonElement",n.badButtonElement);i=this._element.getAttribute("type");(null===i||""===i||void 0===i)&&this._element.setAttribute("type","button");this._element.innerHTML=""}else this._element=t.document.createElement("button");this._element.type="button";this._iconSpan=t.document.createElement("span");this._iconSpan.setAttribute("aria-hidden","true");this._iconSpan.className="win-commandicon win-commandring";this._iconSpan.tabIndex=-1;this._element.appendChild(this._iconSpan);this._imageSpan=t.document.createElement("span");this._imageSpan.setAttribute("aria-hidden","true");this._imageSpan.className="win-commandimage";this._imageSpan.tabIndex=-1;this._iconSpan.appendChild(this._imageSpan);this._labelSpan=t.document.createElement("span");this._labelSpan.setAttribute("aria-hidden","true");this._labelSpan.className="win-label";this._labelSpan.tabIndex=-1;this._element.appendChild(this._labelSpan);this._tooltipControl=new c.Tooltip(this._element);r=this;this._tooltipControl.addEventListener("beforeopen",function(){r._hideIfFullSize&&!h._Overlay._getParentControlUsingClassName(r._element.parentElement,l.reducedClass)&&r._tooltipControl.close()},!1)},_setSection:function(n){n||(n=l.sectionPrimary);this._section&&(this._section===l.sectionGlobal?s.removeClass(this._element,l.appBarCommandGlobalClass):this.section===l.sectionSelection&&s.removeClass(this._element,l.appBarCommandSelectionClass));this._section=n;n===l.sectionGlobal?s.addClass(this._element,l.appBarCommandGlobalClass):n===l.sectionSelection&&s.addClass(this._element,l.appBarCommandSelectionClass)},_updateTabStop:function(){this.element.tabIndex=this._firstElementFocus||this._lastElementFocus?-1:0},_isFocusable:function(){return!this.hidden&&this._type!==l.typeSeparator&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)},_sendEvent:function(n,i){if(!this._disposed){var r=t.document.createEvent("CustomEvent");return r.initEvent(n,!0,!0,i||{}),this._element.dispatchEvent(r)}}})})});r.Namespace._moduleDefine(n,"WinJS.UI",{Command:r.Namespace._lazy(function(){return n.AppBarCommand})})});t("WinJS/Controls/Menu/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Constants","../Flyout/_Overlay"],function(n,t,i,r,u,f,e,o,s){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{MenuCommand:i.Namespace._lazy(function(){var n={get ariaLabel(){return u._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}};return i.Class.define(function(t,i){var u,s;if(t&&t.winControl)throw new r("WinJS.UI.MenuCommand.DuplicateConstruction",n.duplicateConstruction);(this._disposed=!1,i||(i={}),i.type||(this._type=o.typeButton),this._element=t,i.type===o.typeSeparator?this._createSeparator():this._createButton(),e.addClass(this._element,"win-disposable"),this._element.winControl=this,e.addClass(this._element,o.menuCommandClass),i.selected||i.type!==o.typeToggle||(this.selected=!1),i.onclick&&(this.onclick=i.onclick),i.onclick=this._handleMenuClick.bind(this),f.setOptions(this,i),this._type!==o.typeSeparator)&&(u=this._element.getAttribute("role"),(null===u||""===u||void 0===u)&&(u="menuitem",this._type===o.typeToggle&&(u="menuitemcheckbox"),this._element.setAttribute("role",u),this._type===o.typeFlyout&&this._element.setAttribute("aria-haspopup",!0)),s=this._element.getAttribute("aria-label"),(null===s||""===s||void 0===s)&&this._element.setAttribute("aria-label",n.ariaLabel));this._handleMouseMoveBound=this._handleMouseMove.bind(this);this._element.addEventListener("mouseover",this._handleMouseOver.bind(this),!1);this._element.addEventListener("mouseout",this._handleMouseOut.bind(this),!1)},{id:{get:function(){return this._element.id},set:function(n){this._element.id||(this._element.id=n)}},type:{get:function(){return this._type},set:function(n){this._type||(this._type=n!==o.typeButton&&n!==o.typeFlyout&&n!==o.typeToggle&&n!==o.typeSeparator?o.typeButton:n)}},label:{get:function(){return this._label},set:function(n){this._label=n||"";this._element.textContent=this.label;this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(t){if(t&&"function"!=typeof t)throw new r("WinJS.UI.MenuCommand.BadClick",u._formatString(n.badClick,"MenuCommand"));this._onclick=t}},flyout:{get:function(){var n=this._flyout;return"string"==typeof n&&(n=t.document.getElementById(n)),n&&!n.element&&(n=n.winControl),n},set:function(n){var t=n;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=e._uniqueID(t),t=t.id)));"string"==typeof t&&this._element.setAttribute("aria-owns",t);this._flyout=n}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(n){this._element.setAttribute("aria-checked",!!n)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(n){this._element.disabled=!!n}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(n){var i=s._Overlay._getParentControlUsingClassName(this._element,o.menuClass),t;if(i&&!i.hidden)throw new r("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",u._formatString(s._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));t=this._element.style;n?(t.visibility="hidden",t.display="none"):(t.visibility="",t.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(n){this._extraClass&&e.removeClass(this._element,this._extraClass);this._extraClass=n;e.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0,this._flyout&&this._flyout.dispose())},addEventListener:function(n,t,i){return this._element.addEventListener(n,t,i)},removeEventListener:function(n,t,i){return this._element.removeEventListener(n,t,i)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new r("WinJS.UI.MenuCommand.BadHrElement",n.badHrElement);}else this._element=t.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new r("WinJS.UI.MenuCommand.BadButtonElement",n.badButtonElement);this._element.innerHTML=""}else this._element=t.document.createElement("button");this._element.type="button"},_handleMenuClick:function(n){var i=this,u,r;i&&(u=!0,i._type===o.typeToggle?i.selected=!i.selected:i._type===o.typeFlyout&&i._flyout&&(r=i._flyout,"string"==typeof r&&(r=t.document.getElementById(r)),r.show||(r=r.winControl),r&&r.show&&(i._parentFlyout?(u=!1,r.show(i._parentFlyout._currentAnchor,i._parentFlyout._currentPlacement,i._parentFlyout._currentAlignment)):r.show(this.element))),i.onclick&&i.onclick(n),u&&i._parentFlyout&&i._parentFlyout.hide())},_handleMouseOver:function(){this&&this.element&&this.element.focus&&(this.element.focus(),this.element.addEventListener("mousemove",this._handleMouseMoveBound,!1))},_handleMouseMove:function(){this&&this.element&&this.element.focus&&this.element!==t.document.activeElement&&this.element.focus()},_handleMouseOut:function(){var n=this._getParentFlyout(this.element);n&&this.element===t.document.activeElement&&e.hasClass(n,o.menuClass)&&n.focus?n.focus():n&&this.element===t.document.activeElement&&n.children&&n.children.length>0&&n.children[0]&&e.hasClass(n.children[0],o.firstDivClass)&&n.children[0].focus&&n.children[0].focus();this.element.removeEventListener("mousemove",this._handleMouseMoveBound,!1)},_getParentFlyout:function(n){for(;n&&!e.hasClass(n,o.flyoutClass);)n=n.parentElement;return n}})})})});t("WinJS/Controls/Menu",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout","./Flyout/_Overlay","./Menu/_Command","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{Menu:i.Namespace._lazy(function(){var n=o.Key,s={get ariaLabel(){return f._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get nullCommand(){return"Invalid argument: command must not be null"}},v=i.Class.derive(c.Flyout,function(n,i){i=i||{};this._element=n||t.document.createElement("div");this._id=this._element.id||o._uniqueID(this._element);this._writeProfilerMark("constructor,StartTM");!i.commands&&this._element&&(i=r._shallowCopy(i),i.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var u=this._element?this._element.getAttribute("role"):null,f=this._element?this._element.getAttribute("aria-label"):null;this._baseFlyoutConstructor(this._element,i);(null===u||""===u||void 0===u)&&this._element.setAttribute("role","menu");(null===f||""===f||void 0===f)&&this._element.setAttribute("aria-label",s.ariaLabel);this._element.addEventListener("keydown",this._handleKeyDown,!0);o.addClass(this._element,h.menuClass);this.hide();this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(n){if(!this.hidden)throw new u("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",f._formatString(l._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));o.empty(this._element);Array.isArray(n)||(n=[n]);for(var i=n.length,t=0;i>t;t++)this._addCommand(n[t])}},getCommandById:function(n){for(var r=this.element.querySelectorAll("#"+n),t=[],i=0,u=r.length;u>i;i++)r[i].winControl&&t.push(r[i].winControl);return 1===t.length?t[0]:0===t.length?null:t},showCommands:function(n){if(!n)throw new u("WinJS.UI.Menu.RequiresCommands",s.requiresCommands);this._showCommands(n,!0)},hideCommands:function(n){if(!n)throw new u("WinJS.UI.Menu.RequiresCommands",s.requiresCommands);this._hideCommands(n,!0)},showOnlyCommands:function(n){if(!n)throw new u("WinJS.UI.Menu.RequiresCommands",s.requiresCommands);this._showOnlyCommands(n,!0)},show:function(n,t,i){this._writeProfilerMark("show,StartTM");this._show(n,t,i)},_show:function(n,t,i){this._checkForFlyoutCommands();this._baseFlyoutShow(n,t,i)},_addCommand:function(n){if(!n)throw new u("WinJS.UI.Menu.NullCommand",s.nullCommand);n._element||(n=new a.MenuCommand(null,n));n._element.parentElement&&n._element.parentElement.removeChild(n._element);this._element.appendChild(n._element)},_checkToggle:function(){var t=this._element.querySelectorAll(".win-command[aria-checked]"),i=!1,n;if(t)for(n=0;n<t.length;n++)if(t[n]&&t[n].winControl&&!t[n].winControl.hidden){i=!0;break}i?o.addClass(this._element,h.menuToggleClass):o.removeClass(this._element,h.menuToggleClass)},_checkForFlyoutCommands:function(){for(var t=this._element.querySelectorAll(".win-command"),n=0;n<t.length;n++)t[n].winControl&&(t[n].winControl._parentFlyout=this)},_handleKeyDown:function(i){var r=this;i.keyCode===n.escape?(this.winControl._keyboardInvoked=!0,this.winControl._hide()):i.keyCode!==n.space&&i.keyCode!==n.enter||this!==t.document.activeElement?i.keyCode===n.upArrow?(v._focusOnPreviousElement(r),i.preventDefault()):i.keyCode===n.downArrow?(v._focusOnNextElement(r),i.preventDefault()):i.keyCode===n.tab&&i.preventDefault():(i.preventDefault(),this.winControl.hide())},_writeProfilerMark:function(n){e("WinJS.UI.Menu:"+this._id+":"+n)}});return v._focusOnNextElement=function(n){var i=t.document.activeElement;do i=i===n?i.firstElementChild:i.nextElementSibling,i?i.focus():i=n;while(i!==t.document.activeElement)},v._focusOnPreviousElement=function(n){var i=t.document.activeElement;do i=i===n?i.lastElementChild:i.previousElementSibling,i?i.focus():i=n;while(i!==t.document.activeElement)},v})})});r=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};t("WinJS/Controls/Toolbar/_MenuCommand",["require","exports","../Menu/_Command"],function(n,t,i){var u=function(n){function t(t,i,r){r&&r.beforeOnClick&&(this._beforeOnClick=r.beforeOnClick);this._isAttachedMode=t;n.call(this,i,r)}return r(t,n),t.prototype._handleMenuClick=function(t){this._beforeOnClick&&this._beforeOnClick(t);n.prototype._handleMenuClick.call(this,t)},t.prototype._handleMouseOver=function(){this._isAttachedMode||n.prototype._handleMouseOver.call(this)},t.prototype._handleMouseOut=function(){this._isAttachedMode||n.prototype._handleMouseOut.call(this)},t}(i.MenuCommand);t._MenuCommand=u});t("WinJS/Controls/Toolbar",["require","exports","../Animations","../Core/_Base","../Core/_BaseUtils","../BindingList","../ControlProcessor","./Toolbar/_Constants","./AppBar/_Command","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Core/_ErrorFromName","../Controls/Flyout","../Core/_Global","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Controls/Menu","./Menu/_Command","../Core/_Resources","../Scheduler","./Toolbar/_MenuCommand","../Core/_WriteProfilerMark"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";var it={get ariaLabel(){return d._getWinJSString("ui/toolbarAriaLabel").value},get overflowButtonAriaLabel(){return d._getWinJSString("ui/toolbarOverflowButtonAriaLabel").value},get badOverflowMode(){return"Invalid argument: The overflowMode property must be 'attached' or 'detached'"},get badData(){return"Invalid argument: The data property must an instance of a WinJS.Binding.List"},get mustContainCommands(){return"The toolbar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"}},rt=function(){function n(n,t){var i,e,s,r,f;return"undefined"==typeof t&&(t={}),i=this,this._measured=!1,this._initializing=!0,this._hoverable=p.isHoverable,this._dataChangedEvents=["itemchanged","iteminserted","itemmoved","itemremoved","reload"],this._element=n||y.document.createElement("div"),this._element.winControl=this,this._id=this._element.id||l._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),l.addClass(this._element,o.controlCssClass),this._disposed=!1,l.addClass(this._element,"win-disposable"),e=this._element.getAttribute("role"),e||this._element.setAttribute("role","menubar"),s=this._element.getAttribute("aria-label"),s||this._element.setAttribute("aria-label",it.ariaLabel),this._refreshBound=this._refresh.bind(this),this._setupTree(),t.data||(t=u._shallowCopy(t),t.data=this._getDataFromDOMElements()),t.overflowMode||(t.overflowMode=o.overflowModeDetached),h.setOptions(this,t),this._resizeHandlerBound=this._resizeHandler.bind(this),l._resizeNotifier.subscribe(this._element,this._resizeHandlerBound),r=y.document.body.contains(this._element),(l._addInsertedNotifier(this._element),r)?(this._measureCommands(),this._positionCommands()):(f=function(){i._writeProfilerMark("_setupTree_WinJSNodeInserted:initiallyParented:"+r+",info");i._element.removeEventListener("WinJSNodeInserted",f,!1);i._measureCommands();i._positionCommands()},this._element.addEventListener("WinJSNodeInserted",f,!1)),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this._winKeyboard=new w._WinKeyboard(this.element),this._initializing=!1,this._writeProfilerMark("constructor,StopTM"),this}return Object.defineProperty(n.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"overflowMode",{get:function(){return this._overflowMode},set:function(n){if(this._writeProfilerMark("set_overflowMode,info"),n!==this._overflowMode){if(n!==o.overflowModeAttached&&n!==o.overflowModeDetached)throw new a("WinJS.UI.Toolbar.BadOverflowMode",it.badOverflowMode);this._overflowMode=n;n===o.overflowModeDetached?(l.addClass(this.element,o.detachedModeCssClass),l.removeClass(this.element,o.attachedModeCssClass)):(l.addClass(this.element,o.attachedModeCssClass),l.removeClass(this.element,o.detachedModeCssClass),this._attachedOverflowArea||(this._attachedOverflowArea=y.document.createElement("div"),l.addClass(this._attachedOverflowArea,o.overflowAreaCssClass),l.addClass(this._attachedOverflowArea,o.menuCssClass),this.element.appendChild(this._attachedOverflowArea)));this._initializing||this._positionCommands()}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(n){if(this._writeProfilerMark("set_data,info"),n!==this.data){if(!(n instanceof f.List))throw new a("WinJS.UI.Toolbar.BadData",it.badData);this._data&&this._removeDataListeners();this._data=n;this._addDataListeners();this._dataUpdated()}},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this._disposed||(l._resizeNotifier.unsubscribe(this._element,this._resizeHandlerBound),this._customContentFlyout&&(this._customContentFlyout.dispose(),this._customContentFlyout.element.parentNode.removeChild(this._customContentFlyout.element)),this._menu&&(this._menu.dispose(),this._menu.element.parentNode.removeChild(this._menu.element)),c.disposeSubTree(this.element),this._disposed=!0)},n.prototype.forceLayout=function(){this._positionCommands()},n.prototype._writeProfilerMark=function(n){tt("WinJS.UI.Toolbar:"+this._id+":"+n)},n.prototype._isAttachedMode=function(){return this.overflowMode===o.overflowModeAttached},n.prototype._setupTree=function(){var n=this;this._writeProfilerMark("_setupTree,info");this._primaryCommands=[];this._secondaryCommands=[];this._mainActionArea=y.document.createElement("div");l.addClass(this._mainActionArea,o.actionAreaCssClass);l._reparentChildren(this.element,this._mainActionArea);this.element.appendChild(this._mainActionArea);this._overflowButton=y.document.createElement("button");this._overflowButton.tabIndex=0;this._overflowButton.innerHTML="<span class='"+o.ellipsisCssClass+"'><\/span>";l.addClass(this._overflowButton,o.overflowButtonCssClass);this._mainActionArea.appendChild(this._overflowButton);this._overflowButton.addEventListener("click",function(){var t="rtl"===y.getComputedStyle(n._element).direction;n._menu.show(n._overflowButton,"autovertical",t?"left":"right")});this._overflowButtonWidth=l.getTotalWidth(this._overflowButton)},n.prototype._getFocusableElementsInfo=function(){var i=this,n={elements:[],focusedIndex:-1},t=Array.prototype.slice.call(this._mainActionArea.children);return this._isAttachedMode()&&(t=t.concat(Array.prototype.slice.call(this._attachedOverflowArea.children))),t.forEach(function(t){i._isElementFocusable(t)&&(n.elements.push(t),t.contains(y.document.activeElement)&&(n.focusedIndex=n.elements.length-1))}),n},n.prototype._dataUpdated=function(){var t=this,n,r;this._writeProfilerMark("_dataUpdated,info");n=this._getDataChangeInfo();r=i._createUpdateListAnimation(n.addedElements,n.deletedElements,n.currentElements);n.deletedElements.forEach(function(n){n.parentElement&&n.parentElement.removeChild(n)});n.dataElements.forEach(function(n){t._mainActionArea.appendChild(n)});this._overflowButton&&this._mainActionArea.appendChild(this._overflowButton);this._primaryCommands=[];this._secondaryCommands=[];this.data.length>0?(l.removeClass(this.element,o.emptyToolbarCssClass),this.data.forEach(function(n){"secondary"===n.section?t._secondaryCommands.push(n):t._primaryCommands.push(n)}),this._initializing||(this._measureCommands(),this._positionCommands())):l.addClass(this.element,o.emptyToolbarCssClass);r.execute()},n.prototype._getDataChangeInfo=function(){for(var t,n=0,i=0,r=[],u=[],e=[],f=[],n=0,i=this.data.length;i>n;n++)r.push(this.data.getAt(n).element);for(n=0,i=this._mainActionArea.children.length;i>n;n++)t=this._mainActionArea.children[n],"none"!==t.style.display&&(f.push(t),-1===r.indexOf(t)&&t!==this._overflowButton&&u.push(t));return r.forEach(function(n){-1===u.indexOf(n)&&-1===f.indexOf(n)&&e.push(n)}),{dataElements:r,deletedElements:u,addedElements:e,currentElements:f}},n.prototype._refresh=function(){var n=this;this._refreshPending||(this._refreshPending=!0,g.schedule(function(){n._refreshPending&&!n._disposed&&(n._dataUpdated(),n._refreshPending=!1)},g.Priority.high,null,"WinJS.UI.Toolbar._refresh"))},n.prototype._addDataListeners=function(){var n=this;this._dataChangedEvents.forEach(function(t){n._data.addEventListener(t,n._refreshBound,!1)})},n.prototype._removeDataListeners=function(){var n=this;this._dataChangedEvents.forEach(function(t){n._data.removeEventListener(t,n._refreshBound,!1)})},n.prototype._isElementFocusable=function(n){var i=!1,t;return n&&(t=n.winControl,i=t?"none"!==t.element.style.display&&t.type!==o.typeSeparator&&!t.hidden&&!t.disabled&&(!t.firstElementFocus||t.firstElementFocus.tabIndex>=0||t.lastElementFocus.tabIndex>=0):"none"!==n.style.display&&"hidden"!==getComputedStyle(n).visibility&&n.tabIndex>=0),i},n.prototype._isMainActionCommand=function(n){return n&&n.winControl&&n.parentElement===this._mainActionArea},n.prototype._getLastElementFocus=function(n){return this._isMainActionCommand(n)?n.winControl.lastElementFocus:n},n.prototype._getFirstElementFocus=function(n){return this._isMainActionCommand(n)?n.winControl.firstElementFocus:n},n.prototype._keyDownHandler=function(n){var i;if(!n.altKey){if(l._matchesSelector(n.target,".win-interactive, .win-interactive *"))return;var u,r=l.Key,f="rtl"===y.getComputedStyle(this._element).direction,t=this._getFocusableElementsInfo();if(t.elements.length)switch(n.keyCode){case f?r.rightArrow:r.leftArrow:case r.upArrow:i=Math.max(0,t.focusedIndex-1);u=this._getLastElementFocus(t.elements[i%t.elements.length]);break;case f?r.leftArrow:r.rightArrow:case r.downArrow:i=Math.min(t.focusedIndex+1,t.elements.length-1);u=this._getFirstElementFocus(t.elements[i]);break;case r.home:i=0;u=this._getFirstElementFocus(t.elements[i]);break;case r.end:i=t.elements.length-1;!this._isAttachedMode()&&this._isElementFocusable(this._overflowButton)&&(i=Math.max(0,i-1));u=this._getLastElementFocus(t.elements[i])}u&&(u.focus(),n.preventDefault())}},n.prototype._getDataFromDOMElements=function(){this._writeProfilerMark("_getDataFromDOMElements,info");e.processAll(this._mainActionArea,!0);for(var n,i=[],r=this._mainActionArea.children.length,t=0;r>t;t++)if(n=this._mainActionArea.children[t],n.winControl&&n.winControl instanceof s.AppBarCommand)i.push(n.winControl);else if(!this._overflowButton)throw new a("WinJS.UI.Toolbar.MustContainCommands",it.mustContainCommands);return new f.List(i)},n.prototype._resizeHandler=function(){this.element.offsetWidth>0&&this._positionCommands()},n.prototype._commandUniqueId=function(n){return l._uniqueID(n.element)},n.prototype._getCommandsInfo=function(){for(var n,i=0,r=[],u=0,f=0,t=this._primaryCommands.length-1;t>=0;t--)n=this._primaryCommands[t],u=void 0===n.priority?f--:n.priority,i="none"===n.element.style.display?0:this._getCommandWidth(n),r.unshift({command:n,width:i,priority:u});return r},n.prototype._getPrimaryCommandsLocation=function(n){this._writeProfilerMark("_getCommandsLocation,info");for(var r=[],u=[],f=0,c=this._secondaryCommands.length>0,e=this._getCommandsInfo(),i=e.slice(0).sort(function(n,t){return n.priority-t.priority}),o=Number.MAX_VALUE,s=n,t=0,h=i.length;h>t;t++)if(s-=i[t].width,f=this._isAttachedMode()||c||h-1>t?this._overflowButtonWidth:0,0>s-f){o=i[t].priority-1;break}return e.forEach(function(n){n.priority<=o?r.push(n.command):u.push(n.command)}),{mainArea:r,overflowArea:u}},n.prototype._getCommandWidth=function(n){return n.type===o.typeContent?this._customContentCommandsWidth[this._commandUniqueId(n)]:n.type===o.typeSeparator?this._separatorWidth:this._standardCommandWidth},n.prototype._measureCommands=function(){var n=this;this._writeProfilerMark("_measureCommands,info");!this._disposed&&y.document.body.contains(this._element)&&(this._customContentCommandsWidth={},this._separatorWidth=0,this._standardCommandWidth=0,this._primaryCommands.forEach(function(t){t.element.parentElement||n._mainActionArea.appendChild(t.element);t.type===o.typeContent?n._customContentCommandsWidth[n._commandUniqueId(t)]=l.getTotalWidth(t.element):t.type===o.typeSeparator?n._separatorWidth||(n._separatorWidth=l.getTotalWidth(t.element)):n._standardCommandWidth||(n._standardCommandWidth=l.getTotalWidth(t.element))}),this._overflowButton&&!this._overflowButtonWidth&&(this._overflowButtonWidth=l.getTotalWidth(this._overflowButton)),this._measured=!0)},n.prototype._positionCommands=function(){if(this._writeProfilerMark("_positionCommands,StartTM"),this._disposed||!this._measured)return void this._writeProfilerMark("_positionCommands,StopTM");this._overflowButton&&this._mainActionArea.appendChild(this._overflowButton);this._primaryCommands.forEach(function(n){n.element.style.display=n.hidden?"none":""});var t=l.getTotalWidth(this.element),n=this._getPrimaryCommandsLocation(t);this._hideSeparatorsIfNeeded(n.mainArea);n.overflowArea.forEach(function(n){n.element.style.display="none"});this._secondaryCommands.forEach(function(n){n.element.style.display="none"});this._setupOverflowArea(n.overflowArea);this._writeProfilerMark("_positionCommands,StopTM")},n.prototype._getMenuCommand=function(n){var i=this,t=new nt._MenuCommand(this._isAttachedMode(),null,{label:n.label,type:(n.type===o.typeContent?o.typeFlyout:n.type)||o.typeButton,disabled:n.disabled,flyout:n.flyout,beforeOnClick:function(){i._chosenCommand=t._originalToolbarCommand;i._chosenCommand.type===o.typeToggle&&(i._chosenCommand.selected=!i._chosenCommand.selected)}});return n.selected&&(t.selected=!0),n.extraClass&&(t.extraClass=n.extraClass),n.type===o.typeContent?(t.label||(t.label=o.contentMenuCommandDefaultLabel),t.flyout=this._customContentFlyout):t.onclick=n.onclick,t._originalToolbarCommand=n,t},n.prototype._setupOverflowArea=function(n){if(this._isAttachedMode())this._overflowButton.style.display="",this._overflowButton.style.visibility="hidden",this._setupOverflowAreaAttached(n);else{var t=n.length>0||this._secondaryCommands.length>0;this._overflowButton.style.display=t?"":"none";this._overflowButton.style.visibility="";this._setupOverflowAreaDetached(n)}},n.prototype._setupOverflowAreaAttached=function(n){var t=this,i,r,u;this._writeProfilerMark("_setupOverflowAreaAttached,info");i=!1;l.empty(this._attachedOverflowArea);this._hideSeparatorsIfNeeded(n);n.forEach(function(n){n.type===o.typeToggle&&(i=!0);t._attachedOverflowArea.appendChild(t._getMenuCommand(n).element)});r=this._secondaryCommands.length;n.length>0&&r>0&&(u=new nt._MenuCommand(this._isAttachedMode(),null,{type:o.typeSeparator}),this._attachedOverflowArea.appendChild(u.element));this._hideSeparatorsIfNeeded(this._secondaryCommands);this._secondaryCommands.forEach(function(n){n.hidden||(n.type===o.typeToggle&&(i=!0),t._attachedOverflowArea.appendChild(t._getMenuCommand(n).element))});l[i?"addClass":"removeClass"](this._attachedOverflowArea,o.menuToggleClass)},n.prototype._setupOverflowAreaDetached=function(n){var t=this,u,r,f,i;this._writeProfilerMark("_setupOverflowAreaDetached,info");u=function(n){return n.type===o.typeContent};r=n.filter(u);(0===r.length&&(r=this._secondaryCommands.filter(u)),r.length>0&&!this._customContentFlyout)&&(f=y.document.createElement("div"),this._customContentContainer=y.document.createElement("div"),l.addClass(this._customContentContainer,o.overflowContentFlyoutCssClass),f.appendChild(this._customContentContainer),this._customContentFlyout=new v.Flyout(f),y.document.body.appendChild(this._customContentFlyout.element),this._customContentFlyout.onbeforeshow=function(){l.empty(t._customContentContainer);l._reparentChildren(t._chosenCommand.element,t._customContentContainer)},this._customContentFlyout.onafterhide=function(){l._reparentChildren(t._customContentContainer,t._chosenCommand.element)});this._menu||(this._menu=new b.Menu,l.addClass(this._menu.element,o.overflowAreaCssClass),y.document.body.appendChild(this._menu.element));i=[];n.forEach(function(n){i.push(t._getMenuCommand(n))});n.length>0&&this._secondaryCommands.length>0&&i.push(new k.MenuCommand(null,{type:o.typeSeparator}));this._secondaryCommands.forEach(function(n){n.hidden||i.push(t._getMenuCommand(n))});this._hideSeparatorsIfNeeded(i);this._menu.commands=i},n.prototype._hideSeparatorsIfNeeded=function(n){var i,r=o.typeSeparator,u=n.length,t;for(n.forEach(function(n){n.type===o.typeSeparator&&r===o.typeSeparator&&(n.element.style.display="none");r=n.type}),t=u-1;t>=0&&(i=n[t],i.type===o.typeSeparator);t--)i.element.style.display="none"},n.supportedForProcessing=!0,n}();t.Toolbar=rt;r.Class.mix(rt,h.DOMEventMixin);r.Namespace.define("WinJS.UI",{Toolbar:rt})});t("WinJS/Controls/AppBar/_Layouts",["exports","../../Animations/_TransitionAnimation","../../BindingList","../../Core/_BaseUtils","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Controls/Toolbar","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Command","./_Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";f.Namespace._moduleDefine(n,"WinJS.UI",{_AppBarBaseLayout:f.Namespace._lazy(function(){var n=w.appBarLayoutCustom,t={get nullCommand(){return"Invalid argument: command must not be null"}};return f.Class.define(function(n,t){this._disposed=!1;t=t||{};a.setOptions(this,t);n&&this.connect(n)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||n}},commandsInOrder:{get:function(){var n=this.appBarEl.querySelectorAll("."+w.appBarCommandClass);return Array.prototype.slice.call(n)}},connect:function(n){this.className&&y.addClass(n,this.className);this.appBarEl=n},disconnect:function(){this.className&&y.removeClass(this.appBarEl,this.className);this.appBarEl=null;this.dispose()},layout:function(n){for(var r,i=n.length,t=0;i>t;t++)r=this.sanitizeCommand(n[t]),this.appBarEl.appendChild(r._element)},sanitizeCommand:function(n){if(!n)throw new e("WinJS.UI.AppBar.NullCommand",t.nullCommand);return n=n.winControl||n,n._element||(n=new p.AppBarCommand(null,n)),n._element.parentElement&&n._element.parentElement.removeChild(n._element),n},dispose:function(){this._disposed=!0},disposeChildren:function(){var t=this.appBarEl.querySelectorAll("."+w.firstDivClass),n,i;t=t.length>=1?t[0]:null;n=this.appBarEl.querySelectorAll("."+w.finalDivClass);n=n.length>=1?n[0]:null;for(var u=this.appBarEl.children,f=u.length,r=0;f>r;r++)i=u[r],i!==t&&i!==n&&v.disposeSubTree(i)},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){},positionChanging:function(){return c.wrap()}})})});f.Namespace._moduleDefine(n,"WinJS.UI",{_AppBarCommandsLayout:f.Namespace._lazy(function(){var i=w.commandLayoutClass,r=w.appBarLayoutCommands,t=f.Class.derive(n._AppBarBaseLayout,function(t){n._AppBarBaseLayout.call(this,t,{_className:i,_type:r});this._commandLayoutsInit(t)},{_getWidthOfFullSizeCommands:function(n){var i,t,e;this._needToMeasureNewCommands&&this._measureContentCommands();var r=0,u=0,f=0;if(!n)return this._fullSizeWidthOfLastKnownVisibleCommands;for(t=0,e=n.length;e>t;t++)i=n[t].winControl||n[t],i._type===w.typeSeparator?u++:i._type!==w.typeContent?f++:r+=i._fullSizeWidth;return r+(u*w.separatorWidth+f*w.buttonWidth)},_getFocusableCommandsInLogicalOrder:function(){var i=this._secondaryCommands.children,r=this._primaryCommands.children,n=-1,f=function(t){for(var i,e,r=[],f=0,o=t.length;o>f;f++)i=t[f],y.hasClass(i,w.appBarCommandClass)&&i.winControl&&(e=i.contains(u.document.activeElement),(i.winControl._isFocusable()||e)&&(r.push(i),e&&(n=r.length-1)));return r},e=Array.prototype.slice.call(i).concat(Array.prototype.slice.call(r)),t=f(e);return t.focusedIndex=n,t}});return f.Class.mix(t,b),t})});var b={layout:function(n){var i,r,t;for(y.empty(this._primaryCommands),y.empty(this._secondaryCommands),this._commandsInOriginalOrder=[],i=0,r=n.length;r>i;i++)t=this.sanitizeCommand(n[i]),this._commandsInOriginalOrder.push(t.element),"primary"===t.section||"global"===t.section?this._primaryCommands.appendChild(t._element):this._secondaryCommands.appendChild(t._element);this.appBarEl.appendChild(this._secondaryCommands);this.appBarEl.appendChild(this._primaryCommands);this._needToMeasureNewCommands=!0;l.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),l.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},commandsInOrder:{get:function(){return this._commandsInOriginalOrder.filter(function(n){return this.appBarEl.contains(n)},this)}},disposeChildren:function(){v.disposeSubTree(this._primaryCommands);v.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(n){var i=y.Key,f,h,t,r;if(!y._matchesSelector(n.target,".win-interactive, .win-interactive *")){var e="rtl"===u.getComputedStyle(this.appBarEl).direction,o=e?i.rightArrow:i.leftArrow,s=e?i.leftArrow:i.rightArrow;if(n.keyCode===o||n.keyCode===s||n.keyCode===i.home||n.keyCode===i.end){if(h=this._primaryCommands.contains(u.document.activeElement),t=this._getFocusableCommandsInLogicalOrder(h),t.length)switch(n.keyCode){case o:r=Math.max(-1,t.focusedIndex-1)+t.length;f=t[r%t.length].winControl.lastElementFocus;break;case s:r=t.focusedIndex+1+t.length;f=t[r%t.length].winControl.firstElementFocus;break;case i.home:r=0;f=t[r].winControl.firstElementFocus;break;case i.end:r=t.length-1;f=t[r].winControl.lastElementFocus}f&&(f.focus(),n.preventDefault())}}},commandsUpdated:function(n){var t=n?n:this.commandsInOrder.filter(function(n){return!n.winControl.hidden});this._fullSizeWidthOfLastKnownVisibleCommands=this._getWidthOfFullSizeCommands(t)},beginAnimateCommands:function(n,t,i){var r,u;this._scaleAfterAnimations=!1;r=this._getWidthOfFullSizeCommands(n)-this._getWidthOfFullSizeCommands(t);r>0?(u=i.concat(n),this.commandsUpdated(u),this.scale()):0>r&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},scale:function(){var n=this._getWidthOfFullSizeCommands();this._appBarTotalKnownWidth!==+this._appBarTotalKnownWidth&&(this._appBarTotalKnownWidth=this._scaleHelper());n<=this._appBarTotalKnownWidth?y.removeClass(this.appBarEl,w.reducedClass):y.addClass(this.appBarEl,w.reducedClass)},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.hidden||this.scale())},disconnect:function(){y.removeClass(this.appBarEl,w.reducedClass);n._AppBarBaseLayout.prototype.disconnect.call(this)},_commandLayoutsInit:function(){this._primaryCommands=u.document.createElement("DIV");this._secondaryCommands=u.document.createElement("DIV");y.addClass(this._primaryCommands,w.primaryCommandsClass);y.addClass(this._secondaryCommands,w.secondaryCommandsClass)},_scaleHelper:function(){var n="minimal"===this.appBarEl.winControl.closedDisplayMode?w.appBarInvokeButtonWidth:0;return u.document.documentElement.clientWidth-n},_measureContentCommands:function(){var i,r,f;if(u.document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;i=y.hasClass(this.appBarEl,w.reducedClass);y.removeClass(this.appBarEl,w.reducedClass);r=y.hasClass(this.appBarEl,w.hiddenClass);y.removeClass(this.appBarEl,w.hiddenClass);f=this.appBarEl.style.display;this.appBarEl.style.display="";for(var e,n,o=this.appBarEl.querySelectorAll("div."+w.appBarCommandClass),t=0,s=o.length;s>t;t++)n=o[t],n.winControl&&n.winControl._type===w.typeContent&&(e=n.style.display,n.style.display="",n.winControl._fullSizeWidth=y.getTotalWidth(n)||0,n.style.display=e);this.appBarEl.style.display=f;i&&y.addClass(this.appBarEl,w.reducedClass);r&&y.addClass(this.appBarEl,w.hiddenClass);this.commandsUpdated()}}};f.Namespace._moduleDefine(n,"WinJS.UI",{_AppBarDrawerLayout:f.Namespace._lazy(function(){var e=w.drawerLayoutClass,o=w.appBarLayoutDrawer;return f.Class.derive(n._AppBarBaseLayout,function(t){n._AppBarBaseLayout.call(this,t,{_className:e,_type:o});this._tranformNames=r._browserStyleEquivalents.transform},{layout:function(n){this._writeProfilerMark("layout,info");this._drawer?y.empty(this._drawer):(this._drawer=u.document.createElement("div"),y.addClass(this._drawer,w.drawerContainerClass),this.appBarEl.appendChild(this._drawer));this._toolbarContainer=u.document.createElement("div");y.addClass(this._toolbarContainer,w.toolbarContainerClass);this._drawer.appendChild(this._toolbarContainer);this._toolbarEl=u.document.createElement("div");this._toolbarContainer.appendChild(this._toolbarEl);this._createToolbar(n)},connect:function(t){this._writeProfilerMark("connect,info");n._AppBarBaseLayout.prototype.connect.call(this,t);this._id=y._uniqueID(t)},resize:function(){this._writeProfilerMark("resize,info");this._forceLayoutPending=!0},positionChanging:function(n,t){return this._writeProfilerMark("positionChanging from:"+n+" to: "+t+",info"),"shown"===t?this._animateToolbarEntrance():this._animateToolbarExit()},disposeChildren:function(){this._writeProfilerMark("disposeChildren,info");this._toolbar&&v.disposeSubTree(this._toolbar)},_createToolbar:function(n){var t,r,u,f,e;this._writeProfilerMark("_createToolbar,info");t=[];r=this;n.forEach(function(n){t.push(r.sanitizeCommand(n))});u=y.hasClass(this.appBarEl,w.reducedClass);y.removeClass(this.appBarEl,w.reducedClass);f=y.hasClass(this.appBarEl,w.hiddenClass);y.removeClass(this.appBarEl,w.hiddenClass);e=this.appBarEl.style.display;this.appBarEl.style.display="";this._toolbar=new h.Toolbar(this._toolbarEl,{data:new i.List(t),overflowMode:"attached"});this._positionToolbar();this.appBarEl.style.display=e;u&&y.addClass(this.appBarEl,w.reducedClass);f&&y.addClass(this.appBarEl,w.hiddenClass)},_positionToolbar:function(){this._writeProfilerMark("_positionToolbar,info");var n=this._toolbarEl.offsetHeight-(this._isMinimal()&&!this._isBottom()?0:this.appBarEl.offsetHeight),t=this._toolbarEl.offsetHeight-(this._isMinimal()?0:this.appBarEl.offsetHeight);this._toolbarContainer.style[this._tranformNames.scriptName]="translateY(0px)";this._drawer.style[this._tranformNames.scriptName]="translateY(-"+n+"px)";this._toolbarEl.style[this._tranformNames.scriptName]="translateY("+t+"px)"},_animateToolbarEntrance:function(){this._writeProfilerMark("_animateToolbarEntrance,info");this._forceLayoutPending&&(this._forceLayoutPending=!1,this._toolbar.forceLayout(),this._positionToolbar());var n,t,i=this._isMinimal()?0:this.appBarEl.offsetHeight;return this._isBottom()?(n=this._executeTranslate(this._toolbarContainer,"translateY("+(this._toolbarContainer.offsetHeight-i)+"px)"),t=this._executeTranslate(this._toolbarEl,"translateY("+-(this._toolbarContainer.offsetHeight-i)+"px)")):(n=this._executeTranslate(this._toolbarContainer,"translateY("+(this._toolbarContainer.offsetHeight-i)+"px)"),t=this._executeTranslate(this._toolbarEl,"translateY(0px)")),c.join([n,t])},_animateToolbarExit:function(){this._writeProfilerMark("_animateToolbarExit,info");var n=this._isMinimal()?0:this.appBarEl.offsetHeight,t=this._executeTranslate(this._toolbarContainer,"translateY(0px)"),i=this._executeTranslate(this._toolbarEl,"translateY("+(this._toolbarContainer.offsetHeight-n)+"px)");return c.join([t,i])},_executeTranslate:function(n,i){return t.executeTransition(n,{property:this._tranformNames.cssName,delay:0,duration:400,timing:"ease-in",to:i})},_isMinimal:function(){return"minimal"===this.appBarEl.winControl.closedDisplayMode},_isBottom:function(){return"bottom"===this.appBarEl.winControl.placement},_writeProfilerMark:function(n){s("WinJS.UI._AppBarDrawerLayout:"+this._id+":"+n)}})})})});t("WinJS/Controls/AppBar",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./AppBar/_Constants","./AppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","./Flyout/_Overlay","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{AppBar:r.Namespace._lazy(function(){function at(n){if(!g._Overlay._containsRightMouseClick||n.kind!==i.Windows.UI.Input.EdgeGestureKind.mouse)if(k)k=null;else{var t=n.kind===i.Windows.UI.Input.EdgeGestureKind.keyboard;y._toggleAllAppBarsState(t)}}function vt(){k||(k=y._toggleAllAppBarsState(!1))}function yt(){var n=st();"showing"===k?g._Overlay._hideAppBars(n,!1):"hiding"===k&&g._Overlay._showAppBars(n,!1);k=null}function pt(n){var r=t.document.querySelectorAll("."+w.appBarClass),e,i,u,f;if(r)for(e=r.length,i=0;e>i;i++)u=r[i],f=u.winControl,f&&!u.disabled&&f._manipulationChanged(n)}function st(){var f=t.document.querySelectorAll("."+w.appBarClass),e=f.length,n=[],r,u,i;for(n._shown=!1,n._hidden=!1,r=0;e>r;r++)u=f[r],u.disabled||(i=u.winControl,i&&(n.push(i),v.hasClass(i._element,w.hiddenClass)||v.hasClass(i._element,w.hidingClass)?n._hidden=!0:n._shown=!0));return n}function nt(n,t,i){for(var r,u=n;u>=0;u--)if(r=i[u].winControl,r&&r.placement===t&&!r.hidden&&r._focusOnLastFocusableElement&&r._focusOnLastFocusableElement())return!0;return!1}function wt(){var n=t.document.querySelectorAll("."+w.appBarClass),i,r,u;if(n.length){for(i=0,r=0;r<n.length;r++)if(n[r]===this.parentElement){i=r;break}if(u=this.parentElement.winControl,u.placement===w.appBarPlacementBottom){if(i&&nt(i-1,w.appBarPlacementBottom,n))return;if(nt(n.length-1,w.appBarPlacementTop,n))return;if(nt(n.length-1,w.appBarPlacementBottom,n))return}else if(u.placement===w.appBarPlacementTop){if(i&&nt(i-1,w.appBarPlacementTop,n))return;if(nt(n.length-1,w.appBarPlacementBottom,n))return;if(nt(n.length-1,w.appBarPlacementTop,n))return}}}function tt(n,t,i){for(var r,u=n;u<i.length;u++)if(r=i[u].winControl,r&&r.placement===t&&!r.hidden&&r._focusOnFirstFocusableElement&&r._focusOnFirstFocusableElement())return!0;return!1}function bt(){for(var n=t.document.querySelectorAll("."+w.appBarClass),r=0,i=0;i<n.length;i++)if(n[i]===this.parentElement){r=i;break}if(this.parentElement.winControl.placement===w.appBarPlacementBottom){if(tt(r+1,w.appBarPlacementBottom,n))return;if(tt(0,w.appBarPlacementTop,n))return;if(tt(0,w.appBarPlacementBottom,n))return}else if(this.parentElement.winControl.placement===w.appBarPlacementTop){if(tt(r+1,w.appBarPlacementTop,n))return;if(tt(0,w.appBarPlacementBottom,n))return;if(tt(0,w.appBarPlacementTop,n))return}}function ut(){for(var n,r=t.document.querySelectorAll("."+w.appBarClass),i=0;i<r.length;i++)n=r[i].winControl,n&&!n.hidden&&n._updateFirstAndFinalDiv&&n._updateFirstAndFinalDiv()}function it(){for(var i,u=t.document.querySelectorAll("."+w.appBarClass),r=0;r<u.length;r++)if(i=u[r].winControl,i&&!i.sticky&&(!i.hidden||i._element.winAnimating===n.shown))return!0;return!1}function kt(n){n.relatedTarget&&n.relatedTarget.focus&&!g._Overlay._isAppBarOrChild(n.relatedTarget)&&ft(n.relatedTarget)}function ft(n){n&&(g._Overlay._ElementWithFocusPreviousToAppBar=n)}function dt(){g._Overlay._trySetActive(g._Overlay._ElementWithFocusPreviousToAppBar)}var ht=v.Key,ct={disabled:0,none:0,hidden:0,minimal:25},n={disabled:"hidden",none:"hidden",hidden:"hidden",minimal:"minimal",shown:"shown"},rt={none:"none",minimal:"minimal"},et="shown",ot="hidden",lt=!1,k=null,d={get ariaLabel(){return e._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get cannotChangePlacementWhenVisible(){return"Invalid argument: The placement property cannot be set when the AppBar is visible, call hide() first"},get badLayout(){return"Invalid argument: The layout property must be 'custom', 'drawer' or 'commands'"},get cannotChangeLayoutWhenVisible(){return"Invalid argument: The layout property cannot be set when the AppBar is visible, call hide() first"}},y=r.Class.derive(g._Overlay,function(r,f){var s,h,e,c,o;return this._initializing=!0,f=f||{},this._element=r||t.document.createElement("div"),this._id=this._element.id||v._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),v.addClass(this._element,w.appBarClass),s=this._element.getAttribute("role"),s||this._element.setAttribute("role","menubar"),h=this._element.getAttribute("aria-label"),h||this._element.setAttribute("aria-label",d.ariaLabel),this._baseOverlayConstructor(this._element),this._lastPositionVisited=n.none,v.addClass(this._element,w.hiddenClass),f.layout!==w.appBarLayoutCustom&&!f.commands&&this._element&&(f=u._shallowCopy(f),f.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.AppBarCommand")),this._invokeButton=t.document.createElement("button"),this._invokeButton.tabIndex=0,this._invokeButton.innerHTML="<span class='"+w.ellipsisClass+"'><\/span>",v.addClass(this._invokeButton,w.invokeButtonClass),this._element.appendChild(this._invokeButton),e=this,v._addEventListener(this._invokeButton,"pointerdown",function(){g._Overlay._addHideFocusClass(e._invokeButton)},!1),this._invokeButton.addEventListener("click",function(){y._toggleAllAppBarsState(p._keyboardSeenLast,e)},!1),this.layout=f.layout||w.appBarLayoutCommands,delete f.layout,this.placement=f.placement||w.appBarPlacementBottom,this.closedDisplayMode=f.closedDisplayMode||rt.minimal,l.setOptions(this,f),c=this._commandsUpdated.bind(this),(this._element.addEventListener(w.commandVisibilityChanged,function(n){e._disposed||(e.hidden||n.preventDefault(),c())}),this._initializing=!1,this._setFocusToAppBarBound=this._setFocusToAppBar.bind(this),g._Overlay._createClickEatingDivAppBar(),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),lt)||(i.Windows.UI.Input.EdgeGesture&&(o=i.Windows.UI.Input.EdgeGesture.getForCurrentView(),o.addEventListener("starting",vt),o.addEventListener("completed",at),o.addEventListener("canceled",yt)),t.document.addEventListener("MSManipulationStateChanged",pt,!1),lt=!0),v._addEventListener(this._element,"focusin",function(n){kt(n)},!1),v._addEventListener(this._element,"focusout",function(){g._Overlay._hideIfAllAppBarsLostFocus()},!1),this.closedDisplayMode===rt.none&&this.layout===w.appBarLayoutCommands&&(this._element.style.display="none"),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(n){var t=!1;if(i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),t=!0),!this.hidden)throw new f("WinJS.UI.AppBar.CannotChangePlacementWhenVisible",d.cannotChangePlacementWhenVisible);this._placement=n===w.appBarPlacementTop?w.appBarPlacementTop:w.appBarPlacementBottom;this._placement===w.appBarPlacementTop?(v.addClass(this._element,w.topClass),v.removeClass(this._element,w.bottomClass)):this._placement===w.appBarPlacementBottom&&(v.removeClass(this._element,w.topClass),v.addClass(this._element,w.bottomClass));t&&this._show()}},layout:{get:function(){return this._layout.type},set:function(n){var r,t;if(n!==w.appBarLayoutCommands&&n!==w.appBarLayoutCustom&&n!==w.appBarLayoutDrawer)throw new f("WinJS.UI.AppBar.BadLayout",d.badLayout);if(r=!1,i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),r=!0),!this.hidden)throw new f("WinJS.UI.AppBar.CannotChangeLayoutWhenVisible",d.cannotChangeLayoutWhenVisible);this._initializing||(t=this._layout.commandsInOrder,this._layout.disconnect());this._layout=n===w.appBarLayoutCommands?new b._AppBarCommandsLayout:n===w.appBarLayoutDrawer?new b._AppBarDrawerLayout:new b._AppBarBaseLayout;this._layout.connect(this._element);t&&t.length&&this._layoutCommands(t);r&&this._show()},configurable:!0},sticky:{get:function(){return this._sticky},set:function(n){this._sticky!==!!n&&(this._sticky=!!n,this.hidden||"visible"!==this._element.style.visibility||(ut(),this._sticky?it()||g._Overlay._hideClickEatingDivAppBar():(g._Overlay._showClickEatingDivAppBar(),this._shouldStealFocus()&&(ft(t.document.activeElement),this._setFocusToAppBar()))))}},commands:{set:function(n){if(!this.hidden)throw new f("WinJS.UI.AppBar.CannotChangeCommandsWhenVisible",e._formatString(g._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"AppBar"));this._initializing||this._disposeChildren();this._layoutCommands(n)}},_layoutCommands:function(n){v.empty(this._element);this._element.appendChild(this._invokeButton);Array.isArray(n)||(n=[n]);this._layout.layout(n)},closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(t){var i=this._closedDisplayMode;i!==t&&(t===rt.none?(this._closedDisplayMode=rt.none,v.removeClass(this._element,w.minimalClass)):(this._closedDisplayMode=rt.minimal,v.addClass(this._element,w.minimalClass)),this._layout.resize(),(v.hasClass(this._element,w.hiddenClass)||v.hasClass(this._element,w.hidingClass))&&this._changeVisiblePosition(n[this._closedDisplayMode]))}},disabled:{get:function(){return!!this._element.disabled},set:function(t){var t=!!t,i;this.disabled!==t&&(this._element.disabled=t,i=t?n.disabled:n[this.closedDisplayMode],this._hide(i))}},hidden:{get:function(){return v.hasClass(this._element,w.hiddenClass)||v.hasClass(this._element,w.hidingClass)||this._doNext===n.minimal||this._doNext===n.none}},getCommandById:function(n){for(var r=this.element.querySelectorAll("#"+n),t=[],i=0,u=r.length;u>i;i++)r[i].winControl&&t.push(r[i].winControl);return 1===t.length?t[0]:0===t.length?null:t},showCommands:function(n){if(!n)throw new f("WinJS.UI.AppBar.RequiresCommands",d.requiresCommands);this._showCommands(n)},hideCommands:function(n){if(!n)throw new f("WinJS.UI.AppBar.RequiresCommands",d.requiresCommands);this._hideCommands(n)},showOnlyCommands:function(n){if(!n)throw new f("WinJS.UI.AppBar.RequiresCommands",d.requiresCommands);this._showOnlyCommands(n)},show:function(){this._writeProfilerMark("show,StartTM");this._keyboardInvoked=!1;this._doNotFocus=!!this.sticky;this._show()},_show:function(){var r=n.shown,i=null;!this.disabled&&(v.hasClass(this._element,w.hiddenClass)||v.hasClass(this._element,w.hidingClass))&&(i=et);this._changeVisiblePosition(r,i);i&&(this.sticky||g._Overlay._showClickEatingDivAppBar(),!this.sticky&&it()?ut():this._updateFirstAndFinalDiv(),!this._doNotFocus&&this._shouldStealFocus()&&(g._Overlay._ElementWithFocusPreviousToAppBar||ft(t.document.activeElement),this._positionChangingPromise.then(this._setFocusToAppBarBound,this._setFocusToAppBarBound)))},hide:function(){this._writeProfilerMark("hide,StartTM");this._hide()},_hide:function(i){var i=i||n[this.closedDisplayMode],o=null,f,s,h,c,b,l,e;if(v.hasClass(this._element,w.hiddenClass)||v.hasClass(this._element,w.hidingClass)||(o=ot),this._changeVisiblePosition(i,o),o){for(var u=t.document.querySelectorAll("."+w.appBarClass),a=!1,p=!1,r=0;r<u.length;r++)if(f=u[r].winControl,f&&!f.hidden&&f!==this&&(a=!0,!f.sticky)){p=!0;break}for(s=t.document.querySelectorAll("."+w.settingsFlyoutClass),h=!1,r=0;r<s.length;r++)if(c=s[r].winControl,c&&!c.hidden){h=!0;break}if(p||h||g._Overlay._hideClickEatingDivAppBar(),b=this,a){if(y._isWithinAppBarOrChild(t.document.activeElement,b.element))for(l=!1,r=0;r<=u.length;r++)if(r===u.length&&(r=0),e=u[r],e===this.element)l=!0;else if(l&&!e.winControl.hidden){e.winControl._keyboardInvoked=!!this._keyboardInvoked;e.winControl._setFocusToAppBar();break}}else g._Overlay._ElementWithFocusPreviousToAppBar&&(!t.document.activeElement||g._Overlay._isAppBarOrChild(t.document.activeElement))&&dt(),g._Overlay._ElementWithFocusPreviousToAppBar=null;this.sticky||it()||ut();this._keyboardInvoked=!1;this._doNotFocus=!1}},_dispose:function(){a.disposeSubTree(this.element);this._layout.dispose();this.disabled=!0},_disposeChildren:function(){this._layout.disposeChildren()},_isLightDismissible:function(){return g._Overlay.prototype._isLightDismissible.call(this)||it()},_handleKeyDown:function(n){n.keyCode===ht.escape&&n.keyCode!==ht.IME&&(n.preventDefault(),n.stopPropagation(),this._lightDismiss(!0));this._invokeButton.contains(t.document.activeElement)||this._layout.handleKeyDown(n)},_visiblePixels:{get:function(){return{hidden:ct.hidden,minimal:ct.minimal,shown:this._element.offsetHeight}}},_visiblePosition:{get:function(){return this._animating&&n[this._element.winAnimating]?this._element.winAnimating:this._lastPositionVisited}},_visible:{get:function(){return this._visiblePosition!==n.none}},_changeVisiblePosition:function(t,i){var r,u,f;this._visiblePosition===t&&!this._keyboardObscured||this.disabled&&t!==n.disabled?this._afterPositionChange(null):this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard?(this._doNext=t,this._afterPositionChange(null)):(this._element.winAnimating=t,r=this._initializing?!1:!0,u=this._lastPositionVisited,this._element.style.display="",f=t===n.hidden,this._keyboardObscured&&(f?r=!1:u=n.hidden,this._keyboardObscured=!1),i===et?this._beforeShow():i===ot&&this._beforeHide(),this._ensurePosition(),this._element.style.opacity=1,this._element.style.visibility="visible",this._animationPromise=r?this._animatePositionChange(u,t):h.wrap(),this._animationPromise.then(function(){this._afterPositionChange(t,i)}.bind(this),function(){this._afterPositionChange(t,i)}.bind(this)))},_afterPositionChange:function(t,i){if(!this._disposed){if(t){this._element.winAnimating="";this._lastPositionVisited=t;this._doNext===this._lastPositionVisited&&(this._doNext="");t===n.hidden&&(this._element.style.visibility="hidden",this._element.style.display="none");var r=u._browserStyleEquivalents.transform.scriptName;this._element.style[r]="";i===et?this._afterShow():i===ot&&this._afterHide();c.schedule(this._checkDoNext,c.Priority.normal,this,"WinJS.UI.AppBar._checkDoNext")}this._afterPositionChangeCallBack()}},_afterPositionChangeCallBack:function(){},_beforeShow:function(){this._cachedDocumentSize=this._cachedDocumentSize||g._Overlay._sizeOfDocument();this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]);this._layout.scale();v.removeClass(this._element,w.hiddenClass);v.addClass(this._element,w.showingClass);this._sendEvent(g._Overlay.beforeShow)},_afterShow:function(){v.removeClass(this._element,w.showingClass);v.addClass(this._element,w.shownClass);this._sendEvent(g._Overlay.afterShow);this._writeProfilerMark("show,StopTM")},_beforeHide:function(){v.removeClass(this._element,w.shownClass);v.addClass(this._element,w.hidingClass);this._sendEvent(g._Overlay.beforeHide)},_afterHide:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]);v.removeClass(this._element,w.hidingClass);v.addClass(this._element,w.hiddenClass);this._sendEvent(g._Overlay.afterHide);this._writeProfilerMark("hide,StopTM")},_animatePositionChange:function(n,t){var e,o;this._positionChangingPromise=this._layout.positionChanging(n,t);var i=this._visiblePixels[n],r=this._visiblePixels[t],u=Math.abs(r-i),f=this._placement===w.appBarPlacementTop?-u:u;return r>i?(e={top:f+"px",left:"0px"},s.showEdgeUI(this._element,e,{mechanism:"transition"})):(o={top:f+"px",left:"0px"},s.hideEdgeUI(this._element,o,{mechanism:"transition"}))},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||(this._doNext===n.disabled||this._doNext===n.hidden||this._doNext===n.minimal?(this._hide(this._doNext),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():this._doNext===n.shown&&(this._show(),this._doNext=""))},_isABottomAppBarInTheProcessOfShowing:function(){for(var r=t.document.querySelectorAll("."+w.appBarClass+"."+w.bottomClass),i=0;i<r.length;i++)if(r[i].winAnimating===n.shown)return!0;return!1},_shouldStealFocus:function(){var n=g._Overlay._isAppBarOrChild(t.document.activeElement),i;return this._element===n?!1:this._placement===w.appBarPlacementBottom?!0:(i=this._isABottomAppBarInTheProcessOfShowing(),n?n.winControl&&(n.winControl._placement===w.appBarPlacementBottom||n.winControl._placement===w.appBarPlacementTop||i)?!1:!0:!i)},_setFocusToAppBar:function(){this._focusOnFirstFocusableElement()?this._keyboardInvoked||g._Overlay._addHideFocusClass(t.document.activeElement):g._Overlay._trySetActive(this._element)},_commandsUpdated:function(){this._initializing||(this._layout.commandsUpdated(),this._layout.scale())},_beginAnimateCommands:function(n,t,i){this._layout.beginAnimateCommands(n,t,i)},_endAnimateCommands:function(){this._layout.endAnimateCommands();this._endAnimateCommandsCallBack()},_endAnimateCommandsCallBack:function(){},_getTopOfVisualViewport:function(){return g._Overlay._keyboardInfo._visibleDocTop},_getAdjustedBottom:function(){return g._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(n){if(this._keyboardObscured=!1,this._needToHandleHidingKeyboard=!1,!g._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._needToHandleShowingKeyboard=!0;!this.hidden&&this._element.contains(t.document.activeElement)&&(n.ensuredFocusedElementInView=!0);this._visible&&this._placement!==w.appBarPlacementTop&&g._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var i=this;t.setTimeout(function(n){i._checkKeyboardTimer(n)},g._Overlay._keyboardInfo._animationShowLength+g._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1;this._needToHandleShowingKeyboard=!1;this._needToHandleHidingKeyboard=!0;g._Overlay._keyboardInfo._isResized||((this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""),this._needToHandleHidingKeyboard=!1)},_resize:function(n){this._needToHandleShowingKeyboard?this._visible&&(this._placement===w.appBarPlacementTop||this._keyboardObscured||(this._element.style.display="none")):this._needToHandleHidingKeyboard&&(this._needToHandleHidingKeyboard=!1,(this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""));this._initializing||this._layout.resize(n)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(n){0===n.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){if(this._needToHandleShowingKeyboard)if(this._needToHandleShowingKeyboard=!1,this._keyboardObscured||this._placement===w.appBarPlacementTop&&0===g._Overlay._keyboardInfo._visibleDocTop)this._checkDoNext();else{var t=this._visiblePosition;this._lastPositionVisited=n.hidden;this._changeVisiblePosition(t,!1)}this._scrollHappened=!1},_ensurePosition:function(){var n=this._computePositionOffset();this._element.style.bottom=n.bottom;this._element.style.top=n.top},_computePositionOffset:function(){var n={};return this._placement===w.appBarPlacementBottom?(n.bottom=this._getAdjustedBottom()+"px",n.top=""):this._placement===w.appBarPlacementTop&&(n.bottom="",n.top=this._getTopOfVisualViewport()+"px"),n},_checkScrollPosition:function(){return this._needToHandleShowingKeyboard?void(this._scrollHappened=!0):void((this._visible||this._animating)&&(this._ensurePosition(),this._checkDoNext()))},_alreadyInPlace:function(){var n=this._computePositionOffset();return n.top===this._element.style.top&&n.bottom===this._element.style.bottom},_updateFirstAndFinalDiv:function(){var i=this._element.querySelectorAll("."+w.firstDivClass),n,r,u;i=i.length>=1?i[0]:null;n=this._element.querySelectorAll("."+w.finalDivClass);n=n.length>=1?n[0]:null;i&&this._element.children[0]!==i&&(i.parentNode.removeChild(i),i=null);n&&this._element.children[this._element.children.length-1]!==n&&(n.parentNode.removeChild(n),n=null);i||(i=t.document.createElement("div"),i.style.display="inline",i.className=w.firstDivClass,i.tabIndex=-1,i.setAttribute("aria-hidden","true"),v._addEventListener(i,"focusin",wt,!1),this._element.children[0]?this._element.insertBefore(i,this._element.children[0]):this._element.appendChild(i));n||(n=t.document.createElement("div"),n.style.display="inline",n.className=w.finalDivClass,n.tabIndex=-1,n.setAttribute("aria-hidden","true"),v._addEventListener(n,"focusin",bt,!1),this._element.appendChild(n));this._element.children[this._element.children.length-2]!==this._invokeButton&&this._element.insertBefore(this._invokeButton,n);r=this._element.getElementsByTagName("*");u=v._getHighestTabIndexInList(r);this._invokeButton.tabIndex=u;it()?(i&&(i.tabIndex=v._getLowestTabIndexInList(r)),n&&(n.tabIndex=u)):(i&&(i.tabIndex=-1),n&&(n.tabIndex=-1))},_writeProfilerMark:function(n){o("WinJS.UI.AppBar:"+this._id+":"+n)}},{_appBarsSynchronizationPromise:h.as(),_isWithinAppBarOrChild:function(n,t){if(!n||!t)return!1;if(t.contains(n))return!0;var i=g._Overlay._getParentControlUsingClassName(n,w.flyoutClass);return i&&t.contains(i._previousFocus)},_toggleAllAppBarsState:function(n,t){var r,i=st();return r=t?v.hasClass(t._element,w.showingClass)||v.hasClass(t._element,w.shownClass):i._shown&&!i._hidden,r?(y._appBarsSynchronizationPromise=y._appBarsSynchronizationPromise.then(function(){return g._Overlay._hideAppBars(i,n)}),"hiding"):(y._appBarsSynchronizationPromise=y._appBarsSynchronizationPromise.then(function(){return g._Overlay._showAppBars(i,n)}),"showing")}});return y})})});t("WinJS/Controls/AutoSuggestBox/_SearchSuggestionManagerShim",["exports","../../_Signal","../../Core/_Base","../../Core/_BaseUtils","../../Core/_Events","../../BindingList"],function(n,t,i,r,u){"use strict";var e={reset:0,itemInserted:1,itemRemoved:2,itemChanged:3},f={Query:0,Result:1,Separator:2},o=i.Class.derive(Array,function(){},{reset:function(){this.length=0;this.dispatchEvent("vectorchanged",{collectionChange:e.reset,index:0})},insert:function(n,t){this.splice(n,0,t);this.dispatchEvent("vectorchanged",{collectionChange:e.itemInserted,index:n})},remove:function(n){this.splice(n,1);this.dispatchEvent("vectorchanged",{collectionChange:e.itemRemoved,index:n})}});i.Class.mix(o,u.eventMixin);var h=i.Class.define(function(){this._data=[]},{size:{get:function(){return this._data.length}},appendQuerySuggestion:function(n){this._data.push({kind:f.Query,text:n})},appendQuerySuggestions:function(n){n.forEach(this.appendQuerySuggestion.bind(this))},appendResultSuggestion:function(n,t,i,r,u){this._data.push({kind:f.Result,text:n,detailText:t,tag:i,imageUrl:r,imageAlternateText:u,image:null})},appendSearchSeparator:function(n){this._data.push({kind:f.Separator,text:n})}}),c=i.Class.define(function(n,t,i){this._queryText=n;this._language=t;this._linguisticDetails=i;this._searchSuggestionCollection=new h},{language:{get:function(){return this._language}},linguisticDetails:{get:function(){return this._linguisticDetails}},queryText:{get:function(){return this._queryText}},searchSuggestionCollection:{get:function(){return this._searchSuggestionCollection}},getDeferral:function(){return this._deferralSignal||(this._deferralSignal=new t)},_deferralSignal:null}),s=i.Class.define(function(){this._updateVector=this._updateVector.bind(this);this._suggestionVector=new o;this._query="";this._history={"":[]};this._dataSource=[];this.searchHistoryContext="";this.searchHistoryEnabled=!0},{addToHistory:function(n){var u;if(n&&n.trim()){for(var t=this._history[this.searchHistoryContext],r=-1,i=0,e=t.length;e>i;i++)if(u=t[i],u.text.toLowerCase()===n.toLowerCase()){r=i;break}r>=0&&t.splice(r,1);t.splice(0,0,{text:n,kind:f.Query});this._updateVector()}},clearHistory:function(){this._history[this.searchHistoryContext]=[];this._updateVector()},setLocalContentSuggestionSettings:function(){},setQuery:function(n){function i(n){r._dataSource=n;r._updateVector()}var r=this,t;this._query=n;t=new c(n);this.dispatchEvent("suggestionsrequested",{request:t});t._deferralSignal?t._deferralSignal.promise.then(i.bind(this,t.searchSuggestionCollection._data)):i(t.searchSuggestionCollection._data)},searchHistoryContext:{get:function(){return""+this._searchHistoryContext},set:function(n){n=""+n;this._history[n]||(this._history[n]=[]);this._searchHistoryContext=n}},searchHistoryEnabled:{get:function(){return this._searchHistoryEnabled},set:function(n){this._searchHistoryEnabled=n}},suggestions:{get:function(){return this._suggestionVector}},_updateVector:function(){var n,t,i;for(this.suggestions.insert(this.suggestions.length,{text:"",kind:f.Query});this.suggestions.length>1;)this.suggestions.remove(0);n=0;t={};this.searchHistoryEnabled&&(i=this._query.toLowerCase(),this._history[this.searchHistoryContext].forEach(function(r){var u=r.text.toLowerCase();0===u.indexOf(i)&&(this.suggestions.insert(n,r),t[u]=!0,n++)},this));this._dataSource.forEach(function(i){i.kind===f.Query?t[i.text.toLowerCase()]||(this.suggestions.insert(n,i),n++):(this.suggestions.insert(n,i),n++)},this);this.suggestions.remove(this.suggestions.length-1)}});i.Class.mix(s,u.eventMixin);i.Namespace._moduleDefine(n,null,{_CollectionChange:e,_SearchSuggestionKind:f,_SearchSuggestionManagerShim:s})});t("WinJS/Controls/AutoSuggestBox",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Animations","../BindingList","../Promise","./Repeater","./AutoSuggestBox/_SearchSuggestionManagerShim"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";r.Namespace._moduleDefine(n,"WinJS.UI",{AutoSuggestBox:r.Namespace._lazy(function(){function k(i,r,u,f){function a(i,r,u){var f=t.document.createElement("span");return f.textContent=r,f.setAttribute("aria-hidden","true"),f.classList.add(n.asbHitHighlightSpan),i.insertBefore(f,u),f}var c,l,o,w;if(u){s.query("."+n.asbHitHighlightSpan,i).forEach(function(n){n.parentNode.removeChild(n)});c=i.firstChild;l=r.hits;!l&&f&&r.kind!==p._SearchSuggestionKind.Separator&&(l=f.find(u));for(var y=d._sortAndMergeHits(l),e=0,v=0;v<y.length;v++)o=y[v],a(i,u.substring(e,o.startPosition),c),e=o.startPosition+o.length,w=a(i,u.substring(o.startPosition,e),c),h.addClass(w,n.asbBoxFlyoutHighlightText);e<u.length&&a(i,u.substring(e),c)}}function g(n){var i={ctrlKey:1,altKey:2,shiftKey:4},t=0;return n.ctrlKey&&(t|=i.ctrlKey),n.altKey&&(t|=i.altKey),n.shiftKey&&(t|=i.shiftKey),t}function nt(i,r){var f=t.document.createElement("div"),o=new t.Image,c,u,a,s,v;return o.style.opacity=0,c=function(n){function t(){o.removeEventListener("load",t,!1);l.fadeIn(o)}o.addEventListener("load",t,!1);o.src=n},null!==r.image?r.image.openReadAsync().then(function(n){null!==n&&c(t.URL.createObjectURL(n,{oneTimeOnly:!0}))}):null!==r.imageUrl&&c(r.imageUrl),o.setAttribute("aria-hidden","true"),f.appendChild(o),u=t.document.createElement("div"),h.addClass(u,n.asbSuggestionResultText),k(u,r,r.text),u.title=r.text,u.setAttribute("aria-hidden","true"),f.appendChild(u),a=t.document.createElement("br"),u.appendChild(a),s=t.document.createElement("span"),h.addClass(s,n.asbSuggestionResultDetailedText),k(s,r,r.detailText),s.title=r.detailText,s.setAttribute("aria-hidden","true"),u.appendChild(s),h.addClass(f,n.asbSuggestionResult),h._addEventListener(f,"pointerup",function(n){i._inputElement.focus();i._processSuggestionChosen(r,n)}),f.setAttribute("role","option"),v=e._formatString(b.ariaLabelResult,r.text,r.detailText),f.setAttribute("aria-label",v),f}function tt(i,r){var u=t.document.createElement("div"),f;return k(u,r,r.text),u.title=r.text,u.classList.add(n.asbSuggestionQuery),h._addEventListener(u,"pointerup",function(n){i._inputElement.focus();i._processSuggestionChosen(r,n)}),f=e._formatString(b.ariaLabelQuery,r.text),u.setAttribute("role","option"),u.setAttribute("aria-label",f),u}function it(i){var r=t.document.createElement("div"),u,f;return i.text.length>0&&(u=t.document.createElement("div"),u.textContent=i.text,u.title=i.text,u.setAttribute("aria-hidden","true"),r.appendChild(u)),r.insertAdjacentHTML("beforeend","<hr/>"),h.addClass(r,n.asbSuggestionSeparator),r.setAttribute("role","separator"),f=e._formatString(b.ariaLabelSeparator,i.text),r.setAttribute("aria-label",f),r}var c=h.Key,n={asb:"win-autosuggestbox",asbDisabled:"win-autosuggestbox-disabled",asbFlyout:"win-autosuggestbox-flyout",asbFlyoutAbove:"win-autosuggestbox-flyout-above",asbBoxFlyoutHighlightText:"win-autosuggestbox-flyout-highlighttext",asbHitHighlightSpan:"win-autosuggestbox-hithighlight-span",asbInput:"win-autosuggestbox-input",asbInputFocus:"win-autosuggestbox-input-focus",asbSuggestionQuery:"win-autosuggestbox-suggestion-query",asbSuggestionResult:"win-autosuggestbox-suggestion-result",asbSuggestionResultText:"win-autosuggestbox-suggestion-result-text",asbSuggestionResultDetailedText:"win-autosuggestbox-suggestion-result-detailed-text",asbSuggestionSelected:"win-autosuggestbox-suggestion-selected",asbSuggestionSeparator:"win-autosuggestbox-suggestion-separator"},w={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested"},b={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get invalidSuggestionKind(){return"Error: Invalid suggestion kind."},get ariaLabel(){return e._getWinJSString("ui/autoSuggestBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return e._getWinJSString("ui/autoSuggestBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return e._getWinJSString("ui/autoSuggestBoxAriaLabelInputPlaceHolder").value},get ariaLabelQuery(){return e._getWinJSString("ui/autoSuggestBoxAriaLabelQuery").value},get ariaLabelResult(){return e._getWinJSString("ui/autoSuggestBoxAriaLabelResult").value},get ariaLabelSeparator(){return e._getWinJSString("ui/autoSuggestBoxAriaLabelSeparator").value}},d=r.Class.define(function(i,r){if(i=i||t.document.createElement("div"),r=r||{},i.winControl)throw new u("WinJS.UI.AutoSuggestBox.DuplicateConstruction",b.duplicateConstruction);this._suggestionsChangedHandler=this._suggestionsChangedHandler.bind(this);this._suggestionsRequestedHandler=this._suggestionsRequestedHandler.bind(this);this._element=i;i.winControl=this;i.classList.add(n.asb);i.classList.add("win-disposable");this._setupDOM();this._setupSSM();this._chooseSuggestionOnEnter=!1;this._currentFocusedIndex=-1;this._currentSelectedIndex=-1;this._flyoutOpenPromise=v.wrap();this._lastKeyPressLanguage="";this._prevLinguisticDetails=this._getLinguisticDetails();this._prevQueryText="";o.setOptions(this,r);this._hideFlyout()},{onresultsuggestionchosen:f._createEventProperty(w.resultsuggestionchosen),onquerychanged:f._createEventProperty(w.querychanged),onquerysubmitted:f._createEventProperty(w.querysubmitted),onsuggestionsrequested:f._createEventProperty(w.suggestionsrequested),element:{get:function(){return this._element}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(n){this._chooseSuggestionOnEnter=!!n}},disabled:{get:function(){return this._inputElement.disabled},set:function(n){this._inputElement.disabled!==!!n&&(n?this._disableControl():this._enableControl())}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(n){this._inputElement.placeholder=n;this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(n){this._inputElement.value=n}},searchHistoryDisabled:{get:function(){return!this._suggestionManager.searchHistoryEnabled},set:function(n){this._suggestionManager.searchHistoryEnabled=!n}},searchHistoryContext:{get:function(){return this._suggestionManager.searchHistoryContext},set:function(n){this._suggestionManager.searchHistoryContext=n}},dispose:function(){this._disposed||(this._flyoutOpenPromise.cancel(),this._suggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandler),this._suggestionManager=null,this._suggestions=null,this._hitFinder=null,this._disposed=!0)},setLocalContentSuggestionSettings:function(n){this._suggestionManager.setLocalContentSuggestionSettings(n)},_setupDOM:function(){function e(n){return f._renderSuggestion(n)}var u=this._flyoutPointerReleasedHandler.bind(this),i=this._inputOrImeChangeHandler.bind(this),r,f;this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",b.ariaLabel);this._element.setAttribute("role","group");this._inputElement=t.document.createElement("input");this._inputElement.type="search";this._inputElement.classList.add(n.asbInput);this._inputElement.setAttribute("role","textbox");this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this));this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this));this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this));this._inputElement.addEventListener("focus",this._inputFocusHandler.bind(this));this._inputElement.addEventListener("blur",this._inputBlurHandler.bind(this));this._inputElement.addEventListener("input",i);this._inputElement.addEventListener("compositionstart",i);this._inputElement.addEventListener("compositionupdate",i);this._inputElement.addEventListener("compositionend",i);h._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this));this._updateInputElementAriaLabel();this._element.appendChild(this._inputElement);r=this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext();r&&(r.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),r.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this)));this._flyoutElement=t.document.createElement("div");this._flyoutElement.classList.add(n.asbFlyout);this._flyoutElement.addEventListener("blur",this._flyoutBlurHandler.bind(this));h._addEventListener(this._flyoutElement,"pointerup",u);h._addEventListener(this._flyoutElement,"pointercancel",u);h._addEventListener(this._flyoutElement,"pointerout",u);h._addEventListener(this._flyoutElement,"pointerdown",this._flyoutPointerDownHandler.bind(this));this._element.appendChild(this._flyoutElement);f=this;this._suggestionsData=new a.List;this._repeaterElement=t.document.createElement("div");this._repeater=new y.Repeater(this._repeaterElement,{data:this._suggestionsData,template:e});h._ensureId(this._repeaterElement);this._repeaterElement.setAttribute("role","listbox");this._repeaterElement.setAttribute("aria-live","polite");this._flyoutElement.appendChild(this._repeaterElement)},_setupSSM:function(){this._suggestionManager=i.Windows.ApplicationModel.Search.Core.SearchSuggestionManager?new i.Windows.ApplicationModel.Search.Core.SearchSuggestionManager:new p._SearchSuggestionManagerShim;this._suggestions=this._suggestionManager.suggestions;this._suggestions.addEventListener("vectorchanged",this._suggestionsChangedHandler);this._suggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandler)},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutElement.style.display="none")},_showFlyout:function(){var f,e;if(!this._isFlyoutShown()&&0!==this._suggestionsData.length){this._flyoutElement.style.display="block";var i=this._inputElement.getBoundingClientRect(),r=this._flyoutElement.getBoundingClientRect(),u=t.document.documentElement.clientWidth,o=i.top,s=t.document.documentElement.clientHeight-i.bottom;this._flyoutBelowInput=s>=o;this._flyoutBelowInput?(this._flyoutElement.classList.remove(n.asbFlyoutAbove),this._flyoutElement.scrollTop=0):(this._flyoutElement.classList.add(n.asbFlyoutAbove),this._flyoutElement.scrollTop=this._flyoutElement.scrollHeight-this._flyoutElement.clientHeight);this._addFlyoutIMEPaddingIfRequired();f="rtl"===t.getComputedStyle(this._flyoutElement).direction?i.right-r.width>=0||i.left+r.width>u:i.left+r.width>u&&i.right-r.width>=0;this._flyoutElement.style.left=f?i.width-r.width-this._element.clientLeft+"px":"-"+this._element.clientLeft+"px";this._flyoutElement.style.touchAction=this._flyoutElement.scrollHeight>r.height?"pan-y":"none";this._flyoutOpenPromise.cancel();e=this._flyoutBelowInput?"WinJS-flyoutBelowASB-showPopup":"WinJS-flyoutAboveASB-showPopup";this._flyoutOpenPromise=l.showPopup(this._flyoutElement,{top:"0px",left:"0px",keyframe:e})}},_addFlyoutIMEPaddingIfRequired:function(){var t=this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext(),i,e;if(t&&this._isFlyoutShown()&&this._flyoutBelowInput){var o=this._flyoutElement.getBoundingClientRect(),n=t.getCandidateWindowClientRect(),r=this._inputElement.getBoundingClientRect(),u=r.bottom,f=r.bottom+o.height;(n.top<u||n.top>f)&&(n.bottom<u||n.bottom>f)||(i=t.getCandidateWindowClientRect(),e=l.createRepositionAnimation(this._flyoutElement),this._flyoutElement.style.marginTop=i.bottom-i.top+4+"px",e.execute())}},_findNextSuggestionElementIndex:function(n){for(var i=0>n?0:n+1,t=i;t<this._suggestionsData.length;t++)if(this._repeater.elementFromIndex(t)&&this._isSuggestionSelectable(this._suggestionsData.getAt(t)))return t;return-1},_findPreviousSuggestionElementIndex:function(n){for(var i=n>=this._suggestionsData.length?this._suggestionsData.length-1:n-1,t=i;t>=0;t--)if(this._repeater.elementFromIndex(t)&&this._isSuggestionSelectable(this._suggestionsData.getAt(t)))return t;return-1},_isFlyoutShown:function(){return"none"!==this._flyoutElement.style.display},_isSuggestionSelectable:function(n){return n.kind===p._SearchSuggestionKind.Query||n.kind===p._SearchSuggestionKind.Result},_processSuggestionChosen:function(n,t){this.queryText=n.text;n.kind===p._SearchSuggestionKind.Query?this._submitQuery(n.text,!1,t):n.kind===p._SearchSuggestionKind.Result&&this._fireEvent(w.resultsuggestionchosen,{tag:n.tag,keyModifiers:g(t),storageFile:null});this._hideFlyout()},_selectSuggestionAtIndex:function(t){function f(n){var t=i._flyoutElement.getBoundingClientRect().bottom-i._flyoutElement.getBoundingClientRect().top,r;n.offsetTop+n.offsetHeight>i._flyoutElement.scrollTop+t?(r=n.offsetTop+n.offsetHeight-(i._flyoutElement.scrollTop+t),h._zoomTo(i._flyoutElement,{contentX:0,contentY:i._flyoutElement.scrollTop+r,viewportX:0,viewportY:0})):n.offsetTop<i._flyoutElement.scrollTop&&h._zoomTo(i._flyoutElement,{contentX:0,contentY:n.offsetTop,viewportX:0,viewportY:0})}for(var i=this,r=null,u=0;u<this._suggestionsData.length;u++)r=this._repeater.elementFromIndex(u),u!==t?(r.classList.remove(n.asbSuggestionSelected),r.setAttribute("aria-selected","false")):(r.classList.add(n.asbSuggestionSelected),f(r),r.setAttribute("aria-selected","true"));this._currentSelectedIndex=t;r?this._inputElement.setAttribute("aria-activedescendant",this._repeaterElement.id+t):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_updateFakeFocus:function(){var n;n=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1;this._selectSuggestionAtIndex(n)},_updateQueryTextWithSuggestionText:function(n){n>=0&&n<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(n).text)},_disableControl:function(){this._isFlyoutShown()&&this._hideFlyout();this._element.disabled=!0;this._element.classList.add(n.asbDisabled);this._inputElement.disabled=!0},_enableControl:function(){this._element.disabled=!1;this._element.classList.remove(n.asbDisabled);this._inputElement.disabled=!1;t.document.activeElement===this._element&&h._setActive(this._inputElement)},_fireEvent:function(n,i){var r=t.document.createEvent("CustomEvent");return r.initCustomEvent(n,!0,!0,i),this._element.dispatchEvent(r)},_getLinguisticDetails:function(n,t){function c(n,t,r,u,f){for(var o=[],e=0;e<n.length;e++)o[e]=u+n[e]+f;return i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails?new i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(o,t,r):{queryTextAlternatives:o,queryTextCompositionStart:t,queryTextCompositionLength:r}}var e=null,r;if(this._inputElement.value===this._prevQueryText&&n&&this._prevLinguisticDetails&&t)e=this._prevLinguisticDetails;else{var h=[],u=0,f=0,o="",s="";t&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext().getCompositionAlternatives&&(r=this._inputElement.msGetInputContext(),h=r.getCompositionAlternatives(),u=r.compositionStartOffset,f=r.compositionEndOffset-r.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||f>0?(o=this._inputElement.value.substring(0,u),s=this._inputElement.value.substring(u+f)):(o=this._inputElement.value.substring(0,this._prevCompositionStart),s=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength)));e=c(h,u,f,o,s)}return e},_isElementInSearchControl:function(n){return this.element.contains(n)||this.element===n},_renderSuggestion:function(n){var t=null;if(!n)return t;if(n.kind===p._SearchSuggestionKind.Query)t=tt(this,n);else if(n.kind===p._SearchSuggestionKind.Separator)t=it(n);else{if(n.kind!==p._SearchSuggestionKind.Result)throw new u("WinJS.UI.AutoSuggestBox.invalidSuggestionKind",b.invalidSuggestionKind);t=nt(this,n)}return t},_shouldIgnoreInput:function(){var n=this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey;return n||this._isFlyoutPointerDown},_submitQuery:function(n,t,r){this._disposed||(i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(w.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,t),queryText:n,keyModifiers:g(r)}),this._suggestionManager&&this._suggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?e._formatString(b.ariaLabelInputPlaceHolder,this._inputElement.placeholder):b.ariaLabelInputNoPlaceHolder)},_flyoutBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)?this._internalFocusMove=!0:(this._element.classList.remove(n.asbInputFocus),this._hideFlyout())},_flyoutPointerDownHandler:function(n){function u(){if(i)for(var n=0;n<r._suggestionsData.length;n++)if(r._repeater.elementFromIndex(n)===i)return n;return-1}var r=this,i=n.target,t;for(this._isFlyoutPointerDown=!0;i&&i.parentNode!==this._repeaterElement;)i=i.parentNode;t=u();t>=0&&t<this._suggestionsData.length&&this._currentFocusedIndex!==t&&this._isSuggestionSelectable(this._suggestionsData.getAt(t))&&(this._currentFocusedIndex=t,this._selectSuggestionAtIndex(t),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex));n.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var n=l.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="";n.execute()}},_inputBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)||(this._element.classList.remove(n.asbInputFocus),this._hideFlyout());this._isProcessingDownKey=!1;this._isProcessingUpKey=!1;this._isProcessingTabKey=!1;this._isProcessingEnterKey=!1},_inputFocusHandler:function(t){this._inputElement.value!==this._prevQueryText&&i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):null);t.target!==this._inputElement||this._internalFocusMove||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0)));this._internalFocusMove=!1;this._element.classList.add(n.asbInputFocus)},_inputOrImeChangeHandler:function(){function r(n){var i=!1;return(t._prevLinguisticDetails.queryTextCompositionStart!==n.queryTextCompositionStart||t._prevLinguisticDetails.queryTextCompositionLength!==n.queryTextCompositionLength||t._prevLinguisticDetails.queryTextAlternatives.length!==n.queryTextAlternatives.length)&&(i=!0),t._prevLinguisticDetails=n,i}var t=this,n,r;if(!this._shouldIgnoreInput()){if(n=this._getLinguisticDetails(!1,!0),r=r(n),(this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||n.queryTextCompositionLength>0)&&(this._prevCompositionStart=n.queryTextCompositionStart,this._prevCompositionLength=n.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!r)return;this._prevQueryText=this._inputElement.value;i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag);i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):null);this._fireEvent(w.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:n});this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,n)}},_inputPointerDownHandler:function(){t.document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_keyDownHandler:function(n){function t(t){f._currentFocusedIndex=t;f._selectSuggestionAtIndex(t);n.preventDefault();n.stopPropagation()}var f=this,i,r,u;(this._lastKeyPressLanguage=n.locale,n.keyCode===c.tab?this._isProcessingTabKey=!0:n.keyCode===c.upArrow?this._isProcessingUpKey=!0:n.keyCode===c.downArrow?this._isProcessingDownKey=!0:n.keyCode===c.enter&&"ko"===n.locale&&(this._isProcessingEnterKey=!0),n.keyCode!==c.IME)&&(n.keyCode===c.tab?(i=!0,n.shiftKey?-1!==this._currentFocusedIndex&&(t(-1),i=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._flyoutBelowInput?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!==this._currentFocusedIndex&&(t(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),i=!1)),i&&this._hideFlyout()):n.keyCode===c.escape?-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,t(-1)):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),n.preventDefault(),n.stopPropagation()):n.keyCode===c.upArrow?(-1!==this._currentSelectedIndex?(r=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===r&&(this.queryText=this._prevQueryText)):r=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),t(r),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)):n.keyCode===c.downArrow?(u=this._findNextSuggestionElementIndex(this._currentSelectedIndex),-1!==this._currentSelectedIndex&&-1===u&&(this.queryText=this._prevQueryText),t(u),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)):n.keyCode===c.enter&&(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,n):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),n),this._hideFlyout()))},_keyUpHandler:function(n){n.keyCode===c.tab?this._isProcessingTabKey=!1:n.keyCode===c.upArrow?this._isProcessingUpKey=!1:n.keyCode===c.downArrow?this._isProcessingDownKey=!1:n.keyCode===c.enter&&(this._isProcessingEnterKey=!1)},_keyPressHandler:function(n){this._lastKeyPressLanguage=n.locale},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var n=l.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="";n.execute()}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired();this._reflowImeOnPointerRelease=!1},_suggestionsChangedHandler:function(i){var e=i.collectionChange||i.detail.collectionChange,u=+i.index===i.index?i.index:i.detail.index,o=p._CollectionChange,r,f,s,c;e===o.reset?(this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length)):e===o.itemInserted?(r=this._suggestions[u],this._suggestionsData.splice(u,0,r),this._showFlyout()):e===o.itemRemoved?(1===this._suggestionsData.length&&(h._setActive(this._inputElement),this._hideFlyout()),this._suggestionsData.splice(u,1)):e===o.itemChanged&&(r=this._suggestions[u],r!==this._suggestionsData.getAt(u)?this._suggestionsData.setAt(u,r):(f=this._repeater.elementFromIndex(u),h.hasClass(f,n.asbSuggestionQuery)?k(f,r,r.text):(s=f.querySelector("."+n.asbSuggestionResultText),s&&(k(s,r,r.text),c=f.querySelector("."+n.asbSuggestionResultDetailedText),c&&k(c,r,r.detailText)))));t.document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(n){i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag);var t,r=n.request||n.detail.request;this._fireEvent(w.suggestionsrequested,{setPromise:function(n){t=r.getDeferral();n.then(function(){t.complete()})},searchSuggestionCollection:r.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})}},{createResultSuggestionImage:function(n){return i.Windows.Foundation.Uri&&i.Windows.Storage.Streams.RandomAccessStreamReference?i.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new i.Windows.Foundation.Uri(n)):n},_EventNames:w,_sortAndMergeHits:function(n){function u(n,t){var i=0;return n.startPosition<t.startPosition?i=-1:n.startPosition>t.startPosition&&(i=1),i}function f(n,t,i){var r,u,f;return 0===i?n.push(t):(r=n[n.length-1],u=r.startPosition+r.length,t.startPosition<=u?(f=t.startPosition+t.length,f>u&&(r.length=f-r.startPosition)):n.push(t)),n}var r=[],i,t;if(n){for(i=new Array(n.length),t=0;t<n.length;t++)i.push({startPosition:n[t].startPosition,length:n[t].length});i.sort(u);i.reduce(f,r)}return r}});return r.Class.mix(d,o.DOMEventMixin),d})})});t("WinJS/Controls/SearchBox",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","./AutoSuggestBox","../Utilities/_Control","../Utilities/_ElementUtilities","./AutoSuggestBox/_SearchSuggestionManagerShim","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h){"use strict";i.Namespace.define("WinJS.UI",{SearchBox:i.Namespace._lazy(function(){var r={searchBox:"win-searchbox",searchBoxInput:"win-searchbox-input",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxButtonInputFocus:"win-searchbox-button-input-focus"},l={receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},u={get invalidSearchBoxSuggestionKind(){return"Error: Invalid search suggestion kind."},get ariaLabel(){return f._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return f._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return f._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value}},c=i.Class.derive(e.AutoSuggestBox,function(n,t){e.AutoSuggestBox.call(this,n,t);this._buttonElement=null;this._focusOnKeyboardInput=!1;this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this);this._keydownCaptureHandlerBind=this._keydownCaptureHandler.bind(this);this._frameLoadCaptureHandlerBind=this._frameLoadCaptureHandler.bind(this);this._setupSearchBoxDOM()},{focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(t){this._focusOnKeyboardInput&&!t?this._suggestionManager instanceof h._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(n.top,!1):this._suggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&t&&(this._suggestionManager instanceof h._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(n.top,!0):this._suggestionManager.addEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind));this._focusOnKeyboardInput=!!t}},dispose:function(){this._disposed||(e.AutoSuggestBox.prototype.dispose.call(this),this._focusOnKeyboardInput&&(this._suggestionManager instanceof h._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(n.top,!1):this._suggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind)))},_setupSearchBoxDOM:function(){this.element.classList.add(r.searchBox);this._flyoutElement.classList.add(r.searchBoxFlyout);this._inputElement.classList.add(r.searchBoxInput);this._inputElement.addEventListener("blur",this._searchboxInputBlurHandler.bind(this));this._inputElement.addEventListener("focus",this._searchboxInputFocusHandler.bind(this));this._buttonElement=n.document.createElement("div");this._buttonElement.tabIndex=-1;this._buttonElement.classList.add(r.searchBoxButton);this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this));this.element.appendChild(this._buttonElement)},_disableControl:function(){e.AutoSuggestBox.prototype._disableControl.call(this);this._buttonElement.disabled=!0},_enableControl:function(){e.AutoSuggestBox.prototype._enableControl.call(this);this._buttonElement.disabled=!1},_renderSuggestion:function(n){var t=e.AutoSuggestBox.prototype._renderSuggestion.call(this,n);return t.classList.add(n.kind===h._SearchSuggestionKind.Query?r.searchBoxSuggestionQuery:n.kind===h._SearchSuggestionKind.Separator?r.searchBoxSuggestionSeparator:r.searchBoxSuggestionResult),t},_shouldIgnoreInput:function(){var n=e.AutoSuggestBox.prototype._shouldIgnoreInput(),t=s._matchesSelector(this._buttonElement,":active");return n||t},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?f._formatString(u.ariaLabelInputPlaceHolder,this._inputElement.placeholder):u.ariaLabelInputNoPlaceHolder)},_buttonClickHandler:function(n){this._inputElement.focus();this._submitQuery(this._inputElement.value,!0,n);this._hideFlyout()},_searchboxInputBlurHandler:function(){s.removeClass(this._buttonElement,r.searchBoxButtonInputFocus)},_searchboxInputFocusHandler:function(){s.addClass(this._buttonElement,r.searchBoxButtonInputFocus)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(l.receivingfocusonkeyboardinput,null),n.document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(t){}},_keydownCaptureHandler:function(n){this._focusOnKeyboardInput&&this._shouldKeyTriggerTypeToSearch(n)&&this._requestingFocusOnKeyboardInputHandler(n)},_frameLoadCaptureHandler:function(n){this._focusOnKeyboardInput&&this._updateKeydownCaptureListeners(n.target.contentWindow,!0)},_updateKeydownCaptureListeners:function(n,t){var r,u,i;try{t?n.document.addEventListener("keydown",this._keydownCaptureHandlerBind,!0):n.document.removeEventListener("keydown",this._keydownCaptureHandlerBind,!0)}catch(f){}if(n.frames)for(r=0,u=n.frames.length;u>r;r++){i=n.frames[r];this._updateKeydownCaptureListeners(i,t);try{t?i.frameElement&&i.frameElement.addEventListener("load",this._frameLoadCaptureHandlerBind,!0):i.frameElement&&i.frameElement.removeEventListener("load",this._frameLoadCaptureHandlerBind,!0)}catch(f){}}},_shouldKeyTriggerTypeToSearch:function(n){var t=!1;if(!n.metaKey&&(!n.ctrlKey&&!n.altKey||n.getModifierState&&n.getModifierState("AltGraph")))switch(n.keyCode){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 186:case 187:case 188:case 189:case 190:case 191:case 192:case 219:case 220:case 221:case 222:case 223:case 226:case 229:case 231:t=!0}return t}},{createResultSuggestionImage:function(n){return t.Windows.Foundation.Uri&&t.Windows.Storage.Streams.RandomAccessStreamReference?t.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new t.Windows.Foundation.Uri(n)):n},_getKeyModifiers:function(n){var i={ctrlKey:1,altKey:2,shiftKey:4},t=0;return n.ctrlKey&&(t|=i.ctrlKey),n.altKey&&(t|=i.altKey),n.shiftKey&&(t|=i.shiftKey),t},_isTypeToSearchKey:function(n){return n.shiftKey||n.ctrlKey||n.altKey?!1:!0}});return i.Class.mix(c,o.DOMEventMixin),c})})});t("WinJS/Controls/SettingsFlyout",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Pages","../Promise","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout/_Overlay","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";i.Namespace.define("WinJS.UI",{SettingsFlyout:i.Namespace._lazy(function(){function d(){if(t.Windows.UI.ApplicationSettings.SettingsEdgeLocation){var n=t.Windows.UI.ApplicationSettings;return n.SettingsPane.edge===n.SettingsEdgeLocation.left}return!1}function g(n,t){for(var i,r,f=n.querySelectorAll("."+y.settingsFlyoutClass),u=0;u<f.length;u++)if(r=f[u].winControl){if(r.settingsCommandId===t){i=r;break}f[u].id===t&&(i=i||r)}return i}var k,b=l.Key,nt="narrow",tt="wide",v=i.Class.derive(p._Overlay,function(t,i){var r,u;this._element=t||n.document.createElement("div");this._id=this._element.id||l._uniqueID(this._element);this._writeProfilerMark("constructor,StartTM");this._baseOverlayConstructor(this._element,i);this._addFirstDiv();this._addFinalDiv();this._element.addEventListener("keydown",this._handleKeyDown,!0);p._Overlay._createClickEatingDivAppBar();this._element.style.visibilty="hidden";this._element.style.display="none";l.addClass(this._element,y.settingsFlyoutClass);a.query("div.win-content",this._element).forEach(function(n){l._matchesSelector(n,".win-ui-dark, .win-ui-dark *")||l.addClass(n,y.flyoutLightClass)});r=this._element.getAttribute("role");(null===r||""===r||void 0===r)&&this._element.setAttribute("role","dialog");u=this._element.getAttribute("aria-label");(null===u||""===u||void 0===u)&&this._element.setAttribute("aria-label",w.ariaLabel);this._handleOverlayEventsForFlyoutOrSettingsFlyout();this._currentAnimateIn=this._animateSlideIn;this._currentAnimateOut=this._animateSlideOut;this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(n){l._deprecated(w.widthDeprecationMessage);n!==this._width&&(this._width===nt?l.removeClass(this._element,y.narrowClass):this._width===tt&&l.removeClass(this._element,y.wideClass),this._width=n,this._width===nt?l.addClass(this._element,y.narrowClass):this._width===tt&&l.addClass(this._element,y.wideClass))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(n){this._settingsCommandId=n}},show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){c.disposeSubTree(this.element);this._dismiss()},_show:function(){this._baseShow();p._Overlay._showClickEatingDivAppBar()},_endShow:function(){this._initAfterAnimation()},_initAfterAnimation:function(){var n,t;(k=0,l.hasClass(this.element.children[0],y.firstDivClass))||(n=this.element.querySelectorAll(".win-first"),n&&n.length>0&&n.item(0).parentNode.removeChild(n.item(0)),this._addFirstDiv());(this.element.children[0]&&(l._addEventListener(this.element.children[0],"focusout",function(){k=1},!1),this.element.children[0].focus()),l.hasClass(this.element.children[this.element.children.length-1],y.finalDivClass))||(t=this.element.querySelectorAll(".win-final"),t&&t.length>0&&t.item(0).parentNode.removeChild(t.item(0)),this._addFinalDiv());this._setBackButtonsAriaLabel()},_setBackButtonsAriaLabel:function(){for(var n,i=this.element.querySelectorAll(".win-backbutton"),t=0;t<i.length;t++)n=i[t].getAttribute("aria-label"),(null===n||""===n||void 0===n)&&i[t].setAttribute("aria-label",w.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM");this._hide()},_hide:function(){this._baseHide()&&p._Overlay._hideClickEatingDivAppBar()},_animateSlideIn:function(){var i=d(),r=i?"-100px":"100px",n,t;return a.query("div.win-content",this._element).forEach(function(n){o.enterPage(n,{left:r})}),t=this._element.offsetWidth,i?(n={top:"0px",left:"-"+t+"px"},this._element.style.right="auto",this._element.style.left="0px"):(n={top:"0px",left:t+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",o.showPanel(this._element,n)},_animateSlideOut:function(){var t,n=this._element.offsetWidth;return d()?(t={top:"0px",left:n+"px"},this._element.style.right="auto",this._element.style.left="-"+n+"px"):(t={top:"0px",left:"-"+n+"px"},this._element.style.right="-"+n+"px",this._element.style.left="auto"),o.showPanel(this._element,t)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(n){this._fragDiv=n}},_unloadPage:function(t){var i=t.currentTarget.winControl;i.removeEventListener(p._Overlay.afterHide,this._unloadPage,!1);h.as().then(function(){i._fragmentDiv&&(n.document.body.removeChild(i._fragmentDiv),i._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(p._Overlay.afterHide,this._unloadPage,!1);this._hide()},_handleKeyDown:function(t){if(t.keyCode===b.escape)t.preventDefault(),t.stopPropagation(),this.winControl._dismiss();else if(t.keyCode!==b.space&&t.keyCode!==b.enter||this.children[0]!==n.document.activeElement){if(t.shiftKey&&t.keyCode===b.tab&&this.children[0]===n.document.activeElement){t.preventDefault();t.stopPropagation();for(var r=this.getElementsByTagName("*"),i=r.length-2;i>=0&&(r[i].focus(),r[i]!==n.document.activeElement);i--);}}else t.preventDefault(),t.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var u=n.document.activeElement,t,i,r;if(k&&u&&l.hasClass(u,y.firstDivClass)&&(t=this.parentElement.getElementsByTagName("*"),!(t.length<=2)))if(r=t[t.length-1].tabIndex,r){for(i=t.length-2;i>0;i--)if(t[i].tabIndex===r){t[i].focus();break}}else for(i=t.length-2;i>0&&("DIV"===t[i].tagName&&null===t[i].getAttribute("tabIndex")||(t[i].focus(),t[i]!==n.document.activeElement));i--);},_focusOnFirstFocusableElementFromParent:function(){var u=n.document.activeElement,i,t,r;if(u&&l.hasClass(u,y.finalDivClass)&&(i=this.parentElement.getElementsByTagName("*"),!(i.length<=2)))if(r=i[0].tabIndex,r){for(t=1;t<i.length-1;t++)if(i[t].tabIndex===r){i[t].focus();break}}else for(t=1;t<i.length-1&&("DIV"===i[t].tagName&&null===i[t].getAttribute("tabIndex")||(i[t].focus(),i[t]!==n.document.activeElement));t++);},_addFirstDiv:function(){for(var t,r=this._element.getElementsByTagName("*"),u=0,i=0;i<r.length;i++)0<r[i].tabIndex&&(0===u||r[i].tabIndex<u)&&(u=r[i].tabIndex);t=n.document.createElement("div");t.className=y.firstDivClass;t.style.display="inline";t.setAttribute("role","menuitem");t.setAttribute("aria-hidden","true");t.tabIndex=u;l._addEventListener(t,"focusin",this._focusOnLastFocusableElementFromParent,!1);this._element.children[0]?this._element.insertBefore(t,this._element.children[0]):this._element.appendChild(t)},_addFinalDiv:function(){for(var t,r=this._element.getElementsByTagName("*"),u=0,i=0;i<r.length;i++)r[i].tabIndex>u&&(u=r[i].tabIndex);t=n.document.createElement("div");t.className=y.finalDivClass;t.style.display="inline";t.setAttribute("role","menuitem");t.setAttribute("aria-hidden","true");t.tabIndex=u;l._addEventListener(t,"focusin",this._focusOnFirstFocusableElementFromParent,!1);this._element.appendChild(t)},_writeProfilerMark:function(n){e("WinJS.UI.SettingsFlyout:"+this._id+":"+n)}}),r,w;return v.show=function(){var r;t.Windows.UI.ApplicationSettings.SettingsPane&&t.Windows.UI.ApplicationSettings.SettingsPane.show();for(var u=n.document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),f=u.length,i=0;f>i;i++)r=u[i].winControl,r&&r._dismiss()},r={event:void 0},v.populateSettings=function(n){if(r.event=n.detail,r.event.applicationcommands){var i=t.Windows.UI.ApplicationSettings;Object.keys(r.event.applicationcommands).forEach(function(n){var t=r.event.applicationcommands[n],u;t.title||(t.title=n);u=new i.SettingsCommand(n,t.title,v._onSettingsCommand);r.event.e.request.applicationCommands.append(u)})}},v._onSettingsCommand=function(n){var t=n.id;r.event.applicationcommands&&r.event.applicationcommands[t]&&v.showSettings(t,r.event.applicationcommands[t].href)},v.showSettings=function(t,i){var f=g(n.document,t),r;if(f)f.show();else{if(!i)throw new u("WinJS.UI.SettingsFlyout.BadReference",w.badReference);r=n.document.createElement("div");r=n.document.body.appendChild(r);s.render(i,r).then(function(){f=g(r,t);f?(f._fragmentDiv=r,f.show()):n.document.body.removeChild(r)})}},w={get ariaLabel(){return f._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return"Invalid argument: Invalid href to settings flyout fragment"},get backbuttonAriaLabel(){return f._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return"SettingsFlyout.width may be altered or unavailable in future versions. Instead, style the CSS width property on elements with the .win-settingsflyout class."}},v})})});t("WinJS/Controls/NavBar/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Navigation","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Icon"],function(n,t,i,r,u,f,e,o,s,h){"use strict";i.Namespace._moduleDefine(n,"WinJS.UI",{_WinPressed:i.Namespace._lazy(function(){var n=i.Class.define(function(n){this._element=n;s._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(i){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this));i.isPrimary&&(this._pointerId&&this._resetPointer(),s._matchesSelector(i.target,".win-interactive, .win-interactive *")||(this._pointerId=i.pointerId,s._addEventListener(t,"pointerup",this._pointerUpBound,!0),s._addEventListener(t,"pointercancel",this._pointerCancelBound),!0,s._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),s._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),s.addClass(this._element,n.winPressed)))},_MSPointerOverHandler:function(t){this._pointerId===t.pointerId&&s.addClass(this._element,n.winPressed)},_MSPointerOutHandler:function(t){this._pointerId===t.pointerId&&s.removeClass(this._element,n.winPressed)},_MSPointerCancelHandler:function(n){this._pointerId===n.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(n){this._pointerId===n.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null;s._removeEventListener(t,"pointerup",this._pointerUpBound,!0);s._removeEventListener(t,"pointercancel",this._pointerCancelBound,!0);s._removeEventListener(this._element,"pointerover",this._pointerOverBound,!0);s._removeEventListener(this._element,"pointerout",this._pointerOutBound,!0);s.removeClass(this._element,n.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return n}),NavBarCommand:i.Namespace._lazy(function(){var c=s.Key,l={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},u=i.Class.define(function(n,i){if(n=n||t.document.createElement("DIV"),i=i||{},n.winControl)throw new r("WinJS.UI.NavBarCommand.DuplicateConstruction",l.duplicateConstruction);n.winControl=this;this._element=n;s.addClass(this.element,u._ClassName.navbarcommand);s.addClass(this.element,"win-disposable");this._tooltip=null;this._splitOpened=!1;this._buildDom();n.addEventListener("keydown",this._keydownHandler.bind(this));o.setOptions(this,i)},{element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(n){this._label=n;this._labelEl.textContent=n}},tooltip:{get:function(){return this._tooltip},set:function(n){this._tooltip=n;this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(n){this._icon=h[n]||n;this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},location:{get:function(){return this._location},set:function(n){this._location=n}},state:{get:function(){return this._state},set:function(n){this._state=n}},splitButton:{get:function(){return this._split},set:function(n){this._split=n;this._splitButtonEl.style.display=this._split?"":"none"}},splitOpened:{get:function(){return this._splitOpened},set:function(n){this._splitOpened!==!!n&&this._toggleSplit()}},_toggleSplit:function(){this._splitOpened=!this._splitOpened;this._splitOpened?(s.addClass(this._splitButtonEl,u._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","true")):(s.removeClass(this._splitButtonEl,u._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","false"));this._fireEvent(u._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===t.getComputedStyle(this.element).direction}},_keydownHandler:function(n){if(!s._matchesSelector(n.target,".win-interactive, .win-interactive *")){var t=this._rtl?c.rightArrow:c.leftArrow,i=this._rtl?c.leftArrow:c.rightArrow;n.altKey||n.keyCode!==t&&n.keyCode!==c.home&&n.keyCode!==c.end||n.target!==this._splitButtonEl?n.altKey||n.keyCode!==i||!this.splitButton||n.target!==this._buttonEl&&!this._buttonEl.contains(n.target)?n.keyCode!==c.space&&n.keyCode!==c.enter||n.target!==this._buttonEl&&!this._buttonEl.contains(n.target)?n.keyCode!==c.space&&n.keyCode!==c.enter||n.target!==this._splitButtonEl||this._toggleSplit():(this.location&&e.navigate(this.location,this.state),this._fireEvent(u._EventName._invoked)):(s._setActive(this._splitButtonEl),n.keyCode===i&&n.stopPropagation(),n.preventDefault()):(s._setActive(this._buttonEl),n.keyCode===t&&n.stopPropagation(),n.preventDefault())}},_getFocusInto:function(n){var t=this._rtl?c.rightArrow:c.leftArrow;return n===t&&this.splitButton?this._splitButtonEl:this._buttonEl},_buildDom:function(){var r='<div tabindex="0" role="button" class="'+u._ClassName.navbarcommandbutton+'"><div class="'+u._ClassName.navbarcommandbuttoncontent+'"><div class="'+u._ClassName.navbarcommandicon+'"><\/div><div class="'+u._ClassName.navbarcommandlabel+'"><\/div><\/div><\/div><div tabindex="-1" aria-expanded="false" class="'+u._ClassName.navbarcommandsplitbutton+'"><\/div>',i,t;for(this.element.insertAdjacentHTML("afterBegin",r),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new n._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new n._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",s._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this)),i=new s._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this)),i.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this)),t=this._splitButtonEl.nextSibling;t;)this._buttonEl.insertBefore(t,this._contentEl),"#text"!==t.nodeName&&f.processAll(t),t=this._splitButtonEl.nextSibling},_handleButtonClick:function(n){var t=n.target;s._matchesSelector(t,".win-interactive, .win-interactive *")||(this.location&&e.navigate(this.location,this.state),this._fireEvent(u._EventName._invoked))},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_fireEvent:function(n,i){var r=t.document.createEvent("CustomEvent");r.initCustomEvent(n,!0,!1,i);this.element.dispatchEvent(r)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:{navbarcommand:"win-navbarcommand",navbarcommandbutton:"win-navbarcommand-button",navbarcommandbuttoncontent:"win-navbarcommand-button-content",navbarcommandsplitbutton:"win-navbarcommand-splitbutton",navbarcommandsplitbuttonopened:"win-navbarcommand-splitbutton-opened",navbarcommandicon:"win-navbarcommand-icon",navbarcommandlabel:"win-navbarcommand-label"},_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return i.Class.mix(u,o.DOMEventMixin),u})})});t("WinJS/Controls/NavBar/_Container",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../AppBar/_Constants","../Repeater","./_Command"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function it(){return null===t.document.activeElement||t.document.activeElement===t.document.body}i.Namespace._moduleDefine(n,"WinJS.UI",{NavBarContainer:i.Namespace._lazy(function(){var ut=b.Key,ft=3e3,et=b._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",ot=0,st=f._createEventProperty,rt={invoked:"invoked",splittoggle:"splittoggle"},ht={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarContainerViewportAriaLabel(){return o._getWinJSString("ui/navBarContainerViewportAriaLabel").value}},n=i.Class.define(function(i,r){if(i=i||t.document.createElement("DIV"),this._id=i.id||b._uniqueID(i),this._writeProfilerMark("constructor,StartTM"),r=r||{},i.winControl)throw new u("WinJS.UI.NavBarContainer.DuplicateConstruction",ht.duplicateConstruction);i.winControl=this;this._element=i;b.addClass(this.element,n._ClassName.navbarcontainer);b.addClass(this.element,"win-disposable");i.getAttribute("tabIndex")||(i.tabIndex=-1);this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this);this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this);this._currentManipulationState=ot;this._panningDisabled=!1;this._fixedSize=!1;this._maxRows=1;this._sizes={};this._setupTree();this._duringConstructor=!0;this._dataChangingBound=this._dataChanging.bind(this);this._dataChangedBound=this._dataChanged.bind(this);v.addEventListener("navigated",this._closeSplitAndResetBound);this.layout=r.layout||d.Orientation.horizontal;r.maxRows&&(this.maxRows=r.maxRows);r.template&&(this.template=r.template);r.data&&(this.data=r.data);r.fixedSize&&(this.fixedSize=r.fixedSize);w._setOptions(this,r,!0);this._duringConstructor=!1;r.currentIndex&&(this.currentIndex=r.currentIndex);var f=this,e=!1;b._detectSnapPointsSupport().then(function(n){f._panningDisabled=!n;f._disposed||(f._updatePageUI(),e=!0)});e||this._updatePageUI();p.schedule(function(){this._updateAppBarReference()},p.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize");this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(n){if(this._template=n,this._repeater){var i=this.element.contains(t.document.activeElement);this._duringConstructor||this._closeSplitIfOpen();this._repeater.template=this._repeater.template;this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}}},_render:function(n){var r=t.document.createElement("div"),i=this._template,u;return i&&(i.render?i.render(n,r):i.winControl&&i.winControl.render?i.winControl.render(n,r):r.appendChild(i(n))),u=new tt.NavBarCommand(r,n),u._element},data:{get:function(){return this._repeater&&this._repeater.data},set:function(n){n||(n=new l.List);this._duringConstructor||this._closeSplitIfOpen();this._removeDataChangingEvents();this._removeDataChangedEvents();var i=this.element.contains(t.document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new nt.Repeater(this._surfaceEl,{template:this._render.bind(this)}));this._addDataChangingEvents(n);this._repeater.data=n;this._addDataChangedEvents(n);this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(n){n=+n===n?n:1;this._maxRows=Math.max(1,n);this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(t){t===d.Orientation.vertical?(this._layout=d.Orientation.vertical,b.removeClass(this.element,n._ClassName.horizontal),b.addClass(this.element,n._ClassName.vertical)):(this._layout=d.Orientation.horizontal,b.removeClass(this.element,n._ClassName.vertical),b.addClass(this.element,n._ClassName.horizontal));this._viewportEl.style.msScrollSnapType="";this._zooming=!1;this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(n){if(n===+n){var i=this.element.contains(t.document.activeElement);this._keyboardBehavior.currentIndex=n;this._ensureVisible(this._keyboardBehavior.currentIndex,!0);i&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(n){this._fixedSize=!!n;this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:st(rt.invoked),onsplittoggle:st(rt.splittoggle),forceLayout:function(){this._resizeHandler();this._measured&&(this._scrollPosition=b.getScrollPosition(this._viewportEl)[this.layout===d.Orientation.horizontal?"scrollLeft":"scrollTop"]);this._duringForceLayout=!0;this._ensureVisible(this._keyboardBehavior.currentIndex,!0);this._updatePageUI();this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._appBarEl.removeEventListener("aftershow",this._focusCurrentItemPassivelyBound));for(var n=this.element.parentNode;n&&!b.hasClass(n,g.appBarClass);)n=n.parentNode;this._appBarEl=n;this._appBarEl&&(this._appBarEl.addEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.addEventListener("aftershow",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen();this._reset()},_dataChanging:function(n){this._elementHadFocus=t.document.activeElement;this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===n.type?this._surfaceEl.children[n.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===n.type?this._surfaceEl.children[n.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===n.type?this._surfaceEl.children[n.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===n.type&&this._closeSplitIfOpen())},_dataChanged:function(n){this._measured=!1;"itemremoved"===n.type?n.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:n.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,it()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===n.type?n.detail.index===this._keyboardBehavior.currentIndex&&it()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===n.type?n.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===n.type?n.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=n.detail.newIndex,it()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===n.type&&(this._keyboardBehavior.currentIndex=0,it()&&this._elementHadFocus&&this._keyboardBehavior._focus());this._ensureVisible(this._keyboardBehavior.currentIndex,!0);this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0;this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(0);this._viewportEl.style.msScrollSnapType="";this._zooming=!1;this._ensureVisible(0,!0);this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(n){n.addEventListener("itemchanged",this._dataChangingBound);n.addEventListener("iteminserted",this._dataChangingBound);n.addEventListener("itemmoved",this._dataChangingBound);n.addEventListener("itemremoved",this._dataChangingBound);n.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(n){n.pointerType===et&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(n){n.pointerType!==et&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=y.wrap();this._element.addEventListener("mouseleave",this._mouseleave.bind(this));b._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this));b._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this));b._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1);this._pageindicatorsEl=t.document.createElement("div");b.addClass(this._pageindicatorsEl,n._ClassName.pageindicators);this._element.appendChild(this._pageindicatorsEl);this._ariaStartMarker=t.document.createElement("div");this._element.appendChild(this._ariaStartMarker);this._viewportEl=t.document.createElement("div");b.addClass(this._viewportEl,n._ClassName.viewport);this._element.appendChild(this._viewportEl);this._viewportEl.setAttribute("role","group");this._viewportEl.setAttribute("aria-label",ht.navBarContainerViewportAriaLabel);this._boundResizeHandler=this._resizeHandler.bind(this);b._resizeNotifier.subscribe(this._element,this._boundResizeHandler);this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this));this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this));this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this));this._ariaEndMarker=t.document.createElement("div");this._element.appendChild(this._ariaEndMarker);this._surfaceEl=t.document.createElement("div");b.addClass(this._surfaceEl,n._ClassName.surface);this._viewportEl.appendChild(this._surfaceEl);this._surfaceEl.addEventListener("_invoked",this._navbarCommandInvokedHandler.bind(this));this._surfaceEl.addEventListener("_splittoggle",this._navbarCommandSplitToggleHandler.bind(this));b._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1);this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var i=this.element.firstElementChild;i!==this._pageindicatorsEl;)this._surfaceEl.appendChild(i),a.process(i),i=this.element.firstElementChild;this._leftArrowEl=t.document.createElement("div");b.addClass(this._leftArrowEl,n._ClassName.navleftarrow);b.addClass(this._leftArrowEl,n._ClassName.navarrow);this._element.appendChild(this._leftArrowEl);this._leftArrowEl.addEventListener("click",this._goLeft.bind(this));this._leftArrowEl.style.opacity=0;this._leftArrowEl.style.visibility="hidden";this._leftArrowFadeOut=y.wrap();this._rightArrowEl=t.document.createElement("div");b.addClass(this._rightArrowEl,n._ClassName.navrightarrow);b.addClass(this._rightArrowEl,n._ClassName.navarrow);this._element.appendChild(this._rightArrowEl);this._rightArrowEl.addEventListener("click",this._goRight.bind(this));this._rightArrowEl.style.opacity=0;this._rightArrowEl.style.visibility="hidden";this._rightArrowFadeOut=y.wrap();this._keyboardBehavior=new k._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl});this._winKeyboard=new k._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var n=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.min(Math.floor(this._keyboardBehavior.currentIndex/n)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(n*t,this._surfaceEl.children.length);this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var n=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/n)-1);this._keyboardBehavior.currentIndex=Math.max(n*t,0);this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===d.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var n=this.layout===d.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(t.getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(t.getComputedStyle(this._viewportEl).height);n&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&this._appBarEl.winControl.hidden?(p.schedule(this._resizeImplBound,p.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeshow",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(n){var h=n.keyCode,v,i,c,p,a,w,s;if(!n.altKey&&(h===ut.pageUp||h===ut.pageDown)){if(v=n.target,b._matchesSelector(v,".win-interactive, .win-interactive *"))return;i=this._keyboardBehavior.currentIndex;this._measure();var r=this._sizes,y=Math.floor(i/(r.columnsPerPage*r.rowsPerPage)),u=null;if(h===ut.pageUp){if(this.layout===d.Orientation.horizontal)c=y*r.columnsPerPage*r.rowsPerPage,i===c&&this._surfaceEl.children[i].winControl._buttonEl===t.document.activeElement?i-=r.columnsPerPage*r.rowsPerPage:i=c;else{var o=this._surfaceEl.children[i],e=o.offsetTop,l=e+o.offsetHeight,f=this._zooming?this._zoomPosition:this._scrollPosition;if(e>=f&&l<f+r.viewportOffsetHeight)for(;i>0&&this._surfaceEl.children[i-1].offsetTop>f;)i--;if(this._keyboardBehavior.currentIndex===i){for(p=l-r.viewportOffsetHeight,i=Math.max(0,i-1);i>0&&this._surfaceEl.children[i-1].offsetTop>p;)i--;u=i>0?this._surfaceEl.children[i].offsetTop-this._sizes.itemMarginTop:0}}i=Math.max(i,0);this._keyboardBehavior.currentIndex=i;s=this._surfaceEl.children[i].winControl._buttonEl;null!==u&&this._scrollTo(u);b._setActive(s,this._viewportEl)}else{if(this.layout===d.Orientation.horizontal)a=(y+1)*r.columnsPerPage*r.rowsPerPage-1,i===a?i+=r.columnsPerPage*r.rowsPerPage:i=a;else{var o=this._surfaceEl.children[this._keyboardBehavior.currentIndex],e=o.offsetTop,l=e+o.offsetHeight,f=this._zooming?this._zoomPosition:this._scrollPosition;if(e>=f&&l<f+r.viewportOffsetHeight)for(;i<this._surfaceEl.children.length-1&&this._surfaceEl.children[i+1].offsetTop+this._surfaceEl.children[i+1].offsetHeight<f+r.viewportOffsetHeight;)i++;if(i===this._keyboardBehavior.currentIndex){for(w=e+r.viewportOffsetHeight,i=Math.min(this._surfaceEl.children.length-1,i+1);i<this._surfaceEl.children.length-1&&this._surfaceEl.children[i+1].offsetTop+this._surfaceEl.children[i+1].offsetHeight<w;)i++;u=i<this._surfaceEl.children.length-1?this._surfaceEl.children[i+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}i=Math.min(i,this._surfaceEl.children.length-1);this._keyboardBehavior.currentIndex=i;s=this._surfaceEl.children[i].winControl._buttonEl;null!==u&&this._scrollTo(u);try{b._setActive(s,this._viewportEl)}catch(k){}}}},_focusHandler:function(n){var t=n.target;this._surfaceEl.contains(t)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(n){var t=n.target,i;if(t!==this._surfaceEl){for(;t.parentNode!==this._surfaceEl;)t=t.parentNode;for(i=-1;t;)i++,t=t.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(i)}},_ensureVisible:function(n,t){var r,u,f,e,i;(this._measure(),this.layout===d.Orientation.horizontal)?(r=Math.floor(n/(this._sizes.rowsPerPage*this._sizes.columnsPerPage)),this._scrollTo(r*this._sizes.viewportOffsetWidth,t)):(f=this._surfaceEl.children[n],u=n>0?f.offsetTop-this._sizes.itemMarginTop:0,e=n<this._surfaceEl.children.length-1?this._surfaceEl.children[n+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight,i=this._zooming?this._zoomPosition:this._scrollPosition,i=Math.max(i,e),i=Math.min(i,u),this._scrollTo(i,t))},_scrollTo:function(n,t){if(this._measure(),n=this.layout===d.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,n)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,n)),t){if(Math.abs(this._scrollPosition-n)>1){this._zooming=!1;this._scrollPosition=n;this._updatePageUI();this._duringForceLayout||this._closeSplitIfOpen();var i={};i[this.layout===d.Orientation.horizontal?"scrollLeft":"scrollTop"]=n;b.setScrollPosition(this._viewportEl,i)}}else(!this._zooming&&Math.abs(this._scrollPosition-n)>1||this._zooming&&Math.abs(this._zoomPosition-n)>1)&&(this._zoomPosition=n,this._zooming=!0,this.layout===d.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",b._zoomTo(this._viewportEl,{contentX:n,contentY:0,viewportX:0,viewportY:0})):b._zoomTo(this._viewportEl,{contentX:0,contentY:n,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(n){this._currentManipulationState=n.currentState;n.currentState===n.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1);t.clearTimeout(this._manipulationStateTimeoutId);n.currentState===n.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=t.setTimeout(function(){this._viewportEl.style.msScrollSnapType="";this._zooming=!1;this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var n=this;this._checkingScroll=r._requestAnimationFrame(function(){if(!n._disposed){n._checkingScroll=null;var t=b.getScrollPosition(n._viewportEl)[n.layout===d.Orientation.horizontal?"scrollLeft":"scrollTop"];t!==n._scrollPosition&&(n._scrollPosition=t,n._closeSplitIfOpen());n._updatePageUI();n._zooming||n._currentManipulationState!==ot||n._updateCurrentIndexIfPageChanged()}})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===d.Orientation.horizontal){this._measure();var n=this._currentPage,i=n*this._sizes.rowsPerPage*this._sizes.columnsPerPage,r=(n+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<i||this._keyboardBehavior.currentIndex>r)&&(this._keyboardBehavior.currentIndex=i,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){var n,r,i,u,f;this._measured||(this._resizeImpl(),this._writeProfilerMark("measure,StartTM"),n=this._sizes,n.rtl="rtl"===t.getComputedStyle(this._element).direction,r=this._surfaceEl.children.length,r>0?(this._sizes.itemMeasured||(this._writeProfilerMark("measureItem,StartTM"),i=this._surfaceEl.firstElementChild,i.style.margin="",i.style.width="",u=t.getComputedStyle(i),n.itemOffsetWidth=parseFloat(t.getComputedStyle(i).width),0===i.offsetWidth&&(n.itemOffsetWidth=0),n.itemMarginLeft=parseFloat(u.marginLeft),n.itemMarginRight=parseFloat(u.marginRight),n.itemWidth=n.itemOffsetWidth+n.itemMarginLeft+n.itemMarginRight,n.itemOffsetHeight=parseFloat(t.getComputedStyle(i).height),0===i.offsetHeight&&(n.itemOffsetHeight=0),n.itemMarginTop=parseFloat(u.marginTop),n.itemMarginBottom=parseFloat(u.marginBottom),n.itemHeight=n.itemOffsetHeight+n.itemMarginTop+n.itemMarginBottom,n.itemOffsetWidth>0&&n.itemOffsetHeight>0&&(n.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")),(n.viewportOffsetWidth=parseFloat(t.getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(n.viewportOffsetWidth=0),n.viewportOffsetHeight=parseFloat(t.getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(n.viewportOffsetHeight=0),this._measured=0===n.viewportOffsetWidth||0===n.itemOffsetHeight?!1:!0,this.layout===d.Orientation.horizontal)?(this._scrollPosition=b.getScrollPosition(this._viewportEl).scrollLeft,n.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(t.getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(t.getComputedStyle(this._leftArrowEl).marginRight),f=n.viewportOffsetWidth-2*n.leadingEdge,n.maxColumns=n.itemWidth?Math.max(1,Math.floor(f/n.itemWidth)):1,n.rowsPerPage=Math.min(this.maxRows,Math.ceil(r/n.maxColumns)),n.columnsPerPage=Math.min(n.maxColumns,r),n.pages=Math.ceil(r/(n.columnsPerPage*n.rowsPerPage)),n.trailingEdge=n.leadingEdge,n.extraSpace=f-n.columnsPerPage*n.itemWidth,this._scrollLength=n.viewportOffsetWidth*n.pages,this._keyboardBehavior.fixedSize=n.rowsPerPage,this._keyboardBehavior.fixedDirection=k._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=n.itemHeight*n.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"):(this._scrollPosition=this._viewportEl.scrollTop,n.leadingEdge=0,n.rowsPerPage=r,n.columnsPerPage=1,n.pages=1,n.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=n.columnsPerPage,this._keyboardBehavior.fixedDirection=k._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width=""),this._updateGridStyles()):(n.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width=""),this._writeProfilerMark("measure,StopTM"))},_updateGridStyles:function(){for(var r,u,t,f,a,o,s,n=this._sizes,v=this._surfaceEl.children.length,i=0;v>i;i++){if(t=this._surfaceEl.children[i],f="",this.layout===d.Orientation.horizontal){var h=Math.floor(i/n.rowsPerPage),c=h%n.columnsPerPage==0,l=h%n.columnsPerPage==n.columnsPerPage-1,e=n.trailingEdge;this.fixedSize?e+=n.extraSpace:(a=n.extraSpace-(n.maxColumns-n.columnsPerPage)*n.itemWidth,f=n.itemOffsetWidth+a/n.maxColumns+"px");n.rtl?(o=c?n.leadingEdge:0,s=l?e:0):(o=l?e:0,s=c?n.leadingEdge:0);r=o+n.itemMarginRight+"px";u=s+n.itemMarginLeft+"px"}else r="",u="";t.style.marginRight!==r&&(t.style.marginRight=r);t.style.marginLeft!==u&&(t.style.marginLeft=u);t.style.width!==f&&(t.style.width=f)}},_updatePageUI:function(){var t,i,f,r,e,u;for(this._measure(),t=this._currentPage,this._hasPreviousContent=0!==t,this._hasNextContent=t<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+n._ClassName.indicator+'"><\/span>')),i=0;i<this._pageindicatorsEl.children.length;i++)i===t?b.addClass(this._pageindicatorsEl.children[i],n._ClassName.currentindicator):b.removeClass(this._pageindicatorsEl.children[i],n._ClassName.currentindicator);(this._sizes.pages>1?(this._viewportEl.style.overflowX=this._panningDisabled?"hidden":"",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==d.Orientation.horizontal)?(this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom")):(f=t*this._sizes.rowsPerPage*this._sizes.columnsPerPage,r=this._surfaceEl.children[f].winControl._buttonEl,b._ensureId(r),this._ariaStartMarker.setAttribute("aria-flowto",r.id),e=Math.min(this._surfaceEl.children.length-1,(t+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),u=this._surfaceEl.children[e].winControl._buttonEl,b._ensureId(u),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",u.id))},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var n=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,t=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,i=this;(this._mouseInViewport||this._panningDisabled)&&n?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||h.fadeIn(this._leftArrowEl)):(n?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||y.timeout(c._animationTimeAdjustment(ft)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=y.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel();this._leftArrowFadeIn=null;this._leftArrowFadeOut=this._leftArrowFadeOut||h.fadeOut(this._leftArrowEl).then(function(){i._leftArrowEl.style.visibility="hidden"})}.bind(this)));(this._mouseInViewport||this._panningDisabled)&&t?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||h.fadeIn(this._rightArrowEl)):(t?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||y.timeout(c._animationTimeAdjustment(ft)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=y.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel();this._rightArrowFadeIn=null;this._rightArrowFadeOut=this._rightArrowFadeOut||h.fadeOut(this._rightArrowEl).then(function(){i._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(t){for(var i=t.target,r=-1;i;)r++,i=i.previousSibling;this._fireEvent(n._EventName.invoked,{index:r,navbarCommand:t.target.winControl,data:this._repeater?this._repeater.data.getAt(r):null})},_navbarCommandSplitToggleHandler:function(t){for(var i,r=t.target,u=-1;r;)u++,r=r.previousSibling;i=t.target.winControl;this._closeSplitIfOpen();i.splitOpened&&(this._currentSplitNavItem=i);this._fireEvent(n._EventName.splitToggle,{opened:i.splitOpened,index:u,navbarCommand:i,data:this._repeater?this._repeater.data.getAt(u):null})},_fireEvent:function(n,i){var r=t.document.createEvent("CustomEvent");r.initCustomEvent(n,!0,!1,i);this.element.dispatchEvent(r)},_writeProfilerMark:function(n){var t="WinJS.UI.NavBarContainer:"+this._id+":"+n;s(t);e.log&&e.log(t,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound)),v.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),b._resizeNotifier.unsubscribe(this._element,this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:rt.invoked,splitToggle:rt.splittoggle}});return i.Class.mix(n,w.DOMEventMixin),n})})});t("WinJS/Controls/NavBar",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";var l="custom";i.Namespace.define("WinJS.UI",{NavBar:i.Namespace._lazy(function(){var a="childrenprocessed",v=u._createEventProperty,h=i.Class.derive(c.AppBar,function(n,i){i=i||{};i=r._shallowCopy(i);i.placement=i.placement||"top";i.layout=l;c.AppBar.call(this,n,i);this._element.addEventListener("beforeshow",this._handleBeforeShow.bind(this));s.addClass(this.element,h._ClassName.navbar);t.Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():o.schedule(this._processChildren.bind(this),o.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{layout:{get:function(){return l},set:function(){Object.getOwnPropertyDescriptor(c.AppBar.prototype,"layout").set.call(this,l)}},onchildrenprocessed:v(a),_processChildren:function(){if(!this._processed){this._processed=!0;this._writeProfilerMark("processChildren,StartTM");var n=this,t=e.as();return this._processors&&this._processors.forEach(function(i){for(var r=0,u=n.element.children.length;u>r;r++)!function(n){t=t.then(function(){i(n)})}(n.element.children[r])}),t.then(function(){n._writeProfilerMark("processChildren,StopTM");n._fireEvent(h._EventName.childrenProcessed)},function(){n._writeProfilerMark("processChildren,StopTM");n._fireEvent(h._EventName.childrenProcessed)})}return e.wrap()},_show:function(){if(!this.disabled){var n=this;this._processChildren().then(function(){c.AppBar.prototype._show.call(n)})}},_handleBeforeShow:function(){if(!this._disposed)for(var t=this.element.querySelectorAll(".win-navbarcontainer"),n=0;n<t.length;n++)t[n].winControl.forceLayout()},_fireEvent:function(t,i){var r=n.document.createEvent("CustomEvent");r.initCustomEvent(t,!0,!1,i||{});this.element.dispatchEvent(r)},_writeProfilerMark:function(n){f("WinJS.UI.NavBar:"+this._id+":"+n)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:a},isDeclarativeControlContainer:r.markSupportedForProcessing(function(n,t){if(n._processed)for(var i=0,r=n.element.children.length;r>i;i++)t(n.element.children[i]);else n._processors=n._processors||[],n._processors.push(t)})});return h})})});t("WinJS/Controls/ViewBox",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s){"use strict";t.Namespace.define("WinJS.UI",{ViewBox:t.Namespace._lazy(function(){function c(n){if(n&&!n._resizing){n._resizing=n._resizing||0;n._resizing++;try{n._updateLayout()}finally{n._resizing--}}}function u(n){n.target&&c(n.target.winControl)}function h(n){n.target&&c(n.target.parentElement.winControl)}var a={get invalidViewBoxChildren(){return"ViewBox expects to only have one child element"}},l=t.Class.define(function(t){this._disposed=!1;this._element=t||n.document.createElement("div");var i=this.element;i.winControl=this;s.addClass(i,"win-disposable");s.addClass(i,"win-viewbox");this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===n.getComputedStyle(this.element).direction}},_initialize:function(){var n=this.element,t,e;if(n.firstElementChild!==this._sizer){if(i.validation&&1!==n.childElementCount)throw new r("WinJS.UI.ViewBox.InvalidChildren",a.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);t=n.firstElementChild;(this._sizer=t,t&&(s._resizeNotifier.subscribe(n,u),n.addEventListener("mselementresize",u),s._resizeNotifier.subscribe(t,h),t.addEventListener("mselementresize",h)),0===n.clientWidth&&0===n.clientHeight)&&(e=this,f.schedule(function(){e._updateLayout()},f.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout"))}},_updateLayout:function(){var n=this._sizer;if(n){var r=this.element,u=n.clientWidth,f=n.clientHeight,e=r.clientWidth,o=r.clientHeight,h=e/u,c=o/f,t=Math.min(h,c),l=Math.abs(e-u*t)/2,a=Math.abs(o-f*t)/2,s=this._rtl;this._sizer.style[i._browserStyleEquivalents.transform.scriptName]="translate("+(s?"-":"")+l+"px,"+a+"px) scale("+t+")";this._sizer.style[i._browserStyleEquivalents["transform-origin"].scriptName]=s?"top right":"top left"}},dispose:function(){this._disposed||(this.element&&s._resizeNotifier.unsubscribe(this.element,u),this._sizer&&s._resizeNotifier.unsubscribe(this._sizer,h),this._disposed=!0,o.disposeSubTree(this._element))},forceLayout:function(){this._initialize();this._updateLayout()}});return t.Class.mix(l,e.DOMEventMixin),l})})});t("WinJS/Controls/ContentDialog",["../Application","../Utilities/_Dispose","../Promise","../_Signal","../Core/_BaseUtils","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_Events","../Core/_ErrorFromName","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Animations","require-style!less/controls"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";o.Namespace.define("WinJS.UI",{ContentDialog:o.Namespace._lazy(function(){function ft(n){for(;n;){if(a.hasClass(n,"win-flyout"))return!0;n=n.parentNode}return!1}function ut(n){return i._cancelBlocker(n,function(){n.cancel()})}function tt(n){n.ensuredFocusedElementInView=!0;this.dialog._renderForInputPane(n.occludedRect.height)}function it(){this.dialog._clearInputPaneRendering()}function c(){}function k(n,t){n._interruptibleWorkPromises=n._interruptibleWorkPromises||[];var i=new r;n._interruptibleWorkPromises.push(t(n,i.promise));i.complete()}function d(){(this._interruptibleWorkPromises||[]).forEach(function(n){n.cancel()})}var w={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get controlDisposed(){return"Cannot interact with the control after it has been disposed"},get contentDialogAlreadyShowing(){return"Cannot show a ContentDialog if there is already a ContentDialog that is showing"}},b={none:"none",primary:"primary",secondary:"secondary"},v={contentDialog:"win-contentdialog",backgroundOverlay:"win-contentdialog-backgroundoverlay",dialog:"win-contentdialog-dialog",title:"win-contentdialog-title",content:"win-contentdialog-content",commands:"win-contentdialog-commands",primaryCommand:"win-contentdialog-primarycommand",secondaryCommand:"win-contentdialog-secondarycommand",_verticalAlignment:"win-contentdialog-verticalalignment",_scroller:"win-contentdialog-scroller",_column0or1:"win-contentdialog-column0or1",_visible:"win-contentdialog-visible",_tabStop:"win-contentdialog-tabstop",_commandSpacer:"win-contentdialog-commandspacer"},g={beforeShow:"beforeshow",afterShow:"aftershow",beforeHide:"beforehide",afterHide:"afterhide"},et=120,nt=new(o.Class.define(function(){this._dialogs=[];this._prevFocus=null},{willShow:function(n){var t=this._dialogs.length;this._pruneDialogsMissingFromDom();-1===this._dialogs.indexOf(n)&&this._dialogs.push(n);0===t&&1===this._dialogs.length&&this._firstDialogWillShow(n)},didHide:function(n){var i=this._dialogs.length,t;this._pruneDialogsMissingFromDom();t=this._dialogs.indexOf(n);-1!==t&&this._dialogs.splice(t,1);i>0&&0===this._dialogs.length&&this._lastDialogDidHide()},aDialogIsShowing:function(){return this._dialogs.some(function(n){return!n.hidden})},_pruneDialogsMissingFromDom:function(){this._dialogs=this._dialogs.filter(function(n){return!f.document.body.contains(n.element)})},_firstDialogWillShow:function(){this._prevFocus=f.document.activeElement},_lastDialogDidHide:function(){var n=this._prevFocus;this._prevFocus=null;n&&n.focus()}})),p={Init:o.Class.define(null,{name:"Init",hidden:!0,enter:function(){this.dialog._dismissedSignal=new r;this.dialog._setState(p.Hidden,!1)},exit:c,show:function(){throw"It's illegal to call show on the Init state";},hide:c,onCommandClicked:c,onInputPaneShown:c,onInputPaneHidden:c}),Hidden:o.Class.define(null,{name:"Hidden",hidden:!0,enter:function(n){n?this.show():nt.didHide(this.dialog)},exit:c,show:function(){if(nt.aDialogIsShowing())return i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing));var n=this.dialog._dismissedSignal.promise;return this.dialog._setState(p.BeforeShow),n},hide:c,onCommandClicked:c,onInputPaneShown:c,onInputPaneHidden:c}),BeforeShow:o.Class.define(null,{name:"BeforeShow",hidden:!0,enter:function(){k(this,function(n,t){return t.then(function(){return n.dialog._fireBeforeShow()}).then(function(t){return t||n.dialog._cancelDismissalPromise(),t}).then(function(t){t?n.dialog._setState(p.Showing):n.dialog._setState(p.Hidden,!1)})})},exit:d,show:function(){return i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing))},hide:c,onCommandClicked:c,onInputPaneShown:c,onInputPaneHidden:c}),Showing:o.Class.define(null,{name:"Showing",hidden:{get:function(){return!!this._pendingHide}},enter:function(){k(this,function(n,t){return t.then(function(){if(n._pendingHide=null,a.addClass(n.dialog._dom.root,v._visible),n.dialog._addExternalListeners(),e.Windows.UI.ViewManagement.InputPane){var t=e.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height;t>0&&n.dialog._renderForInputPane(t)}return nt.willShow(n.dialog),n.dialog._focusInitialElement(),n.dialog._playEntranceAnimation()}).then(function(){n.dialog._fireEvent(g.afterShow)}).then(function(){n.dialog._setState(p.Shown,n._pendingHide)})})},exit:d,show:function(){if(this._pendingHide){var n=this._pendingHide.reason;return this._pendingHide=null,this.dialog._resetDismissalPromise(n).promise}return i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing))},hide:function(n){this._pendingHide={reason:n}},onCommandClicked:c,onInputPaneShown:tt,onInputPaneHidden:it}),Shown:o.Class.define(null,{name:"Shown",hidden:!1,enter:function(n){n&&this.hide(n.reason)},exit:c,show:function(){return i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing))},hide:function(n){this.dialog._setState(p.BeforeHide,n)},onCommandClicked:function(n){this.hide(n)},onInputPaneShown:tt,onInputPaneHidden:it}),BeforeHide:o.Class.define(null,{name:"BeforeHide",hidden:!1,enter:function(n){k(this,function(t,i){return i.then(function(){return t.dialog._fireBeforeHide(n)}).then(function(i){i?t.dialog._setState(p.Hiding,n):t.dialog._setState(p.Shown,null)})})},exit:d,show:function(){return i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing))},hide:c,onCommandClicked:c,onInputPaneShown:tt,onInputPaneHidden:it}),Hiding:o.Class.define(null,{name:"Hiding",hidden:{get:function(){return!this._showIsPending}},enter:function(n){k(this,function(t,i){return i.then(function(){t._showIsPending=!1;t.dialog._resetDismissalPromise(n)}).then(function(){return t.dialog._playExitAnimation()}).then(function(){t.dialog._removeExternalListeners();a.removeClass(t.dialog._dom.root,v._visible);t.dialog._clearInputPaneRendering();t.dialog._fireAfterHide(n)}).then(function(){t.dialog._setState(p.Hidden,t._showIsPending)})})},exit:d,show:function(){return this._showIsPending?i.wrapError(new h("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",w.contentDialogAlreadyShowing)):(this._showIsPending=!0,this.dialog._dismissedSignal.promise)},hide:function(n){this._showIsPending&&(this._showIsPending=!1,this.dialog._resetDismissalPromise(n))},onCommandClicked:c,onInputPaneShown:c,onInputPaneHidden:c}),Disposed:o.Class.define(null,{name:"Disposed",hidden:!0,enter:function(){nt.didHide(this.dialog);this.dialog._removeExternalListeners();this.dialog._dismissedSignal.error(new h("WinJS.UI.ContentDialog.ControlDisposed",w.controlDisposed))},exit:c,show:function(){return i.wrapError(new h("WinJS.UI.ContentDialog.ControlDisposed",w.controlDisposed))},hide:c,onCommandClicked:c,onInputPaneShown:c,onInputPaneHidden:c})},rt=o.Class.define(function(n,t){if(n&&n.winControl)throw new h("WinJS.UI.ContentDialog.DuplicateConstruction",w.duplicateConstruction);t=t||{};this._onBackClickBound=this._onBackClick.bind(this);this._onInputPaneShownBound=this._onInputPaneShown.bind(this);this._onInputPaneHiddenBound=this._onInputPaneHidden.bind(this);this._onFocusInBound=this._onFocusIn.bind(this);this._onKeyDownBound=this._onKeyDown.bind(this);this._disposed=!1;this._resizedForInputPane=!1;this._currentFocus=null;this._initializeDom(n||f.document.createElement("div"));this._setState(p.Init);this.title="";this.primaryCommandText="";this.primaryCommandDisabled=!1;this.secondaryCommandText="";this.secondaryCommandDisabled=!1;l.setOptions(this,t)},{element:{get:function(){return this._dom.root}},title:{get:function(){return this._title},set:function(n){n=n||"";this._title!==n&&(this._title=n,this._dom.title.textContent=n,this._dom.title.style.display=n?"":"none")}},primaryCommandText:{get:function(){return this._primaryCommandText},set:function(n){n=n||"";this._primaryCommandText!==n&&(this._primaryCommandText=n,this._dom.commands[0].textContent=n,this._updateCommandsUI())}},secondaryCommandText:{get:function(){return this._secondaryCommandText},set:function(n){n=n||"";this._secondaryCommandText!==n&&(this._secondaryCommandText=n,this._dom.commands[1].textContent=n,this._updateCommandsUI())}},primaryCommandDisabled:{get:function(){return this._primaryCommandDisabled},set:function(n){n=!!n;this._primaryCommandDisabled!==n&&(this._primaryCommandDisabled=n,this._dom.commands[0].disabled=n)}},secondaryCommandDisabled:{get:function(){return this._secondaryCommandDisabled},set:function(n){n=!!n;this._secondaryCommandDisabled!==n&&(this._secondaryCommandDisabled=n,this._dom.commands[1].disabled=n)}},hidden:{get:function(){return this._state.hidden}},dispose:function(){this._disposed||(this._setState(p.Disposed),this._disposed=!0,t._disposeElement(this._dom.content))},show:function(){return this._state.show()},hide:function(n){this._state.hide(void 0===n?b.none:n)},_initializeDom:function(n){var i=f.document.createElement("div"),t;i.className=v.content;a._reparentChildren(n,i);n.winControl=this;n.className=v.contentDialog+" "+v._verticalAlignment+" win-disposable";n.innerHTML='<div class="'+v.backgroundOverlay+'"><\/div><div class="'+v._tabStop+'"><\/div><div tabindex="-1" role="dialog" class="'+v.dialog+'"><div class="'+v.title+'"><\/div><div class="'+v._scroller+'"><\/div><div class="'+v.commands+'"><button class="'+v._commandSpacer+'"><\/button><button class="'+v.primaryCommand+'"><\/button><button class="'+v.secondaryCommand+'"><\/button><\/div><\/div><div class="'+v._tabStop+'"><\/div><div class="'+v._column0or1+'"><\/div>';t={};t.root=n;t.backgroundOverlay=t.root.firstElementChild;t.startBodyTab=t.backgroundOverlay.nextElementSibling;t.dialog=t.startBodyTab.nextElementSibling;t.title=t.dialog.firstElementChild;t.scroller=t.title.nextElementSibling;t.commandContainer=t.scroller.nextElementSibling;t.commandSpacer=t.commandContainer.firstElementChild;t.commands=[];t.commands.push(t.commandSpacer.nextElementSibling);t.commands.push(t.commands[0].nextElementSibling);t.endBodyTab=t.dialog.nextElementSibling;t.content=i;this._dom=t;t.scroller.appendChild(t.content);a._ensureId(t.title);t.dialog.setAttribute("aria-labelledby",t.title.id);this._updateTabIndices();a._addEventListener(t.root,"pointerdown",this._onPointerDown.bind(this));a._addEventListener(t.root,"pointerup",this._onPointerUp.bind(this));t.root.addEventListener("click",this._onClick.bind(this));a._addEventListener(t.startBodyTab,"focusin",this._onStartBodyTabFocusIn.bind(this));a._addEventListener(t.endBodyTab,"focusin",this._onEndBodyTabFocusIn.bind(this));t.commands[0].addEventListener("click",this._onCommandClicked.bind(this,b.primary));t.commands[1].addEventListener("click",this._onCommandClicked.bind(this,b.secondary))},_updateCommandsUI:function(){this._dom.commands[0].style.display=this.primaryCommandText?"":"none";this._dom.commands[1].style.display=this.secondaryCommandText?"":"none";this._dom.commandSpacer.style.display=this.primaryCommandText&&!this.secondaryCommandText||!this.primaryCommandText&&this.secondaryCommandText?"":"none"},_updateTabIndices:function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=u._throttledFunction(100,this._updateTabIndicesImpl.bind(this)));this._updateTabIndicesThrottled()},_updateTabIndicesImpl:function(){var n=a._getHighAndLowTabIndices(this._dom.content);this._dom.startBodyTab.tabIndex=n.lowest;this._dom.commands[0].tabIndex=n.highest;this._dom.commands[1].tabIndex=n.highest;this._dom.endBodyTab.tabIndex=n.highest},_elementInDialog:function(n){return this._dom.dialog.contains(n)||n===this._dom.startBodyTab||n===this._dom.endBodyTab},_retakeFocus:function(){this._currentFocus&&this._elementInDialog(this._currentFocus)&&a._tryFocus(this._currentFocus)||this._focusInitialElement()},_isTopLevel:{get:function(){return!ft(f.document.activeElement)}},_onCommandClicked:function(n){this._state.onCommandClicked(n)},_onPointerDown:function(n){n.stopPropagation();this._elementInDialog(n.target)||n.preventDefault()},_onPointerUp:function(n){n.stopPropagation();this._elementInDialog(n.target)||n.preventDefault()},_onClick:function(n){n.stopPropagation();this._elementInDialog(n.target)||n.preventDefault()},_onFocusIn:function(n){n=n.detail.originalEvent;this._isTopLevel&&(this._elementInDialog(n.target)?this._currentFocus=n.target:this._retakeFocus())},_onKeyDown:function(n){n=n.detail.originalEvent;this._isTopLevel&&(n.keyCode===a.Key.tab?this._updateTabIndices():n.keyCode===a.Key.escape?(this.hide(b.none),n.preventDefault(),n.stopPropagation()):this._elementInDialog(f.document.activeElement)||(n.preventDefault(),n.stopPropagation()))},_onBackClick:function(n){this._isTopLevel&&(this.hide(b.none),n.preventDefault())},_onStartBodyTabFocusIn:function(){a._focusLastFocusableElement(this._dom.dialog)},_onEndBodyTabFocusIn:function(){a._focusFirstFocusableElement(this._dom.dialog)},_onInputPaneShown:function(n){this._state.onInputPaneShown(n.detail.originalEvent)},_onInputPaneHidden:function(){this._state.onInputPaneHidden()},_setState:function(n,t){this._disposed||(this._state&&this._state.exit(),this._state=new n,this._state.dialog=this,this._state.enter(t))},_resetDismissalPromise:function(n){var t=this._dismissedSignal,i=this._dismissedSignal=new r;return t.complete({reason:n}),i},_cancelDismissalPromise:function(){var n=this._dismissedSignal,t=this._dismissedSignal=new r;return n.cancel(),t},_fireEvent:function(n,t){t=t||{};var r=t.detail||null,u=!!t.cancelable,i=f.document.createEvent("CustomEvent");return i.initCustomEvent(n,!0,u,r),this._dom.root.dispatchEvent(i)},_fireBeforeShow:function(){return this._fireEvent(g.beforeShow,{cancelable:!0})},_fireBeforeHide:function(n){return this._fireEvent(g.beforeHide,{detail:{reason:n},cancelable:!0})},_fireAfterHide:function(n){this._fireEvent(g.afterHide,{detail:{reason:n}})},_playEntranceAnimation:function(){return ut(y.fadeIn(this._dom.root))},_playExitAnimation:function(){return ut(y.fadeOut(this._dom.root))},_addExternalListeners:function(){a._inputPaneListener.addEventListener(this._dom.root,"showing",this._onInputPaneShownBound);a._inputPaneListener.addEventListener(this._dom.root,"hiding",this._onInputPaneShownBound);a._documentElementListener.addEventListener(this._dom.root,"keydown",this._onKeyDownBound,!0);a._documentElementListener.addEventListener(this._dom.root,"focusin",this._onFocusInBound);n._applicationListener.addEventListener(this._dom.root,"backclick",this._onBackClickBound)},_removeExternalListeners:function(){a._inputPaneListener.removeEventListener(this._dom.root,"showing",this._onInputPaneShownBound);a._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._onInputPaneShownBound);a._documentElementListener.removeEventListener(this._dom.root,"keydown",this._onKeyDownBound,!0);a._documentElementListener.removeEventListener(this._dom.root,"focusin",this._onFocusInBound);n._applicationListener.removeEventListener(this._dom.root,"backclick",this._onBackClickBound)},_renderForInputPane:function(n){var r;this._clearInputPaneRendering();var i=this._dom.dialog,t=i.style,h=i.offsetLeft,u=i.offsetTop,e=i.offsetHeight,o=u+e,s=this._dom.root.offsetHeight-n,c=a.getTotalHeight(this._dom.title),l=a.getTotalHeight(this._dom.commandContainer);o>s&&(r=e-(o-s),et>r-c-l&&this._dom.scroller.insertBefore(this._dom.title,this._dom.content),this._dom.root.style.display="block",t.height=r+"px",t.position="absolute",t.left=h+"px",t.top=u+"px",t.minHeight=0,this._resizedForInputPane=!0,f.document.activeElement.focus())},_clearInputPaneRendering:function(){if(this._resizedForInputPane){this._dom.title.parentNode!==this._dom.dialog&&this._dom.dialog.insertBefore(this._dom.title,this._dom.scroller);var n=this._dom.dialog.style;this._dom.root.style.display="";n.height="";n.position="";n.left="";n.top="";n.minHeight="";this._resizedForInputPane=!1}},_focusInitialElement:function(){a._focusFirstFocusableElement(this._dom.content)||this._dom.dialog.focus()}},{DismissalReason:b,_ClassNames:v});return o.Class.mix(rt,s.createEventProperties("beforeshow","aftershow","beforehide","afterhide")),o.Class.mix(rt,l.DOMEventMixin),rt})})});t("WinJS",["WinJS/Core/_WinJS","WinJS/Core","WinJS/Promise","WinJS/_Signal","WinJS/Scheduler","WinJS/Utilities","WinJS/Fragments","WinJS/Application","WinJS/Navigation","WinJS/Animations","WinJS/Binding","WinJS/BindingTemplate","WinJS/BindingList","WinJS/Res","WinJS/Pages","WinJS/ControlProcessor","WinJS/Controls/HtmlControl","WinJS/VirtualizedDataSource","WinJS/Controls/IntrinsicControls","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/AppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox","WinJS/Controls/ContentDialog","WinJS/Controls/Toolbar"],function(n){"use strict";return n});i(["WinJS/Core/_WinJS","WinJS"],function(t){return n.WinJS=t,t})})}(this);
/*
//# sourceMappingURL=WinJS.min.js.map
*/